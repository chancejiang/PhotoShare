{"_id":"_design/photoshare","vendor":{"phonegap":{},"zepto":{}},"filters":{"thumbnail":"function(doc, req) {\n  if(doc.type == \"thumbnail\") {\n    return true;\n  } else {\n    return false;\n  }\n}"},"language":"javascript","views":{"photo_and_comments":{"map":"function(doc) {\n  if(doc.type == 'photo')\n    emit([doc._id, 0], doc);\n  else if(doc.type == 'comment')\n    emit([doc.photo, 1], doc);\n};"},"thumbnails":{"map":"function(doc) {\n  if(doc.type == \"thumbnail\") {\n    emit(doc._id, doc);\n  }\n}"},"photos":{"map":"function(doc) {\n  if(doc.type == \"photo\" || doc._attachments && doc._attachments['original.jpg'])\n    emit(doc._id, doc);\n}"}},"README":"## Generated CouchApp\n\nThis is meant to be an example CouchApp and to ship with most of the CouchApp goodies.\n\nClone with git:\n\n    git clone git://github.com/couchapp/example.git\n    cd example\n\nInstall with \n    \n    couchapp push . http://localhost:5984/example\n\nor (if you have security turned on)\n\n    couchapp push . http://adminname:adminpass@localhost:5984/example\n  \nYou can also create this app by running\n\n    couchapp generate example && cd example\n    couchapp push . http://localhost:5984/example\n\nDeprecated: *couchapp generate proto && cd proto*\n\n\n## Todo\n\n* factor CouchApp Commonjs to jquery.couch.require.js\n* use $.couch.app in app.js\n\n## License\n\nApache 2.0","couchapp":{"manifest":["couchapp.json","filters/","filters/thumbnail.js","language","README.md","vendor/","vendor/phonegap/","vendor/zepto/","views/","views/photo_and_comments/","views/photo_and_comments/map.js","views/photos/","views/photos/map.js","views/thumbnails/","views/thumbnails/map.js"],"signatures":{"style/photoshare.css":"d8656de8e07ad551a6f351732a45e758","index.html":"ed4cc04736daac48839ea2a865809932","script/capture.js":"0c1b2a6ec76667963a6484f86dae30c0","script/.capture.js.swp":"31beb2588a6f8e3927ae04ebbd65da07","vendor/zepto/zepto.min.js":"13a2dd4addf1cd5036d48780868e25d7","vendor/phonegap/phonegap-1.0.0.js":"538bf1c6197e199483f6bf4d9c9868bb","vendor/zepto/zepto.js":"a321f0a42b6237205a89b1f4254e6207","script/couchdbplugin.js":"664ead06ac914a7ac80430ecd40a001f"},"description":"Photo sharing application","objects":{},"name":"PhotoShare"},"_attachments":{"style/photoshare.css":{"content_type":"text/css","revpos":6,"data":"I3N5bmNwb2ludCB7CiAgcGFkZGluZzogMWVtOwp9CmJ1dHRvbiB7CiAgaGVpZ2h0OiA0MnB4OwogIHBhZGRpbmc6IDAgOHB4OwogIGNvbG9yOiAjMTUxYjI0OwogIGxpbmUtaGVpZ2h0OiA0MnB4OwogIHRleHQtc2hhZG93OiAjZmZmIDBweCAxcHggMXB4OwogIC13ZWJraXQtYm9yZGVyLXJhZGl1czogMTZweDsKICBib3JkZXI6IDFweCBzb2xpZCAjMzEzNjNkOwogIGJhY2tncm91bmQ6IC13ZWJraXQtZ3JhZGllbnQobGluZWFyLCBsZWZ0IHRvcCwgbGVmdCBib3R0b20sIGZyb20oI2NiY2ZkNCksIHRvKCM5MzliYTYpKTsKICAtd2Via2l0LWJhY2tncm91bmQtY2xpcDogcGFkZGluZy1ib3g7Cn0KI3Bob3RvdmlldyB7CiAgLXdlYmtpdC10cmFuc2l0aW9uLWR1cmF0aW9uOiAxczsKICAtd2Via2l0LXRyYW5zZm9ybTogdHJhbnNsYXRlKDEwMCUsIDApOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBtYXJnaW4tbGVmdDogYXV0bzsKICBtYXJnaW4tcmlnaHQ6IGF1dG87CiAgdG9wOjA7bGVmdDowO3JpZ2h0OjA7Ym90dG9tOjA7YmFja2dyb3VuZDpyZ2JhKDI1NSwyNTUsMjU1LDEpOwp9CgoudGh1bWJuYWlsIHsKICB3aWR0aDogIjYwcHgiOwogIGZsb2F0OiAibGVmdCI7CiAgcGFkZGluZzogIjJweCI7Cn0KCiNjb21tZW50LWZvcm0gewogIGNvbG9yOiBibGFjazsKfQojY29tbWVudC1mb3JtICogewogIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7Cn0KCiNjb21tZW50LWF1dGhvciB7CiAgd2lkdGg6IDUwcHg7Cn0KCi5hdXRob3IgewogIGZvbnQtd2VpZ2h0OiBib2xkOwp9Cg=="},"index.html":{"content_type":"text/html","revpos":6,"data":"PCFET0NUWVBFIEhUTUw+CjxodG1sPgogIDxoZWFkPgogICAgPHRpdGxlPlBob25lR2FwPC90aXRsZT4KICAgIDxsaW5rIGhyZWY9InN0eWxlL3Bob3Rvc2hhcmUuY3NzIiB0eXBlPSJ0ZXh0L2NzcyIgcmVsPSJzdHlsZXNoZWV0IiAvPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9InVzZXItc2NhbGFibGU9bm8sIHdpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLCBtYXhpbXVtLXNjYWxlPTEiIC8+CiAgPC9oZWFkPgogIDxib2R5IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsiPgogICAgPCEtLSBtYWluIC0tPgogICAgPGRpdiBpZD0ibWFpbiI+CiAgICAgIDxoMT5XZWxjb21lIHRvIFBob3RvU2hhcmU8L2gxPgogICAgICA8aDI+PHN0cm9uZz5kZW1vOjwvc3Ryb25nPiBBbGwgUGhvdG9zIGFyZSBQdWJsaWM8L2gyPgogICAgICA8ZGl2IGlkPSJzeW5jcG9pbnQiPjwvZGl2PgogICAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgY2hhcnNldD0idXRmLTgiIHNyYz0idmVuZG9yL3Bob25lZ2FwL3Bob25lZ2FwLTEuMC4wLmpzIj48L3NjcmlwdD4KICAgICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIGNoYXJzZXQ9InV0Zi04IiBzcmM9InZlbmRvci96ZXB0by96ZXB0by5taW4uanMiPjwvc2NyaXB0PgogICAgICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgY2hhcnNldD0idXRmLTgiIHNyYz0ic2NyaXB0L2NvdWNoZGJwbHVnaW4uanMiPjwvc2NyaXB0PgogICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgaWQ9ImNhcHR1cmVQaG90byIKICAgICAgICAgICAgICBvbmNsaWNrPSJjYXB0dXJlUGhvdG8oKTsiIGRpc2FibGVkPSJkaXNhYmxlZCI+CiAgICAgICAgVGFrZSBhIHBpY3R1cmUhCiAgICAgIDwvYnV0dG9uPgogICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgaWQ9InJlbG9hZFBhZ2UiCiAgICAgICAgICAgICAgb25jbGljaz0id2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOyI+CiAgICAgICAgUmVsb2FkIFBhZ2UKICAgICAgPC9idXR0b24+CiAgICAgIDxociAvPgogICAgICA8ZGl2IGlkPSJtZXNzYWdlIj48L2Rpdj4KICAgICAgPGgzPlBpY3R1cmVzIGluIENvdWNoYmFzZTwvaDM+CiAgICAgIDxkaXYgaWQ9InBpY3R1cmVzIj48L2Rpdj4KICAgIDwvZGl2PgogICAgPCEtLSBlbmQgbWFpbiAtLT4KICAgIDxkaXYgaWQ9InBob3RvdmlldyIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+CiAgICAgIDxpbWcgaWQ9InBob3Rvdmlldy1pbWFnZSIgc3JjPSJodHRwOi8vd3d3LnBob25lZ2FwLmNvbS9hc3NldHMvY2Fyb3VzZWwvZHc1XzQuanBnIiBhbHQ9IiIgLz4KICAgICAgPGRpdiBpZD0iY29tbWVudHMiPgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBpZD0iY29tbWVudC1mb3JtIj4KICAgICAgICA8bGFiZWwgZm9yPSJjb21tZW50LWF1dGhvciI+QXV0aG9yPC9sYWJlbD4KICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImNvbW1lbnQtYXV0aG9yIiB2YWx1ZT0iQXV0aG9yIiAvPgogICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iY29tbWVudC10ZXh0IiB2YWx1ZT0iUHV0IHlvdXIgY29tbWVudCBoZXJlLi4uIiAvPgogICAgICAgIDxidXR0b24gaWQ9InNlbmQtY29tbWVudCI+U2VuZCBjb21tZW50ITwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIGNoYXJzZXQ9InV0Zi04IiBzcmM9InNjcmlwdC9jYXB0dXJlLmpzIj48L3NjcmlwdD4KICA8L2JvZHk+CjwvaHRtbD4K"},"script/capture.js":{"content_type":"application/javascript","revpos":7,"data":"Ly8gVXNlIFBob25lR2FwIHBvbGxpbmcgYmVjYXVzZSBvZiBjcm9zcy1vcmlnaW4mc3BlZWQgcHJvYmxlbSB3aGVuIGxvYWRpbmcgZnJvbSBjb3VjaERCClBob25lR2FwLlVzZVBvbGxpbmcgPSB0cnVlOwoKdmFyIHNlbGVjdGVkUGljdHVyZUlkID0gbnVsbDsKCi8vIEhlbHBlciBNZXRob2RzCgpmdW5jdGlvbiBhZGRJbWFnZShpbWFnZUlkKSB7CiAgICB2YXIgbmV3SW1nID0gJCgiPGltZz48L2ltZz4iKQogICAgICAgICAgICAgICAgIC5hZGRDbGFzcygndGh1bWJuYWlsJykKICAgICAgICAgICAgICAgICAuY3NzKCdmbG9hdCcsICdsZWZ0JykKICAgICAgICAgICAgICAgICAuY3NzKCdwYWRkaW5nJywgJzJweCcpCiAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAuYXR0cih7aWQ6IGltYWdlSWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHNyYzogJy9waG90b3NoYXJlLycraW1hZ2VJZCsnL3RodW1ibmFpbC5qcGcnCiAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICBuZXdJbWcuY2xpY2sob25JbWFnZUNsaWNrKTsKICAgICQoJyNwaWN0dXJlcycpLnByZXBlbmQobmV3SW1nKTsKfQoKZnVuY3Rpb24gYWRkQ29tbWVudChjb21tZW50RG9jKSB7CiAgJCgnI2NvbW1lbnRzJykucHJlcGVuZCgnPHNwYW4+Jytjb21tZW50RG9jLmNvbW1lbnQrJzwvc3Bhbj48YnIvPicpCiAgICAgICAgICAgICAgICAucHJlcGVuZCgnPHNwYW4gY2xhc3M9ImF1dGhvciI+Jytjb21tZW50RG9jLmF1dGhvcisnIHdyb3RlOjwvc3Bhbj4gJyk7Cn0KCmZ1bmN0aW9uIGNsZWFyUGhvdG9WaWV3KCkgewogICQoJyNjb21tZW50cycpLmh0bWwoJycpOwogICQoJyNwaG90b3ZpZXctaW1hZ2UnKS5hdHRyKCdzcmMnLCAnJyk7Cn0KCmZ1bmN0aW9uIHRvZ2dsZUJ1dHRvbigpIHsKICB2YXIgY2FwdHVyZSA9ICQoJyNjYXB0dXJlUGhvdG8nKTsKICBpZihjYXB0dXJlLmF0dHIoJ2Rpc2FibGVkJykpIHsKICAgIGNhcHR1cmUucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsKICB9IGVsc2UgewogICAgY2FwdHVyZS5hdHRyKCdkaXNhYmxlZCcsIHRydWUpOwogIH0KfQoKZnVuY3Rpb24gc2V0TWVzc2FnZShtZXNzYWdlKSB7CiAgJCgnI21lc3NhZ2UnKS5odG1sKG1lc3NhZ2UpOwp9CgovLyBTeW5jcG9pbnQKCmZ1bmN0aW9uIHNldHVwU3luYygpIHsKICAgIHZhciBzeW5jcG9pbnQgPSAiaHR0cDovL2NvdWNoYmFzZS5pYy5odC9waG90b3NoYXJlIjsKICAgICQuYWpheCh7CiAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgdXJsOiAnL19yZXBsaWNhdGUnLAogICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICBzb3VyY2UgOiBzeW5jcG9pbnQsCiAgICAgICAgICB0YXJnZXQgOiAicGhvdG9zaGFyZSIKICAgICAgfSksCiAgICAgIGRhdGFUeXBlOiAnanNvbicsCiAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicKICAgIH0pOwogICAgJC5hamF4KHsKICAgICAgdHlwZTogJ1BPU1QnLAogICAgICB1cmw6ICcvX3JlcGxpY2F0ZScsCiAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgIHRhcmdldCA6IHN5bmNwb2ludCwKICAgICAgICAgIHNvdXJjZSA6ICJwaG90b3NoYXJlIgogICAgICB9KSwKICAgICAgZGF0YVR5cGU6ICdqc29uJywKICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJwogICAgfSk7Cn0KCi8vIENhcHR1cmUKCmZ1bmN0aW9uIG9uQ2FwdHVyZVN1Y2Nlc3MoaW1hZ2VEYXRhKSB7CiAgY29uc29sZS5sb2coIm9uQ2FwdHVyZVN1Y2Nlc3MiKTsKICB2YXIgb25TYXZlU3VjY2VzcyA9IGZ1bmN0aW9uKGltYWdlRG9jKSB7CiAgICBhZGRJbWFnZShpbWFnZURvYy5pZCk7CiAgICBzZXRNZXNzYWdlKCcnKTsKICB9OwogIHZhciBvblNhdmVGYWlsdXJlID0gZnVuY3Rpb24oeGhyLCB0eXBlKSB7CiAgICBhbGVydCgib25TYXZlRmFpbHVyZSAiK3R5cGUgKyAnICcgKyB4aHIucmVzcG9uc2VUZXh0KTsKICB9OwogIHNldE1lc3NhZ2UoJ1NhdmluZyBpbWFnZS4uLicpOwogIHZhciBpbWFnZURvYyA9IHsKICAgIHR5cGU6ICJwaG90byIsCiAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLAogICAgX2F0dGFjaG1lbnRzOiB7CiAgICAgICJvcmlnaW5hbC5qcGciOiB7CiAgICAgICAgY29udGVudF90eXBlOiAiaW1hZ2UvanBlZyIsCiAgICAgICAgZGF0YTogaW1hZ2VEYXRhCiAgICAgIH0KICB9fTsKICAkLmFqYXgoewogICAgdHlwZTogJ1BPU1QnLAogICAgdXJsOiAnL3Bob3Rvc2hhcmUnLAogICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoaW1hZ2VEb2MpLAogICAgZGF0YVR5cGU6ICdqc29uJywKICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsCiAgICBzdWNjZXNzOiBvblNhdmVTdWNjZXNzLAogICAgZXJyb3I6IG9uU2F2ZUZhaWx1cmUKICB9KTsKfQoKZnVuY3Rpb24gb25DYXB0dXJlRmFpbHVyZShtZXNzYWdlKSB7CiAgYWxlcnQoJ29uQ2FwdHVyZUZhaWx1cmUgJyArIG1lc3NhZ2UpOwp9CgpmdW5jdGlvbiBjYXB0dXJlUGhvdG8oKSB7CiAgY29uc29sZS5sb2coImNhcHR1cmVQaG90byIpOwogIG5hdmlnYXRvci5jYW1lcmEuZ2V0UGljdHVyZShvbkNhcHR1cmVTdWNjZXNzLCBvbkNhcHR1cmVGYWlsdXJlLCB7IHF1YWxpdHk6IDEwIH0pOwp9CgoKCnZhciBzaW5jZSA9IDA7CmZ1bmN0aW9uIGNoYW5nZXNDYWxsYmFjayhvcHRzKSB7CiAgc2luY2UgPSBvcHRzLmxhc3Rfc2VxIHx8IHNpbmNlOwogIG9uREJDaGFuZ2Uob3B0cyk7CiAgJC5hamF4KHsKICAgIHR5cGU6ICdHRVQnLAogICAgdXJsOiAnL3Bob3Rvc2hhcmUvX2NoYW5nZXM/ZmVlZD1sb25ncG9sbCZmaWx0ZXI9cGhvdG9zaGFyZS90aHVtYm5haWwmc2luY2U9JytzaW5jZSwKICAgIGRhdGFUeXBlOiAnanNvbicsCiAgICBzdWNjZXNzOiBjaGFuZ2VzQ2FsbGJhY2ssCiAgICBlcnJvcjogZnVuY3Rpb24oKSB7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS5sb2coImVycm9yIGNoYW5nZXMiKTsKICAgICAgICBjb25zb2xlLmxvZyhvcHRzKTsKICAgICAgICBjaGFuZ2VzQ2FsbGJhY2soe2xhc3Rfc2VxIDogc2luY2V9KTsKICAgICAgfSwgMjUwKQogICAgfQogIH0pOwp9CgoKZnVuY3Rpb24gc2V0dXBDaGFuZ2VzKCkgewogIGNoYW5nZXNDYWxsYmFjayh7bGFzdF9zZXEgOiAwfSk7Cn0KCmZ1bmN0aW9uIG9uREJDaGFuZ2Uob3B0cykgewogIC8vIGFwcGVuZCBuZXcgcGljdHVyZXMgdG8gdGhlIHZpZXcgd2l0aG91dCBkaXN0dXJiaW5nIG9sZCBvbmVzCiAgbGlzdFBpY3R1cmVzKG9wdHMpOwp9CgpmdW5jdGlvbiBsaXN0UGljdHVyZXMoZGF0YSkgewogIGlmIChkYXRhLnJlc3VsdHMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5yZXN1bHRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmKCFkYXRhLnJlc3VsdHNbaV0uZGVsZXRlZCkgewogICAgICAgIGFkZEltYWdlKGRhdGEucmVzdWx0c1tpXS5pZCk7CiAgICAgIH0KICAgIH0KICB9Cn0KCmZ1bmN0aW9uIHNlbmRDb21tZW50KCkgewogICAgdmFyIGNvbW1lbnREb2MgPSB7CiAgICAgICJ0eXBlIjogImNvbW1lbnQiLAogICAgICAicGhvdG8iOiBzZWxlY3RlZFBpY3R1cmVJZCwKICAgICAgImF1dGhvciI6ICQoJyNjb21tZW50LWF1dGhvcicpLnZhbCgpLAogICAgICAiY29tbWVudCI6ICQoJyNjb21tZW50LXRleHQnKS52YWwoKQogICAgfTsKCiAgICB2YXIgb25Db21tZW50U3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgIGFkZENvbW1lbnQoY29tbWVudERvYyk7CiAgICB9OwoKICAgIHZhciBvbkNvbW1lbnRGYWlsdXJlID0gZnVuY3Rpb24oeGhyLCB0eXBlKSB7CiAgICAgIGFsZXJ0KHR5cGUgKyAnICcgKyB4aHIucmVzcG9uc2VUZXh0KTsKICAgIH07CgogICAgQ291Y2hEYlBsdWdpbi5zYXZlKGNvbW1lbnREb2MsIG9uQ29tbWVudFN1Y2Nlc3MsIG9uQ29tbWVudEZhaWx1cmUpOwp9CgpmdW5jdGlvbiBvbkltYWdlQ2xpY2soKSB7CiAgLy8gRklYTUU6IG1heWJlIHVzZSBhIGhpZGRlbiBmaWVsZCBpbnN0ZWFkPwogIHNlbGVjdGVkUGljdHVyZUlkID0gdGhpcy5pZDsKICAkKCcjcGhvdG92aWV3LWltYWdlJykuYXR0cignc3JjJywgJy9waG90b3NoYXJlLycrdGhpcy5pZCsnL29yaWdpbmFsLmpwZycpLmNzcygnd2lkdGgnLCAnMTAwJScpOwogICQoJyNwaG90b3ZpZXcnKS5jc3MoIi13ZWJraXQtdHJhbnNmb3JtIiwidHJhbnNsYXRlKDAsMCkiKTsKCiAgdmFyIG9uRmV0Y2hTdWNjZXNzID0gZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSk7CiAgICBmb3IodmFyIGkgPSAwICwgaiA9IHJlc3BvbnNlLnJvd3MubGVuZ3RoIDsgaSA8IGogOyBpKyspIHsKICAgICAgYWRkQ29tbWVudChyZXNwb25zZS5yb3dzW2ldLnZhbHVlKTsKICAgIH0KICAgICQoJyNwaG90b3ZpZXcnKS5zaG93KCk7CiAgICAkKCcjbWFpbicpLmhpZGUoKTsKICAgICQoJyNzZW5kLWNvbW1lbnQnKS5jbGljayhzZW5kQ29tbWVudCk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdiYWNrYnV0dG9uJywgYmFja0tleURvd24sIHRydWUpOwogIH07CgogIHZhciBvbkZldGNoRmFpbHVyZSA9IGZ1bmN0aW9uKHhociwgdHlwZSkgewogICAgY29uc29sZS5sb2codHlwZSArICcgJyArIHhoci5yZXNwb25zZVRleHQpOwogIH0KICBjb25zb2xlLmxvZyhzZWxlY3RlZFBpY3R1cmVJZCk7CiAgJC5hamF4KHsKICAgdHlwZTogJ0dFVCcsCiAgIHVybDogJy9waG90b3NoYXJlL19kZXNpZ24vcGhvdG9zaGFyZS9fdmlldy9waG90b19hbmRfY29tbWVudHM/c3RhcnRrZXk9WyInK3NlbGVjdGVkUGljdHVyZUlkKyciLDFdJmVuZGtleT1bIicrc2VsZWN0ZWRQaWN0dXJlSWQrJyIsMV0nLAogICBkYXRhVHlwZTogJ2pzb24nLAogICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLAogICBzdWNjZXNzOiBvbkZldGNoU3VjY2VzcywKICAgZXJyb3I6IG9uRmV0Y2hGYWlsdXJlCiAgfSk7Cn0KCmZ1bmN0aW9uIGJhY2tLZXlEb3duKCkgewogIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JhY2tidXR0b24nLCBiYWNrS2V5RG93biwgdHJ1ZSk7CiAgJCgnI3NlbmQtY29tbWVudCcpLnVuYmluZCgnY2xpY2snKTsKICAkKCcjcGhvdG92aWV3JykuY3NzKCItd2Via2l0LXRyYW5zZm9ybSIsInRyYW5zbGF0ZSgxMDAlLDApIik7CiAgJCgnI3Bob3RvdmlldycpLmhpZGUoKTsKICBjbGVhclBob3RvVmlldygpOwogICQoJyNtYWluJykuc2hvdygpOwp9CgpmdW5jdGlvbiBzdGFydENhbWVyYSgpIHsKICB2YXIgY2FwdHVyZSA9ICQoJyNjYXB0dXJlUGhvdG8nKTsKICBjYXB0dXJlLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7Cn0KCgpmdW5jdGlvbiBzdGFydCgpIHsKICAgIC8vIHNldHVwIGxpc3Rpbmcgb2YgcGljdHVyZXMgYW5kIGF1dG8gcmVmcmVzaAogICAgc2V0dXBDaGFuZ2VzKCk7CiAgICBzZXR1cFN5bmMoKTsKfQoKdmFyIHN0YXJ0ZWQgPSBmYWxzZTsKZnVuY3Rpb24gc3RhcnRBcHAoKSB7CiAgICBpZiAoc3RhcnRlZCkgcmV0dXJuOwogICAgc3RhcnRlZCA9IHRydWU7CiAgICBzdGFydCgpOwp9OwoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiZGV2aWNlcmVhZHkiLCBzdGFydENhbWVyYSwgdHJ1ZSk7CiQoJ2JvZHknKS5yZWFkeShzdGFydEFwcCk7Cg=="},"script/.capture.js.swp":{"content_type":"","revpos":7,"data":"YjBWSU0gNy4zAAAAABAAAEg1WE4y22ACpkYBAGFrYWRyaQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABrcnlwdG9uaXRlLmxvY2FsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfmFrYWRyaS9Qcm9qZWN0cy9QaG90b1NoYXJlL2Fzc2V0cy9waG90b3NoYXJlL19hdHRhY2htZW50cy9zY3JpcHQvY2FwdHVyZS5qcwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AMzIxMAAAAAAjIiEgExJVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHRwAgB/AAAAAgAAAAAAAACTAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAADAAAAAAAAAFYAAAAAAAAAlAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABhZAAABwAAAG8CAAAAEAAAkwAAAAAAAACoDwAAjA8AAIsPAABtDwAAbA8AAFoPAABZDwAAPA8AABoPAADyDgAAyw4AAKMOAAB+DgAAWw4AAEcOAAAiDgAA3Q0AAMINAACiDQAAfg0AAHwNAAB7DQAAWQ0AABQNAAC9DAAAuwwAALoMAACeDAAAgwwAAFoMAABYDAAAVwwAAD0MAAAZDAAA+AsAANQLAADJCwAApQsAAKELAACfCwAAngsAAH8LAABgCwAAXgsAAF0LAABQCwAATwsAADgLAAD/CgAA8goAAN4KAADECgAApwoAAIkKAABpCgAAXwoAAEcKAAAhCgAAGQoAAAwKAAD4CQAA3gkAAMEJAACjCQAAgwkAAHkJAABhCQAAOwkAADMJAAAxCQAAMAkAACUJAAAkCQAA/QgAANoIAACvCAAAlAgAAIAIAAB7CAAATwgAABQIAAAPCAAA7gcAANsHAADIBwAArAcAAJgHAACABwAAXAcAAEQHAAA8BwAANgcAACsHAAAZBwAAAQcAAN0GAADHBgAAogYAAIYGAABtBgAAZwYAAGUGAABkBgAAPwYAABcGAAAVBgAAFAYAAPoFAADbBQAAhwUAAIUFAACEBQAAgwUAAIIFAABzBQAAUgUAADAFAAAcBQAAEQUAAAAFAACoBAAAkgQAAHQEAABcBAAAPgQAABgEAAD9AwAA0AMAAMIDAAC8AwAAtgMAALQDAACzAwAAsgMAAJgDAAB1AwAAcwMAAHIDAABWAwAAFQMAAP8CAAD9AgAA/AIAAN4CAADIAgAAlAIAAG8CAAB5AgAAAAAAAAAAACAgICAgIGlmKCFkYXRhLnJlc3VsdHNbaV0uZGVsZXRlZCkgewAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLnJlc3VsdHMubGVuZ3RoOyBpKyspIHsAICBpZiAoZGF0YS5yZXN1bHRzKSB7AGZ1bmN0aW9uIGxpc3RQaWN0dXJlcyhkYXRhKSB7AAB9ACAgbGlzdFBpY3R1cmVzKG9wdHMpOwAgIC8vIGFwcGVuZCBuZXcgcGljdHVyZXMgdG8gdGhlIHZpZXcgd2l0aG91dCBkaXN0dXJiaW5nIG9sZCBvbmVzAGZ1bmN0aW9uIG9uREJDaGFuZ2Uob3B0cykgewAAfQAgIGNoYW5nZXNDYWxsYmFjayh7bGFzdF9zZXEgOiAwfSk7AGZ1bmN0aW9uIHNldHVwQ2hhbmdlcygpIHsAAAB9ACAgfSk7ACAgICB9ACAgICAgIH0sIDI1MCkAICAgICAgICBjaGFuZ2VzQ2FsbGJhY2soe2xhc3Rfc2VxIDogc2luY2V9KTsAICAgICAgICBjb25zb2xlLmxvZyhvcHRzKTsAICAgICAgICBjb25zb2xlLmxvZygiZXJyb3IgY2hhbmdlcyIpOwAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewAgICAgZXJyb3I6IGZ1bmN0aW9uKCkgewAgICAgc3VjY2VzczogY2hhbmdlc0NhbGxiYWNrLAAgICAgZGF0YVR5cGU6ICdqc29uJywAICAgIHVybDogJy9waG90b3NoYXJlL19jaGFuZ2VzP2ZlZWQ9bG9uZ3BvbGwmZmlsdGVyPXBob3Rvc2hhcmUvdGh1bWJuYWlsJnNpbmNlPScrc2luY2UsACAgICB0eXBlOiAnR0VUJywAICAkLmFqYXgoewAgIG9uREJDaGFuZ2Uob3B0cyk7ACAgc2luY2UgPSBvcHRzLmxhc3Rfc2VxIHx8IHNpbmNlOwBmdW5jdGlvbiBjaGFuZ2VzQ2FsbGJhY2sob3B0cykgewB2YXIgc2luY2UgPSAwOwAAAAB9ACAgbmF2aWdhdG9yLmNhbWVyYS5nZXRQaWN0dXJlKG9uQ2FwdHVyZVN1Y2Nlc3MsIG9uQ2FwdHVyZUZhaWx1cmUsIHsgcXVhbGl0eTogMTAgfSk7ACAgY29uc29sZS5sb2coImNhcHR1cmVQaG90byIpOwBmdW5jdGlvbiBjYXB0dXJlUGhvdG8oKSB7AAB9ACAgYWxlcnQoJ29uQ2FwdHVyZUZhaWx1cmUgJyArIG1lc3NhZ2UpOwBmdW5jdGlvbiBvbkNhcHR1cmVGYWlsdXJlKG1lc3NhZ2UpIHsAAH0AICB9KTsAICAgIGVycm9yOiBvblNhdmVGYWlsdXJlACAgICBzdWNjZXNzOiBvblNhdmVTdWNjZXNzLAAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywAICAgIGRhdGFUeXBlOiAnanNvbicsACAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShpbWFnZURvYyksACAgICB1cmw6ICcvcGhvdG9zaGFyZScsACAgICB0eXBlOiAnUE9TVCcsACAgJC5hamF4KHsAICB9fTsAICAgICAgfQAgICAgICAgIGRhdGE6IGltYWdlRGF0YQAgICAgICAgIGNvbnRlbnRfdHlwZTogImltYWdlL2pwZWciLAAgICAgICAib3JpZ2luYWwuanBnIjogewAgICAgX2F0dGFjaG1lbnRzOiB7ACAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLAAgICAgdHlwZTogInBob3RvIiwAICB2YXIgaW1hZ2VEb2MgPSB7ACAgc2V0TWVzc2FnZSgnU2F2aW5nIGltYWdlLi4uJyk7ACAgfTsAICAgIGFsZXJ0KCJvblNhdmVGYWlsdXJlICIrdHlwZSArICcgJyArIHhoci5yZXNwb25zZVRleHQpOwAgIHZhciBvblNhdmVGYWlsdXJlID0gZnVuY3Rpb24oeGhyLCB0eXBlKSB7ACAgfTsAICAgIHNldE1lc3NhZ2UoJycpOwAgICAgYWRkSW1hZ2UoaW1hZ2VEb2MuaWQpOwAgIHZhciBvblNhdmVTdWNjZXNzID0gZnVuY3Rpb24oaW1hZ2VEb2MpIHsAICBjb25zb2xlLmxvZygib25DYXB0dXJlU3VjY2VzcyIpOwBmdW5jdGlvbiBvbkNhcHR1cmVTdWNjZXNzKGltYWdlRGF0YSkgewAALy8gQ2FwdHVyZQAAfQAgICAgfSk7ACAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicAICAgICAgZGF0YVR5cGU6ICdqc29uJywAICAgICAgfSksACAgICAgICAgICBzb3VyY2UgOiAicGhvdG9zaGFyZSIAICAgICAgICAgIHRhcmdldCA6IHN5bmNwb2ludCwAICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoewAgICAgICB1cmw6ICcvX3JlcGxpY2F0ZScsACAgICAgIHR5cGU6ICdQT1NUJywAICAgICQuYWpheCh7ACAgICB9KTsAICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJwAgICAgICBkYXRhVHlwZTogJ2pzb24nLAAgICAgICB9KSwAICAgICAgICAgIHRhcmdldCA6ICJwaG90b3NoYXJlIgAgICAgICAgICAgc291cmNlIDogc3luY3BvaW50LAAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7ACAgICAgIHVybDogJy9fcmVwbGljYXRlJywAICAgICAgdHlwZTogJ1BPU1QnLAAgICAgJC5hamF4KHsAICAgIHZhciBzeW5jcG9pbnQgPSAiaHR0cDovL2NvdWNoYmFzZS5pYy5odC9waG90b3NoYXJlIjsAZnVuY3Rpb24gc2V0dXBTeW5jKCkgewAALy8gU3luY3BvaW50AAB9ACAgJCgnI21lc3NhZ2UnKS5odG1sKG1lc3NhZ2UpOwBmdW5jdGlvbiBzZXRNZXNzYWdlKG1lc3NhZ2UpIHsAAH0AICB9ACAgICBjYXB0dXJlLmF0dHIoJ2Rpc2FibGVkJywgdHJ1ZSk7ACAgfSBlbHNlIHsAICAgIGNhcHR1cmUucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsAICBpZihjYXB0dXJlLmF0dHIoJ2Rpc2FibGVkJykpIHsAICB2YXIgY2FwdHVyZSA9ICQoJyNjYXB0dXJlUGhvdG8nKTsAZnVuY3Rpb24gdG9nZ2xlQnV0dG9uKCkgewAAfQAgICQoJyNwaG90b3ZpZXctaW1hZ2UnKS5hdHRyKCdzcmMnLCAnJyk7ACAgJCgnI2NvbW1lbnRzJykuaHRtbCgnJyk7AGZ1bmN0aW9uIGNsZWFyUGhvdG9WaWV3KCkgewAAfQAgICAgICAgICAgICAgICAgLnByZXBlbmQoJzxzcGFuIGNsYXNzPSJhdXRob3IiPicrY29tbWVudERvYy5hdXRob3IrJyB3cm90ZTo8L3NwYW4+ICcpOwAgICQoJyNjb21tZW50cycpLnByZXBlbmQoJzxzcGFuPicrY29tbWVudERvYy5jb21tZW50Kyc8L3NwYW4+PGJyLz4nKQBmdW5jdGlvbiBhZGRDb21tZW50KGNvbW1lbnREb2MpIHsAAH0AICAgICQoJyNwaWN0dXJlcycpLnByZXBlbmQobmV3SW1nKTsAICAgIG5ld0ltZy5jbGljayhvbkltYWdlQ2xpY2spOwAgICAgICAgICAgICAgICAgICAgICAgIH0pOwAgICAgICAgICAgICAgICAgICAgICAgICBzcmM6ICcvcGhvdG9zaGFyZS8nK2ltYWdlSWQrJy90aHVtYm5haWwuanBnJwAgICAgICAgICAgICAgICAgIC5hdHRyKHtpZDogaW1hZ2VJZCwAICAgICAgICAgICAgICAgICB9KQAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCk7ACAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKCkgewAgICAgICAgICAgICAgICAgIC5jc3MoJ3BhZGRpbmcnLCAnMnB4JykAICAgICAgICAgICAgICAgICAuY3NzKCdmbG9hdCcsICdsZWZ0JykAICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3RodW1ibmFpbCcpACAgICB2YXIgbmV3SW1nID0gJCgiPGltZz48L2ltZz4iKQBmdW5jdGlvbiBhZGRJbWFnZShpbWFnZUlkKSB7AAAvLyBIZWxwZXIgTWV0aG9kcwAAdmFyIHNlbGVjdGVkUGljdHVyZUlkID0gbnVsbDsAAFBob25lR2FwLlVzZVBvbGxpbmcgPSB0cnVlOwAvLyBVc2UgUGhvbmVHYXAgcG9sbGluZyBiZWNhdXNlIG9mIGNyb3NzLW9yaWdpbiZzcGVlZCBwcm9ibGVtIHdoZW4gbG9hZGluZyBmcm9tIGNvdWNoREIAYWQAANsFAABPBwAAABAAAFYAAAAAAAAA2g8AANIPAADMDwAAyA8AAMYPAADFDwAArA8AAJUPAAB8DwAAWg8AAC4PAAAEDwAA/Q4AAPwOAADMDgAArg4AAKcOAACmDgAAdQ4AAEkOAABCDgAAQQ4AAPkNAAD3DQAA9g0AANwNAACuDQAAjw0AAC0NAADwDAAA7wwAAMMMAACYDAAAWgwAADAMAAAqDAAADgwAAPcLAADMCwAAjAsAAIcLAACGCwAAWQsAACkLAAAlCwAAAwsAAPgKAADoCgAAXQoAAEgKAAAkCgAACAoAAO8JAADpCQAA5wkAAOYJAADNCQAAjAkAAGYJAAAmCQAADAkAAPgIAADjCAAA4QgAAOAIAADHCAAAowgAAIEIAAB/CAAAfggAAH0IAABqCAAAOAgAACQIAAATCAAAEQgAABAIAAD7BwAA5QcAAMwHAAC4BwAAqwcAAKgHAACnBwAAagcAAE8HAABOBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkKCdib2R5JykucmVhZHkoc3RhcnRBcHApOwBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJkZXZpY2VyZWFkeSIsIHN0YXJ0Q2FtZXJhLCB0cnVlKTsAAH07ACAgICBzdGFydCgpOwAgICAgc3RhcnRlZCA9IHRydWU7ACAgICBpZiAoc3RhcnRlZCkgcmV0dXJuOwBmdW5jdGlvbiBzdGFydEFwcCgpIHsAdmFyIHN0YXJ0ZWQgPSBmYWxzZTsAAH0AICAgIHNldHVwU3luYygpOwAgICAgc2V0dXBDaGFuZ2VzKCk7ACAgICAvLyBzZXR1cCBsaXN0aW5nIG9mIHBpY3R1cmVzIGFuZCBhdXRvIHJlZnJlc2gAZnVuY3Rpb24gc3RhcnQoKSB7AAAAfQAgIGNhcHR1cmUucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsAICB2YXIgY2FwdHVyZSA9ICQoJyNjYXB0dXJlUGhvdG8nKTsAZnVuY3Rpb24gc3RhcnRDYW1lcmEoKSB7AAB9ACAgJCgnI21haW4nKS5zaG93KCk7ACAgY2xlYXJQaG90b1ZpZXcoKTsAICAkKCcjcGhvdG92aWV3JykuaGlkZSgpOwAgICQoJyNwaG90b3ZpZXcnKS5jc3MoIi13ZWJraXQtdHJhbnNmb3JtIiwidHJhbnNsYXRlKDEwMCUsMCkiKTsAICAkKCcjc2VuZC1jb21tZW50JykudW5iaW5kKCdjbGljaycpOwAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JhY2tidXR0b24nLCBiYWNrS2V5RG93biwgdHJ1ZSk7AGZ1bmN0aW9uIGJhY2tLZXlEb3duKCkgewAAfQAgIH0pOwAgICBlcnJvcjogb25GZXRjaEZhaWx1cmUAICAgc3VjY2Vzczogb25GZXRjaFN1Y2Nlc3MsACAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsACAgIGRhdGFUeXBlOiAnanNvbicsACAgIHVybDogJy9waG90b3NoYXJlL19kZXNpZ24vcGhvdG9zaGFyZS9fdmlldy9waG90b19hbmRfY29tbWVudHM/c3RhcnRrZXk9WyInK3NlbGVjdGVkUGljdHVyZUlkKyciLDFdJmVuZGtleT1bIicrc2VsZWN0ZWRQaWN0dXJlSWQrJyIsMV0nLAAgICB0eXBlOiAnR0VUJywAICAkLmFqYXgoewAgIGNvbnNvbGUubG9nKHNlbGVjdGVkUGljdHVyZUlkKTsAICB9ACAgICBjb25zb2xlLmxvZyh0eXBlICsgJyAnICsgeGhyLnJlc3BvbnNlVGV4dCk7ACAgdmFyIG9uRmV0Y2hGYWlsdXJlID0gZnVuY3Rpb24oeGhyLCB0eXBlKSB7AAAgIH07ACAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdiYWNrYnV0dG9uJywgYmFja0tleURvd24sIHRydWUpOwAgICAgJCgnI3NlbmQtY29tbWVudCcpLmNsaWNrKHNlbmRDb21tZW50KTsAICAgICQoJyNtYWluJykuaGlkZSgpOwAgICAgJCgnI3Bob3RvdmlldycpLnNob3coKTsAICAgIH0AICAgICAgYWRkQ29tbWVudChyZXNwb25zZS5yb3dzW2ldLnZhbHVlKTsAICAgIGZvcih2YXIgaSA9IDAgLCBqID0gcmVzcG9uc2Uucm93cy5sZW5ndGggOyBpIDwgaiA7IGkrKykgewAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpKTsAICB2YXIgb25GZXRjaFN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwb25zZSkgewAAICAkKCcjcGhvdG92aWV3JykuY3NzKCItd2Via2l0LXRyYW5zZm9ybSIsInRyYW5zbGF0ZSgwLDApIik7ACAgJCgnI3Bob3Rvdmlldy1pbWFnZScpLmF0dHIoJ3NyYycsICcvcGhvdG9zaGFyZS8nK3RoaXMuaWQrJy9vcmlnaW5hbC5qcGcnKS5jc3MoJ3dpZHRoJywgJzEwMCUnKTsAICBzZWxlY3RlZFBpY3R1cmVJZCA9IHRoaXMuaWQ7ACAgLy8gRklYTUU6IG1heWJlIHVzZSBhIGhpZGRlbiBmaWVsZCBpbnN0ZWFkPwBmdW5jdGlvbiBvbkltYWdlQ2xpY2soKSB7AAB9ACAgICBDb3VjaERiUGx1Z2luLnNhdmUoY29tbWVudERvYywgb25Db21tZW50U3VjY2Vzcywgb25Db21tZW50RmFpbHVyZSk7AAAgICAgfTsAICAgICAgYWxlcnQodHlwZSArICcgJyArIHhoci5yZXNwb25zZVRleHQpOwAgICAgdmFyIG9uQ29tbWVudEZhaWx1cmUgPSBmdW5jdGlvbih4aHIsIHR5cGUpIHsAACAgICB9OwAgICAgICBhZGRDb21tZW50KGNvbW1lbnREb2MpOwAgICAgdmFyIG9uQ29tbWVudFN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwb25zZSkgewAAICAgIH07ACAgICAgICJjb21tZW50IjogJCgnI2NvbW1lbnQtdGV4dCcpLnZhbCgpACAgICAgICJhdXRob3IiOiAkKCcjY29tbWVudC1hdXRob3InKS52YWwoKSwAICAgICAgInBob3RvIjogc2VsZWN0ZWRQaWN0dXJlSWQsACAgICAgICJ0eXBlIjogImNvbW1lbnQiLAAgICAgdmFyIGNvbW1lbnREb2MgPSB7AGZ1bmN0aW9uIHNlbmRDb21tZW50KCkgewAAfQAgIH0AICAgIH0AICAgICAgfQAgICAgICAgIGFkZEltYWdlKGRhdGEucmVzdWx0c1tpXS5pZCk7AA=="},"vendor/zepto/zepto.min.js":{"content_type":"application/javascript","revpos":1,"data":"Ly8gICAgIFplcHRvLmpzCi8vICAgICAoYykgMjAxMCwgMjAxMSBUaG9tYXMgRnVjaHMKLy8gICAgIFplcHRvLmpzIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgooZnVuY3Rpb24oYSl7U3RyaW5nLnByb3RvdHlwZS50cmltPT09YSYmKFN0cmluZy5wcm90b3R5cGUudHJpbT1mdW5jdGlvbigpe3JldHVybiB0aGlzLnJlcGxhY2UoL15ccysvLCIiKS5yZXBsYWNlKC9ccyskLywiIil9KSxBcnJheS5wcm90b3R5cGUucmVkdWNlPT09YSYmKEFycmF5LnByb3RvdHlwZS5yZWR1Y2U9ZnVuY3Rpb24oYil7aWYodGhpcz09PXZvaWQgMHx8dGhpcz09PW51bGwpdGhyb3cgbmV3IFR5cGVFcnJvcjt2YXIgYz1PYmplY3QodGhpcyksZD1jLmxlbmd0aD4+PjAsZT0wLGY7aWYodHlwZW9mIGIhPSJmdW5jdGlvbiIpdGhyb3cgbmV3IFR5cGVFcnJvcjtpZihkPT0wJiZhcmd1bWVudHMubGVuZ3RoPT0xKXRocm93IG5ldyBUeXBlRXJyb3I7aWYoYXJndW1lbnRzLmxlbmd0aD49MilmPWFyZ3VtZW50c1sxXTtlbHNlIGRve2lmKGUgaW4gYyl7Zj1jW2UrK107YnJlYWt9aWYoKytlPj1kKXRocm93IG5ldyBUeXBlRXJyb3J9d2hpbGUoITApO3doaWxlKGU8ZCllIGluIGMmJihmPWIuY2FsbChhLGYsY1tlXSxlLGMpKSxlKys7cmV0dXJuIGZ9KX0pKCk7dmFyIFplcHRvPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gSyhhLGMpe2MoYSk7Zm9yKGIgaW4gYS5jaGlsZE5vZGVzKUsoYS5jaGlsZE5vZGVzW2JdLGMpfWZ1bmN0aW9uIEooYSxiLGMpe3ZhciBkPSFhfHxhPT0zP2I6Yi5wYXJlbnROb2RlO2QuaW5zZXJ0QmVmb3JlKGMsYT9hPT0xP2IubmV4dFNpYmxpbmc6YT09Mj9iOm51bGw6ZC5maXJzdENoaWxkKX1mdW5jdGlvbiBJKGEsYixjLGQpe3JldHVybiBzKGIpP2IuY2FsbChhLGMsZCk6Yn1mdW5jdGlvbiBIKGIsYyl7cmV0dXJuIGM9PT1hP0coYik6RyhiKS5maWx0ZXIoYyl9ZnVuY3Rpb24gRyhiLGQpe2lmKCFiKXJldHVybiBGKCk7aWYoZCE9PWEpcmV0dXJuIEcoZCkuZmluZChiKTtpZihzKGIpKXJldHVybiBHKGcpLnJlYWR5KGIpO2lmKGIgaW5zdGFuY2VvZiBGKXJldHVybiBiO3ZhciBlO3UoYik/ZT13KGIpOm0uaW5kZXhPZihiLm5vZGVUeXBlKT49MHx8Yj09PXdpbmRvdz8oZT1bYl0sYj1udWxsKTpsLnRlc3QoYik/KGU9RShiLFJlZ0V4cC4kMSksYj1udWxsKTpiLm5vZGVUeXBlJiZiLm5vZGVUeXBlPT0zP2U9W2JdOmU9YyhnLGIpO3JldHVybiBGKGUsYil9ZnVuY3Rpb24gRihhLGIpe2E9YXx8ZSxhLl9fcHJvdG9fXz1GLnByb3RvdHlwZSxhLnNlbGVjdG9yPWJ8fCIiO3JldHVybiBhfWZ1bmN0aW9uIEUoYixjKXtjPT09YSYmbC50ZXN0KGIpJiZSZWdFeHAuJDEsYyBpbiByfHwoYz0iKiIpO3ZhciBkPXJbY107ZC5pbm5lckhUTUw9IiIrYjtyZXR1cm4gZi5jYWxsKGQuY2hpbGROb2Rlcyl9ZnVuY3Rpb24gRChhKXt2YXIgYixjO2hbYV18fChiPWcuY3JlYXRlRWxlbWVudChhKSxnLmJvZHkuYXBwZW5kQ2hpbGQoYiksYz1qKGIsIiIpLmdldFByb3BlcnR5VmFsdWUoImRpc3BsYXkiKSxiLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYiksYz09Im5vbmUiJiYoYz0iYmxvY2siKSxoW2FdPWMpO3JldHVybiBoW2FdfWZ1bmN0aW9uIEMoYSxiKXtyZXR1cm4gdHlwZW9mIGI9PSJudW1iZXIiJiYha1t6KGEpXT9iKyJweCI6Yn1mdW5jdGlvbiBCKGEpe3JldHVybiBhIGluIGk/aVthXTppW2FdPW5ldyBSZWdFeHAoIihefFxccykiK2ErIihcXHN8JCkiKX1mdW5jdGlvbiBBKGEpe3JldHVybiBhLmZpbHRlcihmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGMuaW5kZXhPZihhKT09Yn0pfWZ1bmN0aW9uIHooYSl7cmV0dXJuIGEucmVwbGFjZSgvOjovZywiLyIpLnJlcGxhY2UoLyhbQS1aXSspKFtBLVpdW2Etel0pL2csIiQxXyQyIikucmVwbGFjZSgvKFthLXpcZF0pKFtBLVpdKS9nLCIkMV8kMiIpLnJlcGxhY2UoL18vZywiLSIpLnRvTG93ZXJDYXNlKCl9ZnVuY3Rpb24geShhKXtyZXR1cm4gYS5yZXBsYWNlKC8tKyguKT8vZyxmdW5jdGlvbihhLGIpe3JldHVybiBiP2IudG9VcHBlckNhc2UoKToiIn0pfWZ1bmN0aW9uIHgoYSl7cmV0dXJuIGEubGVuZ3RoPjA/W10uY29uY2F0LmFwcGx5KFtdLGEpOmF9ZnVuY3Rpb24gdyhiKXtyZXR1cm4gYi5maWx0ZXIoZnVuY3Rpb24oYil7cmV0dXJuIGIhPT1hJiZiIT09bnVsbH0pfWZ1bmN0aW9uIHYoYSl7cmV0dXJuIHR5cGVvZiBhLmxlbmd0aD09Im51bWJlciJ9ZnVuY3Rpb24gdShhKXtyZXR1cm4gYSBpbnN0YW5jZW9mIEFycmF5fWZ1bmN0aW9uIHQoYSl7cmV0dXJuIGEgaW5zdGFuY2VvZiBPYmplY3R9ZnVuY3Rpb24gcyhhKXtyZXR1cm57fS50b1N0cmluZy5jYWxsKGEpPT0iW29iamVjdCBGdW5jdGlvbl0ifXZhciBhLGIsYyxkLGU9W10sZj1lLnNsaWNlLGc9d2luZG93LmRvY3VtZW50LGg9e30saT17fSxqPWcuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSxrPXsiY29sdW1uLWNvdW50IjoxLGNvbHVtbnM6MSwiZm9udC13ZWlnaHQiOjEsImxpbmUtaGVpZ2h0IjoxLG9wYWNpdHk6MSwiei1pbmRleCI6MSx6b29tOjF9LGw9L15ccyo8KFx3KylbXj5dKj4vLG09WzEsOSwxMV0sbj1bInByZXBlbmQiLCJhZnRlciIsImJlZm9yZSIsImFwcGVuZCJdLG89WyJhcHBlbmQiLCJwcmVwZW5kIl0scD1nLmNyZWF0ZUVsZW1lbnQoInRhYmxlIikscT1nLmNyZWF0ZUVsZW1lbnQoInRyIikscj17dHI6Zy5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpLHRib2R5OnAsdGhlYWQ6cCx0Zm9vdDpwLHRkOnEsdGg6cSwiKiI6Zy5jcmVhdGVFbGVtZW50KCJkaXYiKX07Ry5leHRlbmQ9ZnVuY3Rpb24oYSl7Zi5jYWxsKGFyZ3VtZW50cywxKS5mb3JFYWNoKGZ1bmN0aW9uKGMpe2ZvcihiIGluIGMpYVtiXT1jW2JdfSk7cmV0dXJuIGF9LEcucXNhPWM9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZi5jYWxsKGEucXVlcnlTZWxlY3RvckFsbChiKSl9LEcuaXNGdW5jdGlvbj1zLEcuaXNPYmplY3Q9dCxHLmlzQXJyYXk9dSxHLm1hcD1mdW5jdGlvbihhLGIpe3ZhciBjLGQ9W10sZSxmO2lmKHYoYSkpZm9yKGU9MDtlPGEubGVuZ3RoO2UrKyljPWIoYVtlXSxlKSxjIT1udWxsJiZkLnB1c2goYyk7ZWxzZSBmb3IoZiBpbiBhKWM9YihhW2ZdLGYpLGMhPW51bGwmJmQucHVzaChjKTtyZXR1cm4geChkKX0sRy5lYWNoPWZ1bmN0aW9uKGEsYil7dmFyIGMsZDtpZih2KGEpKXtmb3IoYz0wO2M8YS5sZW5ndGg7YysrKWlmKGIoYyxhW2NdKT09PSExKXJldHVybiBhfWVsc2UgZm9yKGQgaW4gYSlpZihiKGQsYVtkXSk9PT0hMSlyZXR1cm4gYTtyZXR1cm4gYX0sRy5mbj17Zm9yRWFjaDplLmZvckVhY2gscmVkdWNlOmUucmVkdWNlLHB1c2g6ZS5wdXNoLGluZGV4T2Y6ZS5pbmRleE9mLGNvbmNhdDplLmNvbmNhdCxtYXA6ZnVuY3Rpb24oYSl7cmV0dXJuIEcubWFwKHRoaXMsZnVuY3Rpb24oYixjKXtyZXR1cm4gYS5jYWxsKGIsYyxiKX0pfSxzbGljZTpmdW5jdGlvbigpe3JldHVybiBHKGYuYXBwbHkodGhpcyxhcmd1bWVudHMpKX0scmVhZHk6ZnVuY3Rpb24oYSl7KGcucmVhZHlTdGF0ZT09ImNvbXBsZXRlInx8Zy5yZWFkeVN0YXRlPT0ibG9hZGVkIikmJmEoKSxnLmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLGEsITEpO3JldHVybiB0aGlzfSxnZXQ6ZnVuY3Rpb24oYil7cmV0dXJuIGI9PT1hP3RoaXM6dGhpc1tiXX0sc2l6ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxlbmd0aH0scmVtb3ZlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3RoaXMucGFyZW50Tm9kZSE9bnVsbCYmdGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMpfSl9LGVhY2g6ZnVuY3Rpb24oYSl7dGhpcy5mb3JFYWNoKGZ1bmN0aW9uKGIsYyl7YS5jYWxsKGIsYyxiKX0pO3JldHVybiB0aGlzfSxmaWx0ZXI6ZnVuY3Rpb24oYSl7cmV0dXJuIEcoW10uZmlsdGVyLmNhbGwodGhpcyxmdW5jdGlvbihiKXtyZXR1cm4gYyhiLnBhcmVudE5vZGUsYSkuaW5kZXhPZihiKT49MH0pKX0sZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHJldk9iamVjdHx8RygpfSxhZGQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gRyhBKHRoaXMuY29uY2F0KEcoYSxiKSkpKX0saXM6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMubGVuZ3RoPjAmJkcodGhpc1swXSkuZmlsdGVyKGEpLmxlbmd0aD4wfSxub3Q6ZnVuY3Rpb24oYil7dmFyIGM9W107aWYocyhiKSYmYi5jYWxsIT09YSl0aGlzLmVhY2goZnVuY3Rpb24oYSl7Yi5jYWxsKHRoaXMsYSl8fGMucHVzaCh0aGlzKX0pO2Vsc2V7dmFyIGQ9dHlwZW9mIGI9PSJzdHJpbmciP3RoaXMuZmlsdGVyKGIpOnYoYikmJnMoYi5pdGVtKT9mLmNhbGwoYik6RyhiKTt0aGlzLmZvckVhY2goZnVuY3Rpb24oYSl7ZC5pbmRleE9mKGEpPDAmJmMucHVzaChhKX0pfXJldHVybiBHKGMpfSxlcTpmdW5jdGlvbihhKXtyZXR1cm4gYT09PS0xP3RoaXMuc2xpY2UoYSk6dGhpcy5zbGljZShhLCthKzEpfSxmaXJzdDpmdW5jdGlvbigpe3JldHVybiBHKHRoaXNbMF0pfSxsYXN0OmZ1bmN0aW9uKCl7cmV0dXJuIEcodGhpc1t0aGlzLmxlbmd0aC0xXSl9LGZpbmQ6ZnVuY3Rpb24oYSl7dmFyIGI7dGhpcy5sZW5ndGg9PTE/Yj1jKHRoaXNbMF0sYSk6Yj10aGlzLm1hcChmdW5jdGlvbigpe3JldHVybiBjKHRoaXMsYSl9KTtyZXR1cm4gRyhiKX0sY2xvc2VzdDpmdW5jdGlvbihiLGQpe3ZhciBlPXRoaXNbMF0sZj1jKGQhPT1hP2Q6ZyxiKTtmLmxlbmd0aD09PTAmJihlPW51bGwpO3doaWxlKGUmJmUhPT1nJiZmLmluZGV4T2YoZSk8MCllPWUucGFyZW50Tm9kZTtyZXR1cm4gRyhlIT09ZyYmZSl9LHBhcmVudHM6ZnVuY3Rpb24oYSl7dmFyIGI9W10sYz10aGlzO3doaWxlKGMubGVuZ3RoPjApYz1HLm1hcChjLGZ1bmN0aW9uKGEpe2lmKChhPWEucGFyZW50Tm9kZSkmJmEhPT1nJiZiLmluZGV4T2YoYSk8MCl7Yi5wdXNoKGEpO3JldHVybiBhfX0pO3JldHVybiBIKGIsYSl9LHBhcmVudDpmdW5jdGlvbihhKXtyZXR1cm4gSChBKHRoaXMucGx1Y2soInBhcmVudE5vZGUiKSksYSl9LGNoaWxkcmVuOmZ1bmN0aW9uKGEpe3JldHVybiBIKHRoaXMubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIGYuY2FsbCh0aGlzLmNoaWxkcmVuKX0pLGEpfSxzaWJsaW5nczpmdW5jdGlvbihhKXtyZXR1cm4gSCh0aGlzLm1hcChmdW5jdGlvbihhLGIpe3JldHVybiBmLmNhbGwoYi5wYXJlbnROb2RlLmNoaWxkcmVuKS5maWx0ZXIoZnVuY3Rpb24oYSl7cmV0dXJuIGEhPT1ifSl9KSxhKX0sZW1wdHk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5pbm5lckhUTUw9IiJ9KX0scGx1Y2s6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXNbYV19KX0sc2hvdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt0aGlzLnN0eWxlLmRpc3BsYXk9PSJub25lIiYmKHRoaXMuc3R5bGUuZGlzcGxheT1udWxsKSxqKHRoaXMsIiIpLmdldFByb3BlcnR5VmFsdWUoImRpc3BsYXkiKT09Im5vbmUiJiYodGhpcy5zdHlsZS5kaXNwbGF5PUQodGhpcy5ub2RlTmFtZSkpfSl9LHJlcGxhY2VXaXRoOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj10aGlzLnBhcmVudE5vZGUsYz10aGlzLm5leHRTaWJsaW5nO0codGhpcykucmVtb3ZlKCksYz9HKGMpLmJlZm9yZShhKTpHKGIpLmFwcGVuZChhKX0pfSx3cmFwOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtHKHRoaXMpLndyYXBBbGwoRyhhKVswXS5jbG9uZU5vZGUoITEpKX0pfSx3cmFwQWxsOmZ1bmN0aW9uKGEpe3RoaXNbMF0mJihHKHRoaXNbMF0pLmJlZm9yZShhPUcoYSkpLGEuYXBwZW5kKHRoaXMpKTtyZXR1cm4gdGhpc30sdW53cmFwOmZ1bmN0aW9uKCl7dGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCl7Ryh0aGlzKS5yZXBsYWNlV2l0aChHKHRoaXMpLmNoaWxkcmVuKCkpfSk7cmV0dXJuIHRoaXN9LGhpZGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jc3MoImRpc3BsYXkiLCJub25lIil9LHRvZ2dsZTpmdW5jdGlvbihiKXtyZXR1cm4oYj09PWE/dGhpcy5jc3MoImRpc3BsYXkiKT09Im5vbmUiOmIpP3RoaXMuc2hvdygpOnRoaXMuaGlkZSgpfSxwcmV2OmZ1bmN0aW9uKCl7cmV0dXJuIEcodGhpcy5wbHVjaygicHJldmlvdXNFbGVtZW50U2libGluZyIpKX0sbmV4dDpmdW5jdGlvbigpe3JldHVybiBHKHRoaXMucGx1Y2soIm5leHRFbGVtZW50U2libGluZyIpKX0saHRtbDpmdW5jdGlvbihiKXtyZXR1cm4gYj09PWE/dGhpcy5sZW5ndGg+MD90aGlzWzBdLmlubmVySFRNTDpudWxsOnRoaXMuZWFjaChmdW5jdGlvbihhKXt2YXIgYz10aGlzLmlubmVySFRNTDtHKHRoaXMpLmVtcHR5KCkuYXBwZW5kKEkodGhpcyxiLGEsYykpfSl9LHRleHQ6ZnVuY3Rpb24oYil7cmV0dXJuIGI9PT1hP3RoaXMubGVuZ3RoPjA/dGhpc1swXS50ZXh0Q29udGVudDpudWxsOnRoaXMuZWFjaChmdW5jdGlvbigpe3RoaXMudGV4dENvbnRlbnQ9Yn0pfSxhdHRyOmZ1bmN0aW9uKGMsZCl7cmV0dXJuIHR5cGVvZiBjPT0ic3RyaW5nIiYmZD09PWE/dGhpcy5sZW5ndGg+MCYmdGhpc1swXS5ub2RlTmFtZT09IklOUFVUIiYmdGhpc1swXS50eXBlPT0idGV4dCImJmM9PSJ2YWx1ZSI/dGhpcy52YWwoKTp0aGlzLmxlbmd0aD4wP3RoaXNbMF0uZ2V0QXR0cmlidXRlKGMpfHwoYyBpbiB0aGlzWzBdP3RoaXNbMF1bY106YSk6YTp0aGlzLmVhY2goZnVuY3Rpb24oYSl7aWYodChjKSlmb3IoYiBpbiBjKXRoaXMuc2V0QXR0cmlidXRlKGIsY1tiXSk7ZWxzZSB0aGlzLnNldEF0dHJpYnV0ZShjLEkodGhpcyxkLGEsdGhpcy5nZXRBdHRyaWJ1dGUoYykpKX0pfSxyZW1vdmVBdHRyOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt0aGlzLnJlbW92ZUF0dHJpYnV0ZShhKX0pfSxkYXRhOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuYXR0cigiZGF0YS0iK2EsYil9LHZhbDpmdW5jdGlvbihiKXtyZXR1cm4gYj09PWE/dGhpcy5sZW5ndGg+MD90aGlzWzBdLnZhbHVlOm51bGw6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dGhpcy52YWx1ZT1ifSl9LG9mZnNldDpmdW5jdGlvbigpe2lmKHRoaXMubGVuZ3RoPT0wKXJldHVybiBudWxsO3ZhciBhPXRoaXNbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7cmV0dXJue2xlZnQ6YS5sZWZ0K2cuYm9keS5zY3JvbGxMZWZ0LHRvcDphLnRvcCtnLmJvZHkuc2Nyb2xsVG9wLHdpZHRoOmEud2lkdGgsaGVpZ2h0OmEuaGVpZ2h0fX0sY3NzOmZ1bmN0aW9uKGMsZCl7aWYoZD09PWEmJnR5cGVvZiBjPT0ic3RyaW5nIilyZXR1cm4gdGhpc1swXS5zdHlsZVt5KGMpXXx8aih0aGlzWzBdLCIiKS5nZXRQcm9wZXJ0eVZhbHVlKGMpO3ZhciBlPSIiO2ZvcihiIGluIGMpZSs9eihiKSsiOiIrQyhiLGNbYl0pKyI7Ijt0eXBlb2YgYz09InN0cmluZyImJihlPXooYykrIjoiK0MoYyxkKSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3RoaXMuc3R5bGUuY3NzVGV4dCs9IjsiK2V9KX0saW5kZXg6ZnVuY3Rpb24oYSl7cmV0dXJuIGE/dGhpcy5pbmRleE9mKEcoYSlbMF0pOnRoaXMucGFyZW50KCkuY2hpbGRyZW4oKS5pbmRleE9mKHRoaXNbMF0pfSxoYXNDbGFzczpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5sZW5ndGg8MT8hMTpCKGEpLnRlc3QodGhpc1swXS5jbGFzc05hbWUpfSxhZGRDbGFzczpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe2Q9W107dmFyIGM9dGhpcy5jbGFzc05hbWUsZT1JKHRoaXMsYSxiLGMpO2Uuc3BsaXQoL1xzKy9nKS5mb3JFYWNoKGZ1bmN0aW9uKGEpe0codGhpcykuaGFzQ2xhc3MoYSl8fGQucHVzaChhKX0sdGhpcyksZC5sZW5ndGgmJih0aGlzLmNsYXNzTmFtZSs9KGM/IiAiOiIiKStkLmpvaW4oIiAiKSl9KX0scmVtb3ZlQ2xhc3M6ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihjKXtpZihiPT09YSlyZXR1cm4gdGhpcy5jbGFzc05hbWU9IiI7ZD10aGlzLmNsYXNzTmFtZSxJKHRoaXMsYixjLGQpLnNwbGl0KC9ccysvZykuZm9yRWFjaChmdW5jdGlvbihhKXtkPWQucmVwbGFjZShCKGEpLCIgIil9KSx0aGlzLmNsYXNzTmFtZT1kLnRyaW0oKX0pfSx0b2dnbGVDbGFzczpmdW5jdGlvbihiLGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZCl7dmFyIGU9dGhpcy5jbGFzc05hbWUsZj1JKHRoaXMsYixkLGUpO2MhPT1hJiYhY3x8Ryh0aGlzKS5oYXNDbGFzcyhmKT9HKHRoaXMpLnJlbW92ZUNsYXNzKGYpOkcodGhpcykuYWRkQ2xhc3MoZil9KX19LCJmaWx0ZXIsYWRkLG5vdCxlcSxmaXJzdCxsYXN0LGZpbmQsY2xvc2VzdCxwYXJlbnRzLHBhcmVudCxjaGlsZHJlbixzaWJsaW5ncyIuc3BsaXQoIiwiKS5mb3JFYWNoKGZ1bmN0aW9uKGEpe3ZhciBiPUcuZm5bYV07Ry5mblthXT1mdW5jdGlvbigpe3ZhciBhPWIuYXBwbHkodGhpcyxhcmd1bWVudHMpO2EucHJldk9iamVjdD10aGlzO3JldHVybiBhfX0pLFsid2lkdGgiLCJoZWlnaHQiXS5mb3JFYWNoKGZ1bmN0aW9uKGIpe0cuZm5bYl09ZnVuY3Rpb24oYyl7dmFyIGQ7cmV0dXJuIGM9PT1hPyhkPXRoaXMub2Zmc2V0KCkpJiZkW2JdOnRoaXMuY3NzKGIsYyl9fSksbi5mb3JFYWNoKGZ1bmN0aW9uKGEsYil7Ry5mblthXT1mdW5jdGlvbihhKXt2YXIgYz10eXBlb2YgYT09Im9iamVjdCI/YTpFKGEpOyJsZW5ndGgiaW4gY3x8KGM9W2NdKTtpZihjLmxlbmd0aDwxKXJldHVybiB0aGlzO3ZhciBkPXRoaXMubGVuZ3RoLGU9ZD4xLGY9YjwyO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYSxnKXtmb3IodmFyIGg9MDtoPGMubGVuZ3RoO2grKyl7dmFyIGk9Y1tmP2MubGVuZ3RoLWgtMTpoXTtLKGksZnVuY3Rpb24oYSl7YS5ub2RlTmFtZSE9bnVsbCYmYS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpPT09IlNDUklQVCImJndpbmRvdy5ldmFsLmNhbGwod2luZG93LGEuaW5uZXJIVE1MKX0pLGUmJmE8ZC0xJiYoaT1pLmNsb25lTm9kZSghMCkpLEooYixnLGkpfX0pfX0pLG8uZm9yRWFjaChmdW5jdGlvbihhKXtHLmZuW2ErIlRvIl09ZnVuY3Rpb24oYil7dHlwZW9mIGIhPSJvYmplY3QiJiYoYj1HKGIpKSxiW2FdKHRoaXMpO3JldHVybiB0aGlzfX0pLEYucHJvdG90eXBlPUcuZm47cmV0dXJuIEd9KCk7IiQiaW4gd2luZG93fHwod2luZG93LiQ9WmVwdG8pLGZ1bmN0aW9uKGEpe2Z1bmN0aW9uIG4oYil7dmFyIGM9YS5leHRlbmQoe29yaWdpbmFsRXZlbnQ6Yn0sYik7YS5lYWNoKG0sZnVuY3Rpb24oYSxkKXtjW2FdPWZ1bmN0aW9uKCl7dGhpc1tkXT1rO3JldHVybiBiW2FdLmFwcGx5KGIsYXJndW1lbnRzKX0sY1tkXT1sfSk7cmV0dXJuIGN9ZnVuY3Rpb24gaihhLGIsZCxnKXt2YXIgaD1lKGEpOyhifHwiIikuc3BsaXQoL1xzLykuZm9yRWFjaChmdW5jdGlvbihiKXtmKGEsYixkLGcpLmZvckVhY2goZnVuY3Rpb24oYil7ZGVsZXRlIGNbaF1bYi5pXSxhLnJlbW92ZUV2ZW50TGlzdGVuZXIoYi5lLGIucHJveHksITEpfSl9KX1mdW5jdGlvbiBpKGIsZCxmLGgsaSl7dmFyIGo9ZShiKSxrPWNbal18fChjW2pdPVtdKTtkLnNwbGl0KC9ccy8pLmZvckVhY2goZnVuY3Rpb24oYyl7dmFyIGQ9aXx8ZixlPWZ1bmN0aW9uKGEpe3ZhciBjPWQuYXBwbHkoYixbYV0uY29uY2F0KGEuZGF0YSkpO2M9PT0hMSYmYS5wcmV2ZW50RGVmYXVsdCgpO3JldHVybiBjfSxqPWEuZXh0ZW5kKGcoYykse2ZuOmYscHJveHk6ZSxzZWw6aCxkZWw6aSxpOmsubGVuZ3RofSk7ay5wdXNoKGopLGIuYWRkRXZlbnRMaXN0ZW5lcihqLmUsZSwhMSl9KX1mdW5jdGlvbiBoKGEpe3JldHVybiBuZXcgUmVnRXhwKCIoPzpefCApIithLnJlcGxhY2UoIiAiLCIgLiogPyIpKyIoPzogfCQpIil9ZnVuY3Rpb24gZyhhKXt2YXIgYj0oIiIrYSkuc3BsaXQoIi4iKTtyZXR1cm57ZTpiWzBdLG5zOmIuc2xpY2UoMSkuc29ydCgpLmpvaW4oIiAiKX19ZnVuY3Rpb24gZihhLGIsZCxmKXtiPWcoYik7aWYoYi5ucyl2YXIgaT1oKGIubnMpO3JldHVybihjW2UoYSldfHxbXSkuZmlsdGVyKGZ1bmN0aW9uKGEpe3JldHVybiBhJiYoIWIuZXx8YS5lPT1iLmUpJiYoIWIubnN8fGkudGVzdChhLm5zKSkmJighZHx8YS5mbj09ZCkmJighZnx8YS5zZWw9PWYpfSl9ZnVuY3Rpb24gZShhKXtyZXR1cm4gYS5femlkfHwoYS5femlkPWQrKyl9dmFyIGI9YS5xc2EsYz17fSxkPTE7YS5ldmVudD17YWRkOmkscmVtb3ZlOmp9LGEuZm4uYmluZD1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpKHRoaXMsYSxiKX0pfSxhLmZuLnVuYmluZD1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtqKHRoaXMsYSxiKX0pfSxhLmZuLm9uZT1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYz10aGlzO2kodGhpcyxhLGZ1bmN0aW9uKGUpe2IuY2FsbChjLGUpLGooYyxhLGFyZ3VtZW50cy5jYWxsZWUpfSl9KX07dmFyIGs9ZnVuY3Rpb24oKXtyZXR1cm4hMH0sbD1mdW5jdGlvbigpe3JldHVybiExfSxtPXtwcmV2ZW50RGVmYXVsdDoiaXNEZWZhdWx0UHJldmVudGVkIixzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb246ImlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkIixzdG9wUHJvcGFnYXRpb246ImlzUHJvcGFnYXRpb25TdG9wcGVkIn07YS5mbi5kZWxlZ2F0ZT1mdW5jdGlvbihjLGQsZSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihmLGcpe2koZyxkLGUsYyxmdW5jdGlvbihkLGYpe3ZhciBoPWQudGFyZ2V0LGk9YihnLGMpO3doaWxlKGgmJmkuaW5kZXhPZihoKTwwKWg9aC5wYXJlbnROb2RlO2gmJmghPT1nJiZoIT09ZG9jdW1lbnQmJmUuY2FsbChoLGEuZXh0ZW5kKG4oZCkse2N1cnJlbnRUYXJnZXQ6aCxsaXZlRmlyZWQ6Z30pLGYpfSl9KX0sYS5mbi51bmRlbGVnYXRlPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7aih0aGlzLGIsYyxhKX0pfSxhLmZuLmxpdmU9ZnVuY3Rpb24oYixjKXthKGRvY3VtZW50LmJvZHkpLmRlbGVnYXRlKHRoaXMuc2VsZWN0b3IsYixjKTtyZXR1cm4gdGhpc30sYS5mbi5kaWU9ZnVuY3Rpb24oYixjKXthKGRvY3VtZW50LmJvZHkpLnVuZGVsZWdhdGUodGhpcy5zZWxlY3RvcixiLGMpO3JldHVybiB0aGlzfSxhLmZuLnRyaWdnZXI9ZnVuY3Rpb24oYixjKXt0eXBlb2YgYj09InN0cmluZyImJihiPWEuRXZlbnQoYikpLGIuZGF0YT1jO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt0aGlzLmRpc3BhdGNoRXZlbnQoYil9KX0sYS5mbi50cmlnZ2VySGFuZGxlcj1mdW5jdGlvbihiLGMpe3ZhciBkLGU7dGhpcy5lYWNoKGZ1bmN0aW9uKGcsaCl7ZD1uKHR5cGVvZiBiPT0ic3RyaW5nIj9hLkV2ZW50KGIpOmIpLGQuZGF0YT1jLGQudGFyZ2V0PWgsYS5lYWNoKGYoaCxiLnR5cGV8fGIpLGZ1bmN0aW9uKGEsYil7ZT1iLnByb3h5KGQpO2lmKGQuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSlyZXR1cm4hMX0pfSk7cmV0dXJuIGV9LCJmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgbW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBjaGFuZ2Ugc2VsZWN0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgZXJyb3IiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbihiKXthLmZuW2JdPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmJpbmQoYixhKX19KSxbImZvY3VzIiwiYmx1ciJdLmZvckVhY2goZnVuY3Rpb24oYil7YS5mbltiXT1mdW5jdGlvbihhKXtpZihhKXRoaXMuYmluZChiLGEpO2Vsc2UgaWYodGhpcy5sZW5ndGgpdHJ5e3RoaXMuZ2V0KDApW2JdKCl9Y2F0Y2goYyl7fXJldHVybiB0aGlzfX0pLGEuRXZlbnQ9ZnVuY3Rpb24oYixjKXt2YXIgZD1kb2N1bWVudC5jcmVhdGVFdmVudCgiRXZlbnRzIik7YyYmYS5leHRlbmQoZCxjKSxkLmluaXRFdmVudChiLCFjfHxjLmJ1YmJsZXMhPT0hMSwhMCk7cmV0dXJuIGR9fShaZXB0byksZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihhKXt2YXIgYT1hLGI9e30sYz1hLm1hdGNoKC8oQW5kcm9pZClccysoW1xkLl0rKS8pLGQ9YS5tYXRjaCgvKGlQYWQpLipPU1xzKFtcZF9dKykvKSxlPSFkJiZhLm1hdGNoKC8oaVBob25lXHNPUylccyhbXGRfXSspLyksZj1hLm1hdGNoKC8od2ViT1N8aHB3T1MpW1xzXC9dKFtcZC5dKykvKSxnPWYmJmEubWF0Y2goL1RvdWNoUGFkLyksaD1hLm1hdGNoKC8oQmxhY2tCZXJyeSkuKlZlcnNpb25cLyhbXGQuXSspLyk7YyYmKGIuYW5kcm9pZD0hMCxiLnZlcnNpb249Y1syXSksZSYmKGIuaW9zPSEwLGIudmVyc2lvbj1lWzJdLnJlcGxhY2UoL18vZywiLiIpLGIuaXBob25lPSEwKSxkJiYoYi5pb3M9ITAsYi52ZXJzaW9uPWRbMl0ucmVwbGFjZSgvXy9nLCIuIiksYi5pcGFkPSEwKSxmJiYoYi53ZWJvcz0hMCxiLnZlcnNpb249ZlsyXSksZyYmKGIudG91Y2hwYWQ9ITApLGgmJihiLmJsYWNrYmVycnk9ITAsYi52ZXJzaW9uPWhbMl0pO3JldHVybiBifWEub3M9YihuYXZpZ2F0b3IudXNlckFnZW50KSxhLl9fZGV0ZWN0PWI7dmFyIGM9bmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvV2ViS2l0XC8oW1xkLl0rKS8pO2EuYnJvd3Nlcj1jP3t3ZWJraXQ6ITAsdmVyc2lvbjpjWzFdfTp7d2Via2l0OiExfX0oWmVwdG8pLGZ1bmN0aW9uKGEsYil7dmFyIGM9WyJzY2FsZSIsInNjYWxlWCIsInNjYWxlWSIsInRyYW5zbGF0ZSIsInRyYW5zbGF0ZVgiLCJ0cmFuc2xhdGVZIiwidHJhbnNsYXRlM2QiLCJza2V3Iiwic2tld1giLCJza2V3WSIsInJvdGF0ZSIsInJvdGF0ZVgiLCJyb3RhdGVZIiwicm90YXRlWiIsInJvdGF0ZTNkIiwibWF0cml4Il07YS5mbi5hbmltPWZ1bmN0aW9uKGEsZCxlLGYpe3ZhciBnPVtdLGg9e30saSxqPXRoaXMsaztmb3IoaSBpbiBhKWMuaW5kZXhPZihpKT49MD9nLnB1c2goaSsiKCIrYVtpXSsiKSIpOmhbaV09YVtpXTtrPWZ1bmN0aW9uKCl7ai5jc3MoeyItd2Via2l0LXRyYW5zaXRpb24iOiJub25lIn0pLGYmJmYoKX0sZD4wP3RoaXMub25lKCJ3ZWJraXRUcmFuc2l0aW9uRW5kIixrKTpzZXRUaW1lb3V0KGssMCksZy5sZW5ndGg+MCYmKGhbIi13ZWJraXQtdHJhbnNmb3JtIl09Zy5qb2luKCIgIikpLGhbIi13ZWJraXQtdHJhbnNpdGlvbiJdPSJhbGwgIisoZCE9PWI/ZDouNSkrInMgIisoZXx8IiIpLHNldFRpbWVvdXQoZnVuY3Rpb24oKXtqLmNzcyhoKX0sMCk7cmV0dXJuIHRoaXN9fShaZXB0byksZnVuY3Rpb24oYSl7ZnVuY3Rpb24gZSgpe312YXIgYj0wLGM9YS5pc09iamVjdCxkO2EuYWpheEpTT05QPWZ1bmN0aW9uKGMpe3ZhciBkPSJqc29ucCIrICsrYixlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpO3dpbmRvd1tkXT1mdW5jdGlvbihhKXtjLnN1Y2Nlc3MoYSksZGVsZXRlIHdpbmRvd1tkXX0sZS5zcmM9Yy51cmwucmVwbGFjZSgvPVw/LywiPSIrZCksYSgiaGVhZCIpLmFwcGVuZChlKX0sYS5hamF4U2V0dGluZ3M9e3R5cGU6IkdFVCIsYmVmb3JlU2VuZDplLHN1Y2Nlc3M6ZSxlcnJvcjplLGNvbXBsZXRlOmUsYWNjZXB0czp7c2NyaXB0OiJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQiLGpzb246ImFwcGxpY2F0aW9uL2pzb24iLHhtbDoiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsaHRtbDoidGV4dC9odG1sIix0ZXh0OiJ0ZXh0L3BsYWluIn19LGEuYWpheD1mdW5jdGlvbihiKXtiPWJ8fHt9O3ZhciBlPWEuZXh0ZW5kKHt9LGIpO2ZvcihkIGluIGEuYWpheFNldHRpbmdzKWVbZF18fChlW2RdPWEuYWpheFNldHRpbmdzW2RdKTtpZigvPVw/Ly50ZXN0KGUudXJsKSlyZXR1cm4gYS5hamF4SlNPTlAoZSk7ZS51cmx8fChlLnVybD13aW5kb3cubG9jYXRpb24udG9TdHJpbmcoKSksZS5kYXRhJiYhZS5jb250ZW50VHlwZSYmKGUuY29udGVudFR5cGU9ImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpLGMoZS5kYXRhKSYmKGUuZGF0YT1hLnBhcmFtKGUuZGF0YSkpO2lmKGUudHlwZS5tYXRjaCgvZ2V0L2kpJiZlLmRhdGEpe3ZhciBmPWUuZGF0YTtlLnVybC5tYXRjaCgvXD8uKj0vKT9mPSImIitmOmZbMF0hPSI/IiYmKGY9Ij8iK2YpLGUudXJsKz1mfXZhciBnPWUuYWNjZXB0c1tlLmRhdGFUeXBlXSxoPW5ldyBYTUxIdHRwUmVxdWVzdDtlLmhlYWRlcnM9YS5leHRlbmQoeyJYLVJlcXVlc3RlZC1XaXRoIjoiWE1MSHR0cFJlcXVlc3QifSxlLmhlYWRlcnN8fHt9KSxnJiYoZS5oZWFkZXJzLkFjY2VwdD1nKSxoLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpe2lmKGgucmVhZHlTdGF0ZT09NCl7dmFyIGEsYj0hMTtpZihoLnN0YXR1cz49MjAwJiZoLnN0YXR1czwzMDB8fGguc3RhdHVzPT0wKXtpZihnPT0iYXBwbGljYXRpb24vanNvbiImJmgucmVzcG9uc2VUZXh0IT0iIil0cnl7YT1KU09OLnBhcnNlKGgucmVzcG9uc2VUZXh0KX1jYXRjaChjKXtiPWN9ZWxzZSBhPWgucmVzcG9uc2VUZXh0O2I/ZS5lcnJvcihoLCJwYXJzZXJlcnJvciIsYik6ZS5zdWNjZXNzKGEsInN1Y2Nlc3MiLGgpfWVsc2UgYj0hMCxlLmVycm9yKGgsImVycm9yIik7ZS5jb21wbGV0ZShoLGI/ImVycm9yIjoic3VjY2VzcyIpfX0saC5vcGVuKGUudHlwZSxlLnVybCwhMCk7aWYoZS5iZWZvcmVTZW5kKGgsZSk9PT0hMSl7aC5hYm9ydCgpO3JldHVybiExfWUuY29udGVudFR5cGUmJihlLmhlYWRlcnNbIkNvbnRlbnQtVHlwZSJdPWUuY29udGVudFR5cGUpO2ZvcihuYW1lIGluIGUuaGVhZGVycyloLnNldFJlcXVlc3RIZWFkZXIobmFtZSxlLmhlYWRlcnNbbmFtZV0pO2guc2VuZChlLmRhdGEpO3JldHVybiBofSxhLmdldD1mdW5jdGlvbihiLGMpe2EuYWpheCh7dXJsOmIsc3VjY2VzczpjfSl9LGEucG9zdD1mdW5jdGlvbihiLGMsZCxlKXthLmlzRnVuY3Rpb24oYykmJihlPWV8fGQsZD1jLGM9bnVsbCksYS5hamF4KHt0eXBlOiJQT1NUIix1cmw6YixkYXRhOmMsc3VjY2VzczpkLGRhdGFUeXBlOmV9KX0sYS5nZXRKU09OPWZ1bmN0aW9uKGIsYyl7YS5hamF4KHt1cmw6YixzdWNjZXNzOmMsZGF0YVR5cGU6Impzb24ifSl9LGEuZm4ubG9hZD1mdW5jdGlvbihiLGMpe2lmKCF0aGlzLmxlbmd0aClyZXR1cm4gdGhpczt2YXIgZD10aGlzLGU9Yi5zcGxpdCgvXHMvKSxmO2UubGVuZ3RoPjEmJihiPWVbMF0sZj1lWzFdKSxhLmdldChiLGZ1bmN0aW9uKGIpe2QuaHRtbChmP2EoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpLmh0bWwoYikuZmluZChmKS5odG1sKCk6YiksYyYmYygpfSk7cmV0dXJuIHRoaXN9LGEucGFyYW09ZnVuY3Rpb24oYixlKXt2YXIgZj1bXSxnPWZ1bmN0aW9uKGEsYil7Zi5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChlP2UrIlsiK2ErIl0iOmEpKyI9IitlbmNvZGVVUklDb21wb25lbnQoYikpfSxoPWEuaXNBcnJheShiKTtmb3IoZCBpbiBiKWMoYltkXSk/Zi5wdXNoKGEucGFyYW0oYltkXSxlP2UrIlsiK2QrIl0iOmQpKTpnKGg/IiI6ZCxiW2RdKTtyZXR1cm4gZi5qb2luKCImIikucmVwbGFjZSgiJTIwIiwiKyIpfX0oWmVwdG8pLGZ1bmN0aW9uKGEpe2EuZm4uc2VyaWFsaXplQXJyYXk9ZnVuY3Rpb24oKXt2YXIgYj1bXSxjO2EoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5nZXQoMCkuZWxlbWVudHMpKS5lYWNoKGZ1bmN0aW9uKCl7Yz1hKHRoaXMpLChjLmF0dHIoInR5cGUiKSE9PSJyYWRpbyJ8fGMuaXMoIjpjaGVja2VkIikpJiYoYy5hdHRyKCJ0eXBlIikhPT0iY2hlY2tib3gifHwhIWMuaXMoIjpjaGVja2VkIikpJiZiLnB1c2goe25hbWU6Yy5hdHRyKCJuYW1lIiksdmFsdWU6Yy52YWwoKX0pfSk7cmV0dXJuIGJ9LGEuZm4uc2VyaWFsaXplPWZ1bmN0aW9uKCl7dmFyIGE9W107dGhpcy5zZXJpYWxpemVBcnJheSgpLmZvckVhY2goZnVuY3Rpb24oYil7YS5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChiLm5hbWUpKyI9IitlbmNvZGVVUklDb21wb25lbnQoYi52YWx1ZSkpfSk7cmV0dXJuIGEuam9pbigiJiIpfSxhLmZuLnN1Ym1pdD1mdW5jdGlvbihiKXtpZihiKXRoaXMuYmluZCgic3VibWl0IixiKTtlbHNlIGlmKHRoaXMubGVuZ3RoKXt2YXIgYz1hLkV2ZW50KCJzdWJtaXQiKTt0aGlzLmVxKDApLnRyaWdnZXIoYyksYy5kZWZhdWx0UHJldmVudGVkfHx0aGlzLmdldCgwKS5zdWJtaXQoKX1yZXR1cm4gdGhpc319KFplcHRvKSxmdW5jdGlvbihhKXtmdW5jdGlvbiBnKCl7Yi5sYXN0JiZEYXRlLm5vdygpLWIubGFzdD49ZiYmKGEoYi50YXJnZXQpLnRyaWdnZXIoImxvbmdUYXAiKSxiPXt9KX1mdW5jdGlvbiBlKGEsYixjLGQpe3ZhciBlPU1hdGguYWJzKGEtYiksZj1NYXRoLmFicyhjLWQpO3JldHVybiBlPj1mP2EtYj4wPyJMZWZ0IjoiUmlnaHQiOmMtZD4wPyJVcCI6IkRvd24ifWZ1bmN0aW9uIGQoYSl7cmV0dXJuInRhZ05hbWUiaW4gYT9hOmEucGFyZW50Tm9kZX12YXIgYj17fSxjLGY9NzUwO2EoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7YShkb2N1bWVudC5ib2R5KS5iaW5kKCJ0b3VjaHN0YXJ0IixmdW5jdGlvbihhKXt2YXIgZT1EYXRlLm5vdygpLGg9ZS0oYi5sYXN0fHxlKTtiLnRhcmdldD1kKGEudG91Y2hlc1swXS50YXJnZXQpLGMmJmNsZWFyVGltZW91dChjKSxiLngxPWEudG91Y2hlc1swXS5wYWdlWCxiLnkxPWEudG91Y2hlc1swXS5wYWdlWSxoPjAmJmg8PTI1MCYmKGIuaXNEb3VibGVUYXA9ITApLGIubGFzdD1lLHNldFRpbWVvdXQoZyxmKX0pLmJpbmQoInRvdWNobW92ZSIsZnVuY3Rpb24oYSl7Yi54Mj1hLnRvdWNoZXNbMF0ucGFnZVgsYi55Mj1hLnRvdWNoZXNbMF0ucGFnZVl9KS5iaW5kKCJ0b3VjaGVuZCIsZnVuY3Rpb24oZCl7Yi5pc0RvdWJsZVRhcD8oYShiLnRhcmdldCkudHJpZ2dlcigiZG91YmxlVGFwIiksYj17fSk6Yi54Mj4wfHxiLnkyPjA/KChNYXRoLmFicyhiLngxLWIueDIpPjMwfHxNYXRoLmFicyhiLnkxLWIueTIpPjMwKSYmYShiLnRhcmdldCkudHJpZ2dlcigic3dpcGUiKSYmYShiLnRhcmdldCkudHJpZ2dlcigic3dpcGUiK2UoYi54MSxiLngyLGIueTEsYi55MikpLGIueDE9Yi54Mj1iLnkxPWIueTI9Yi5sYXN0PTApOiJsYXN0ImluIGImJihjPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtjPW51bGwsYShiLnRhcmdldCkudHJpZ2dlcigidGFwIiksYj17fX0sMjUwKSl9KS5iaW5kKCJ0b3VjaGNhbmNlbCIsZnVuY3Rpb24oKXtiPXt9fSl9KSxbInN3aXBlIiwic3dpcGVMZWZ0Iiwic3dpcGVSaWdodCIsInN3aXBlVXAiLCJzd2lwZURvd24iLCJkb3VibGVUYXAiLCJ0YXAiLCJsb25nVGFwIl0uZm9yRWFjaChmdW5jdGlvbihiKXthLmZuW2JdPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmJpbmQoYixhKX19KX0oWmVwdG8pCg=="},"vendor/phonegap/phonegap-1.0.0.js":{"content_type":"application/javascript","revpos":1,"data":"LyoKICogUGhvbmVHYXAgaXMgYXZhaWxhYmxlIHVuZGVyICplaXRoZXIqIHRoZSB0ZXJtcyBvZiB0aGUgbW9kaWZpZWQgQlNEIGxpY2Vuc2UgKm9yKiB0aGUKICogTUlUIExpY2Vuc2UgKDIwMDgpLiBTZWUgaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL2FscGhhYmV0aWNhbCBmb3IgZnVsbCB0ZXh0LgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDUtMjAxMCwgTml0b2JpIFNvZnR3YXJlIEluYy4KICogQ29weXJpZ2h0IChjKSAyMDEwLTIwMTEsIElCTSBDb3Jwb3JhdGlvbgogKi8KCmlmICh0eXBlb2YgUGhvbmVHYXAgPT09ICJ1bmRlZmluZWQiKSB7CgovKioKICogVGhlIG9yZGVyIG9mIGV2ZW50cyBkdXJpbmcgcGFnZSBsb2FkIGFuZCBQaG9uZUdhcCBzdGFydHVwIGlzIGFzIGZvbGxvd3M6CiAqCiAqIG9uRE9NQ29udGVudExvYWRlZCAgICAgICAgIEludGVybmFsIGV2ZW50IHRoYXQgaXMgcmVjZWl2ZWQgd2hlbiB0aGUgd2ViIHBhZ2UgaXMgbG9hZGVkIGFuZCBwYXJzZWQuCiAqIHdpbmRvdy5vbmxvYWQgICAgICAgICAgICAgIEJvZHkgb25sb2FkIGV2ZW50LgogKiBvbk5hdGl2ZVJlYWR5ICAgICAgICAgICAgICBJbnRlcm5hbCBldmVudCB0aGF0IGluZGljYXRlcyB0aGUgUGhvbmVHYXAgbmF0aXZlIHNpZGUgaXMgcmVhZHkuCiAqIG9uUGhvbmVHYXBJbml0ICAgICAgICAgICAgIEludGVybmFsIGV2ZW50IHRoYXQga2lja3Mgb2ZmIGNyZWF0aW9uIG9mIGFsbCBQaG9uZUdhcCBKYXZhU2NyaXB0IG9iamVjdHMgKHJ1bnMgY29uc3RydWN0b3JzKS4KICogb25QaG9uZUdhcFJlYWR5ICAgICAgICAgICAgSW50ZXJuYWwgZXZlbnQgZmlyZWQgd2hlbiBhbGwgUGhvbmVHYXAgSmF2YVNjcmlwdCBvYmplY3RzIGhhdmUgYmVlbiBjcmVhdGVkCiAqIG9uUGhvbmVHYXBJbmZvUmVhZHkgICAgICAgIEludGVybmFsIGV2ZW50IGZpcmVkIHdoZW4gZGV2aWNlIHByb3BlcnRpZXMgYXJlIGF2YWlsYWJsZQogKiBvbkRldmljZVJlYWR5ICAgICAgICAgICAgICBVc2VyIGV2ZW50IGZpcmVkIHRvIGluZGljYXRlIHRoYXQgUGhvbmVHYXAgaXMgcmVhZHkKICogb25SZXN1bWUgICAgICAgICAgICAgICAgICAgVXNlciBldmVudCBmaXJlZCB0byBpbmRpY2F0ZSBhIHN0YXJ0L3Jlc3VtZSBsaWZlY3ljbGUgZXZlbnQKICogb25QYXVzZSAgICAgICAgICAgICAgICAgICAgVXNlciBldmVudCBmaXJlZCB0byBpbmRpY2F0ZSBhIHBhdXNlIGxpZmVjeWNsZSBldmVudAogKiBvbkRlc3Ryb3kgICAgICAgICAgICAgICAgICBJbnRlcm5hbCBldmVudCBmaXJlZCB3aGVuIGFwcCBpcyBiZWluZyBkZXN0cm95ZWQgKFVzZXIgc2hvdWxkIHVzZSB3aW5kb3cub251bmxvYWQgZXZlbnQsIG5vdCB0aGlzIG9uZSkuCiAqCiAqIFRoZSBvbmx5IFBob25lR2FwIGV2ZW50cyB0aGF0IHVzZXIgY29kZSBzaG91bGQgcmVnaXN0ZXIgZm9yIGFyZToKICogICAgICBvbkRldmljZVJlYWR5CiAqICAgICAgb25SZXN1bWUKICoKICogTGlzdGVuZXJzIGNhbiBiZSByZWdpc3RlcmVkIGFzOgogKiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImRldmljZXJlYWR5IiwgbXlEZXZpY2VSZWFkeUxpc3RlbmVyLCBmYWxzZSk7CiAqICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigicmVzdW1lIiwgbXlSZXN1bWVMaXN0ZW5lciwgZmFsc2UpOwogKiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInBhdXNlIiwgbXlQYXVzZUxpc3RlbmVyLCBmYWxzZSk7CiAqLwoKaWYgKHR5cGVvZihEZXZpY2VJbmZvKSAhPT0gJ29iamVjdCcpIHsKICAgIHZhciBEZXZpY2VJbmZvID0ge307Cn0KCi8qKgogKiBUaGlzIHJlcHJlc2VudHMgdGhlIFBob25lR2FwIEFQSSBpdHNlbGYsIGFuZCBwcm92aWRlcyBhIGdsb2JhbCBuYW1lc3BhY2UgZm9yIGFjY2Vzc2luZwogKiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc3RhdGUgb2YgUGhvbmVHYXAuCiAqIEBjbGFzcwogKi8KdmFyIFBob25lR2FwID0gewogICAgcXVldWU6IHsKICAgICAgICByZWFkeTogdHJ1ZSwKICAgICAgICBjb21tYW5kczogW10sCiAgICAgICAgdGltZXI6IG51bGwKICAgIH0KfTsKCi8qKgogKiBMaXN0IG9mIHJlc291cmNlIGZpbGVzIGxvYWRlZCBieSBQaG9uZUdhcC4KICogVGhpcyBpcyB1c2VkIHRvIGVuc3VyZSBKUyBhbmQgb3RoZXIgZmlsZXMgYXJlIGxvYWRlZCBvbmx5IG9uY2UuCiAqLwpQaG9uZUdhcC5yZXNvdXJjZXMgPSB7YmFzZTogdHJ1ZX07CgovKioKICogRGV0ZXJtaW5lIGlmIHJlc291cmNlIGhhcyBiZWVuIGxvYWRlZCBieSBQaG9uZUdhcAogKgogKiBAcGFyYW0gbmFtZQogKiBAcmV0dXJuCiAqLwpQaG9uZUdhcC5oYXNSZXNvdXJjZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIHJldHVybiBQaG9uZUdhcC5yZXNvdXJjZXNbbmFtZV07Cn07CgovKioKICogQWRkIGEgcmVzb3VyY2UgdG8gbGlzdCBvZiBsb2FkZWQgcmVzb3VyY2VzIGJ5IFBob25lR2FwCiAqCiAqIEBwYXJhbSBuYW1lCiAqLwpQaG9uZUdhcC5hZGRSZXNvdXJjZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIFBob25lR2FwLnJlc291cmNlc1tuYW1lXSA9IHRydWU7Cn07CgovKioKICogQ3VzdG9tIHB1Yi1zdWIgY2hhbm5lbCB0aGF0IGNhbiBoYXZlIGZ1bmN0aW9ucyBzdWJzY3JpYmVkIHRvIGl0CiAqIEBjb25zdHJ1Y3RvcgogKi8KUGhvbmVHYXAuQ2hhbm5lbCA9IGZ1bmN0aW9uICh0eXBlKQp7CiAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgdGhpcy5oYW5kbGVycyA9IHt9OwogICAgdGhpcy5ndWlkID0gMDsKICAgIHRoaXMuZmlyZWQgPSBmYWxzZTsKICAgIHRoaXMuZW5hYmxlZCA9IHRydWU7Cn07CgovKioKICogU3Vic2NyaWJlcyB0aGUgZ2l2ZW4gZnVuY3Rpb24gdG8gdGhlIGNoYW5uZWwuIEFueSB0aW1lIHRoYXQKICogQ2hhbm5lbC5maXJlIGlzIGNhbGxlZCBzbyB0b28gd2lsbCB0aGUgZnVuY3Rpb24uCiAqIE9wdGlvbmFsbHkgc3BlY2lmeSBhbiBleGVjdXRpb24gY29udGV4dCBmb3IgdGhlIGZ1bmN0aW9uCiAqIGFuZCBhIGd1aWQgdGhhdCBjYW4gYmUgdXNlZCB0byBzdG9wIHN1YnNjcmliaW5nIHRvIHRoZSBjaGFubmVsLgogKiBSZXR1cm5zIHRoZSBndWlkLgogKi8KUGhvbmVHYXAuQ2hhbm5lbC5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24oZiwgYywgZykgewogICAgLy8gbmVlZCBhIGZ1bmN0aW9uIHRvIGNhbGwKICAgIGlmIChmID09PSBudWxsKSB7IHJldHVybjsgfQoKICAgIHZhciBmdW5jID0gZjsKICAgIGlmICh0eXBlb2YgYyA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIGYgPT09ICJmdW5jdGlvbiIpIHsgZnVuYyA9IFBob25lR2FwLmNsb3NlKGMsIGYpOyB9CgogICAgZyA9IGcgfHwgZnVuYy5vYnNlcnZlcl9ndWlkIHx8IGYub2JzZXJ2ZXJfZ3VpZCB8fCB0aGlzLmd1aWQrKzsKICAgIGZ1bmMub2JzZXJ2ZXJfZ3VpZCA9IGc7CiAgICBmLm9ic2VydmVyX2d1aWQgPSBnOwogICAgdGhpcy5oYW5kbGVyc1tnXSA9IGZ1bmM7CiAgICByZXR1cm4gZzsKfTsKCi8qKgogKiBMaWtlIHN1YnNjcmliZSBidXQgdGhlIGZ1bmN0aW9uIGlzIG9ubHkgY2FsbGVkIG9uY2UgYW5kIHRoZW4gaXQKICogYXV0by11bnN1YnNjcmliZXMgaXRzZWxmLgogKi8KUGhvbmVHYXAuQ2hhbm5lbC5wcm90b3R5cGUuc3Vic2NyaWJlT25jZSA9IGZ1bmN0aW9uKGYsIGMpIHsKICAgIHZhciBnID0gbnVsbDsKICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICB2YXIgbSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGYuYXBwbHkoYyB8fCBudWxsLCBhcmd1bWVudHMpOwogICAgICAgIF90aGlzLnVuc3Vic2NyaWJlKGcpOwogICAgfTsKICAgIGlmICh0aGlzLmZpcmVkKSB7CiAgICAgICAgaWYgKHR5cGVvZiBjID09PSAib2JqZWN0IiAmJiB0eXBlb2YgZiA9PT0gImZ1bmN0aW9uIikgeyBmID0gUGhvbmVHYXAuY2xvc2UoYywgZik7IH0KICAgICAgICBmLmFwcGx5KHRoaXMsIHRoaXMuZmlyZUFyZ3MpOwogICAgfSBlbHNlIHsKICAgICAgICBnID0gdGhpcy5zdWJzY3JpYmUobSk7CiAgICB9CiAgICByZXR1cm4gZzsKfTsKCi8qKgogKiBVbnN1YnNjcmliZXMgdGhlIGZ1bmN0aW9uIHdpdGggdGhlIGdpdmVuIGd1aWQgZnJvbSB0aGUgY2hhbm5lbC4KICovClBob25lR2FwLkNoYW5uZWwucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24oZykgewogICAgaWYgKHR5cGVvZiBnID09PSAiZnVuY3Rpb24iKSB7IGcgPSBnLm9ic2VydmVyX2d1aWQ7IH0KICAgIHRoaXMuaGFuZGxlcnNbZ10gPSBudWxsOwogICAgZGVsZXRlIHRoaXMuaGFuZGxlcnNbZ107Cn07CgovKioKICogQ2FsbHMgYWxsIGZ1bmN0aW9ucyBzdWJzY3JpYmVkIHRvIHRoaXMgY2hhbm5lbC4KICovClBob25lR2FwLkNoYW5uZWwucHJvdG90eXBlLmZpcmUgPSBmdW5jdGlvbihlKSB7CiAgICBpZiAodGhpcy5lbmFibGVkKSB7CiAgICAgICAgdmFyIGZhaWwgPSBmYWxzZTsKICAgICAgICB2YXIgaXRlbSwgaGFuZGxlciwgcnY7CiAgICAgICAgZm9yIChpdGVtIGluIHRoaXMuaGFuZGxlcnMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuaGFuZGxlcnMuaGFzT3duUHJvcGVydHkoaXRlbSkpIHsKICAgICAgICAgICAgICAgIGhhbmRsZXIgPSB0aGlzLmhhbmRsZXJzW2l0ZW1dOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBoYW5kbGVyID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgcnYgPSAoaGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpID09PSBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgZmFpbCA9IGZhaWwgfHwgcnY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5maXJlZCA9IHRydWU7CiAgICAgICAgdGhpcy5maXJlQXJncyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gIWZhaWw7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKfTsKCi8qKgogKiBDYWxscyB0aGUgcHJvdmlkZWQgZnVuY3Rpb24gb25seSBhZnRlciBhbGwgb2YgdGhlIGNoYW5uZWxzIHNwZWNpZmllZAogKiBoYXZlIGJlZW4gZmlyZWQuCiAqLwpQaG9uZUdhcC5DaGFubmVsLmpvaW4gPSBmdW5jdGlvbihoLCBjKSB7CiAgICB2YXIgaSA9IGMubGVuZ3RoOwogICAgdmFyIGYgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoISgtLWkpKSB7CiAgICAgICAgICAgIGgoKTsKICAgICAgICB9CiAgICB9OwogICAgdmFyIGxlbiA9IGk7CiAgICB2YXIgajsKICAgIGZvciAoaj0wOyBqPGxlbjsgaisrKSB7CiAgICAgICAgaWYgKCFjW2pdLmZpcmVkKSB7CiAgICAgICAgICAgIGNbal0uc3Vic2NyaWJlT25jZShmKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGktLTsKICAgICAgICB9CiAgICB9CiAgICBpZiAoIWkpIHsKICAgICAgICBoKCk7CiAgICB9Cn07CgovKioKICogQm9vbGVhbiBmbGFnIGluZGljYXRpbmcgaWYgdGhlIFBob25lR2FwIEFQSSBpcyBhdmFpbGFibGUgYW5kIGluaXRpYWxpemVkLgogKi8gLy8gVE9ETzogUmVtb3ZlIHRoaXMsIGl0IGlzIHVudXNlZCBoZXJlIC4uLiAtam0KUGhvbmVHYXAuYXZhaWxhYmxlID0gRGV2aWNlSW5mby51dWlkICE9PSB1bmRlZmluZWQ7CgovKioKICogQWRkIGFuIGluaXRpYWxpemF0aW9uIGZ1bmN0aW9uIHRvIGEgcXVldWUgdGhhdCBlbnN1cmVzIGl0IHdpbGwgcnVuIGFuZCBpbml0aWFsaXplCiAqIGFwcGxpY2F0aW9uIGNvbnN0cnVjdG9ycyBvbmx5IG9uY2UgUGhvbmVHYXAgaGFzIGJlZW4gaW5pdGlhbGl6ZWQuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIGNhbGxiYWNrIHlvdSB3YW50IHJ1biBvbmNlIFBob25lR2FwIGlzIGluaXRpYWxpemVkCiAqLwpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIFBob25lR2FwLm9uUGhvbmVHYXBJbml0LnN1YnNjcmliZU9uY2UoZnVuY3Rpb24oKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZnVuYygpOwogICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiRmFpbGVkIHRvIHJ1biBjb25zdHJ1Y3RvcjogIiArIGUpOwogICAgICAgIH0KICAgIH0pOwp9OwoKLyoqCiAqIFBsdWdpbnMgb2JqZWN0CiAqLwppZiAoIXdpbmRvdy5wbHVnaW5zKSB7CiAgICB3aW5kb3cucGx1Z2lucyA9IHt9Owp9CgovKioKICogQWRkcyBhIHBsdWdpbiBvYmplY3QgdG8gd2luZG93LnBsdWdpbnMuCiAqIFRoZSBwbHVnaW4gaXMgYWNjZXNzZWQgdXNpbmcgd2luZG93LnBsdWdpbnMuPG5hbWU+CiAqCiAqIEBwYXJhbSBuYW1lICAgICAgICAgIFRoZSBwbHVnaW4gbmFtZQogKiBAcGFyYW0gb2JqICAgICAgICAgICBUaGUgcGx1Z2luIG9iamVjdAogKi8KUGhvbmVHYXAuYWRkUGx1Z2luID0gZnVuY3Rpb24obmFtZSwgb2JqKSB7CiAgICBpZiAoIXdpbmRvdy5wbHVnaW5zW25hbWVdKSB7CiAgICAgICAgd2luZG93LnBsdWdpbnNbbmFtZV0gPSBvYmo7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZygiRXJyb3I6IFBsdWdpbiAiK25hbWUrIiBhbHJlYWR5IGV4aXN0cy4iKTsKICAgIH0KfTsKCi8qKgogKiBvbkRPTUNvbnRlbnRMb2FkZWQgY2hhbm5lbCBpcyBmaXJlZCB3aGVuIHRoZSBET00gY29udGVudAogKiBvZiB0aGUgcGFnZSBoYXMgYmVlbiBwYXJzZWQuCiAqLwpQaG9uZUdhcC5vbkRPTUNvbnRlbnRMb2FkZWQgPSBuZXcgUGhvbmVHYXAuQ2hhbm5lbCgnb25ET01Db250ZW50TG9hZGVkJyk7CgovKioKICogb25OYXRpdmVSZWFkeSBjaGFubmVsIGlzIGZpcmVkIHdoZW4gdGhlIFBob25lR2FwIG5hdGl2ZSBjb2RlCiAqIGhhcyBiZWVuIGluaXRpYWxpemVkLgogKi8KUGhvbmVHYXAub25OYXRpdmVSZWFkeSA9IG5ldyBQaG9uZUdhcC5DaGFubmVsKCdvbk5hdGl2ZVJlYWR5Jyk7CgovKioKICogb25QaG9uZUdhcEluaXQgY2hhbm5lbCBpcyBmaXJlZCB3aGVuIHRoZSB3ZWIgcGFnZSBpcyBmdWxseSBsb2FkZWQgYW5kCiAqIFBob25lR2FwIG5hdGl2ZSBjb2RlIGhhcyBiZWVuIGluaXRpYWxpemVkLgogKi8KUGhvbmVHYXAub25QaG9uZUdhcEluaXQgPSBuZXcgUGhvbmVHYXAuQ2hhbm5lbCgnb25QaG9uZUdhcEluaXQnKTsKCi8qKgogKiBvblBob25lR2FwUmVhZHkgY2hhbm5lbCBpcyBmaXJlZCB3aGVuIHRoZSBKUyBQaG9uZUdhcCBvYmplY3RzIGhhdmUgYmVlbiBjcmVhdGVkLgogKi8KUGhvbmVHYXAub25QaG9uZUdhcFJlYWR5ID0gbmV3IFBob25lR2FwLkNoYW5uZWwoJ29uUGhvbmVHYXBSZWFkeScpOwoKLyoqCiAqIG9uUGhvbmVHYXBJbmZvUmVhZHkgY2hhbm5lbCBpcyBmaXJlZCB3aGVuIHRoZSBQaG9uZUdhcCBkZXZpY2UgcHJvcGVydGllcwogKiBoYXMgYmVlbiBzZXQuCiAqLwpQaG9uZUdhcC5vblBob25lR2FwSW5mb1JlYWR5ID0gbmV3IFBob25lR2FwLkNoYW5uZWwoJ29uUGhvbmVHYXBJbmZvUmVhZHknKTsKCi8qKgogKiBvblBob25lR2FwQ29ubmVjdGlvblJlYWR5IGNoYW5uZWwgaXMgZmlyZWQgd2hlbiB0aGUgUGhvbmVHYXAgY29ubmVjdGlvbiBwcm9wZXJ0aWVzCiAqIGhhcyBiZWVuIHNldC4KICovClBob25lR2FwLm9uUGhvbmVHYXBDb25uZWN0aW9uUmVhZHkgPSBuZXcgUGhvbmVHYXAuQ2hhbm5lbCgnb25QaG9uZUdhcENvbm5lY3Rpb25SZWFkeScpOwoKLyoqCiAqIG9uUmVzdW1lIGNoYW5uZWwgaXMgZmlyZWQgd2hlbiB0aGUgUGhvbmVHYXAgbmF0aXZlIGNvZGUKICogcmVzdW1lcy4KICovClBob25lR2FwLm9uUmVzdW1lID0gbmV3IFBob25lR2FwLkNoYW5uZWwoJ29uUmVzdW1lJyk7CgovKioKICogb25QYXVzZSBjaGFubmVsIGlzIGZpcmVkIHdoZW4gdGhlIFBob25lR2FwIG5hdGl2ZSBjb2RlCiAqIHBhdXNlcy4KICovClBob25lR2FwLm9uUGF1c2UgPSBuZXcgUGhvbmVHYXAuQ2hhbm5lbCgnb25QYXVzZScpOwoKLyoqCiAqIG9uRGVzdHJveSBjaGFubmVsIGlzIGZpcmVkIHdoZW4gdGhlIFBob25lR2FwIG5hdGl2ZSBjb2RlCiAqIGlzIGRlc3Ryb3llZC4gIEl0IGlzIHVzZWQgaW50ZXJuYWxseS4KICogV2luZG93Lm9udW5sb2FkIHNob3VsZCBiZSB1c2VkIGJ5IHRoZSB1c2VyLgogKi8KUGhvbmVHYXAub25EZXN0cm95ID0gbmV3IFBob25lR2FwLkNoYW5uZWwoJ29uRGVzdHJveScpOwpQaG9uZUdhcC5vbkRlc3Ryb3kuc3Vic2NyaWJlT25jZShmdW5jdGlvbigpIHsKICAgIFBob25lR2FwLnNodXR0aW5nRG93biA9IHRydWU7Cn0pOwpQaG9uZUdhcC5zaHV0dGluZ0Rvd24gPSBmYWxzZTsKCi8vIF9uYXRpdmVSZWFkeSBpcyBnbG9iYWwgdmFyaWFibGUgdGhhdCB0aGUgbmF0aXZlIHNpZGUgY2FuIHNldAovLyB0byBzaWduaWZ5IHRoYXQgdGhlIG5hdGl2ZSBjb2RlIGlzIHJlYWR5LiBJdCBpcyBhIGdsb2JhbCBzaW5jZQovLyBpdCBtYXkgYmUgY2FsbGVkIGJlZm9yZSBhbnkgUGhvbmVHYXAgSlMgaXMgcmVhZHkuCmlmICh0eXBlb2YgX25hdGl2ZVJlYWR5ICE9PSAndW5kZWZpbmVkJykgeyBQaG9uZUdhcC5vbk5hdGl2ZVJlYWR5LmZpcmUoKTsgfQoKLyoqCiAqIG9uRGV2aWNlUmVhZHkgaXMgZmlyZWQgb25seSBhZnRlciBhbGwgUGhvbmVHYXAgb2JqZWN0cyBhcmUgY3JlYXRlZCBhbmQKICogdGhlIGRldmljZSBwcm9wZXJ0aWVzIGFyZSBzZXQuCiAqLwpQaG9uZUdhcC5vbkRldmljZVJlYWR5ID0gbmV3IFBob25lR2FwLkNoYW5uZWwoJ29uRGV2aWNlUmVhZHknKTsKCgovLyBBcnJheSBvZiBjaGFubmVscyB0aGF0IG11c3QgZmlyZSBiZWZvcmUgImRldmljZXJlYWR5IiBpcyBmaXJlZApQaG9uZUdhcC5kZXZpY2VSZWFkeUNoYW5uZWxzQXJyYXkgPSBbIFBob25lR2FwLm9uUGhvbmVHYXBSZWFkeSwgUGhvbmVHYXAub25QaG9uZUdhcEluZm9SZWFkeSwgUGhvbmVHYXAub25QaG9uZUdhcENvbm5lY3Rpb25SZWFkeV07CgovLyBIYXNodGFibGUgb2YgdXNlciBkZWZpbmVkIGNoYW5uZWxzIHRoYXQgbXVzdCBhbHNvIGZpcmUgYmVmb3JlICJkZXZpY2VyZWFkeSIgaXMgZmlyZWQKUGhvbmVHYXAuZGV2aWNlUmVhZHlDaGFubmVsc01hcCA9IHt9OwoKLyoqCiAqIEluZGljYXRlIHRoYXQgYSBmZWF0dXJlIG5lZWRzIHRvIGJlIGluaXRpYWxpemVkIGJlZm9yZSBpdCBpcyByZWFkeSB0byBiZSB1c2VkLgogKiBUaGlzIGhvbGRzIHVwIFBob25lR2FwJ3MgImRldmljZXJlYWR5IiBldmVudCB1bnRpbCB0aGUgZmVhdHVyZSBoYXMgYmVlbiBpbml0aWFsaXplZAogKiBhbmQgUGhvbmVHYXAuaW5pdENvbXBsZXRlKGZlYXR1cmUpIGlzIGNhbGxlZC4KICoKICogQHBhcmFtIGZlYXR1cmUge1N0cmluZ30gICAgIFRoZSB1bmlxdWUgZmVhdHVyZSBuYW1lCiAqLwpQaG9uZUdhcC53YWl0Rm9ySW5pdGlhbGl6YXRpb24gPSBmdW5jdGlvbihmZWF0dXJlKSB7CiAgICBpZiAoZmVhdHVyZSkgewogICAgICAgIHZhciBjaGFubmVsID0gbmV3IFBob25lR2FwLkNoYW5uZWwoZmVhdHVyZSk7CiAgICAgICAgUGhvbmVHYXAuZGV2aWNlUmVhZHlDaGFubmVsc01hcFtmZWF0dXJlXSA9IGNoYW5uZWw7CiAgICAgICAgUGhvbmVHYXAuZGV2aWNlUmVhZHlDaGFubmVsc0FycmF5LnB1c2goY2hhbm5lbCk7CiAgICB9Cn07CgovKioKICogSW5kaWNhdGUgdGhhdCBpbml0aWFsaXphdGlvbiBjb2RlIGhhcyBjb21wbGV0ZWQgYW5kIHRoZSBmZWF0dXJlIGlzIHJlYWR5IHRvIGJlIHVzZWQuCiAqCiAqIEBwYXJhbSBmZWF0dXJlIHtTdHJpbmd9ICAgICBUaGUgdW5pcXVlIGZlYXR1cmUgbmFtZQogKi8KUGhvbmVHYXAuaW5pdGlhbGl6YXRpb25Db21wbGV0ZSA9IGZ1bmN0aW9uKGZlYXR1cmUpIHsKICAgIHZhciBjaGFubmVsID0gUGhvbmVHYXAuZGV2aWNlUmVhZHlDaGFubmVsc01hcFtmZWF0dXJlXTsKICAgIGlmIChjaGFubmVsKSB7CiAgICAgICAgY2hhbm5lbC5maXJlKCk7CiAgICB9Cn07CgovKioKICogQ3JlYXRlIGFsbCBQaG9uZUdhcCBvYmplY3RzIG9uY2UgcGFnZSBoYXMgZnVsbHkgbG9hZGVkIGFuZCBuYXRpdmUgc2lkZSBpcyByZWFkeS4KICovClBob25lR2FwLkNoYW5uZWwuam9pbihmdW5jdGlvbigpIHsKCiAgICAvLyBTdGFydCBsaXN0ZW5pbmcgZm9yIFhIUiBjYWxsYmFja3MKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChQaG9uZUdhcC5Vc2VQb2xsaW5nKSB7CiAgICAgICAgICAgICAgICBQaG9uZUdhcC5KU0NhbGxiYWNrUG9sbGluZygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdmFyIHBvbGxpbmcgPSBwcm9tcHQoInVzZVBvbGxpbmciLCAiZ2FwX2NhbGxiYWNrU2VydmVyOiIpOwogICAgICAgICAgICAgICAgUGhvbmVHYXAuVXNlUG9sbGluZyA9IHBvbGxpbmc7CiAgICAgICAgICAgICAgICBpZiAocG9sbGluZyA9PSAidHJ1ZSIpIHsKICAgICAgICAgICAgICAgICAgICBQaG9uZUdhcC5Vc2VQb2xsaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBQaG9uZUdhcC5KU0NhbGxiYWNrUG9sbGluZygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgUGhvbmVHYXAuVXNlUG9sbGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIFBob25lR2FwLkpTQ2FsbGJhY2soKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sIDEpOwoKICAgIC8vIFJ1biBQaG9uZUdhcCBjb25zdHJ1Y3RvcnMKICAgIFBob25lR2FwLm9uUGhvbmVHYXBJbml0LmZpcmUoKTsKCiAgICAvLyBGaXJlIGV2ZW50IHRvIG5vdGlmeSB0aGF0IGFsbCBvYmplY3RzIGFyZSBjcmVhdGVkCiAgICBQaG9uZUdhcC5vblBob25lR2FwUmVhZHkuZmlyZSgpOwoKICAgIC8vIEZpcmUgb25EZXZpY2VSZWFkeSBldmVudCBvbmNlIGFsbCBjb25zdHJ1Y3RvcnMgaGF2ZSBydW4gYW5kIFBob25lR2FwIGluZm8gaGFzIGJlZW4KICAgIC8vIHJlY2VpdmVkIGZyb20gbmF0aXZlIHNpZGUsIGFuZCBhbnkgdXNlciBkZWZpbmVkIGluaXRpYWxpemF0aW9uIGNoYW5uZWxzLgogICAgUGhvbmVHYXAuQ2hhbm5lbC5qb2luKGZ1bmN0aW9uKCkgewogICAgICAgIFBob25lR2FwLm9uRGV2aWNlUmVhZHkuZmlyZSgpOwoKICAgICAgICAvLyBGaXJlIHRoZSBvbnJlc3VtZSBldmVudCwgc2luY2UgZmlyc3Qgb25lIGhhcHBlbnMgYmVmb3JlIEphdmFTY3JpcHQgaXMgbG9hZGVkCiAgICAgICAgUGhvbmVHYXAub25SZXN1bWUuZmlyZSgpOwogICAgfSwgUGhvbmVHYXAuZGV2aWNlUmVhZHlDaGFubmVsc0FycmF5KTsKCn0sIFsgUGhvbmVHYXAub25ET01Db250ZW50TG9hZGVkLCBQaG9uZUdhcC5vbk5hdGl2ZVJlYWR5IF0pOwoKLy8gTGlzdGVuIGZvciBET01Db250ZW50TG9hZGVkIGFuZCBub3RpZnkgb3VyIGNoYW5uZWwgc3Vic2NyaWJlcnMKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkgewogICAgUGhvbmVHYXAub25ET01Db250ZW50TG9hZGVkLmZpcmUoKTsKfSwgZmFsc2UpOwoKLy8gSW50ZXJjZXB0IGNhbGxzIHRvIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgYW5kIHdhdGNoIGZvciBkZXZpY2VyZWFkeQpQaG9uZUdhcC5tX2RvY3VtZW50X2FkZEV2ZW50TGlzdGVuZXIgPSBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyOwoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uKGV2dCwgaGFuZGxlciwgY2FwdHVyZSkgewogICAgdmFyIGUgPSBldnQudG9Mb3dlckNhc2UoKTsKICAgIGlmIChlID09PSAnZGV2aWNlcmVhZHknKSB7CiAgICAgICAgUGhvbmVHYXAub25EZXZpY2VSZWFkeS5zdWJzY3JpYmVPbmNlKGhhbmRsZXIpOwogICAgfSBlbHNlIGlmIChlID09PSAncmVzdW1lJykgewogICAgICAgIFBob25lR2FwLm9uUmVzdW1lLnN1YnNjcmliZShoYW5kbGVyKTsKICAgICAgICBpZiAoUGhvbmVHYXAub25EZXZpY2VSZWFkeS5maXJlZCkgewogICAgICAgICAgICBQaG9uZUdhcC5vblJlc3VtZS5maXJlKCk7CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChlID09PSAncGF1c2UnKSB7CiAgICAgICAgUGhvbmVHYXAub25QYXVzZS5zdWJzY3JpYmUoaGFuZGxlcik7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAvLyBJZiBzdWJzY3JpYmluZyB0byBBbmRyb2lkIGJhY2tidXR0b24KICAgICAgICBpZiAoZSA9PT0gJ2JhY2tidXR0b24nKSB7CiAgICAgICAgICAgIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIkFwcCIsICJvdmVycmlkZUJhY2tidXR0b24iLCBbdHJ1ZV0pOwogICAgICAgIH0KCiAgICAgICAgUGhvbmVHYXAubV9kb2N1bWVudF9hZGRFdmVudExpc3RlbmVyLmNhbGwoZG9jdW1lbnQsIGV2dCwgaGFuZGxlciwgY2FwdHVyZSk7CiAgICB9Cn07CgovLyBJbnRlcmNlcHQgY2FsbHMgdG8gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciBhbmQgd2F0Y2ggZm9yIGV2ZW50cyB0aGF0Ci8vIGFyZSBnZW5lcmF0ZWQgYnkgUGhvbmVHYXAgbmF0aXZlIGNvZGUKUGhvbmVHYXAubV9kb2N1bWVudF9yZW1vdmVFdmVudExpc3RlbmVyID0gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcjsKCmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihldnQsIGhhbmRsZXIsIGNhcHR1cmUpIHsKICAgIHZhciBlID0gZXZ0LnRvTG93ZXJDYXNlKCk7CgogICAgLy8gSWYgdW5zdWJzY3JpYmluZyB0byBBbmRyb2lkIGJhY2tidXR0b24KICAgIGlmIChlID09PSAnYmFja2J1dHRvbicpIHsKICAgICAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJBcHAiLCAib3ZlcnJpZGVCYWNrYnV0dG9uIiwgW2ZhbHNlXSk7CiAgICB9CgogICAgUGhvbmVHYXAubV9kb2N1bWVudF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwoZG9jdW1lbnQsIGV2dCwgaGFuZGxlciwgY2FwdHVyZSk7Cn07CgovKioKICogTWV0aG9kIHRvIGZpcmUgZXZlbnQgZnJvbSBuYXRpdmUgY29kZQogKi8KUGhvbmVHYXAuZmlyZUV2ZW50ID0gZnVuY3Rpb24odHlwZSkgewogICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnRzJyk7CiAgICBlLmluaXRFdmVudCh0eXBlKTsKICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoZSk7Cn07CgovKioKICogSWYgSlNPTiBub3QgaW5jbHVkZWQsIHVzZSBvdXIgb3duIHN0cmluZ2lmeS4gKEFuZHJvaWQgMS42KQogKiBUaGUgcmVzdHJpY3Rpb24gb24gb3VycyBpcyB0aGF0IGl0IG11c3QgYmUgYW4gYXJyYXkgb2Ygc2ltcGxlIHR5cGVzLgogKgogKiBAcGFyYW0gYXJncwogKiBAcmV0dXJuIHtTdHJpbmd9CiAqLwpQaG9uZUdhcC5zdHJpbmdpZnkgPSBmdW5jdGlvbihhcmdzKSB7CiAgICBpZiAodHlwZW9mIEpTT04gPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgdmFyIHMgPSAiWyI7CiAgICAgICAgdmFyIGksIHR5cGUsIHN0YXJ0LCBuYW1lLCBuYW1lVHlwZSwgYTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoYXJnc1tpXSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcyA9IHMgKyAiLCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0eXBlID0gdHlwZW9mIGFyZ3NbaV07CiAgICAgICAgICAgICAgICBpZiAoKHR5cGUgPT09ICJudW1iZXIiKSB8fCAodHlwZSA9PT0gImJvb2xlYW4iKSkgewogICAgICAgICAgICAgICAgICAgIHMgPSBzICsgYXJnc1tpXTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXJnc1tpXSBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgICAgICAgICAgICAgICAgcyA9IHMgKyAiWyIgKyBhcmdzW2ldICsgIl0iOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhcmdzW2ldIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHMgPSBzICsgJ3snOwogICAgICAgICAgICAgICAgICAgIGZvciAobmFtZSBpbiBhcmdzW2ldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzW2ldW25hbWVdICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IHMgKyAnLCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gcyArICciJyArIG5hbWUgKyAnIjonOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZVR5cGUgPSB0eXBlb2YgYXJnc1tpXVtuYW1lXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobmFtZVR5cGUgPT09ICJudW1iZXIiKSB8fCAobmFtZVR5cGUgPT09ICJib29sZWFuIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gcyArIGFyZ3NbaV1bbmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCh0eXBlb2YgYXJnc1tpXVtuYW1lXSkgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkb24ndCBjb3B5IHRoZSBmdW5jdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gcyArICciIic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFyZ3NbaV1bbmFtZV0gaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gcyArIFBob25lR2FwLnN0cmluZ2lmeShhcmdzW2ldW25hbWVdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9IHMgKyAnIicgKyBhcmdzW2ldW25hbWVdICsgJyInOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzID0gcyArICd9JzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYSA9IGFyZ3NbaV0ucmVwbGFjZSgvXFwvZywgJ1xcXFwnKTsKICAgICAgICAgICAgICAgICAgICBhID0gYS5yZXBsYWNlKC8iL2csICdcXCInKTsKICAgICAgICAgICAgICAgICAgICBzID0gcyArICciJyArIGEgKyAnIic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcyA9IHMgKyAiXSI7CiAgICAgICAgcmV0dXJuIHM7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhcmdzKTsKICAgIH0KfTsKCi8qKgogKiBEb2VzIGEgZGVlcCBjbG9uZSBvZiB0aGUgb2JqZWN0LgogKgogKiBAcGFyYW0gb2JqCiAqIEByZXR1cm4ge09iamVjdH0KICovClBob25lR2FwLmNsb25lID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgaSwgcmV0VmFsOwogICAgaWYoIW9iaikgeyAKICAgICAgICByZXR1cm4gb2JqOwogICAgfQogICAgCiAgICBpZihvYmogaW5zdGFuY2VvZiBBcnJheSl7CiAgICAgICAgcmV0VmFsID0gW107CiAgICAgICAgZm9yKGkgPSAwOyBpIDwgb2JqLmxlbmd0aDsgKytpKXsKICAgICAgICAgICAgcmV0VmFsLnB1c2goUGhvbmVHYXAuY2xvbmUob2JqW2ldKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXRWYWw7CiAgICB9CiAgICAKICAgIGlmICh0eXBlb2Ygb2JqID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgcmV0dXJuIG9iajsKICAgIH0KICAgIAogICAgaWYoIShvYmogaW5zdGFuY2VvZiBPYmplY3QpKXsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQogICAgCiAgICBpZiAob2JqIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgIHJldHVybiBvYmo7CiAgICB9CiAgICAKICAgIHJldFZhbCA9IHt9OwogICAgZm9yKGkgaW4gb2JqKXsKICAgICAgICBpZighKGkgaW4gcmV0VmFsKSB8fCByZXRWYWxbaV0gIT09IG9ialtpXSkgewogICAgICAgICAgICByZXRWYWxbaV0gPSBQaG9uZUdhcC5jbG9uZShvYmpbaV0pOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXRWYWw7Cn07CgpQaG9uZUdhcC5jYWxsYmFja0lkID0gMDsKUGhvbmVHYXAuY2FsbGJhY2tzID0ge307ClBob25lR2FwLmNhbGxiYWNrU3RhdHVzID0gewogICAgTk9fUkVTVUxUOiAwLAogICAgT0s6IDEsCiAgICBDTEFTU19OT1RfRk9VTkRfRVhDRVBUSU9OOiAyLAogICAgSUxMRUdBTF9BQ0NFU1NfRVhDRVBUSU9OOiAzLAogICAgSU5TVEFOVElBVElPTl9FWENFUFRJT046IDQsCiAgICBNQUxGT1JNRURfVVJMX0VYQ0VQVElPTjogNSwKICAgIElPX0VYQ0VQVElPTjogNiwKICAgIElOVkFMSURfQUNUSU9OOiA3LAogICAgSlNPTl9FWENFUFRJT046IDgsCiAgICBFUlJPUjogOQogICAgfTsKCgovKioKICogRXhlY3V0ZSBhIFBob25lR2FwIGNvbW1hbmQuICBJdCBpcyB1cCB0byB0aGUgbmF0aXZlIHNpZGUgd2hldGhlciB0aGlzIGFjdGlvbiBpcyBzeW5jaCBvciBhc3luYy4KICogVGhlIG5hdGl2ZSBzaWRlIGNhbiByZXR1cm46CiAqICAgICAgU3luY2hyb25vdXM6IFBsdWdpblJlc3VsdCBvYmplY3QgYXMgYSBKU09OIHN0cmluZwogKiAgICAgIEFzeW5jaHJvdW5vdXM6IEVtcHR5IHN0cmluZyAiIgogKiBJZiBhc3luYywgdGhlIG5hdGl2ZSBzaWRlIHdpbGwgUGhvbmVHYXAuY2FsbGJhY2tTdWNjZXNzIG9yIFBob25lR2FwLmNhbGxiYWNrRXJyb3IsCiAqIGRlcGVuZGluZyB1cG9uIHRoZSByZXN1bHQgb2YgdGhlIGFjdGlvbi4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2VzcyAgICBUaGUgc3VjY2VzcyBjYWxsYmFjawogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmYWlsICAgICAgIFRoZSBmYWlsIGNhbGxiYWNrCiAqIEBwYXJhbSB7U3RyaW5nfSBzZXJ2aWNlICAgICAgVGhlIG5hbWUgb2YgdGhlIHNlcnZpY2UgdG8gdXNlCiAqIEBwYXJhbSB7U3RyaW5nfSBhY3Rpb24gICAgICAgQWN0aW9uIHRvIGJlIHJ1biBpbiBQaG9uZUdhcAogKiBAcGFyYW0ge0FycmF5LjxTdHJpbmc+fSBbYXJnc10gICAgIFplcm8gb3IgbW9yZSBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgbWV0aG9kCiAqLwpQaG9uZUdhcC5leGVjID0gZnVuY3Rpb24oc3VjY2VzcywgZmFpbCwgc2VydmljZSwgYWN0aW9uLCBhcmdzKSB7CiAgICB0cnkgewogICAgICAgIHZhciBjYWxsYmFja0lkID0gc2VydmljZSArIFBob25lR2FwLmNhbGxiYWNrSWQrKzsKICAgICAgICBpZiAoc3VjY2VzcyB8fCBmYWlsKSB7CiAgICAgICAgICAgIFBob25lR2FwLmNhbGxiYWNrc1tjYWxsYmFja0lkXSA9IHtzdWNjZXNzOnN1Y2Nlc3MsIGZhaWw6ZmFpbH07CiAgICAgICAgfQoKICAgICAgICB2YXIgciA9IHByb21wdChQaG9uZUdhcC5zdHJpbmdpZnkoYXJncyksICJnYXA6IitQaG9uZUdhcC5zdHJpbmdpZnkoW3NlcnZpY2UsIGFjdGlvbiwgY2FsbGJhY2tJZCwgdHJ1ZV0pKTsKCiAgICAgICAgLy8gSWYgYSByZXN1bHQgd2FzIHJldHVybmVkCiAgICAgICAgaWYgKHIubGVuZ3RoID4gMCkgewogICAgICAgICAgICBldmFsKCJ2YXIgdj0iK3IrIjsiKTsKCiAgICAgICAgICAgIC8vIElmIHN0YXR1cyBpcyBPSywgdGhlbiByZXR1cm4gdmFsdWUgYmFjayB0byBjYWxsZXIKICAgICAgICAgICAgaWYgKHYuc3RhdHVzID09PSBQaG9uZUdhcC5jYWxsYmFja1N0YXR1cy5PSykgewoKICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGEgc3VjY2VzcyBjYWxsYmFjaywgdGhlbiBjYWxsIGl0IG5vdyB3aXRoCiAgICAgICAgICAgICAgICAvLyByZXR1cm5lZCB2YWx1ZQogICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzKHYubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXJyb3IgaW4gc3VjY2VzcyBjYWxsYmFjazogIiArIGNhbGxiYWNrSWQgICsgIiA9ICIgKyBlKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIENsZWFyIGNhbGxiYWNrIGlmIG5vdCBleHBlY3RpbmcgYW55IG1vcmUgcmVzdWx0cwogICAgICAgICAgICAgICAgICAgIGlmICghdi5rZWVwQ2FsbGJhY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIFBob25lR2FwLmNhbGxiYWNrc1tjYWxsYmFja0lkXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdi5tZXNzYWdlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJZiBubyByZXN1bHQKICAgICAgICAgICAgZWxzZSBpZiAodi5zdGF0dXMgPT09IFBob25lR2FwLmNhbGxiYWNrU3RhdHVzLk5PX1JFU1VMVCkgewoKICAgICAgICAgICAgICAgIC8vIENsZWFyIGNhbGxiYWNrIGlmIG5vdCBleHBlY3RpbmcgYW55IG1vcmUgcmVzdWx0cwogICAgICAgICAgICAgICAgaWYgKCF2LmtlZXBDYWxsYmFjaykgewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElmIGVycm9yLCB0aGVuIGRpc3BsYXkgZXJyb3IKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXJyb3I6IFN0YXR1cz0iK3Yuc3RhdHVzKyIgTWVzc2FnZT0iK3YubWVzc2FnZSk7CgogICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBmYWlsIGNhbGxiYWNrLCB0aGVuIGNhbGwgaXQgbm93IHdpdGggcmV0dXJuZWQgdmFsdWUKICAgICAgICAgICAgICAgIGlmIChmYWlsKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgZmFpbCh2Lm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkVycm9yIGluIGVycm9yIGNhbGxiYWNrOiAiK2NhbGxiYWNrSWQrIiA9ICIrZTEpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgY2FsbGJhY2sgaWYgbm90IGV4cGVjdGluZyBhbnkgbW9yZSByZXN1bHRzCiAgICAgICAgICAgICAgICAgICAgaWYgKCF2LmtlZXBDYWxsYmFjaykgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgUGhvbmVHYXAuY2FsbGJhY2tzW2NhbGxiYWNrSWRdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBjYXRjaCAoZTIpIHsKICAgICAgICBjb25zb2xlLmxvZygiRXJyb3I6ICIrZTIpOwogICAgfQp9OwoKLyoqCiAqIENhbGxlZCBieSBuYXRpdmUgY29kZSB3aGVuIHJldHVybmluZyBzdWNjZXNzZnVsIHJlc3VsdCBmcm9tIGFuIGFjdGlvbi4KICoKICogQHBhcmFtIGNhbGxiYWNrSWQKICogQHBhcmFtIGFyZ3MKICovClBob25lR2FwLmNhbGxiYWNrU3VjY2VzcyA9IGZ1bmN0aW9uKGNhbGxiYWNrSWQsIGFyZ3MpIHsKICAgIGlmIChQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF0pIHsKCiAgICAgICAgLy8gSWYgcmVzdWx0IGlzIHRvIGJlIHNlbnQgdG8gY2FsbGJhY2sKICAgICAgICBpZiAoYXJncy5zdGF0dXMgPT09IFBob25lR2FwLmNhbGxiYWNrU3RhdHVzLk9LKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoUGhvbmVHYXAuY2FsbGJhY2tzW2NhbGxiYWNrSWRdLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF0uc3VjY2VzcyhhcmdzLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXJyb3IgaW4gc3VjY2VzcyBjYWxsYmFjazogIitjYWxsYmFja0lkKyIgPSAiK2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBDbGVhciBjYWxsYmFjayBpZiBub3QgZXhwZWN0aW5nIGFueSBtb3JlIHJlc3VsdHMKICAgICAgICBpZiAoIWFyZ3Mua2VlcENhbGxiYWNrKSB7CiAgICAgICAgICAgIGRlbGV0ZSBQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF07CiAgICAgICAgfQogICAgfQp9OwoKLyoqCiAqIENhbGxlZCBieSBuYXRpdmUgY29kZSB3aGVuIHJldHVybmluZyBlcnJvciByZXN1bHQgZnJvbSBhbiBhY3Rpb24uCiAqCiAqIEBwYXJhbSBjYWxsYmFja0lkCiAqIEBwYXJhbSBhcmdzCiAqLwpQaG9uZUdhcC5jYWxsYmFja0Vycm9yID0gZnVuY3Rpb24oY2FsbGJhY2tJZCwgYXJncykgewogICAgaWYgKFBob25lR2FwLmNhbGxiYWNrc1tjYWxsYmFja0lkXSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChQaG9uZUdhcC5jYWxsYmFja3NbY2FsbGJhY2tJZF0uZmFpbCkgewogICAgICAgICAgICAgICAgUGhvbmVHYXAuY2FsbGJhY2tzW2NhbGxiYWNrSWRdLmZhaWwoYXJncy5tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiRXJyb3IgaW4gZXJyb3IgY2FsbGJhY2s6ICIrY2FsbGJhY2tJZCsiID0gIitlKTsKICAgICAgICB9CgogICAgICAgIC8vIENsZWFyIGNhbGxiYWNrIGlmIG5vdCBleHBlY3RpbmcgYW55IG1vcmUgcmVzdWx0cwogICAgICAgIGlmICghYXJncy5rZWVwQ2FsbGJhY2spIHsKICAgICAgICAgICAgZGVsZXRlIFBob25lR2FwLmNhbGxiYWNrc1tjYWxsYmFja0lkXTsKICAgICAgICB9CiAgICB9Cn07CgoKLyoqCiAqIEludGVybmFsIGZ1bmN0aW9uIHVzZWQgdG8gZGlzcGF0Y2ggdGhlIHJlcXVlc3QgdG8gUGhvbmVHYXAuICBJdCBwcm9jZXNzZXMgdGhlCiAqIGNvbW1hbmQgcXVldWUgYW5kIGV4ZWN1dGVzIHRoZSBuZXh0IGNvbW1hbmQgb24gdGhlIGxpc3QuICBJZiBvbmUgb2YgdGhlCiAqIGFyZ3VtZW50cyBpcyBhIEphdmFTY3JpcHQgb2JqZWN0LCBpdCB3aWxsIGJlIHBhc3NlZCBvbiB0aGUgUXVlcnlTdHJpbmcgb2YgdGhlCiAqIHVybCwgd2hpY2ggd2lsbCBiZSB0dXJuZWQgaW50byBhIGRpY3Rpb25hcnkgb24gdGhlIG90aGVyIGVuZC4KICogQHByaXZhdGUKICovCi8vIFRPRE86IElzIHRoaXMgdXNlZD8KUGhvbmVHYXAucnVuX2NvbW1hbmQgPSBmdW5jdGlvbigpIHsKICAgIGlmICghUGhvbmVHYXAuYXZhaWxhYmxlIHx8ICFQaG9uZUdhcC5xdWV1ZS5yZWFkeSkgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIFBob25lR2FwLnF1ZXVlLnJlYWR5ID0gZmFsc2U7CgogICAgdmFyIGFyZ3MgPSBQaG9uZUdhcC5xdWV1ZS5jb21tYW5kcy5zaGlmdCgpOwogICAgaWYgKFBob25lR2FwLnF1ZXVlLmNvbW1hbmRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNsZWFySW50ZXJ2YWwoUGhvbmVHYXAucXVldWUudGltZXIpOwogICAgICAgIFBob25lR2FwLnF1ZXVlLnRpbWVyID0gbnVsbDsKICAgIH0KCiAgICB2YXIgdXJpID0gW107CiAgICB2YXIgZGljdCA9IG51bGw7CiAgICB2YXIgaTsKICAgIGZvciAoaSA9IDE7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGFyZyA9IGFyZ3NbaV07CiAgICAgICAgaWYgKGFyZyA9PT0gdW5kZWZpbmVkIHx8IGFyZyA9PT0gbnVsbCkgewogICAgICAgICAgICBhcmcgPSAnJzsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZihhcmcpID09PSAnb2JqZWN0JykgewogICAgICAgICAgICBkaWN0ID0gYXJnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVyaS5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChhcmcpKTsKICAgICAgICB9CiAgICB9CiAgICB2YXIgdXJsID0gImdhcDovLyIgKyBhcmdzWzBdICsgIi8iICsgdXJpLmpvaW4oIi8iKTsKICAgIGlmIChkaWN0ICE9PSBudWxsKSB7CiAgICAgICAgdmFyIG5hbWU7CiAgICAgICAgdmFyIHF1ZXJ5X2FyZ3MgPSBbXTsKICAgICAgICBmb3IgKG5hbWUgaW4gZGljdCkgewogICAgICAgICAgICBpZiAoZGljdC5oYXNPd25Qcm9wZXJ0eShuYW1lKSAmJiAodHlwZW9mIChuYW1lKSA9PT0gJ3N0cmluZycpKSB7CiAgICAgICAgICAgICAgICBxdWVyeV9hcmdzLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KG5hbWUpICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGRpY3RbbmFtZV0pKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAocXVlcnlfYXJncy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHVybCArPSAiPyIgKyBxdWVyeV9hcmdzLmpvaW4oIiYiKTsKICAgICAgICB9CiAgICB9CiAgICBkb2N1bWVudC5sb2NhdGlvbiA9IHVybDsKCn07CgpQaG9uZUdhcC5KU0NhbGxiYWNrUG9ydCA9IG51bGw7ClBob25lR2FwLkpTQ2FsbGJhY2tUb2tlbiA9IG51bGw7CgovKioKICogVGhpcyBpcyBvbmx5IGZvciBBbmRyb2lkLgogKgogKiBJbnRlcm5hbCBmdW5jdGlvbiB0aGF0IHVzZXMgWEhSIHRvIGNhbGwgaW50byBQaG9uZUdhcCBKYXZhIGNvZGUgYW5kIHJldHJpZXZlCiAqIGFueSBKYXZhU2NyaXB0IGNvZGUgdGhhdCBuZWVkcyB0byBiZSBydW4uICBUaGlzIGlzIHVzZWQgZm9yIGNhbGxiYWNrcyBmcm9tCiAqIEphdmEgdG8gSmF2YVNjcmlwdC4KICovClBob25lR2FwLkpTQ2FsbGJhY2sgPSBmdW5jdGlvbigpIHsKCiAgICAvLyBFeGl0IGlmIHNodXR0aW5nIGRvd24gYXBwCiAgICBpZiAoUGhvbmVHYXAuc2h1dHRpbmdEb3duKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIElmIHBvbGxpbmcgZmxhZyB3YXMgY2hhbmdlZCwgc3RhcnQgdXNpbmcgcG9sbGluZyBmcm9tIG5vdyBvbgogICAgaWYgKFBob25lR2FwLlVzZVBvbGxpbmcpIHsKICAgICAgICBQaG9uZUdhcC5KU0NhbGxiYWNrUG9sbGluZygpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgeG1saHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwoKICAgIC8vIENhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gWE1MSHR0cFJlcXVlc3QgaXMgcmVhZHkKICAgIHhtbGh0dHAub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7CiAgICAgICAgaWYoeG1saHR0cC5yZWFkeVN0YXRlID09PSA0KXsKCiAgICAgICAgICAgIC8vIEV4aXQgaWYgc2h1dHRpbmcgZG93biBhcHAKICAgICAgICAgICAgaWYgKFBob25lR2FwLnNodXR0aW5nRG93bikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJZiBjYWxsYmFjayBoYXMgSmF2YVNjcmlwdCBzdGF0ZW1lbnQgdG8gZXhlY3V0ZQogICAgICAgICAgICBpZiAoeG1saHR0cC5zdGF0dXMgPT09IDIwMCkgewoKICAgICAgICAgICAgICAgIC8vIE5lZWQgdG8gdXJsIGRlY29kZSB0aGUgcmVzcG9uc2UKICAgICAgICAgICAgICAgIHZhciBtc2cgPSBkZWNvZGVVUklDb21wb25lbnQoeG1saHR0cC5yZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGV2YWwobXNnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UncmUgZ2V0dGluZyBhbiBlcnJvciBoZXJlLCBzZWVpbmcgdGhlIG1lc3NhZ2Ugd2lsbCBoZWxwIGluIGRlYnVnZ2luZwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiSlNDYWxsYmFjazogTWVzc2FnZSBmcm9tIFNlcnZlcjogIiArIG1zZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJKU0NhbGxiYWNrIEVycm9yOiAiK2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDEpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChQaG9uZUdhcC5KU0NhbGxiYWNrLCAxKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgY2FsbGJhY2sgcGluZyAodXNlZCB0byBrZWVwIFhIUiByZXF1ZXN0IGZyb20gdGltaW5nIG91dCkKICAgICAgICAgICAgZWxzZSBpZiAoeG1saHR0cC5zdGF0dXMgPT09IDQwNCkgewogICAgICAgICAgICAgICAgc2V0VGltZW91dChQaG9uZUdhcC5KU0NhbGxiYWNrLCAxMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElmIHNlY3VyaXR5IGVycm9yCiAgICAgICAgICAgIGVsc2UgaWYgKHhtbGh0dHAuc3RhdHVzID09PSA0MDMpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJKU0NhbGxiYWNrIEVycm9yOiBJbnZhbGlkIHRva2VuLiAgU3RvcHBpbmcgY2FsbGJhY2tzLiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJZiBzZXJ2ZXIgaXMgc3RvcHBpbmcKICAgICAgICAgICAgZWxzZSBpZiAoeG1saHR0cC5zdGF0dXMgPT09IDUwMykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkpTQ2FsbGJhY2sgRXJyb3I6IFNlcnZpY2UgdW5hdmFpbGFibGUuICBTdG9wcGluZyBjYWxsYmFja3MuIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElmIHJlcXVlc3Qgd2Fzbid0IEdFVAogICAgICAgICAgICBlbHNlIGlmICh4bWxodHRwLnN0YXR1cyA9PT0gNDAwKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiSlNDYWxsYmFjayBFcnJvcjogQmFkIHJlcXVlc3QuICBTdG9wcGluZyBjYWxsYmFja3MuIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElmIGVycm9yLCByZXZlcnQgdG8gcG9sbGluZwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJKU0NhbGxiYWNrIEVycm9yOiBSZXF1ZXN0IGZhaWxlZC4iKTsKICAgICAgICAgICAgICAgIFBob25lR2FwLlVzZVBvbGxpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgUGhvbmVHYXAuSlNDYWxsYmFja1BvbGxpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CgogICAgaWYgKFBob25lR2FwLkpTQ2FsbGJhY2tQb3J0ID09PSBudWxsKSB7CiAgICAgICAgUGhvbmVHYXAuSlNDYWxsYmFja1BvcnQgPSBwcm9tcHQoImdldFBvcnQiLCAiZ2FwX2NhbGxiYWNrU2VydmVyOiIpOwogICAgfQogICAgaWYgKFBob25lR2FwLkpTQ2FsbGJhY2tUb2tlbiA9PT0gbnVsbCkgewogICAgICAgIFBob25lR2FwLkpTQ2FsbGJhY2tUb2tlbiA9IHByb21wdCgiZ2V0VG9rZW4iLCAiZ2FwX2NhbGxiYWNrU2VydmVyOiIpOwogICAgfQogICAgeG1saHR0cC5vcGVuKCJHRVQiLCAiaHR0cDovLzEyNy4wLjAuMToiK1Bob25lR2FwLkpTQ2FsbGJhY2tQb3J0KyIvIitQaG9uZUdhcC5KU0NhbGxiYWNrVG9rZW4gLCB0cnVlKTsKICAgIHhtbGh0dHAuc2VuZCgpOwp9OwoKLyoqCiAqIFRoZSBwb2xsaW5nIHBlcmlvZCB0byB1c2Ugd2l0aCBKU0NhbGxiYWNrUG9sbGluZy4KICogVGhpcyBjYW4gYmUgY2hhbmdlZCBieSB0aGUgYXBwbGljYXRpb24uICBUaGUgZGVmYXVsdCBpcyA1MG1zLgogKi8KUGhvbmVHYXAuSlNDYWxsYmFja1BvbGxpbmdQZXJpb2QgPSA1MDsKCi8qKgogKiBGbGFnIHRoYXQgY2FuIGJlIHNldCBieSB0aGUgdXNlciB0byBmb3JjZSBwb2xsaW5nIHRvIGJlIHVzZWQgb3IgZm9yY2UgWEhSIHRvIGJlIHVzZWQuCiAqLwpQaG9uZUdhcC5Vc2VQb2xsaW5nID0gZmFsc2U7ICAgIC8vIFQ9dXNlIHBvbGxpbmcsIEY9dXNlIFhIUgoKLyoqCiAqIFRoaXMgaXMgb25seSBmb3IgQW5kcm9pZC4KICoKICogSW50ZXJuYWwgZnVuY3Rpb24gdGhhdCB1c2VzIHBvbGxpbmcgdG8gY2FsbCBpbnRvIFBob25lR2FwIEphdmEgY29kZSBhbmQgcmV0cmlldmUKICogYW55IEphdmFTY3JpcHQgY29kZSB0aGF0IG5lZWRzIHRvIGJlIHJ1bi4gIFRoaXMgaXMgdXNlZCBmb3IgY2FsbGJhY2tzIGZyb20KICogSmF2YSB0byBKYXZhU2NyaXB0LgogKi8KUGhvbmVHYXAuSlNDYWxsYmFja1BvbGxpbmcgPSBmdW5jdGlvbigpIHsKCiAgICAvLyBFeGl0IGlmIHNodXR0aW5nIGRvd24gYXBwCiAgICBpZiAoUGhvbmVHYXAuc2h1dHRpbmdEb3duKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIElmIHBvbGxpbmcgZmxhZyB3YXMgY2hhbmdlZCwgc3RvcCB1c2luZyBwb2xsaW5nIGZyb20gbm93IG9uCiAgICBpZiAoIVBob25lR2FwLlVzZVBvbGxpbmcpIHsKICAgICAgICBQaG9uZUdhcC5KU0NhbGxiYWNrKCk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBtc2cgPSBwcm9tcHQoIiIsICJnYXBfcG9sbDoiKTsKICAgIGlmIChtc2cpIHsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIHQgPSBldmFsKCIiK21zZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJKU0NhbGxiYWNrUG9sbGluZzogTWVzc2FnZSBmcm9tIFNlcnZlcjogIiArIG1zZyk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiSlNDYWxsYmFja1BvbGxpbmcgRXJyb3I6ICIrZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAxKTsKICAgICAgICBzZXRUaW1lb3V0KFBob25lR2FwLkpTQ2FsbGJhY2tQb2xsaW5nLCAxKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHNldFRpbWVvdXQoUGhvbmVHYXAuSlNDYWxsYmFja1BvbGxpbmcsIFBob25lR2FwLkpTQ2FsbGJhY2tQb2xsaW5nUGVyaW9kKTsKICAgIH0KfTsKCi8qKgogKiBDcmVhdGUgYSBVVUlECiAqCiAqIEByZXR1cm4ge1N0cmluZ30KICovClBob25lR2FwLmNyZWF0ZVVVSUQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBQaG9uZUdhcC5VVUlEY3JlYXRlUGFydCg0KSArICctJyArCiAgICAgICAgUGhvbmVHYXAuVVVJRGNyZWF0ZVBhcnQoMikgKyAnLScgKwogICAgICAgIFBob25lR2FwLlVVSURjcmVhdGVQYXJ0KDIpICsgJy0nICsKICAgICAgICBQaG9uZUdhcC5VVUlEY3JlYXRlUGFydCgyKSArICctJyArCiAgICAgICAgUGhvbmVHYXAuVVVJRGNyZWF0ZVBhcnQoNik7Cn07CgpQaG9uZUdhcC5VVUlEY3JlYXRlUGFydCA9IGZ1bmN0aW9uKGxlbmd0aCkgewogICAgdmFyIHV1aWRwYXJ0ID0gIiI7CiAgICB2YXIgaSwgdXVpZGNoYXI7CiAgICBmb3IgKGk9MDsgaTxsZW5ndGg7IGkrKykgewogICAgICAgIHV1aWRjaGFyID0gcGFyc2VJbnQoKE1hdGgucmFuZG9tKCkgKiAyNTYpLDApLnRvU3RyaW5nKDE2KTsKICAgICAgICBpZiAodXVpZGNoYXIubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIHV1aWRjaGFyID0gIjAiICsgdXVpZGNoYXI7CiAgICAgICAgfQogICAgICAgIHV1aWRwYXJ0ICs9IHV1aWRjaGFyOwogICAgfQogICAgcmV0dXJuIHV1aWRwYXJ0Owp9OwoKUGhvbmVHYXAuY2xvc2UgPSBmdW5jdGlvbihjb250ZXh0LCBmdW5jLCBwYXJhbXMpIHsKICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAndW5kZWZpbmVkJykgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJndW1lbnRzKTsKICAgICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jLmFwcGx5KGNvbnRleHQsIHBhcmFtcyk7CiAgICAgICAgfTsKICAgIH0KfTsKCi8qKgogKiBMb2FkIGEgSmF2YVNjcmlwdCBmaWxlIGFmdGVyIHBhZ2UgaGFzIGxvYWRlZC4KICoKICogQHBhcmFtIHtTdHJpbmd9IGpzZmlsZSAgICAgICAgICAgICAgIFRoZSB1cmwgb2YgdGhlIEphdmFTY3JpcHQgZmlsZSB0byBsb2FkLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgICAgVGhlIGNhbGxiYWNrIHRvIGNhbGwgd2hlbiB0aGUgZmlsZSBoYXMgYmVlbiBsb2FkZWQuCiAqLwpQaG9uZUdhcC5pbmNsdWRlSmF2YXNjcmlwdCA9IGZ1bmN0aW9uKGpzZmlsZSwgc3VjY2Vzc0NhbGxiYWNrKSB7CiAgICB2YXIgaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdOwogICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICBlbC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7CiAgICBpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGVsLm9ubG9hZCA9IHN1Y2Nlc3NDYWxsYmFjazsKICAgIH0KICAgIGVsLnNyYyA9IGpzZmlsZTsKICAgIGlkLmFwcGVuZENoaWxkKGVsKTsKfTsKCn0KLyoKICogUGhvbmVHYXAgaXMgYXZhaWxhYmxlIHVuZGVyICplaXRoZXIqIHRoZSB0ZXJtcyBvZiB0aGUgbW9kaWZpZWQgQlNEIGxpY2Vuc2UgKm9yKiB0aGUKICogTUlUIExpY2Vuc2UgKDIwMDgpLiBTZWUgaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL2FscGhhYmV0aWNhbCBmb3IgZnVsbCB0ZXh0LgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDUtMjAxMCwgTml0b2JpIFNvZnR3YXJlIEluYy4KICogQ29weXJpZ2h0IChjKSAyMDEwLTIwMTEsIElCTSBDb3Jwb3JhdGlvbgogKi8KCmlmICghUGhvbmVHYXAuaGFzUmVzb3VyY2UoImFjY2VsZXJvbWV0ZXIiKSkgewpQaG9uZUdhcC5hZGRSZXNvdXJjZSgiYWNjZWxlcm9tZXRlciIpOwoKLyoqIEBjb25zdHJ1Y3RvciAqLwp2YXIgQWNjZWxlcmF0aW9uID0gZnVuY3Rpb24oeCwgeSwgeikgewogIHRoaXMueCA9IHg7CiAgdGhpcy55ID0geTsKICB0aGlzLnogPSB6OwogIHRoaXMudGltZXN0YW1wID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7Cn07CgovKioKICogVGhpcyBjbGFzcyBwcm92aWRlcyBhY2Nlc3MgdG8gZGV2aWNlIGFjY2VsZXJvbWV0ZXIgZGF0YS4KICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgQWNjZWxlcm9tZXRlciA9IGZ1bmN0aW9uKCkgewoKICAgIC8qKgogICAgICogVGhlIGxhc3Qga25vd24gYWNjZWxlcmF0aW9uLiAgdHlwZT1BY2NlbGVyYXRpb24oKQogICAgICovCiAgICB0aGlzLmxhc3RBY2NlbGVyYXRpb24gPSBudWxsOwoKICAgIC8qKgogICAgICogTGlzdCBvZiBhY2NlbGVyb21ldGVyIHdhdGNoIHRpbWVycwogICAgICovCiAgICB0aGlzLnRpbWVycyA9IHt9Owp9OwoKQWNjZWxlcm9tZXRlci5FUlJPUl9NU0cgPSBbIk5vdCBydW5uaW5nIiwgIlN0YXJ0aW5nIiwgIiIsICJGYWlsZWQgdG8gc3RhcnQiXTsKCi8qKgogKiBBc3luY2hyb25vdXNseSBhcXVpcmVzIHRoZSBjdXJyZW50IGFjY2VsZXJhdGlvbi4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrICAgIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGFjY2VsZXJhdGlvbiBkYXRhIGlzIGF2YWlsYWJsZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrICAgICAgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGVyZSBpcyBhbiBlcnJvciBnZXR0aW5nIHRoZSBhY2NlbGVyYXRpb24gZGF0YS4gKE9QVElPTkFMKQogKiBAcGFyYW0ge0FjY2VsZXJhdGlvbk9wdGlvbnN9IG9wdGlvbnMgVGhlIG9wdGlvbnMgZm9yIGdldHRpbmcgdGhlIGFjY2VsZXJvbWV0ZXIgZGF0YSBzdWNoIGFzIHRpbWVvdXQuIChPUFRJT05BTCkKICovCkFjY2VsZXJvbWV0ZXIucHJvdG90eXBlLmdldEN1cnJlbnRBY2NlbGVyYXRpb24gPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIG9wdGlvbnMpIHsKCiAgICAvLyBzdWNjZXNzQ2FsbGJhY2sgcmVxdWlyZWQKICAgIGlmICh0eXBlb2Ygc3VjY2Vzc0NhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgY29uc29sZS5sb2coIkFjY2VsZXJvbWV0ZXIgRXJyb3I6IHN1Y2Nlc3NDYWxsYmFjayBpcyBub3QgYSBmdW5jdGlvbiIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBlcnJvckNhbGxiYWNrIG9wdGlvbmFsCiAgICBpZiAoZXJyb3JDYWxsYmFjayAmJiAodHlwZW9mIGVycm9yQ2FsbGJhY2sgIT09ICJmdW5jdGlvbiIpKSB7CiAgICAgICAgY29uc29sZS5sb2coIkFjY2VsZXJvbWV0ZXIgRXJyb3I6IGVycm9yQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gR2V0IGFjY2VsZXJhdGlvbgogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJBY2NlbGVyb21ldGVyIiwgImdldEFjY2VsZXJhdGlvbiIsIFtdKTsKfTsKCi8qKgogKiBBc3luY2hyb25vdXNseSBhcXVpcmVzIHRoZSBhY2NlbGVyYXRpb24gcmVwZWF0ZWRseSBhdCBhIGdpdmVuIGludGVydmFsLgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgICAgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgZWFjaCB0aW1lIHRoZSBhY2NlbGVyYXRpb24gZGF0YSBpcyBhdmFpbGFibGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayAgICAgIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IgZ2V0dGluZyB0aGUgYWNjZWxlcmF0aW9uIGRhdGEuIChPUFRJT05BTCkKICogQHBhcmFtIHtBY2NlbGVyYXRpb25PcHRpb25zfSBvcHRpb25zIFRoZSBvcHRpb25zIGZvciBnZXR0aW5nIHRoZSBhY2NlbGVyb21ldGVyIGRhdGEgc3VjaCBhcyB0aW1lb3V0LiAoT1BUSU9OQUwpCiAqIEByZXR1cm4gU3RyaW5nICAgICAgICAgICAgICAgICAgICAgICBUaGUgd2F0Y2ggaWQgdGhhdCBtdXN0IGJlIHBhc3NlZCB0byAjY2xlYXJXYXRjaCB0byBzdG9wIHdhdGNoaW5nLgogKi8KQWNjZWxlcm9tZXRlci5wcm90b3R5cGUud2F0Y2hBY2NlbGVyYXRpb24gPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIG9wdGlvbnMpIHsKCiAgICAvLyBEZWZhdWx0IGludGVydmFsICgxMCBzZWMpCiAgICB2YXIgZnJlcXVlbmN5ID0gKG9wdGlvbnMgIT09IHVuZGVmaW5lZCk/IG9wdGlvbnMuZnJlcXVlbmN5IDogMTAwMDA7CgogICAgLy8gc3VjY2Vzc0NhbGxiYWNrIHJlcXVpcmVkCiAgICBpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayAhPT0gImZ1bmN0aW9uIikgewogICAgICAgIGNvbnNvbGUubG9nKCJBY2NlbGVyb21ldGVyIEVycm9yOiBzdWNjZXNzQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gZXJyb3JDYWxsYmFjayBvcHRpb25hbAogICAgaWYgKGVycm9yQ2FsbGJhY2sgJiYgKHR5cGVvZiBlcnJvckNhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSkgewogICAgICAgIGNvbnNvbGUubG9nKCJBY2NlbGVyb21ldGVyIEVycm9yOiBlcnJvckNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIE1ha2Ugc3VyZSBhY2NlbGVyb21ldGVyIHRpbWVvdXQgPiBmcmVxdWVuY3kgKyAxMCBzZWMKICAgIFBob25lR2FwLmV4ZWMoCiAgICAgICAgZnVuY3Rpb24odGltZW91dCkgewogICAgICAgICAgICBpZiAodGltZW91dCA8IChmcmVxdWVuY3kgKyAxMDAwMCkpIHsKICAgICAgICAgICAgICAgIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIkFjY2VsZXJvbWV0ZXIiLCAic2V0VGltZW91dCIsIFtmcmVxdWVuY3kgKyAxMDAwMF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBmdW5jdGlvbihlKSB7IH0sICJBY2NlbGVyb21ldGVyIiwgImdldFRpbWVvdXQiLCBbXSk7CgogICAgLy8gU3RhcnQgd2F0Y2ggdGltZXIKICAgIHZhciBpZCA9IFBob25lR2FwLmNyZWF0ZVVVSUQoKTsKICAgIG5hdmlnYXRvci5hY2NlbGVyb21ldGVyLnRpbWVyc1tpZF0gPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkFjY2VsZXJvbWV0ZXIiLCAiZ2V0QWNjZWxlcmF0aW9uIiwgW10pOwogICAgfSwgKGZyZXF1ZW5jeSA/IGZyZXF1ZW5jeSA6IDEpKTsKCiAgICByZXR1cm4gaWQ7Cn07CgovKioKICogQ2xlYXJzIHRoZSBzcGVjaWZpZWQgYWNjZWxlcm9tZXRlciB3YXRjaC4KICoKICogQHBhcmFtIHtTdHJpbmd9IGlkICAgICAgIFRoZSBpZCBvZiB0aGUgd2F0Y2ggcmV0dXJuZWQgZnJvbSAjd2F0Y2hBY2NlbGVyYXRpb24uCiAqLwpBY2NlbGVyb21ldGVyLnByb3RvdHlwZS5jbGVhcldhdGNoID0gZnVuY3Rpb24oaWQpIHsKCiAgICAvLyBTdG9wIGphdmFzY3JpcHQgdGltZXIgJiByZW1vdmUgZnJvbSB0aW1lciBsaXN0CiAgICBpZiAoaWQgJiYgbmF2aWdhdG9yLmFjY2VsZXJvbWV0ZXIudGltZXJzW2lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbChuYXZpZ2F0b3IuYWNjZWxlcm9tZXRlci50aW1lcnNbaWRdKTsKICAgICAgICBkZWxldGUgbmF2aWdhdG9yLmFjY2VsZXJvbWV0ZXIudGltZXJzW2lkXTsKICAgIH0KfTsKClBob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCkgewogICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IuYWNjZWxlcm9tZXRlciA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBuYXZpZ2F0b3IuYWNjZWxlcm9tZXRlciA9IG5ldyBBY2NlbGVyb21ldGVyKCk7CiAgICB9Cn0pOwp9Ci8qCiAqIFBob25lR2FwIGlzIGF2YWlsYWJsZSB1bmRlciAqZWl0aGVyKiB0aGUgdGVybXMgb2YgdGhlIG1vZGlmaWVkIEJTRCBsaWNlbnNlICpvciogdGhlCiAqIE1JVCBMaWNlbnNlICgyMDA4KS4gU2VlIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9hbHBoYWJldGljYWwgZm9yIGZ1bGwgdGV4dC4KICoKICogQ29weXJpZ2h0IChjKSAyMDA1LTIwMTAsIE5pdG9iaSBTb2Z0d2FyZSBJbmMuCiAqIENvcHlyaWdodCAoYykgMjAxMC0yMDExLCBJQk0gQ29ycG9yYXRpb24KICovCgppZiAoIVBob25lR2FwLmhhc1Jlc291cmNlKCJhcHAiKSkgewpQaG9uZUdhcC5hZGRSZXNvdXJjZSgiYXBwIik7CihmdW5jdGlvbigpIHsKCi8qKgogKiBDb25zdHJ1Y3RvcgogKiBAY29uc3RydWN0b3IKICovCnZhciBBcHAgPSBmdW5jdGlvbigpIHt9OwoKLyoqCiAqIENsZWFyIHRoZSByZXNvdXJjZSBjYWNoZS4KICovCkFwcC5wcm90b3R5cGUuY2xlYXJDYWNoZSA9IGZ1bmN0aW9uKCkgewogICAgUGhvbmVHYXAuZXhlYyhudWxsLCBudWxsLCAiQXBwIiwgImNsZWFyQ2FjaGUiLCBbXSk7Cn07CgovKioKICogTG9hZCB0aGUgdXJsIGludG8gdGhlIHdlYnZpZXcuCiAqCiAqIEBwYXJhbSB1cmwgICAgICAgICAgIFRoZSBVUkwgdG8gbG9hZAogKiBAcGFyYW0gcHJvcHMgICAgICAgICBQcm9wZXJ0aWVzIHRoYXQgY2FuIGJlIHBhc3NlZCBpbiB0byB0aGUgYWN0aXZpdHk6CiAqICAgICAgd2FpdDogaW50ICAgICAgICAgICAgICAgICAgICAgICAgICAgPT4gd2FpdCBtc2VjIGJlZm9yZSBsb2FkaW5nIFVSTAogKiAgICAgIGxvYWRpbmdEaWFsb2c6ICJUaXRsZSxNZXNzYWdlIiAgICAgID0+IGRpc3BsYXkgYSBuYXRpdmUgbG9hZGluZyBkaWFsb2cKICogICAgICBoaWRlTG9hZGluZ0RpYWxvZ09uUGFnZTogYm9vbGVhbiAgICA9PiBoaWRlIGxvYWRpbmdEaWFsb2cgd2hlbiBwYWdlIGxvYWRlZCBpbnN0ZWFkIG9mIHdoZW4gZGV2aWNlcmVhZHkgZXZlbnQgb2NjdXJzLgogKiAgICAgIGxvYWRJbldlYlZpZXc6IGJvb2xlYW4gICAgICAgICAgICAgID0+IGNhdXNlIGFsbCBsaW5rcyBvbiB3ZWIgcGFnZSB0byBiZSBsb2FkZWQgaW50byBleGlzdGluZyB3ZWIgdmlldywgaW5zdGVhZCBvZiBiZWluZyBsb2FkZWQgaW50byBuZXcgYnJvd3Nlci4KICogICAgICBsb2FkVXJsVGltZW91dFZhbHVlOiBpbnQgICAgICAgICAgICA9PiB0aW1lIGluIG1zZWMgdG8gd2FpdCBiZWZvcmUgdHJpZ2dlcmluZyBhIHRpbWVvdXQgZXJyb3IKICogICAgICBlcnJvclVybDogVVJMICAgICAgICAgICAgICAgICAgICAgICA9PiBVUkwgdG8gbG9hZCBpZiB0aGVyZSdzIGFuIGVycm9yIGxvYWRpbmcgc3BlY2lmaWVkIFVSTCB3aXRoIGxvYWRVcmwoKS4gIFNob3VsZCBiZSBhIGxvY2FsIFVSTCBzdWNoIGFzIGZpbGU6Ly8vYW5kcm9pZF9hc3NldC93d3cvZXJyb3IuaHRtbCIpOwogKiAgICAgIGtlZXBSdW5uaW5nOiBib29sZWFuICAgICAgICAgICAgICAgID0+IGVuYWJsZSBhcHAgdG8ga2VlcCBydW5uaW5nIGluIGJhY2tncm91bmQKICoKICogRXhhbXBsZToKICogICAgICBBcHAgYXBwID0gbmV3IEFwcCgpOwogKiAgICAgIGFwcC5sb2FkVXJsKCJodHRwOi8vc2VydmVyL215YXBwL2luZGV4Lmh0bWwiLCB7d2FpdDoyMDAwLCBsb2FkaW5nRGlhbG9nOiJXYWl0LExvYWRpbmcgQXBwIiwgbG9hZFVybFRpbWVvdXRWYWx1ZTogNjAwMDB9KTsKICovCkFwcC5wcm90b3R5cGUubG9hZFVybCA9IGZ1bmN0aW9uKHVybCwgcHJvcHMpIHsKICAgIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIkFwcCIsICJsb2FkVXJsIiwgW3VybCwgcHJvcHNdKTsKfTsKCi8qKgogKiBDYW5jZWwgbG9hZFVybCB0aGF0IGlzIHdhaXRpbmcgdG8gYmUgbG9hZGVkLgogKi8KQXBwLnByb3RvdHlwZS5jYW5jZWxMb2FkVXJsID0gZnVuY3Rpb24oKSB7CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJBcHAiLCAiY2FuY2VsTG9hZFVybCIsIFtdKTsKfTsKCi8qKgogKiBDbGVhciB3ZWIgaGlzdG9yeSBpbiB0aGlzIHdlYiB2aWV3LgogKiBJbnN0ZWFkIG9mIEJBQ0sgYnV0dG9uIGxvYWRpbmcgdGhlIHByZXZpb3VzIHdlYiBwYWdlLCBpdCB3aWxsIGV4aXQgdGhlIGFwcC4KICovCkFwcC5wcm90b3R5cGUuY2xlYXJIaXN0b3J5ID0gZnVuY3Rpb24oKSB7CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJBcHAiLCAiY2xlYXJIaXN0b3J5IiwgW10pOwp9OwoKLyoqCiAqIE92ZXJyaWRlIHRoZSBkZWZhdWx0IGJlaGF2aW9yIG9mIHRoZSBBbmRyb2lkIGJhY2sgYnV0dG9uLgogKiBJZiBvdmVycmlkZGVuLCB3aGVuIHRoZSBiYWNrIGJ1dHRvbiBpcyBwcmVzc2VkLCB0aGUgImJhY2tLZXlEb3duIiBKYXZhU2NyaXB0IGV2ZW50IHdpbGwgYmUgZmlyZWQuCiAqCiAqIE5vdGU6IFRoZSB1c2VyIHNob3VsZCBub3QgaGF2ZSB0byBjYWxsIHRoaXMgbWV0aG9kLiAgSW5zdGVhZCwgd2hlbiB0aGUgdXNlcgogKiAgICAgICByZWdpc3RlcnMgZm9yIHRoZSAiYmFja2J1dHRvbiIgZXZlbnQsIHRoaXMgaXMgYXV0b21hdGljYWxseSBkb25lLgogKgogKiBAcGFyYW0gb3ZlcnJpZGUJCVQ9b3ZlcnJpZGUsIEY9Y2FuY2VsIG92ZXJyaWRlCiAqLwpBcHAucHJvdG90eXBlLm92ZXJyaWRlQmFja2J1dHRvbiA9IGZ1bmN0aW9uKG92ZXJyaWRlKSB7CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJBcHAiLCAib3ZlcnJpZGVCYWNrYnV0dG9uIiwgW292ZXJyaWRlXSk7Cn07CgovKioKICogRXhpdCBhbmQgdGVybWluYXRlIHRoZSBhcHBsaWNhdGlvbi4KICovCkFwcC5wcm90b3R5cGUuZXhpdEFwcCA9IGZ1bmN0aW9uKCkgewoJcmV0dXJuIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIkFwcCIsICJleGl0QXBwIiwgW10pOwp9OwoKUGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKSB7CiAgICBuYXZpZ2F0b3IuYXBwID0gbmV3IEFwcCgpOwp9KTsKfSgpKTsKfQovKgogKiBQaG9uZUdhcCBpcyBhdmFpbGFibGUgdW5kZXIgKmVpdGhlciogdGhlIHRlcm1zIG9mIHRoZSBtb2RpZmllZCBCU0QgbGljZW5zZSAqb3IqIHRoZQogKiBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvYWxwaGFiZXRpY2FsIGZvciBmdWxsIHRleHQuCiAqCiAqIENvcHlyaWdodCAoYykgMjAwNS0yMDEwLCBOaXRvYmkgU29mdHdhcmUgSW5jLgogKiBDb3B5cmlnaHQgKGMpIDIwMTAtMjAxMSwgSUJNIENvcnBvcmF0aW9uCiAqLwoKaWYgKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiY2FtZXJhIikpIHsKUGhvbmVHYXAuYWRkUmVzb3VyY2UoImNhbWVyYSIpOwoKLyoqCiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgYWNjZXNzIHRvIHRoZSBkZXZpY2UgY2FtZXJhLgogKgogKiBAY29uc3RydWN0b3IKICovCnZhciBDYW1lcmEgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuc3VjY2Vzc0NhbGxiYWNrID0gbnVsbDsKICAgIHRoaXMuZXJyb3JDYWxsYmFjayA9IG51bGw7CiAgICB0aGlzLm9wdGlvbnMgPSBudWxsOwp9OwoKLyoqCiAqIEZvcm1hdCBvZiBpbWFnZSB0aGF0IHJldHVybmVkIGZyb20gZ2V0UGljdHVyZS4KICoKICogRXhhbXBsZTogbmF2aWdhdG9yLmNhbWVyYS5nZXRQaWN0dXJlKHN1Y2Nlc3MsIGZhaWwsCiAqICAgICAgICAgICAgICB7IHF1YWxpdHk6IDgwLAogKiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvblR5cGU6IENhbWVyYS5EZXN0aW5hdGlvblR5cGUuREFUQV9VUkwsCiAqICAgICAgICAgICAgICAgIHNvdXJjZVR5cGU6IENhbWVyYS5QaWN0dXJlU291cmNlVHlwZS5QSE9UT0xJQlJBUll9KQogKi8KQ2FtZXJhLkRlc3RpbmF0aW9uVHlwZSA9IHsKICAgIERBVEFfVVJMOiAwLCAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYmFzZTY0IGVuY29kZWQgc3RyaW5nCiAgICBGSUxFX1VSSTogMSAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIGZpbGUgdXJpIChjb250ZW50Oi8vbWVkaWEvZXh0ZXJuYWwvaW1hZ2VzL21lZGlhLzIgZm9yIEFuZHJvaWQpCn07CkNhbWVyYS5wcm90b3R5cGUuRGVzdGluYXRpb25UeXBlID0gQ2FtZXJhLkRlc3RpbmF0aW9uVHlwZTsKCi8qKgogKiBFbmNvZGluZyBvZiBpbWFnZSByZXR1cm5lZCBmcm9tIGdldFBpY3R1cmUuCiAqCiAqIEV4YW1wbGU6IG5hdmlnYXRvci5jYW1lcmEuZ2V0UGljdHVyZShzdWNjZXNzLCBmYWlsLAogKiAgICAgICAgICAgICAgeyBxdWFsaXR5OiA4MCwKICogICAgICAgICAgICAgICAgZGVzdGluYXRpb25UeXBlOiBDYW1lcmEuRGVzdGluYXRpb25UeXBlLkRBVEFfVVJMLAogKiAgICAgICAgICAgICAgICBzb3VyY2VUeXBlOiBDYW1lcmEuUGljdHVyZVNvdXJjZVR5cGUuQ0FNRVJBLAogKiAgICAgICAgICAgICAgICBlbmNvZGluZ1R5cGU6IENhbWVyYS5FbmNvZGluZ1R5cGUuUE5HfSkKKi8KQ2FtZXJhLkVuY29kaW5nVHlwZSA9IHsKICAgIEpQRUc6IDAsICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gSlBFRyBlbmNvZGVkIGltYWdlCiAgICBQTkc6IDEgICAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIFBORyBlbmNvZGVkIGltYWdlCn07CkNhbWVyYS5wcm90b3R5cGUuRW5jb2RpbmdUeXBlID0gQ2FtZXJhLkVuY29kaW5nVHlwZTsKCi8qKgogKiBTb3VyY2UgdG8gZ2V0UGljdHVyZSBmcm9tLgogKgogKiBFeGFtcGxlOiBuYXZpZ2F0b3IuY2FtZXJhLmdldFBpY3R1cmUoc3VjY2VzcywgZmFpbCwKICogICAgICAgICAgICAgIHsgcXVhbGl0eTogODAsCiAqICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uVHlwZTogQ2FtZXJhLkRlc3RpbmF0aW9uVHlwZS5EQVRBX1VSTCwKICogICAgICAgICAgICAgICAgc291cmNlVHlwZTogQ2FtZXJhLlBpY3R1cmVTb3VyY2VUeXBlLlBIT1RPTElCUkFSWX0pCiAqLwpDYW1lcmEuUGljdHVyZVNvdXJjZVR5cGUgPSB7CiAgICBQSE9UT0xJQlJBUlkgOiAwLCAgICAgICAgICAgLy8gQ2hvb3NlIGltYWdlIGZyb20gcGljdHVyZSBsaWJyYXJ5IChzYW1lIGFzIFNBVkVEUEhPVE9BTEJVTSBmb3IgQW5kcm9pZCkKICAgIENBTUVSQSA6IDEsICAgICAgICAgICAgICAgICAvLyBUYWtlIHBpY3R1cmUgZnJvbSBjYW1lcmEKICAgIFNBVkVEUEhPVE9BTEJVTSA6IDIgICAgICAgICAvLyBDaG9vc2UgaW1hZ2UgZnJvbSBwaWN0dXJlIGxpYnJhcnkgKHNhbWUgYXMgUEhPVE9MSUJSQVJZIGZvciBBbmRyb2lkKQp9OwpDYW1lcmEucHJvdG90eXBlLlBpY3R1cmVTb3VyY2VUeXBlID0gQ2FtZXJhLlBpY3R1cmVTb3VyY2VUeXBlOwoKLyoqCiAqIEdldHMgYSBwaWN0dXJlIGZyb20gc291cmNlIGRlZmluZWQgYnkgIm9wdGlvbnMuc291cmNlVHlwZSIsIGFuZCByZXR1cm5zIHRoZQogKiBpbWFnZSBhcyBkZWZpbmVkIGJ5IHRoZSAib3B0aW9ucy5kZXN0aW5hdGlvblR5cGUiIG9wdGlvbi4KCiAqIFRoZSBkZWZhdWx0cyBhcmUgc291cmNlVHlwZT1DQU1FUkEgYW5kIGRlc3RpbmF0aW9uVHlwZT1EQVRBX1VSTC4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sKICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICovCkNhbWVyYS5wcm90b3R5cGUuZ2V0UGljdHVyZSA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucykgewoKICAgIC8vIHN1Y2Nlc3NDYWxsYmFjayByZXF1aXJlZAogICAgaWYgKHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2sgIT09ICJmdW5jdGlvbiIpIHsKICAgICAgICBjb25zb2xlLmxvZygiQ2FtZXJhIEVycm9yOiBzdWNjZXNzQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gZXJyb3JDYWxsYmFjayBvcHRpb25hbAogICAgaWYgKGVycm9yQ2FsbGJhY2sgJiYgKHR5cGVvZiBlcnJvckNhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSkgewogICAgICAgIGNvbnNvbGUubG9nKCJDYW1lcmEgRXJyb3I6IGVycm9yQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgIHZhciBxdWFsaXR5ID0gODA7CiAgICBpZiAob3B0aW9ucy5xdWFsaXR5KSB7CiAgICAgICAgcXVhbGl0eSA9IHRoaXMub3B0aW9ucy5xdWFsaXR5OwogICAgfQogICAgCiAgICB2YXIgbWF4UmVzb2x1dGlvbiA9IDA7CiAgICBpZiAob3B0aW9ucy5tYXhSZXNvbHV0aW9uKSB7CiAgICAJbWF4UmVzb2x1dGlvbiA9IHRoaXMub3B0aW9ucy5tYXhSZXNvbHV0aW9uOwogICAgfQogICAgCiAgICB2YXIgZGVzdGluYXRpb25UeXBlID0gQ2FtZXJhLkRlc3RpbmF0aW9uVHlwZS5EQVRBX1VSTDsKICAgIGlmICh0aGlzLm9wdGlvbnMuZGVzdGluYXRpb25UeXBlKSB7CiAgICAgICAgZGVzdGluYXRpb25UeXBlID0gdGhpcy5vcHRpb25zLmRlc3RpbmF0aW9uVHlwZTsKICAgIH0KICAgIHZhciBzb3VyY2VUeXBlID0gQ2FtZXJhLlBpY3R1cmVTb3VyY2VUeXBlLkNBTUVSQTsKICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLnNvdXJjZVR5cGUgPT09ICJudW1iZXIiKSB7CiAgICAgICAgc291cmNlVHlwZSA9IHRoaXMub3B0aW9ucy5zb3VyY2VUeXBlOwogICAgfQogICAgdmFyIGVuY29kaW5nVHlwZSA9IENhbWVyYS5FbmNvZGluZ1R5cGUuSlBFRzsKICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5lbmNvZGluZ1R5cGUgPT0gIm51bWJlciIpIHsKICAgICAgICBlbmNvZGluZ1R5cGUgPSB0aGlzLm9wdGlvbnMuZW5jb2RpbmdUeXBlOwogICAgfQogICAgCiAgICB2YXIgdGFyZ2V0V2lkdGggPSAtMTsKICAgIGlmICh0eXBlb2Ygb3B0aW9ucy50YXJnZXRXaWR0aCA9PSAibnVtYmVyIikgewogICAgICAgIHRhcmdldFdpZHRoID0gb3B0aW9ucy50YXJnZXRXaWR0aDsKICAgIH0gZWxzZSBpZiAodHlwZW9mIG9wdGlvbnMudGFyZ2V0V2lkdGggPT0gInN0cmluZyIpIHsKICAgICAgICB2YXIgd2lkdGggPSBuZXcgTnVtYmVyKG9wdGlvbnMudGFyZ2V0V2lkdGgpOwogICAgICAgIGlmIChpc05hTih3aWR0aCkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRhcmdldFdpZHRoID0gd2lkdGgudmFsdWVPZigpOwogICAgICAgIH0KICAgIH0KCiAgICB2YXIgdGFyZ2V0SGVpZ2h0ID0gLTE7CiAgICBpZiAodHlwZW9mIG9wdGlvbnMudGFyZ2V0SGVpZ2h0ID09ICJudW1iZXIiKSB7CiAgICAgICAgdGFyZ2V0SGVpZ2h0ID0gb3B0aW9ucy50YXJnZXRIZWlnaHQ7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zLnRhcmdldEhlaWdodCA9PSAic3RyaW5nIikgewogICAgICAgIHZhciBoZWlnaHQgPSBuZXcgTnVtYmVyKG9wdGlvbnMudGFyZ2V0SGVpZ2h0KTsKICAgICAgICBpZiAoaXNOYU4oaGVpZ2h0KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGFyZ2V0SGVpZ2h0ID0gaGVpZ2h0LnZhbHVlT2YoKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiQ2FtZXJhIiwgInRha2VQaWN0dXJlIiwgW3F1YWxpdHksIGRlc3RpbmF0aW9uVHlwZSwgc291cmNlVHlwZSwgdGFyZ2V0V2lkdGgsIHRhcmdldEhlaWdodCwgZW5jb2RpbmdUeXBlXSk7Cn07CgpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpIHsKICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yLmNhbWVyYSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBuYXZpZ2F0b3IuY2FtZXJhID0gbmV3IENhbWVyYSgpOwogICAgfQp9KTsKfQovKgogKiBQaG9uZUdhcCBpcyBhdmFpbGFibGUgdW5kZXIgKmVpdGhlciogdGhlIHRlcm1zIG9mIHRoZSBtb2RpZmllZCBCU0QgbGljZW5zZSAqb3IqIHRoZQogKiBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvYWxwaGFiZXRpY2FsIGZvciBmdWxsIHRleHQuCiAqCiAqIENvcHlyaWdodCAoYykgMjAwNS0yMDEwLCBOaXRvYmkgU29mdHdhcmUgSW5jLgogKiBDb3B5cmlnaHQgKGMpIDIwMTAtMjAxMSwgSUJNIENvcnBvcmF0aW9uCiAqLwoKaWYgKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiY2FwdHVyZSIpKSB7ClBob25lR2FwLmFkZFJlc291cmNlKCJjYXB0dXJlIik7CgkKLyoqCiAqIFJlcHJlc2VudHMgYSBzaW5nbGUgZmlsZS4KICoKICogbmFtZSB7RE9NU3RyaW5nfSBuYW1lIG9mIHRoZSBmaWxlLCB3aXRob3V0IHBhdGggaW5mb3JtYXRpb24KICogZnVsbFBhdGgge0RPTVN0cmluZ30gdGhlIGZ1bGwgcGF0aCBvZiB0aGUgZmlsZSwgaW5jbHVkaW5nIHRoZSBuYW1lCiAqIHR5cGUge0RPTVN0cmluZ30gbWltZSB0eXBlCiAqIGxhc3RNb2RpZmllZERhdGUge0RhdGV9IGxhc3QgbW9kaWZpZWQgZGF0ZQogKiBzaXplIHtOdW1iZXJ9IHNpemUgb2YgdGhlIGZpbGUgaW4gYnl0ZXMKICovCnZhciBNZWRpYUZpbGUgPSBmdW5jdGlvbihuYW1lLCBmdWxsUGF0aCwgdHlwZSwgbGFzdE1vZGlmaWVkRGF0ZSwgc2l6ZSl7Cgl0aGlzLm5hbWUgPSBuYW1lIHx8IG51bGw7Cgl0aGlzLmZ1bGxQYXRoID0gZnVsbFBhdGggfHwgbnVsbDsKCXRoaXMudHlwZSA9IHR5cGUgfHwgbnVsbDsKCXRoaXMubGFzdE1vZGlmaWVkRGF0ZSA9IGxhc3RNb2RpZmllZERhdGUgfHwgbnVsbDsKCXRoaXMuc2l6ZSA9IHNpemUgfHwgMDsKfTsKCi8qKgogKiBMYXVuY2ggZGV2aWNlIGNhbWVyYSBhcHBsaWNhdGlvbiBmb3IgcmVjb3JkaW5nIHZpZGVvKHMpLgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ0IKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDQgogKi8KTWVkaWFGaWxlLnByb3RvdHlwZS5nZXRGb3JtYXREYXRhID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKXsKCVBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiQ2FwdHVyZSIsICJnZXRGb3JtYXREYXRhIiwgW3RoaXMuZnVsbFBhdGgsIHRoaXMudHlwZV0pOwp9OwoKLyoqCiAqIE1lZGlhRmlsZURhdGEgZW5jYXBzdWxhdGVzIGZvcm1hdCBpbmZvcm1hdGlvbiBvZiBhIG1lZGlhIGZpbGUuCiAqCiAqIEBwYXJhbSB7RE9NU3RyaW5nfSBjb2RlY3MKICogQHBhcmFtIHtsb25nfSBiaXRyYXRlCiAqIEBwYXJhbSB7bG9uZ30gaGVpZ2h0CiAqIEBwYXJhbSB7bG9uZ30gd2lkdGgKICogQHBhcmFtIHtmbG9hdH0gZHVyYXRpb24KICovCnZhciBNZWRpYUZpbGVEYXRhID0gZnVuY3Rpb24oY29kZWNzLCBiaXRyYXRlLCBoZWlnaHQsIHdpZHRoLCBkdXJhdGlvbil7Cgl0aGlzLmNvZGVjcyA9IGNvZGVjcyB8fCBudWxsOwoJdGhpcy5iaXRyYXRlID0gYml0cmF0ZSB8fCAwOwoJdGhpcy5oZWlnaHQgPSBoZWlnaHQgfHwgMDsKCXRoaXMud2lkdGggPSB3aWR0aCB8fCAwOwoJdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uIHx8IDA7Cn07CgovKioKICogVGhlIENhcHR1cmVFcnJvciBpbnRlcmZhY2UgZW5jYXBzdWxhdGVzIGFsbCBlcnJvcnMgaW4gdGhlIENhcHR1cmUgQVBJLgogKi8KdmFyIENhcHR1cmVFcnJvciA9IGZ1bmN0aW9uKCl7Cgl0aGlzLmNvZGUgPSBudWxsOwp9OwoKLy8gQ2FwdHVyZSBlcnJvciBjb2RlcwpDYXB0dXJlRXJyb3IuQ0FQVFVSRV9JTlRFUk5BTF9FUlIgPSAwOwpDYXB0dXJlRXJyb3IuQ0FQVFVSRV9BUFBMSUNBVElPTl9CVVNZID0gMTsKQ2FwdHVyZUVycm9yLkNBUFRVUkVfSU5WQUxJRF9BUkdVTUVOVCA9IDI7CkNhcHR1cmVFcnJvci5DQVBUVVJFX05PX01FRElBX0ZJTEVTID0gMzsKQ2FwdHVyZUVycm9yLkNBUFRVUkVfTk9UX1NVUFBPUlRFRCA9IDIwOwoKLyoqCiAqIFRoZSBDYXB0dXJlIGludGVyZmFjZSBleHBvc2VzIGFuIGludGVyZmFjZSB0byB0aGUgY2FtZXJhIGFuZCBtaWNyb3Bob25lIG9mIHRoZSBob3N0aW5nIGRldmljZS4KICovCnZhciBDYXB0dXJlID0gZnVuY3Rpb24oKXsKCXRoaXMuc3VwcG9ydGVkQXVkaW9Nb2RlcyA9IFtdOwoJdGhpcy5zdXBwb3J0ZWRJbWFnZU1vZGVzID0gW107Cgl0aGlzLnN1cHBvcnRlZFZpZGVvTW9kZXMgPSBbXTsKfTsKCi8qKgogKiBMYXVuY2ggYXVkaW8gcmVjb3JkZXIgYXBwbGljYXRpb24gZm9yIHJlY29yZGluZyBhdWRpbyBjbGlwKHMpLgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ0IKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDQgogKiBAcGFyYW0ge0NhcHR1cmVBdWRpb09wdGlvbnN9IG9wdGlvbnMKICovCkNhcHR1cmUucHJvdG90eXBlLmNhcHR1cmVBdWRpbyA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucyl7CglQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkNhcHR1cmUiLCAiY2FwdHVyZUF1ZGlvIiwgW29wdGlvbnNdKTsKfTsKCi8qKgogKiBMYXVuY2ggY2FtZXJhIGFwcGxpY2F0aW9uIGZvciB0YWtpbmcgaW1hZ2UocykuCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDQgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNCCiAqIEBwYXJhbSB7Q2FwdHVyZUltYWdlT3B0aW9uc30gb3B0aW9ucwogKi8KQ2FwdHVyZS5wcm90b3R5cGUuY2FwdHVyZUltYWdlID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKXsKCVBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiQ2FwdHVyZSIsICJjYXB0dXJlSW1hZ2UiLCBbb3B0aW9uc10pOwp9OwoKLyoqCiAqIExhdW5jaCBjYW1lcmEgYXBwbGljYXRpb24gZm9yIHRha2luZyBpbWFnZShzKS4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NCCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ0IKICogQHBhcmFtIHtDYXB0dXJlSW1hZ2VPcHRpb25zfSBvcHRpb25zCiAqLwpDYXB0dXJlLnByb3RvdHlwZS5fY2FzdE1lZGlhRmlsZSA9IGZ1bmN0aW9uKHBsdWdpblJlc3VsdCl7Cgl2YXIgbWVkaWFGaWxlcyA9IFtdOwoJdmFyIGk7Cglmb3IgKGkgPSAwOyBpIDwgcGx1Z2luUmVzdWx0Lm1lc3NhZ2UubGVuZ3RoOyBpKyspIHsKCQl2YXIgbWVkaWFGaWxlID0gbmV3IE1lZGlhRmlsZSgpOwoJCW1lZGlhRmlsZS5uYW1lID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2VbaV0ubmFtZTsKCQltZWRpYUZpbGUuZnVsbFBhdGggPSBwbHVnaW5SZXN1bHQubWVzc2FnZVtpXS5mdWxsUGF0aDsKCQltZWRpYUZpbGUudHlwZSA9IHBsdWdpblJlc3VsdC5tZXNzYWdlW2ldLnR5cGU7CgkJbWVkaWFGaWxlLmxhc3RNb2RpZmllZERhdGUgPSBwbHVnaW5SZXN1bHQubWVzc2FnZVtpXS5sYXN0TW9kaWZpZWREYXRlOwoJCW1lZGlhRmlsZS5zaXplID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2VbaV0uc2l6ZTsKCQltZWRpYUZpbGVzLnB1c2gobWVkaWFGaWxlKTsKCX0KCXBsdWdpblJlc3VsdC5tZXNzYWdlID0gbWVkaWFGaWxlczsKCXJldHVybiBwbHVnaW5SZXN1bHQ7Cn07CgovKioKICogTGF1bmNoIGRldmljZSBjYW1lcmEgYXBwbGljYXRpb24gZm9yIHJlY29yZGluZyB2aWRlbyhzKS4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NCCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ0IKICogQHBhcmFtIHtDYXB0dXJlVmlkZW9PcHRpb25zfSBvcHRpb25zCiAqLwpDYXB0dXJlLnByb3RvdHlwZS5jYXB0dXJlVmlkZW8gPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIG9wdGlvbnMpewoJUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJDYXB0dXJlIiwgImNhcHR1cmVWaWRlbyIsIFtvcHRpb25zXSk7Cn07CgovKioKICogRW5jYXBzdWxhdGVzIGEgc2V0IG9mIHBhcmFtZXRlcnMgdGhhdCB0aGUgY2FwdHVyZSBkZXZpY2Ugc3VwcG9ydHMuCiAqLwp2YXIgQ29uZmlndXJhdGlvbkRhdGEgPSBmdW5jdGlvbigpewoJLy8gVGhlIEFTQ0lJLWVuY29kZWQgc3RyaW5nIGluIGxvd2VyIGNhc2UgcmVwcmVzZW50aW5nIHRoZSBtZWRpYSB0eXBlLiAKCXRoaXMudHlwZSA9IG51bGw7CgkvLyBUaGUgaGVpZ2h0IGF0dHJpYnV0ZSByZXByZXNlbnRzIGhlaWdodCBvZiB0aGUgaW1hZ2Ugb3IgdmlkZW8gaW4gcGl4ZWxzLiAKCS8vIEluIHRoZSBjYXNlIG9mIGEgc291bmQgY2xpcCB0aGlzIGF0dHJpYnV0ZSBoYXMgdmFsdWUgMC4gCgl0aGlzLmhlaWdodCA9IDA7CgkvLyBUaGUgd2lkdGggYXR0cmlidXRlIHJlcHJlc2VudHMgd2lkdGggb2YgdGhlIGltYWdlIG9yIHZpZGVvIGluIHBpeGVscy4gCgkvLyBJbiB0aGUgY2FzZSBvZiBhIHNvdW5kIGNsaXAgdGhpcyBhdHRyaWJ1dGUgaGFzIHZhbHVlIDAKCXRoaXMud2lkdGggPSAwOwp9OwoKLyoqCiAqIEVuY2Fwc3VsYXRlcyBhbGwgaW1hZ2UgY2FwdHVyZSBvcGVyYXRpb24gY29uZmlndXJhdGlvbiBvcHRpb25zLgogKi8KdmFyIENhcHR1cmVJbWFnZU9wdGlvbnMgPSBmdW5jdGlvbigpewoJLy8gVXBwZXIgbGltaXQgb2YgaW1hZ2VzIHVzZXIgY2FuIHRha2UuIFZhbHVlIG11c3QgYmUgZXF1YWwgb3IgZ3JlYXRlciB0aGFuIDEuCgl0aGlzLmxpbWl0ID0gMTsKCS8vIFRoZSBzZWxlY3RlZCBpbWFnZSBtb2RlLiBNdXN0IG1hdGNoIHdpdGggb25lIG9mIHRoZSBlbGVtZW50cyBpbiBzdXBwb3J0ZWRJbWFnZU1vZGVzIGFycmF5LgoJdGhpcy5tb2RlID0gbnVsbDsKfTsKCi8qKgogKiBFbmNhcHN1bGF0ZXMgYWxsIHZpZGVvIGNhcHR1cmUgb3BlcmF0aW9uIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy4KICovCnZhciBDYXB0dXJlVmlkZW9PcHRpb25zID0gZnVuY3Rpb24oKXsKCS8vIFVwcGVyIGxpbWl0IG9mIHZpZGVvcyB1c2VyIGNhbiByZWNvcmQuIFZhbHVlIG11c3QgYmUgZXF1YWwgb3IgZ3JlYXRlciB0aGFuIDEuCgl0aGlzLmxpbWl0ID0gMTsKCS8vIE1heGltdW0gZHVyYXRpb24gb2YgYSBzaW5nbGUgdmlkZW8gY2xpcCBpbiBzZWNvbmRzLgoJdGhpcy5kdXJhdGlvbiA9IDA7CgkvLyBUaGUgc2VsZWN0ZWQgdmlkZW8gbW9kZS4gTXVzdCBtYXRjaCB3aXRoIG9uZSBvZiB0aGUgZWxlbWVudHMgaW4gc3VwcG9ydGVkVmlkZW9Nb2RlcyBhcnJheS4KCXRoaXMubW9kZSA9IG51bGw7Cn07CgovKioKICogRW5jYXBzdWxhdGVzIGFsbCBhdWRpbyBjYXB0dXJlIG9wZXJhdGlvbiBjb25maWd1cmF0aW9uIG9wdGlvbnMuCiAqLwp2YXIgQ2FwdHVyZUF1ZGlvT3B0aW9ucyA9IGZ1bmN0aW9uKCl7CgkvLyBVcHBlciBsaW1pdCBvZiBzb3VuZCBjbGlwcyB1c2VyIGNhbiByZWNvcmQuIFZhbHVlIG11c3QgYmUgZXF1YWwgb3IgZ3JlYXRlciB0aGFuIDEuCgl0aGlzLmxpbWl0ID0gMTsKCS8vIE1heGltdW0gZHVyYXRpb24gb2YgYSBzaW5nbGUgc291bmQgY2xpcCBpbiBzZWNvbmRzLgoJdGhpcy5kdXJhdGlvbiA9IDA7CgkvLyBUaGUgc2VsZWN0ZWQgYXVkaW8gbW9kZS4gTXVzdCBtYXRjaCB3aXRoIG9uZSBvZiB0aGUgZWxlbWVudHMgaW4gc3VwcG9ydGVkQXVkaW9Nb2RlcyBhcnJheS4KCXRoaXMubW9kZSA9IG51bGw7Cn07CgpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpewoJaWYgKHR5cGVvZiBuYXZpZ2F0b3IuZGV2aWNlID09PSAidW5kZWZpbmVkIikgewoJCW5hdmlnYXRvci5kZXZpY2UgPSB3aW5kb3cuZGV2aWNlID0gbmV3IERldmljZSgpOwoJfQoJaWYgKHR5cGVvZiBuYXZpZ2F0b3IuZGV2aWNlLmNhcHR1cmUgPT09ICJ1bmRlZmluZWQiKSB7CgkJbmF2aWdhdG9yLmRldmljZS5jYXB0dXJlID0gd2luZG93LmRldmljZS5jYXB0dXJlID0gbmV3IENhcHR1cmUoKTsKCX0KfSk7Cn0vKgogKiBQaG9uZUdhcCBpcyBhdmFpbGFibGUgdW5kZXIgKmVpdGhlciogdGhlIHRlcm1zIG9mIHRoZSBtb2RpZmllZCBCU0QgbGljZW5zZSAqb3IqIHRoZQogKiBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvYWxwaGFiZXRpY2FsIGZvciBmdWxsIHRleHQuCiAqCiAqIENvcHlyaWdodCAoYykgMjAwNS0yMDEwLCBOaXRvYmkgU29mdHdhcmUgSW5jLgogKiBDb3B5cmlnaHQgKGMpIDIwMTAtMjAxMSwgSUJNIENvcnBvcmF0aW9uCiAqLwoKaWYgKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiY29tcGFzcyIpKSB7ClBob25lR2FwLmFkZFJlc291cmNlKCJjb21wYXNzIik7CgovKioKICogVGhpcyBjbGFzcyBwcm92aWRlcyBhY2Nlc3MgdG8gZGV2aWNlIENvbXBhc3MgZGF0YS4KICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgQ29tcGFzcyA9IGZ1bmN0aW9uKCkgewogICAgLyoqCiAgICAgKiBUaGUgbGFzdCBrbm93biBDb21wYXNzIHBvc2l0aW9uLgogICAgICovCiAgICB0aGlzLmxhc3RIZWFkaW5nID0gbnVsbDsKCiAgICAvKioKICAgICAqIExpc3Qgb2YgY29tcGFzcyB3YXRjaCB0aW1lcnMKICAgICAqLwogICAgdGhpcy50aW1lcnMgPSB7fTsKfTsKCkNvbXBhc3MuRVJST1JfTVNHID0gWyJOb3QgcnVubmluZyIsICJTdGFydGluZyIsICIiLCAiRmFpbGVkIHRvIHN0YXJ0Il07CgovKioKICogQXN5bmNocm9ub3VzbHkgYXF1aXJlcyB0aGUgY3VycmVudCBoZWFkaW5nLgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGUgaGVhZGluZyBkYXRhIGlzIGF2YWlsYWJsZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IgZ2V0dGluZyB0aGUgaGVhZGluZyBkYXRhLiAoT1BUSU9OQUwpCiAqIEBwYXJhbSB7UG9zaXRpb25PcHRpb25zfSBvcHRpb25zIFRoZSBvcHRpb25zIGZvciBnZXR0aW5nIHRoZSBoZWFkaW5nIGRhdGEgc3VjaCBhcyB0aW1lb3V0LiAoT1BUSU9OQUwpCiAqLwpDb21wYXNzLnByb3RvdHlwZS5nZXRDdXJyZW50SGVhZGluZyA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucykgewoKICAgIC8vIHN1Y2Nlc3NDYWxsYmFjayByZXF1aXJlZAogICAgaWYgKHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2sgIT09ICJmdW5jdGlvbiIpIHsKICAgICAgICBjb25zb2xlLmxvZygiQ29tcGFzcyBFcnJvcjogc3VjY2Vzc0NhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIGVycm9yQ2FsbGJhY2sgb3B0aW9uYWwKICAgIGlmIChlcnJvckNhbGxiYWNrICYmICh0eXBlb2YgZXJyb3JDYWxsYmFjayAhPT0gImZ1bmN0aW9uIikpIHsKICAgICAgICBjb25zb2xlLmxvZygiQ29tcGFzcyBFcnJvcjogZXJyb3JDYWxsYmFjayBpcyBub3QgYSBmdW5jdGlvbiIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBHZXQgaGVhZGluZwogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJDb21wYXNzIiwgImdldEhlYWRpbmciLCBbXSk7Cn07CgovKioKICogQXN5bmNocm9ub3VzbHkgYXF1aXJlcyB0aGUgaGVhZGluZyByZXBlYXRlZGx5IGF0IGEgZ2l2ZW4gaW50ZXJ2YWwuCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayAgICBUaGUgZnVuY3Rpb24gdG8gY2FsbCBlYWNoIHRpbWUgdGhlIGhlYWRpbmcgZGF0YSBpcyBhdmFpbGFibGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayAgICAgIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IgZ2V0dGluZyB0aGUgaGVhZGluZyBkYXRhLiAoT1BUSU9OQUwpCiAqIEBwYXJhbSB7SGVhZGluZ09wdGlvbnN9IG9wdGlvbnMgICAgICBUaGUgb3B0aW9ucyBmb3IgZ2V0dGluZyB0aGUgaGVhZGluZyBkYXRhIHN1Y2ggYXMgdGltZW91dCBhbmQgdGhlIGZyZXF1ZW5jeSBvZiB0aGUgd2F0Y2guIChPUFRJT05BTCkKICogQHJldHVybiBTdHJpbmcgICAgICAgICAgICAgICAgICAgICAgIFRoZSB3YXRjaCBpZCB0aGF0IG11c3QgYmUgcGFzc2VkIHRvICNjbGVhcldhdGNoIHRvIHN0b3Agd2F0Y2hpbmcuCiAqLwpDb21wYXNzLnByb3RvdHlwZS53YXRjaEhlYWRpbmc9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucykgewoKICAgIC8vIERlZmF1bHQgaW50ZXJ2YWwgKDEwMCBtc2VjKQogICAgdmFyIGZyZXF1ZW5jeSA9IChvcHRpb25zICE9PSB1bmRlZmluZWQpID8gb3B0aW9ucy5mcmVxdWVuY3kgOiAxMDA7CgogICAgLy8gc3VjY2Vzc0NhbGxiYWNrIHJlcXVpcmVkCiAgICBpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayAhPT0gImZ1bmN0aW9uIikgewogICAgICAgIGNvbnNvbGUubG9nKCJDb21wYXNzIEVycm9yOiBzdWNjZXNzQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gZXJyb3JDYWxsYmFjayBvcHRpb25hbAogICAgaWYgKGVycm9yQ2FsbGJhY2sgJiYgKHR5cGVvZiBlcnJvckNhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSkgewogICAgICAgIGNvbnNvbGUubG9nKCJDb21wYXNzIEVycm9yOiBlcnJvckNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIE1ha2Ugc3VyZSBjb21wYXNzIHRpbWVvdXQgPiBmcmVxdWVuY3kgKyAxMCBzZWMKICAgIFBob25lR2FwLmV4ZWMoCiAgICAgICAgZnVuY3Rpb24odGltZW91dCkgewogICAgICAgICAgICBpZiAodGltZW91dCA8IChmcmVxdWVuY3kgKyAxMDAwMCkpIHsKICAgICAgICAgICAgICAgIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIkNvbXBhc3MiLCAic2V0VGltZW91dCIsIFtmcmVxdWVuY3kgKyAxMDAwMF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBmdW5jdGlvbihlKSB7IH0sICJDb21wYXNzIiwgImdldFRpbWVvdXQiLCBbXSk7CgogICAgLy8gU3RhcnQgd2F0Y2ggdGltZXIgdG8gZ2V0IGhlYWRpbmdzCiAgICB2YXIgaWQgPSBQaG9uZUdhcC5jcmVhdGVVVUlEKCk7CiAgICBuYXZpZ2F0b3IuY29tcGFzcy50aW1lcnNbaWRdID0gc2V0SW50ZXJ2YWwoCiAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiQ29tcGFzcyIsICJnZXRIZWFkaW5nIiwgW10pOwogICAgICAgIH0sIChmcmVxdWVuY3kgPyBmcmVxdWVuY3kgOiAxKSk7CgogICAgcmV0dXJuIGlkOwp9OwoKCi8qKgogKiBDbGVhcnMgdGhlIHNwZWNpZmllZCBoZWFkaW5nIHdhdGNoLgogKgogKiBAcGFyYW0ge1N0cmluZ30gaWQgICAgICAgVGhlIElEIG9mIHRoZSB3YXRjaCByZXR1cm5lZCBmcm9tICN3YXRjaEhlYWRpbmcuCiAqLwpDb21wYXNzLnByb3RvdHlwZS5jbGVhcldhdGNoID0gZnVuY3Rpb24oaWQpIHsKCiAgICAvLyBTdG9wIGphdmFzY3JpcHQgdGltZXIgJiByZW1vdmUgZnJvbSB0aW1lciBsaXN0CiAgICBpZiAoaWQgJiYgbmF2aWdhdG9yLmNvbXBhc3MudGltZXJzW2lkXSkgewogICAgICAgIGNsZWFySW50ZXJ2YWwobmF2aWdhdG9yLmNvbXBhc3MudGltZXJzW2lkXSk7CiAgICAgICAgZGVsZXRlIG5hdmlnYXRvci5jb21wYXNzLnRpbWVyc1tpZF07CiAgICB9Cn07CgpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpIHsKICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yLmNvbXBhc3MgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgbmF2aWdhdG9yLmNvbXBhc3MgPSBuZXcgQ29tcGFzcygpOwogICAgfQp9KTsKfQovKgogKiBQaG9uZUdhcCBpcyBhdmFpbGFibGUgdW5kZXIgKmVpdGhlciogdGhlIHRlcm1zIG9mIHRoZSBtb2RpZmllZCBCU0QgbGljZW5zZSAqb3IqIHRoZQogKiBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvYWxwaGFiZXRpY2FsIGZvciBmdWxsIHRleHQuCiAqCiAqIENvcHlyaWdodCAoYykgMjAwNS0yMDEwLCBOaXRvYmkgU29mdHdhcmUgSW5jLgogKiBDb3B5cmlnaHQgKGMpIDIwMTAtMjAxMSwgSUJNIENvcnBvcmF0aW9uCiAqLwoKaWYgKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiY29udGFjdCIpKSB7ClBob25lR2FwLmFkZFJlc291cmNlKCJjb250YWN0Iik7CgovKioKKiBDb250YWlucyBpbmZvcm1hdGlvbiBhYm91dCBhIHNpbmdsZSBjb250YWN0LgoqIEBjb25zdHJ1Y3RvcgoqIEBwYXJhbSB7RE9NU3RyaW5nfSBpZCB1bmlxdWUgaWRlbnRpZmllcgoqIEBwYXJhbSB7RE9NU3RyaW5nfSBkaXNwbGF5TmFtZQoqIEBwYXJhbSB7Q29udGFjdE5hbWV9IG5hbWUKKiBAcGFyYW0ge0RPTVN0cmluZ30gbmlja25hbWUKKiBAcGFyYW0ge0FycmF5LjxDb250YWN0RmllbGQ+fSBwaG9uZU51bWJlcnMgYXJyYXkgb2YgcGhvbmUgbnVtYmVycwoqIEBwYXJhbSB7QXJyYXkuPENvbnRhY3RGaWVsZD59IGVtYWlscyBhcnJheSBvZiBlbWFpbCBhZGRyZXNzZXMKKiBAcGFyYW0ge0FycmF5LjxDb250YWN0QWRkcmVzcz59IGFkZHJlc3NlcyBhcnJheSBvZiBhZGRyZXNzZXMKKiBAcGFyYW0ge0FycmF5LjxDb250YWN0RmllbGQ+fSBpbXMgaW5zdGFudCBtZXNzYWdpbmcgdXNlciBpZHMKKiBAcGFyYW0ge0FycmF5LjxDb250YWN0T3JnYW5pemF0aW9uPn0gb3JnYW5pemF0aW9ucwoqIEBwYXJhbSB7RE9NU3RyaW5nfSBiaXJ0aGRheSBjb250YWN0J3MgYmlydGhkYXkKKiBAcGFyYW0ge0RPTVN0cmluZ30gbm90ZSB1c2VyIG5vdGVzIGFib3V0IGNvbnRhY3QKKiBAcGFyYW0ge0FycmF5LjxDb250YWN0RmllbGQ+fSBwaG90b3MKKiBAcGFyYW0ge0FycmF5LjxDb250YWN0RmllbGQ+fSBjYXRlZ29yaWVzCiogQHBhcmFtIHtBcnJheS48Q29udGFjdEZpZWxkPn0gdXJscyBjb250YWN0J3Mgd2ViIHNpdGVzCiovCnZhciBDb250YWN0ID0gZnVuY3Rpb24gKGlkLCBkaXNwbGF5TmFtZSwgbmFtZSwgbmlja25hbWUsIHBob25lTnVtYmVycywgZW1haWxzLCBhZGRyZXNzZXMsCiAgICBpbXMsIG9yZ2FuaXphdGlvbnMsIGJpcnRoZGF5LCBub3RlLCBwaG90b3MsIGNhdGVnb3JpZXMsIHVybHMpIHsKICAgIHRoaXMuaWQgPSBpZCB8fCBudWxsOwogICAgdGhpcy5yYXdJZCA9IG51bGw7CiAgICB0aGlzLmRpc3BsYXlOYW1lID0gZGlzcGxheU5hbWUgfHwgbnVsbDsKICAgIHRoaXMubmFtZSA9IG5hbWUgfHwgbnVsbDsgLy8gQ29udGFjdE5hbWUKICAgIHRoaXMubmlja25hbWUgPSBuaWNrbmFtZSB8fCBudWxsOwogICAgdGhpcy5waG9uZU51bWJlcnMgPSBwaG9uZU51bWJlcnMgfHwgbnVsbDsgLy8gQ29udGFjdEZpZWxkW10KICAgIHRoaXMuZW1haWxzID0gZW1haWxzIHx8IG51bGw7IC8vIENvbnRhY3RGaWVsZFtdCiAgICB0aGlzLmFkZHJlc3NlcyA9IGFkZHJlc3NlcyB8fCBudWxsOyAvLyBDb250YWN0QWRkcmVzc1tdCiAgICB0aGlzLmltcyA9IGltcyB8fCBudWxsOyAvLyBDb250YWN0RmllbGRbXQogICAgdGhpcy5vcmdhbml6YXRpb25zID0gb3JnYW5pemF0aW9ucyB8fCBudWxsOyAvLyBDb250YWN0T3JnYW5pemF0aW9uW10KICAgIHRoaXMuYmlydGhkYXkgPSBiaXJ0aGRheSB8fCBudWxsOwogICAgdGhpcy5ub3RlID0gbm90ZSB8fCBudWxsOwogICAgdGhpcy5waG90b3MgPSBwaG90b3MgfHwgbnVsbDsgLy8gQ29udGFjdEZpZWxkW10KICAgIHRoaXMuY2F0ZWdvcmllcyA9IGNhdGVnb3JpZXMgfHwgbnVsbDsgLy8gQ29udGFjdEZpZWxkW10KICAgIHRoaXMudXJscyA9IHVybHMgfHwgbnVsbDsgLy8gQ29udGFjdEZpZWxkW10KfTsKCi8qKgogKiAgQ29udGFjdEVycm9yLgogKiAgQW4gZXJyb3IgY29kZSBhc3NpZ25lZCBieSBhbiBpbXBsZW1lbnRhdGlvbiB3aGVuIGFuIGVycm9yIGhhcyBvY2N1cnJlZHMKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgQ29udGFjdEVycm9yID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmNvZGU9bnVsbDsKfTsKCi8qKgogKiBFcnJvciBjb2RlcwogKi8KQ29udGFjdEVycm9yLlVOS05PV05fRVJST1IgPSAwOwpDb250YWN0RXJyb3IuSU5WQUxJRF9BUkdVTUVOVF9FUlJPUiA9IDE7CkNvbnRhY3RFcnJvci5USU1FT1VUX0VSUk9SID0gMjsKQ29udGFjdEVycm9yLlBFTkRJTkdfT1BFUkFUSU9OX0VSUk9SID0gMzsKQ29udGFjdEVycm9yLklPX0VSUk9SID0gNDsKQ29udGFjdEVycm9yLk5PVF9TVVBQT1JURURfRVJST1IgPSA1OwpDb250YWN0RXJyb3IuUEVSTUlTU0lPTl9ERU5JRURfRVJST1IgPSAyMDsKCi8qKgoqIFJlbW92ZXMgY29udGFjdCBmcm9tIGRldmljZSBzdG9yYWdlLgoqIEBwYXJhbSBzdWNjZXNzQ0Igc3VjY2VzcyBjYWxsYmFjawoqIEBwYXJhbSBlcnJvckNCIGVycm9yIGNhbGxiYWNrCiovCkNvbnRhY3QucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKHN1Y2Nlc3NDQiwgZXJyb3JDQikgewogICAgaWYgKHRoaXMuaWQgPT09IG51bGwpIHsKICAgICAgICB2YXIgZXJyb3JPYmogPSBuZXcgQ29udGFjdEVycm9yKCk7CiAgICAgICAgZXJyb3JPYmouY29kZSA9IENvbnRhY3RFcnJvci5VTktOT1dOX0VSUk9SOwogICAgICAgIGVycm9yQ0IoZXJyb3JPYmopOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ0IsIGVycm9yQ0IsICJDb250YWN0cyIsICJyZW1vdmUiLCBbdGhpcy5pZF0pOwogICAgfQp9OwoKLyoqCiogQ3JlYXRlcyBhIGRlZXAgY29weSBvZiB0aGlzIENvbnRhY3QuCiogV2l0aCB0aGUgY29udGFjdCBJRCBzZXQgdG8gbnVsbC4KKiBAcmV0dXJuIGNvcHkgb2YgdGhpcyBDb250YWN0CiovCkNvbnRhY3QucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgY2xvbmVkQ29udGFjdCA9IFBob25lR2FwLmNsb25lKHRoaXMpOwogICAgdmFyIGk7CiAgICBjbG9uZWRDb250YWN0LmlkID0gbnVsbDsKICAgIGNsb25lZENvbnRhY3QucmF3SWQgPSBudWxsOwogICAgLy8gTG9vcCB0aHJvdWdoIGFuZCBjbGVhciBvdXQgYW55IGlkJ3MgaW4gcGhvbmVzLCBlbWFpbHMsIGV0Yy4KICAgIGlmIChjbG9uZWRDb250YWN0LnBob25lTnVtYmVycykgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbG9uZWRDb250YWN0LnBob25lTnVtYmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjbG9uZWRDb250YWN0LnBob25lTnVtYmVyc1tpXS5pZCA9IG51bGw7CiAgICAgICAgfQogICAgfQogICAgaWYgKGNsb25lZENvbnRhY3QuZW1haWxzKSB7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNsb25lZENvbnRhY3QuZW1haWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNsb25lZENvbnRhY3QuZW1haWxzW2ldLmlkID0gbnVsbDsKICAgICAgICB9CiAgICB9CiAgICBpZiAoY2xvbmVkQ29udGFjdC5hZGRyZXNzZXMpIHsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2xvbmVkQ29udGFjdC5hZGRyZXNzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2xvbmVkQ29udGFjdC5hZGRyZXNzZXNbaV0uaWQgPSBudWxsOwogICAgICAgIH0KICAgIH0KICAgIGlmIChjbG9uZWRDb250YWN0LmltcykgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbG9uZWRDb250YWN0Lmltcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjbG9uZWRDb250YWN0Lmltc1tpXS5pZCA9IG51bGw7CiAgICAgICAgfQogICAgfQogICAgaWYgKGNsb25lZENvbnRhY3Qub3JnYW5pemF0aW9ucykgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbG9uZWRDb250YWN0Lm9yZ2FuaXphdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2xvbmVkQ29udGFjdC5vcmdhbml6YXRpb25zW2ldLmlkID0gbnVsbDsKICAgICAgICB9CiAgICB9CiAgICBpZiAoY2xvbmVkQ29udGFjdC50YWdzKSB7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNsb25lZENvbnRhY3QudGFncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjbG9uZWRDb250YWN0LnRhZ3NbaV0uaWQgPSBudWxsOwogICAgICAgIH0KICAgIH0KICAgIGlmIChjbG9uZWRDb250YWN0LnBob3RvcykgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbG9uZWRDb250YWN0LnBob3Rvcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjbG9uZWRDb250YWN0LnBob3Rvc1tpXS5pZCA9IG51bGw7CiAgICAgICAgfQogICAgfQogICAgaWYgKGNsb25lZENvbnRhY3QudXJscykgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbG9uZWRDb250YWN0LnVybHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2xvbmVkQ29udGFjdC51cmxzW2ldLmlkID0gbnVsbDsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gY2xvbmVkQ29udGFjdDsKfTsKCi8qKgoqIFBlcnNpc3RzIGNvbnRhY3QgdG8gZGV2aWNlIHN0b3JhZ2UuCiogQHBhcmFtIHN1Y2Nlc3NDQiBzdWNjZXNzIGNhbGxiYWNrCiogQHBhcmFtIGVycm9yQ0IgZXJyb3IgY2FsbGJhY2sKKi8KQ29udGFjdC5wcm90b3R5cGUuc2F2ZSA9IGZ1bmN0aW9uKHN1Y2Nlc3NDQiwgZXJyb3JDQikgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ0IsIGVycm9yQ0IsICJDb250YWN0cyIsICJzYXZlIiwgW3RoaXNdKTsKfTsKCi8qKgoqIENvbnRhY3QgbmFtZS4KKiBAY29uc3RydWN0b3IKKiBAcGFyYW0gZm9ybWF0dGVkCiogQHBhcmFtIGZhbWlseU5hbWUKKiBAcGFyYW0gZ2l2ZW5OYW1lCiogQHBhcmFtIG1pZGRsZQoqIEBwYXJhbSBwcmVmaXgKKiBAcGFyYW0gc3VmZml4CiovCnZhciBDb250YWN0TmFtZSA9IGZ1bmN0aW9uKGZvcm1hdHRlZCwgZmFtaWx5TmFtZSwgZ2l2ZW5OYW1lLCBtaWRkbGUsIHByZWZpeCwgc3VmZml4KSB7CiAgICB0aGlzLmZvcm1hdHRlZCA9IGZvcm1hdHRlZCB8fCBudWxsOwogICAgdGhpcy5mYW1pbHlOYW1lID0gZmFtaWx5TmFtZSB8fCBudWxsOwogICAgdGhpcy5naXZlbk5hbWUgPSBnaXZlbk5hbWUgfHwgbnVsbDsKICAgIHRoaXMubWlkZGxlTmFtZSA9IG1pZGRsZSB8fCBudWxsOwogICAgdGhpcy5ob25vcmlmaWNQcmVmaXggPSBwcmVmaXggfHwgbnVsbDsKICAgIHRoaXMuaG9ub3JpZmljU3VmZml4ID0gc3VmZml4IHx8IG51bGw7Cn07CgovKioKKiBHZW5lcmljIGNvbnRhY3QgZmllbGQuCiogQGNvbnN0cnVjdG9yCiogQHBhcmFtIHtET01TdHJpbmd9IGlkIHVuaXF1ZSBpZGVudGlmaWVyLCBzaG91bGQgb25seSBiZSBzZXQgYnkgbmF0aXZlIGNvZGUKKiBAcGFyYW0gdHlwZQoqIEBwYXJhbSB2YWx1ZQoqIEBwYXJhbSBwcmVmCiovCnZhciBDb250YWN0RmllbGQgPSBmdW5jdGlvbih0eXBlLCB2YWx1ZSwgcHJlZikgewoJdGhpcy5pZCA9IG51bGw7CiAgICB0aGlzLnR5cGUgPSB0eXBlIHx8IG51bGw7CiAgICB0aGlzLnZhbHVlID0gdmFsdWUgfHwgbnVsbDsKICAgIHRoaXMucHJlZiA9IHByZWYgfHwgbnVsbDsKfTsKCi8qKgoqIENvbnRhY3QgYWRkcmVzcy4KKiBAY29uc3RydWN0b3IKKiBAcGFyYW0ge0RPTVN0cmluZ30gaWQgdW5pcXVlIGlkZW50aWZpZXIsIHNob3VsZCBvbmx5IGJlIHNldCBieSBuYXRpdmUgY29kZQoqIEBwYXJhbSBmb3JtYXR0ZWQKKiBAcGFyYW0gc3RyZWV0QWRkcmVzcwoqIEBwYXJhbSBsb2NhbGl0eQoqIEBwYXJhbSByZWdpb24KKiBAcGFyYW0gcG9zdGFsQ29kZQoqIEBwYXJhbSBjb3VudHJ5CiovCnZhciBDb250YWN0QWRkcmVzcyA9IGZ1bmN0aW9uKHByZWYsIHR5cGUsIGZvcm1hdHRlZCwgc3RyZWV0QWRkcmVzcywgbG9jYWxpdHksIHJlZ2lvbiwgcG9zdGFsQ29kZSwgY291bnRyeSkgewoJdGhpcy5pZCA9IG51bGw7CiAgICB0aGlzLnByZWYgPSBwcmVmIHx8IG51bGw7CiAgICB0aGlzLnR5cGUgPSB0eXBlIHx8IG51bGw7CiAgICB0aGlzLmZvcm1hdHRlZCA9IGZvcm1hdHRlZCB8fCBudWxsOwogICAgdGhpcy5zdHJlZXRBZGRyZXNzID0gc3RyZWV0QWRkcmVzcyB8fCBudWxsOwogICAgdGhpcy5sb2NhbGl0eSA9IGxvY2FsaXR5IHx8IG51bGw7CiAgICB0aGlzLnJlZ2lvbiA9IHJlZ2lvbiB8fCBudWxsOwogICAgdGhpcy5wb3N0YWxDb2RlID0gcG9zdGFsQ29kZSB8fCBudWxsOwogICAgdGhpcy5jb3VudHJ5ID0gY291bnRyeSB8fCBudWxsOwp9OwoKLyoqCiogQ29udGFjdCBvcmdhbml6YXRpb24uCiogQGNvbnN0cnVjdG9yCiogQHBhcmFtIHtET01TdHJpbmd9IGlkIHVuaXF1ZSBpZGVudGlmaWVyLCBzaG91bGQgb25seSBiZSBzZXQgYnkgbmF0aXZlIGNvZGUKKiBAcGFyYW0gbmFtZQoqIEBwYXJhbSBkZXB0CiogQHBhcmFtIHRpdGxlCiogQHBhcmFtIHN0YXJ0RGF0ZQoqIEBwYXJhbSBlbmREYXRlCiogQHBhcmFtIGxvY2F0aW9uCiogQHBhcmFtIGRlc2MKKi8KdmFyIENvbnRhY3RPcmdhbml6YXRpb24gPSBmdW5jdGlvbihwcmVmLCB0eXBlLCBuYW1lLCBkZXB0LCB0aXRsZSkgewoJdGhpcy5pZCA9IG51bGw7CiAgICB0aGlzLnByZWYgPSBwcmVmIHx8IG51bGw7CiAgICB0aGlzLnR5cGUgPSB0eXBlIHx8IG51bGw7CiAgICB0aGlzLm5hbWUgPSBuYW1lIHx8IG51bGw7CiAgICB0aGlzLmRlcGFydG1lbnQgPSBkZXB0IHx8IG51bGw7CiAgICB0aGlzLnRpdGxlID0gdGl0bGUgfHwgbnVsbDsKfTsKCi8qKgoqIFJlcHJlc2VudHMgYSBncm91cCBvZiBDb250YWN0cy4KKiBAY29uc3RydWN0b3IKKi8KdmFyIENvbnRhY3RzID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmluUHJvZ3Jlc3MgPSBmYWxzZTsKICAgIHRoaXMucmVjb3JkcyA9IFtdOwp9OwovKioKKiBSZXR1cm5zIGFuIGFycmF5IG9mIENvbnRhY3RzIG1hdGNoaW5nIHRoZSBzZWFyY2ggY3JpdGVyaWEuCiogQHBhcmFtIGZpZWxkcyB0aGF0IHNob3VsZCBiZSBzZWFyY2hlZAoqIEBwYXJhbSBzdWNjZXNzQ0Igc3VjY2VzcyBjYWxsYmFjawoqIEBwYXJhbSBlcnJvckNCIGVycm9yIGNhbGxiYWNrCiogQHBhcmFtIHtDb250YWN0RmluZE9wdGlvbnN9IG9wdGlvbnMgdGhhdCBjYW4gYmUgYXBwbGllZCB0byBjb250YWN0IHNlYXJjaGluZwoqIEByZXR1cm4gYXJyYXkgb2YgQ29udGFjdHMgbWF0Y2hpbmcgc2VhcmNoIGNyaXRlcmlhCiovCkNvbnRhY3RzLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24oZmllbGRzLCBzdWNjZXNzQ0IsIGVycm9yQ0IsIG9wdGlvbnMpIHsKICAgIGlmIChzdWNjZXNzQ0IgPT09IG51bGwpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJZb3UgbXVzdCBzcGVjaWZ5IGEgc3VjY2VzcyBjYWxsYmFjayBmb3IgdGhlIGZpbmQgY29tbWFuZC4iKTsKICAgIH0KICAgIGlmIChmaWVsZHMgPT09IG51bGwgfHwgZmllbGRzID09PSAidW5kZWZpbmVkIiB8fCBmaWVsZHMubGVuZ3RoID09PSAidW5kZWZpbmVkIiB8fCBmaWVsZHMubGVuZ3RoIDw9IDApIHsKICAgICAgICBpZiAodHlwZW9mIGVycm9yQ0IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgZXJyb3JDQih7ImNvZGUiOiBDb250YWN0RXJyb3IuSU5WQUxJRF9BUkdVTUVOVF9FUlJPUn0pOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ0IsIGVycm9yQ0IsICJDb250YWN0cyIsICJzZWFyY2giLCBbZmllbGRzLCBvcHRpb25zXSk7ICAgICAgICAKICAgIH0KfTsKCi8qKgoqIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyBhIG5ldyBjb250YWN0LCBidXQgaXQgZG9lcyBub3QgcGVyc2lzdCB0aGUgY29udGFjdAoqIHRvIGRldmljZSBzdG9yYWdlLiBUbyBwZXJzaXN0IHRoZSBjb250YWN0IHRvIGRldmljZSBzdG9yYWdlLCBpbnZva2UKKiBjb250YWN0LnNhdmUoKS4KKiBAcGFyYW0gcHJvcGVydGllcyBhbiBvYmplY3Qgd2hvJ3MgcHJvcGVydGllcyB3aWxsIGJlIGV4YW1pbmVkIHRvIGNyZWF0ZSBhIG5ldyBDb250YWN0CiogQHJldHVybnMgbmV3IENvbnRhY3Qgb2JqZWN0CiovCkNvbnRhY3RzLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7CiAgICB2YXIgaTsKCXZhciBjb250YWN0ID0gbmV3IENvbnRhY3QoKTsKICAgIGZvciAoaSBpbiBwcm9wZXJ0aWVzKSB7CiAgICAgICAgaWYgKGNvbnRhY3RbaV0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGNvbnRhY3RbaV0gPSBwcm9wZXJ0aWVzW2ldOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBjb250YWN0Owp9OwoKLyoqCiogVGhpcyBmdW5jdGlvbiByZXR1cm5zIGFuZCBhcnJheSBvZiBjb250YWN0cy4gIEl0IGlzIHJlcXVpcmVkIGFzIHdlIG5lZWQgdG8gY29udmVydCByYXcKKiBKU09OIG9iamVjdHMgaW50byBjb25jcmV0ZSBDb250YWN0IG9iamVjdHMuICBDdXJyZW50bHkgdGhpcyBtZXRob2QgaXMgY2FsbGVkIGFmdGVyCiogbmF2aWdhdG9yLmNvbnRhY3RzLmZpbmQgYnV0IGJlZm9yZSB0aGUgZmluZCBtZXRob2RzIHN1Y2Nlc3MgY2FsbCBiYWNrLgoqCiogQHBhcmFtIGpzb25BcnJheSBhbiBhcnJheSBvZiBKU09OIE9iamVjdHMgdGhhdCBuZWVkIHRvIGJlIGNvbnZlcnRlZCB0byBDb250YWN0IG9iamVjdHMuCiogQHJldHVybnMgYW4gYXJyYXkgb2YgQ29udGFjdCBvYmplY3RzCiovCkNvbnRhY3RzLnByb3RvdHlwZS5jYXN0ID0gZnVuY3Rpb24ocGx1Z2luUmVzdWx0KSB7Cgl2YXIgY29udGFjdHMgPSBbXTsKCXZhciBpOwoJZm9yIChpPTA7IGk8cGx1Z2luUmVzdWx0Lm1lc3NhZ2UubGVuZ3RoOyBpKyspIHsKCQljb250YWN0cy5wdXNoKG5hdmlnYXRvci5jb250YWN0cy5jcmVhdGUocGx1Z2luUmVzdWx0Lm1lc3NhZ2VbaV0pKTsKCX0KCXBsdWdpblJlc3VsdC5tZXNzYWdlID0gY29udGFjdHM7CglyZXR1cm4gcGx1Z2luUmVzdWx0Owp9OwoKLyoqCiAqIENvbnRhY3RGaW5kT3B0aW9ucy4KICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSBmaWx0ZXIgdXNlZCB0byBtYXRjaCBjb250YWN0cyBhZ2FpbnN0CiAqIEBwYXJhbSBtdWx0aXBsZSBib29sZWFuIHVzZWQgdG8gZGV0ZXJtaW5lIGlmIG1vcmUgdGhhbiBvbmUgY29udGFjdCBzaG91bGQgYmUgcmV0dXJuZWQKICovCnZhciBDb250YWN0RmluZE9wdGlvbnMgPSBmdW5jdGlvbihmaWx0ZXIsIG11bHRpcGxlKSB7CiAgICB0aGlzLmZpbHRlciA9IGZpbHRlciB8fCAnJzsKICAgIHRoaXMubXVsdGlwbGUgPSBtdWx0aXBsZSB8fCBmYWxzZTsKfTsKCi8qKgogKiBBZGQgdGhlIGNvbnRhY3QgaW50ZXJmYWNlIGludG8gdGhlIGJyb3dzZXIuCiAqLwpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpIHsKICAgIGlmKHR5cGVvZiBuYXZpZ2F0b3IuY29udGFjdHMgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgbmF2aWdhdG9yLmNvbnRhY3RzID0gbmV3IENvbnRhY3RzKCk7CiAgICB9Cn0pOwp9Ci8qCiAqIFBob25lR2FwIGlzIGF2YWlsYWJsZSB1bmRlciAqZWl0aGVyKiB0aGUgdGVybXMgb2YgdGhlIG1vZGlmaWVkIEJTRCBsaWNlbnNlICpvciogdGhlCiAqIE1JVCBMaWNlbnNlICgyMDA4KS4gU2VlIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9hbHBoYWJldGljYWwgZm9yIGZ1bGwgdGV4dC4KICoKICogQ29weXJpZ2h0IChjKSAyMDA1LTIwMTAsIE5pdG9iaSBTb2Z0d2FyZSBJbmMuCiAqIENvcHlyaWdodCAoYykgMjAxMC0yMDExLCBJQk0gQ29ycG9yYXRpb24KICovCgovLyBUT0RPOiBOZWVkcyB0byBiZSBjb21tZW50ZWQKCmlmICghUGhvbmVHYXAuaGFzUmVzb3VyY2UoImNyeXB0byIpKSB7ClBob25lR2FwLmFkZFJlc291cmNlKCJjcnlwdG8iKTsKCi8qKgoqIEBjb25zdHJ1Y3RvcgoqLwp2YXIgQ3J5cHRvID0gZnVuY3Rpb24oKSB7Cn07CgpDcnlwdG8ucHJvdG90eXBlLmVuY3J5cHQgPSBmdW5jdGlvbihzZWVkLCBzdHJpbmcsIGNhbGxiYWNrKSB7CiAgICB0aGlzLmVuY3J5cHRXaW4gPSBjYWxsYmFjazsKICAgIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIkNyeXB0byIsICJlbmNyeXB0IiwgW3NlZWQsIHN0cmluZ10pOwp9OwoKQ3J5cHRvLnByb3RvdHlwZS5kZWNyeXB0ID0gZnVuY3Rpb24oc2VlZCwgc3RyaW5nLCBjYWxsYmFjaykgewogICAgdGhpcy5kZWNyeXB0V2luID0gY2FsbGJhY2s7CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJDcnlwdG8iLCAiZGVjcnlwdCIsIFtzZWVkLCBzdHJpbmddKTsKfTsKCkNyeXB0by5wcm90b3R5cGUuZ290Q3J5cHRlZFN0cmluZyA9IGZ1bmN0aW9uKHN0cmluZykgewogICAgdGhpcy5lbmNyeXB0V2luKHN0cmluZyk7Cn07CgpDcnlwdG8ucHJvdG90eXBlLmdldFBsYWluU3RyaW5nID0gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICB0aGlzLmRlY3J5cHRXaW4oc3RyaW5nKTsKfTsKClBob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCkgewogICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IuQ3J5cHRvID09PSAidW5kZWZpbmVkIikgewogICAgICAgIG5hdmlnYXRvci5DcnlwdG8gPSBuZXcgQ3J5cHRvKCk7CiAgICB9Cn0pOwp9Ci8qCiAqIFBob25lR2FwIGlzIGF2YWlsYWJsZSB1bmRlciAqZWl0aGVyKiB0aGUgdGVybXMgb2YgdGhlIG1vZGlmaWVkIEJTRCBsaWNlbnNlICpvciogdGhlCiAqIE1JVCBMaWNlbnNlICgyMDA4KS4gU2VlIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9hbHBoYWJldGljYWwgZm9yIGZ1bGwgdGV4dC4KICoKICogQ29weXJpZ2h0IChjKSAyMDA1LTIwMTAsIE5pdG9iaSBTb2Z0d2FyZSBJbmMuCiAqIENvcHlyaWdodCAoYykgMjAxMC0yMDExLCBJQk0gQ29ycG9yYXRpb24KICovCgppZiAoIVBob25lR2FwLmhhc1Jlc291cmNlKCJkZXZpY2UiKSkgewpQaG9uZUdhcC5hZGRSZXNvdXJjZSgiZGV2aWNlIik7CgovKioKICogVGhpcyByZXByZXNlbnRzIHRoZSBtb2JpbGUgZGV2aWNlLCBhbmQgcHJvdmlkZXMgcHJvcGVydGllcyBmb3IgaW5zcGVjdGluZyB0aGUgbW9kZWwsIHZlcnNpb24sIFVVSUQgb2YgdGhlCiAqIHBob25lLCBldGMuCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIERldmljZSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5hdmFpbGFibGUgPSBQaG9uZUdhcC5hdmFpbGFibGU7CiAgICB0aGlzLnBsYXRmb3JtID0gbnVsbDsKICAgIHRoaXMudmVyc2lvbiA9IG51bGw7CiAgICB0aGlzLm5hbWUgPSBudWxsOwogICAgdGhpcy51dWlkID0gbnVsbDsKICAgIHRoaXMucGhvbmVnYXAgPSBudWxsOwoKICAgIHZhciBtZSA9IHRoaXM7CiAgICB0aGlzLmdldEluZm8oCiAgICAgICAgZnVuY3Rpb24oaW5mbykgewogICAgICAgICAgICBtZS5hdmFpbGFibGUgPSB0cnVlOwogICAgICAgICAgICBtZS5wbGF0Zm9ybSA9IGluZm8ucGxhdGZvcm07CiAgICAgICAgICAgIG1lLnZlcnNpb24gPSBpbmZvLnZlcnNpb247CiAgICAgICAgICAgIG1lLm5hbWUgPSBpbmZvLm5hbWU7CiAgICAgICAgICAgIG1lLnV1aWQgPSBpbmZvLnV1aWQ7CiAgICAgICAgICAgIG1lLnBob25lZ2FwID0gaW5mby5waG9uZWdhcDsKICAgICAgICAgICAgUGhvbmVHYXAub25QaG9uZUdhcEluZm9SZWFkeS5maXJlKCk7CiAgICAgICAgfSwKICAgICAgICBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIG1lLmF2YWlsYWJsZSA9IGZhbHNlOwogICAgICAgICAgICBjb25zb2xlLmxvZygiRXJyb3IgaW5pdGlhbGl6aW5nIFBob25lR2FwOiAiICsgZSk7CiAgICAgICAgICAgIGFsZXJ0KCJFcnJvciBpbml0aWFsaXppbmcgUGhvbmVHYXA6ICIrZSk7CiAgICAgICAgfSk7Cn07CgovKioKICogR2V0IGRldmljZSBpbmZvCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZSBoZWFkaW5nIGRhdGEgaXMgYXZhaWxhYmxlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGVyZSBpcyBhbiBlcnJvciBnZXR0aW5nIHRoZSBoZWFkaW5nIGRhdGEuIChPUFRJT05BTCkKICovCkRldmljZS5wcm90b3R5cGUuZ2V0SW5mbyA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewoKICAgIC8vIHN1Y2Nlc3NDYWxsYmFjayByZXF1aXJlZAogICAgaWYgKHR5cGVvZiBzdWNjZXNzQ2FsbGJhY2sgIT09ICJmdW5jdGlvbiIpIHsKICAgICAgICBjb25zb2xlLmxvZygiRGV2aWNlIEVycm9yOiBzdWNjZXNzQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gZXJyb3JDYWxsYmFjayBvcHRpb25hbAogICAgaWYgKGVycm9yQ2FsbGJhY2sgJiYgKHR5cGVvZiBlcnJvckNhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSkgewogICAgICAgIGNvbnNvbGUubG9nKCJEZXZpY2UgRXJyb3I6IGVycm9yQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gR2V0IGluZm8KICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRGV2aWNlIiwgImdldERldmljZUluZm8iLCBbXSk7Cn07CgovKgogKiBERVBSRUNBVEVECiAqIFRoaXMgaXMgb25seSBmb3IgQW5kcm9pZC4KICoKICogWW91IG11c3QgZXhwbGljaXRseSBvdmVycmlkZSB0aGUgYmFjayBidXR0b24uCiAqLwpEZXZpY2UucHJvdG90eXBlLm92ZXJyaWRlQmFja0J1dHRvbiA9IGZ1bmN0aW9uKCkgewoJY29uc29sZS5sb2coIkRldmljZS5vdmVycmlkZUJhY2tCdXR0b24oKSBpcyBkZXByZWNhdGVkLiAgVXNlIEFwcC5vdmVycmlkZUJhY2tidXR0b24odHJ1ZSkuIik7CgluYXZpZ2F0b3IuYXBwLm92ZXJyaWRlQmFja2J1dHRvbih0cnVlKTsKfTsKCi8qCiAqIERFUFJFQ0FURUQKICogVGhpcyBpcyBvbmx5IGZvciBBbmRyb2lkLgogKgogKiBUaGlzIHJlc2V0cyB0aGUgYmFjayBidXR0b24gdG8gdGhlIGRlZmF1bHQgYmVoYXZpb3VyCiAqLwpEZXZpY2UucHJvdG90eXBlLnJlc2V0QmFja0J1dHRvbiA9IGZ1bmN0aW9uKCkgewoJY29uc29sZS5sb2coIkRldmljZS5yZXNldEJhY2tCdXR0b24oKSBpcyBkZXByZWNhdGVkLiAgVXNlIEFwcC5vdmVycmlkZUJhY2tidXR0b24oZmFsc2UpLiIpOwoJbmF2aWdhdG9yLmFwcC5vdmVycmlkZUJhY2tidXR0b24oZmFsc2UpOwp9OwoKLyoKICogREVQUkVDQVRFRAogKiBUaGlzIGlzIG9ubHkgZm9yIEFuZHJvaWQuCiAqCiAqIFRoaXMgdGVybWluYXRlcyB0aGUgYWN0aXZpdHkhCiAqLwpEZXZpY2UucHJvdG90eXBlLmV4aXRBcHAgPSBmdW5jdGlvbigpIHsKCWNvbnNvbGUubG9nKCJEZXZpY2UuZXhpdEFwcCgpIGlzIGRlcHJlY2F0ZWQuICBVc2UgQXBwLmV4aXRBcHAoKS4iKTsKCW5hdmlnYXRvci5hcHAuZXhpdEFwcCgpOwp9OwoKUGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKSB7CiAgICBpZiAodHlwZW9mIG5hdmlnYXRvci5kZXZpY2UgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgbmF2aWdhdG9yLmRldmljZSA9IHdpbmRvdy5kZXZpY2UgPSBuZXcgRGV2aWNlKCk7CiAgICB9Cn0pOwp9Ci8qCiAqIFBob25lR2FwIGlzIGF2YWlsYWJsZSB1bmRlciAqZWl0aGVyKiB0aGUgdGVybXMgb2YgdGhlIG1vZGlmaWVkIEJTRCBsaWNlbnNlICpvciogdGhlCiAqIE1JVCBMaWNlbnNlICgyMDA4KS4gU2VlIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9hbHBoYWJldGljYWwgZm9yIGZ1bGwgdGV4dC4KICoKICogQ29weXJpZ2h0IChjKSAyMDA1LTIwMTAsIE5pdG9iaSBTb2Z0d2FyZSBJbmMuCiAqIENvcHlyaWdodCAoYykgMjAxMC0yMDExLCBJQk0gQ29ycG9yYXRpb24KICovCgppZiAoIVBob25lR2FwLmhhc1Jlc291cmNlKCJmaWxlIikpIHsKUGhvbmVHYXAuYWRkUmVzb3VyY2UoImZpbGUiKTsKCi8qKgogKiBUaGlzIGNsYXNzIHByb3ZpZGVzIHNvbWUgdXNlZnVsIGluZm9ybWF0aW9uIGFib3V0IGEgZmlsZS4KICogVGhpcyBpcyB0aGUgZmllbGRzIHJldHVybmVkIHdoZW4gbmF2aWdhdG9yLmZpbGVNZ3IuZ2V0RmlsZVByb3BlcnRpZXMoKQogKiBpcyBjYWxsZWQuCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIEZpbGVQcm9wZXJ0aWVzID0gZnVuY3Rpb24oZmlsZVBhdGgpIHsKICAgIHRoaXMuZmlsZVBhdGggPSBmaWxlUGF0aDsKICAgIHRoaXMuc2l6ZSA9IDA7CiAgICB0aGlzLmxhc3RNb2RpZmllZERhdGUgPSBudWxsOwp9OwoKLyoqCiAqIFJlcHJlc2VudHMgYSBzaW5nbGUgZmlsZS4KICoKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSBuYW1lIHtET01TdHJpbmd9IG5hbWUgb2YgdGhlIGZpbGUsIHdpdGhvdXQgcGF0aCBpbmZvcm1hdGlvbgogKiBAcGFyYW0gZnVsbFBhdGgge0RPTVN0cmluZ30gdGhlIGZ1bGwgcGF0aCBvZiB0aGUgZmlsZSwgaW5jbHVkaW5nIHRoZSBuYW1lCiAqIEBwYXJhbSB0eXBlIHtET01TdHJpbmd9IG1pbWUgdHlwZQogKiBAcGFyYW0gbGFzdE1vZGlmaWVkRGF0ZSB7RGF0ZX0gbGFzdCBtb2RpZmllZCBkYXRlCiAqIEBwYXJhbSBzaXplIHtOdW1iZXJ9IHNpemUgb2YgdGhlIGZpbGUgaW4gYnl0ZXMKICovCnZhciBGaWxlID0gZnVuY3Rpb24obmFtZSwgZnVsbFBhdGgsIHR5cGUsIGxhc3RNb2RpZmllZERhdGUsIHNpemUpIHsKCXRoaXMubmFtZSA9IG5hbWUgfHwgbnVsbDsKICAgIHRoaXMuZnVsbFBhdGggPSBmdWxsUGF0aCB8fCBudWxsOwoJdGhpcy50eXBlID0gdHlwZSB8fCBudWxsOwogICAgdGhpcy5sYXN0TW9kaWZpZWREYXRlID0gbGFzdE1vZGlmaWVkRGF0ZSB8fCBudWxsOwogICAgdGhpcy5zaXplID0gc2l6ZSB8fCAwOwp9OwoKLyoqIEBjb25zdHJ1Y3RvciAqLwp2YXIgRmlsZUVycm9yID0gZnVuY3Rpb24oKSB7CiAgIHRoaXMuY29kZSA9IG51bGw7Cn07CgovLyBGaWxlIGVycm9yIGNvZGVzCi8vIEZvdW5kIGluIERPTUV4Y2VwdGlvbgpGaWxlRXJyb3IuTk9UX0ZPVU5EX0VSUiA9IDE7CkZpbGVFcnJvci5TRUNVUklUWV9FUlIgPSAyOwpGaWxlRXJyb3IuQUJPUlRfRVJSID0gMzsKCi8vIEFkZGVkIGJ5IHRoaXMgc3BlY2lmaWNhdGlvbgpGaWxlRXJyb3IuTk9UX1JFQURBQkxFX0VSUiA9IDQ7CkZpbGVFcnJvci5FTkNPRElOR19FUlIgPSA1OwpGaWxlRXJyb3IuTk9fTU9ESUZJQ0FUSU9OX0FMTE9XRURfRVJSID0gNjsKRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSID0gNzsKRmlsZUVycm9yLlNZTlRBWF9FUlIgPSA4OwpGaWxlRXJyb3IuSU5WQUxJRF9NT0RJRklDQVRJT05fRVJSID0gOTsKRmlsZUVycm9yLlFVT1RBX0VYQ0VFREVEX0VSUiA9IDEwOwpGaWxlRXJyb3IuVFlQRV9NSVNNQVRDSF9FUlIgPSAxMTsKRmlsZUVycm9yLlBBVEhfRVhJU1RTX0VSUiA9IDEyOwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBGaWxlIG1hbmFnZXIKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLyoqIEBjb25zdHJ1Y3RvciAqLwp2YXIgRmlsZU1nciA9IGZ1bmN0aW9uKCkgewp9OwoKRmlsZU1nci5wcm90b3R5cGUuZ2V0RmlsZVByb3BlcnRpZXMgPSBmdW5jdGlvbihmaWxlUGF0aCkgewogICAgcmV0dXJuIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIkZpbGUiLCAiZ2V0RmlsZVByb3BlcnRpZXMiLCBbZmlsZVBhdGhdKTsKfTsKCkZpbGVNZ3IucHJvdG90eXBlLmdldEZpbGVCYXNlUGF0aHMgPSBmdW5jdGlvbigpIHsKfTsKCkZpbGVNZ3IucHJvdG90eXBlLnRlc3RTYXZlTG9jYXRpb25FeGlzdHMgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIHJldHVybiBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAidGVzdFNhdmVMb2NhdGlvbkV4aXN0cyIsIFtdKTsKfTsKCkZpbGVNZ3IucHJvdG90eXBlLnRlc3RGaWxlRXhpc3RzID0gZnVuY3Rpb24oZmlsZU5hbWUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgcmV0dXJuIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJ0ZXN0RmlsZUV4aXN0cyIsIFtmaWxlTmFtZV0pOwp9OwoKRmlsZU1nci5wcm90b3R5cGUudGVzdERpcmVjdG9yeUV4aXN0cyA9IGZ1bmN0aW9uKGRpck5hbWUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgcmV0dXJuIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJ0ZXN0RGlyZWN0b3J5RXhpc3RzIiwgW2Rpck5hbWVdKTsKfTsKCkZpbGVNZ3IucHJvdG90eXBlLmdldEZyZWVEaXNrU3BhY2UgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIHJldHVybiBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAiZ2V0RnJlZURpc2tTcGFjZSIsIFtdKTsKfTsKCkZpbGVNZ3IucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oZmlsZU5hbWUsIGRhdGEsIHBvc2l0aW9uLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJ3cml0ZSIsIFtmaWxlTmFtZSwgZGF0YSwgcG9zaXRpb25dKTsKfTsKCkZpbGVNZ3IucHJvdG90eXBlLnRydW5jYXRlID0gZnVuY3Rpb24oZmlsZU5hbWUsIHNpemUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgInRydW5jYXRlIiwgW2ZpbGVOYW1lLCBzaXplXSk7Cn07CgpGaWxlTWdyLnByb3RvdHlwZS5yZWFkQXNUZXh0ID0gZnVuY3Rpb24oZmlsZU5hbWUsIGVuY29kaW5nLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJyZWFkQXNUZXh0IiwgW2ZpbGVOYW1lLCBlbmNvZGluZ10pOwp9OwoKRmlsZU1nci5wcm90b3R5cGUucmVhZEFzRGF0YVVSTCA9IGZ1bmN0aW9uKGZpbGVOYW1lLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJyZWFkQXNEYXRhVVJMIiwgW2ZpbGVOYW1lXSk7Cn07CgpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpIHsKICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yLmZpbGVNZ3IgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgbmF2aWdhdG9yLmZpbGVNZ3IgPSBuZXcgRmlsZU1ncigpOwogICAgfQp9KTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gRmlsZSBSZWFkZXIKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBUT0RPOiBBbGwgb3RoZXIgRmlsZU1nciBmdW5jdGlvbiBvcGVyYXRlIG9uIHRoZSBTRCBjYXJkIGFzIHJvb3QuICBIb3dldmVyLAovLyAgICAgICBmb3IgRmlsZVJlYWRlciAmIEZpbGVXcml0ZXIgdGhlIHJvb3QgaXMgbm90IFNEIGNhcmQuICBTaG91bGQgdGhpcyBiZSBjaGFuZ2VkPwoKLyoqCiAqIFRoaXMgY2xhc3MgcmVhZHMgdGhlIG1vYmlsZSBkZXZpY2UgZmlsZSBzeXN0ZW0uCiAqCiAqIEZvciBBbmRyb2lkOgogKiAgICAgIFRoZSByb290IGRpcmVjdG9yeSBpcyB0aGUgcm9vdCBvZiB0aGUgZmlsZSBzeXN0ZW0uCiAqICAgICAgVG8gcmVhZCBmcm9tIHRoZSBTRCBjYXJkLCB0aGUgZmlsZSBuYW1lIGlzICJzZGNhcmQvbXlfZmlsZS50eHQiCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIEZpbGVSZWFkZXIgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuZmlsZU5hbWUgPSAiIjsKCiAgICB0aGlzLnJlYWR5U3RhdGUgPSAwOwoKICAgIC8vIEZpbGUgZGF0YQogICAgdGhpcy5yZXN1bHQgPSBudWxsOwoKICAgIC8vIEVycm9yCiAgICB0aGlzLmVycm9yID0gbnVsbDsKCiAgICAvLyBFdmVudCBoYW5kbGVycwogICAgdGhpcy5vbmxvYWRzdGFydCA9IG51bGw7ICAgIC8vIFdoZW4gdGhlIHJlYWQgc3RhcnRzLgogICAgdGhpcy5vbnByb2dyZXNzID0gbnVsbDsgICAgIC8vIFdoaWxlIHJlYWRpbmcgKGFuZCBkZWNvZGluZykgZmlsZSBvciBmaWxlQmxvYiBkYXRhLCBhbmQgcmVwb3J0aW5nIHBhcnRpYWwgZmlsZSBkYXRhIChwcm9nZXNzLmxvYWRlZC9wcm9ncmVzcy50b3RhbCkKICAgIHRoaXMub25sb2FkID0gbnVsbDsgICAgICAgICAvLyBXaGVuIHRoZSByZWFkIGhhcyBzdWNjZXNzZnVsbHkgY29tcGxldGVkLgogICAgdGhpcy5vbmVycm9yID0gbnVsbDsgICAgICAgIC8vIFdoZW4gdGhlIHJlYWQgaGFzIGZhaWxlZCAoc2VlIGVycm9ycykuCiAgICB0aGlzLm9ubG9hZGVuZCA9IG51bGw7ICAgICAgLy8gV2hlbiB0aGUgcmVxdWVzdCBoYXMgY29tcGxldGVkIChlaXRoZXIgaW4gc3VjY2VzcyBvciBmYWlsdXJlKS4KICAgIHRoaXMub25hYm9ydCA9IG51bGw7ICAgICAgICAvLyBXaGVuIHRoZSByZWFkIGhhcyBiZWVuIGFib3J0ZWQuIEZvciBpbnN0YW5jZSwgYnkgaW52b2tpbmcgdGhlIGFib3J0KCkgbWV0aG9kLgp9OwoKLy8gU3RhdGVzCkZpbGVSZWFkZXIuRU1QVFkgPSAwOwpGaWxlUmVhZGVyLkxPQURJTkcgPSAxOwpGaWxlUmVhZGVyLkRPTkUgPSAyOwoKLyoqCiAqIEFib3J0IHJlYWRpbmcgZmlsZS4KICovCkZpbGVSZWFkZXIucHJvdG90eXBlLmFib3J0ID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZXZ0OwogICAgdGhpcy5yZWFkeVN0YXRlID0gRmlsZVJlYWRlci5ET05FOwogICAgdGhpcy5yZXN1bHQgPSBudWxsOwoKICAgIC8vIHNldCBlcnJvcgogICAgdmFyIGVycm9yID0gbmV3IEZpbGVFcnJvcigpOwogICAgZXJyb3IuY29kZSA9IGVycm9yLkFCT1JUX0VSUjsKICAgIHRoaXMuZXJyb3IgPSBlcnJvcjsKCiAgICAvLyBJZiBlcnJvciBjYWxsYmFjawogICAgaWYgKHR5cGVvZiB0aGlzLm9uZXJyb3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB0aGlzLm9uZXJyb3IoeyJ0eXBlIjoiZXJyb3IiLCAidGFyZ2V0Ijp0aGlzfSk7CiAgICB9CiAgICAvLyBJZiBhYm9ydCBjYWxsYmFjawogICAgaWYgKHR5cGVvZiB0aGlzLm9uYWJvcnQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB0aGlzLm9uYWJvcnQoeyJ0eXBlIjoiYWJvcnQiLCAidGFyZ2V0Ijp0aGlzfSk7CiAgICB9CiAgICAvLyBJZiBsb2FkIGVuZCBjYWxsYmFjawogICAgaWYgKHR5cGVvZiB0aGlzLm9ubG9hZGVuZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIHRoaXMub25sb2FkZW5kKHsidHlwZSI6ImxvYWRlbmQiLCAidGFyZ2V0Ijp0aGlzfSk7CiAgICB9Cn07CgovKioKICogUmVhZCB0ZXh0IGZpbGUuCiAqCiAqIEBwYXJhbSBmaWxlICAgICAgICAgIHtGaWxlfSBGaWxlIG9iamVjdCBjb250YWluaW5nIGZpbGUgcHJvcGVydGllcwogKiBAcGFyYW0gZW5jb2RpbmcgICAgICBbT3B0aW9uYWxdIChzZWUgaHR0cDovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy9jaGFyYWN0ZXItc2V0cykKICovCkZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc1RleHQgPSBmdW5jdGlvbihmaWxlLCBlbmNvZGluZykgewogICAgdGhpcy5maWxlTmFtZSA9ICIiOwoJaWYgKHR5cGVvZiBmaWxlLmZ1bGxQYXRoID09PSAidW5kZWZpbmVkIikgewoJCXRoaXMuZmlsZU5hbWUgPSBmaWxlOwoJfSBlbHNlIHsKCQl0aGlzLmZpbGVOYW1lID0gZmlsZS5mdWxsUGF0aDsKCX0KCiAgICAvLyBMT0FESU5HIHN0YXRlCiAgICB0aGlzLnJlYWR5U3RhdGUgPSBGaWxlUmVhZGVyLkxPQURJTkc7CgogICAgLy8gSWYgbG9hZHN0YXJ0IGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIHRoaXMub25sb2Fkc3RhcnQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB0aGlzLm9ubG9hZHN0YXJ0KHsidHlwZSI6ImxvYWRzdGFydCIsICJ0YXJnZXQiOnRoaXN9KTsKICAgIH0KCiAgICAvLyBEZWZhdWx0IGVuY29kaW5nIGlzIFVURi04CiAgICB2YXIgZW5jID0gZW5jb2RpbmcgPyBlbmNvZGluZyA6ICJVVEYtOCI7CgogICAgdmFyIG1lID0gdGhpczsKCiAgICAvLyBSZWFkIGZpbGUKICAgIG5hdmlnYXRvci5maWxlTWdyLnJlYWRBc1RleHQodGhpcy5maWxlTmFtZSwgZW5jLAoKICAgICAgICAvLyBTdWNjZXNzIGNhbGxiYWNrCiAgICAgICAgZnVuY3Rpb24ocikgewogICAgICAgICAgICB2YXIgZXZ0OwoKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVJlYWRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNhdmUgcmVzdWx0CiAgICAgICAgICAgIG1lLnJlc3VsdCA9IHI7CgogICAgICAgICAgICAvLyBJZiBvbmxvYWQgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbmxvYWQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9ubG9hZCh7InR5cGUiOiJsb2FkIiwgInRhcmdldCI6bWV9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVJlYWRlci5ET05FOwoKICAgICAgICAgICAgLy8gSWYgb25sb2FkZW5kIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25sb2FkZW5kID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBtZS5vbmxvYWRlbmQoeyJ0eXBlIjoibG9hZGVuZCIsICJ0YXJnZXQiOm1lfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvLyBFcnJvciBjYWxsYmFjawogICAgICAgIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIGV2dDsKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVJlYWRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNhdmUgZXJyb3IKCQkgICAgbWUuZXJyb3IgPSBlOwoKICAgICAgICAgICAgLy8gSWYgb25lcnJvciBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9uZXJyb3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9uZXJyb3IoeyJ0eXBlIjoiZXJyb3IiLCAidGFyZ2V0IjptZX0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBET05FIHN0YXRlCiAgICAgICAgICAgIG1lLnJlYWR5U3RhdGUgPSBGaWxlUmVhZGVyLkRPTkU7CgogICAgICAgICAgICAvLyBJZiBvbmxvYWRlbmQgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbmxvYWRlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9ubG9hZGVuZCh7InR5cGUiOiJsb2FkZW5kIiwgInRhcmdldCI6bWV9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICApOwp9OwoKCi8qKgogKiBSZWFkIGZpbGUgYW5kIHJldHVybiBkYXRhIGFzIGEgYmFzZTY0IGVuY29kZWQgZGF0YSB1cmwuCiAqIEEgZGF0YSB1cmwgaXMgb2YgdGhlIGZvcm06CiAqICAgICAgZGF0YTpbPG1lZGlhdHlwZT5dWztiYXNlNjRdLDxkYXRhPgogKgogKiBAcGFyYW0gZmlsZSAgICAgICAgICB7RmlsZX0gRmlsZSBvYmplY3QgY29udGFpbmluZyBmaWxlIHByb3BlcnRpZXMKICovCkZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc0RhdGFVUkwgPSBmdW5jdGlvbihmaWxlKSB7Cgl0aGlzLmZpbGVOYW1lID0gIiI7CiAgICBpZiAodHlwZW9mIGZpbGUuZnVsbFBhdGggPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgdGhpcy5maWxlTmFtZSA9IGZpbGU7CiAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmlsZU5hbWUgPSBmaWxlLmZ1bGxQYXRoOwogICAgfQoKICAgIC8vIExPQURJTkcgc3RhdGUKICAgIHRoaXMucmVhZHlTdGF0ZSA9IEZpbGVSZWFkZXIuTE9BRElORzsKCiAgICAvLyBJZiBsb2Fkc3RhcnQgY2FsbGJhY2sKICAgIGlmICh0eXBlb2YgdGhpcy5vbmxvYWRzdGFydCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIHRoaXMub25sb2Fkc3RhcnQoeyJ0eXBlIjoibG9hZHN0YXJ0IiwgInRhcmdldCI6dGhpc30pOwogICAgfQoKICAgIHZhciBtZSA9IHRoaXM7CgogICAgLy8gUmVhZCBmaWxlCiAgICBuYXZpZ2F0b3IuZmlsZU1nci5yZWFkQXNEYXRhVVJMKHRoaXMuZmlsZU5hbWUsCgogICAgICAgIC8vIFN1Y2Nlc3MgY2FsbGJhY2sKICAgICAgICBmdW5jdGlvbihyKSB7CiAgICAgICAgICAgIHZhciBldnQ7CgogICAgICAgICAgICAvLyBJZiBET05FIChjYW5jZWxsZWQpLCB0aGVuIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgICAgIGlmIChtZS5yZWFkeVN0YXRlID09PSBGaWxlUmVhZGVyLkRPTkUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2F2ZSByZXN1bHQKICAgICAgICAgICAgbWUucmVzdWx0ID0gcjsKCiAgICAgICAgICAgIC8vIElmIG9ubG9hZCBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ubG9hZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub25sb2FkKHsidHlwZSI6ImxvYWQiLCAidGFyZ2V0IjptZX0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBET05FIHN0YXRlCiAgICAgICAgICAgIG1lLnJlYWR5U3RhdGUgPSBGaWxlUmVhZGVyLkRPTkU7CgogICAgICAgICAgICAvLyBJZiBvbmxvYWRlbmQgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbmxvYWRlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9ubG9hZGVuZCh7InR5cGUiOiJsb2FkZW5kIiwgInRhcmdldCI6bWV9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8vIEVycm9yIGNhbGxiYWNrCiAgICAgICAgZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgZXZ0OwogICAgICAgICAgICAvLyBJZiBET05FIChjYW5jZWxsZWQpLCB0aGVuIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgICAgIGlmIChtZS5yZWFkeVN0YXRlID09PSBGaWxlUmVhZGVyLkRPTkUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2F2ZSBlcnJvcgogICAgICAgICAgICBtZS5lcnJvciA9IGU7CgogICAgICAgICAgICAvLyBJZiBvbmVycm9yIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25lcnJvciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub25lcnJvcih7InR5cGUiOiJlcnJvciIsICJ0YXJnZXQiOm1lfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERPTkUgc3RhdGUKICAgICAgICAgICAgbWUucmVhZHlTdGF0ZSA9IEZpbGVSZWFkZXIuRE9ORTsKCiAgICAgICAgICAgIC8vIElmIG9ubG9hZGVuZCBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ubG9hZGVuZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub25sb2FkZW5kKHsidHlwZSI6ImxvYWRlbmQiLCAidGFyZ2V0IjptZX0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICk7Cn07CgovKioKICogUmVhZCBmaWxlIGFuZCByZXR1cm4gZGF0YSBhcyBhIGJpbmFyeSBkYXRhLgogKgogKiBAcGFyYW0gZmlsZSAgICAgICAgICB7RmlsZX0gRmlsZSBvYmplY3QgY29udGFpbmluZyBmaWxlIHByb3BlcnRpZXMKICovCkZpbGVSZWFkZXIucHJvdG90eXBlLnJlYWRBc0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uKGZpbGUpIHsKICAgIC8vIFRPRE8gLSBDYW4ndCByZXR1cm4gYmluYXJ5IGRhdGEgdG8gYnJvd3Nlci4KICAgIHRoaXMuZmlsZU5hbWUgPSBmaWxlOwp9OwoKLyoqCiAqIFJlYWQgZmlsZSBhbmQgcmV0dXJuIGRhdGEgYXMgYSBiaW5hcnkgZGF0YS4KICoKICogQHBhcmFtIGZpbGUgICAgICAgICAge0ZpbGV9IEZpbGUgb2JqZWN0IGNvbnRhaW5pbmcgZmlsZSBwcm9wZXJ0aWVzCiAqLwpGaWxlUmVhZGVyLnByb3RvdHlwZS5yZWFkQXNBcnJheUJ1ZmZlciA9IGZ1bmN0aW9uKGZpbGUpIHsKICAgIC8vIFRPRE8gLSBDYW4ndCByZXR1cm4gYmluYXJ5IGRhdGEgdG8gYnJvd3Nlci4KICAgIHRoaXMuZmlsZU5hbWUgPSBmaWxlOwp9OwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBGaWxlIFdyaXRlcgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovKioKICogVGhpcyBjbGFzcyB3cml0ZXMgdG8gdGhlIG1vYmlsZSBkZXZpY2UgZmlsZSBzeXN0ZW0uCiAqCiAqIEZvciBBbmRyb2lkOgogKiAgICAgIFRoZSByb290IGRpcmVjdG9yeSBpcyB0aGUgcm9vdCBvZiB0aGUgZmlsZSBzeXN0ZW0uCiAqICAgICAgVG8gd3JpdGUgdG8gdGhlIFNEIGNhcmQsIHRoZSBmaWxlIG5hbWUgaXMgInNkY2FyZC9teV9maWxlLnR4dCIKICoKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSBmaWxlIHtGaWxlfSBGaWxlIG9iamVjdCBjb250YWluaW5nIGZpbGUgcHJvcGVydGllcwogKiBAcGFyYW0gYXBwZW5kIGlmIHRydWUgd3JpdGUgdG8gdGhlIGVuZCBvZiB0aGUgZmlsZSwgb3RoZXJ3aXNlIG92ZXJ3cml0ZSB0aGUgZmlsZQogKi8KdmFyIEZpbGVXcml0ZXIgPSBmdW5jdGlvbihmaWxlKSB7CiAgICB0aGlzLmZpbGVOYW1lID0gIiI7CiAgICB0aGlzLmxlbmd0aCA9IDA7CglpZiAoZmlsZSkgewoJICAgIHRoaXMuZmlsZU5hbWUgPSBmaWxlLmZ1bGxQYXRoIHx8IGZpbGU7CgkgICAgdGhpcy5sZW5ndGggPSBmaWxlLnNpemUgfHwgMDsKCX0KICAgIC8vIGRlZmF1bHQgaXMgdG8gd3JpdGUgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgZmlsZQogICAgdGhpcy5wb3NpdGlvbiA9IDA7CgogICAgdGhpcy5yZWFkeVN0YXRlID0gMDsgLy8gRU1QVFkKCiAgICB0aGlzLnJlc3VsdCA9IG51bGw7CgogICAgLy8gRXJyb3IKICAgIHRoaXMuZXJyb3IgPSBudWxsOwoKICAgIC8vIEV2ZW50IGhhbmRsZXJzCiAgICB0aGlzLm9ud3JpdGVzdGFydCA9IG51bGw7CS8vIFdoZW4gd3JpdGluZyBzdGFydHMKICAgIHRoaXMub25wcm9ncmVzcyA9IG51bGw7CQkvLyBXaGlsZSB3cml0aW5nIHRoZSBmaWxlLCBhbmQgcmVwb3J0aW5nIHBhcnRpYWwgZmlsZSBkYXRhCiAgICB0aGlzLm9ud3JpdGUgPSBudWxsOwkJLy8gV2hlbiB0aGUgd3JpdGUgaGFzIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWQuCiAgICB0aGlzLm9ud3JpdGVlbmQgPSBudWxsOwkJLy8gV2hlbiB0aGUgcmVxdWVzdCBoYXMgY29tcGxldGVkIChlaXRoZXIgaW4gc3VjY2VzcyBvciBmYWlsdXJlKS4KICAgIHRoaXMub25hYm9ydCA9IG51bGw7CQkvLyBXaGVuIHRoZSB3cml0ZSBoYXMgYmVlbiBhYm9ydGVkLiBGb3IgaW5zdGFuY2UsIGJ5IGludm9raW5nIHRoZSBhYm9ydCgpIG1ldGhvZC4KICAgIHRoaXMub25lcnJvciA9IG51bGw7CQkvLyBXaGVuIHRoZSB3cml0ZSBoYXMgZmFpbGVkIChzZWUgZXJyb3JzKS4KfTsKCi8vIFN0YXRlcwpGaWxlV3JpdGVyLklOSVQgPSAwOwpGaWxlV3JpdGVyLldSSVRJTkcgPSAxOwpGaWxlV3JpdGVyLkRPTkUgPSAyOwoKLyoqCiAqIEFib3J0IHdyaXRpbmcgZmlsZS4KICovCkZpbGVXcml0ZXIucHJvdG90eXBlLmFib3J0ID0gZnVuY3Rpb24oKSB7CiAgICAvLyBjaGVjayBmb3IgaW52YWxpZCBzdGF0ZQoJaWYgKHRoaXMucmVhZHlTdGF0ZSA9PT0gRmlsZVdyaXRlci5ET05FIHx8IHRoaXMucmVhZHlTdGF0ZSA9PT0gRmlsZVdyaXRlci5JTklUKSB7CgkJdGhyb3cgRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSOwoJfQoKICAgIC8vIHNldCBlcnJvcgogICAgdmFyIGVycm9yID0gbmV3IEZpbGVFcnJvcigpLCBldnQ7CiAgICBlcnJvci5jb2RlID0gZXJyb3IuQUJPUlRfRVJSOwogICAgdGhpcy5lcnJvciA9IGVycm9yOwoKICAgIC8vIElmIGVycm9yIGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIHRoaXMub25lcnJvciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIHRoaXMub25lcnJvcih7InR5cGUiOiJlcnJvciIsICJ0YXJnZXQiOnRoaXN9KTsKICAgIH0KICAgIC8vIElmIGFib3J0IGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIHRoaXMub25hYm9ydCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIHRoaXMub25hYm9ydCh7InR5cGUiOiJhYm9ydCIsICJ0YXJnZXQiOnRoaXN9KTsKICAgIH0KCiAgICB0aGlzLnJlYWR5U3RhdGUgPSBGaWxlV3JpdGVyLkRPTkU7CgogICAgLy8gSWYgd3JpdGUgZW5kIGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIHRoaXMub253cml0ZWVuZCA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgdGhpcy5vbndyaXRlZW5kKHsidHlwZSI6IndyaXRlZW5kIiwgInRhcmdldCI6dGhpc30pOwogICAgfQp9OwoKLyoqCiAqIFdyaXRlcyBkYXRhIHRvIHRoZSBmaWxlCiAqCiAqIEBwYXJhbSB0ZXh0IHRvIGJlIHdyaXR0ZW4KICovCkZpbGVXcml0ZXIucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24odGV4dCkgewoJLy8gVGhyb3cgYW4gZXhjZXB0aW9uIGlmIHdlIGFyZSBhbHJlYWR5IHdyaXRpbmcgYSBmaWxlCglpZiAodGhpcy5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLldSSVRJTkcpIHsKCQl0aHJvdyBGaWxlRXJyb3IuSU5WQUxJRF9TVEFURV9FUlI7Cgl9CgogICAgLy8gV1JJVElORyBzdGF0ZQogICAgdGhpcy5yZWFkeVN0YXRlID0gRmlsZVdyaXRlci5XUklUSU5HOwoKICAgIHZhciBtZSA9IHRoaXM7CgogICAgLy8gSWYgb253cml0ZXN0YXJ0IGNhbGxiYWNrCiAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGVzdGFydCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIG1lLm9ud3JpdGVzdGFydCh7InR5cGUiOiJ3cml0ZXN0YXJ0IiwgInRhcmdldCI6bWV9KTsKICAgIH0KCiAgICAvLyBXcml0ZSBmaWxlCiAgICBuYXZpZ2F0b3IuZmlsZU1nci53cml0ZSh0aGlzLmZpbGVOYW1lLCB0ZXh0LCB0aGlzLnBvc2l0aW9uLAoKICAgICAgICAvLyBTdWNjZXNzIGNhbGxiYWNrCiAgICAgICAgZnVuY3Rpb24ocikgewogICAgICAgICAgICB2YXIgZXZ0OwogICAgICAgICAgICAvLyBJZiBET05FIChjYW5jZWxsZWQpLCB0aGVuIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgICAgIGlmIChtZS5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLkRPTkUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcG9zaXRpb24gYWx3YXlzIGluY3JlYXNlcyBieSBieXRlcyB3cml0dGVuIGJlY2F1c2UgZmlsZSB3b3VsZCBiZSBleHRlbmRlZAogICAgICAgICAgICBtZS5wb3NpdGlvbiArPSByOwogICAgICAgICAgICAvLyBUaGUgbGVuZ3RoIG9mIHRoZSBmaWxlIGlzIG5vdyB3aGVyZSB3ZSBhcmUgZG9uZSB3cml0aW5nLgogICAgICAgICAgICBtZS5sZW5ndGggPSBtZS5wb3NpdGlvbjsKCiAgICAgICAgICAgIC8vIElmIG9ud3JpdGUgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbndyaXRlID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBtZS5vbndyaXRlKHsidHlwZSI6IndyaXRlIiwgInRhcmdldCI6bWV9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRE9ORSBzdGF0ZQogICAgICAgICAgICBtZS5yZWFkeVN0YXRlID0gRmlsZVdyaXRlci5ET05FOwoKICAgICAgICAgICAgLy8gSWYgb253cml0ZWVuZCBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGVlbmQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGVlbmQoeyJ0eXBlIjoid3JpdGVlbmQiLCAidGFyZ2V0IjptZX0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLy8gRXJyb3IgY2FsbGJhY2sKICAgICAgICBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBldnQ7CgogICAgICAgICAgICAvLyBJZiBET05FIChjYW5jZWxsZWQpLCB0aGVuIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgICAgIGlmIChtZS5yZWFkeVN0YXRlID09PSBGaWxlV3JpdGVyLkRPTkUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2F2ZSBlcnJvcgogICAgICAgICAgICBtZS5lcnJvciA9IGU7CgogICAgICAgICAgICAvLyBJZiBvbmVycm9yIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub25lcnJvciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub25lcnJvcih7InR5cGUiOiJlcnJvciIsICJ0YXJnZXQiOm1lfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERPTkUgc3RhdGUKICAgICAgICAgICAgbWUucmVhZHlTdGF0ZSA9IEZpbGVXcml0ZXIuRE9ORTsKCiAgICAgICAgICAgIC8vIElmIG9ud3JpdGVlbmQgY2FsbGJhY2sKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5vbndyaXRlZW5kID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBtZS5vbndyaXRlZW5kKHsidHlwZSI6IndyaXRlZW5kIiwgInRhcmdldCI6bWV9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICApOwoKfTsKCi8qKgogKiBNb3ZlcyB0aGUgZmlsZSBwb2ludGVyIHRvIHRoZSBsb2NhdGlvbiBzcGVjaWZpZWQuCiAqCiAqIElmIHRoZSBvZmZzZXQgaXMgYSBuZWdhdGl2ZSBudW1iZXIgdGhlIHBvc2l0aW9uIG9mIHRoZSBmaWxlCiAqIHBvaW50ZXIgaXMgcmV3b3VuZC4gIElmIHRoZSBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIHRoZSBmaWxlCiAqIHNpemUgdGhlIHBvc2l0aW9uIGlzIHNldCB0byB0aGUgZW5kIG9mIHRoZSBmaWxlLgogKgogKiBAcGFyYW0gb2Zmc2V0IGlzIHRoZSBsb2NhdGlvbiB0byBtb3ZlIHRoZSBmaWxlIHBvaW50ZXIgdG8uCiAqLwpGaWxlV3JpdGVyLnByb3RvdHlwZS5zZWVrID0gZnVuY3Rpb24ob2Zmc2V0KSB7CiAgICAvLyBUaHJvdyBhbiBleGNlcHRpb24gaWYgd2UgYXJlIGFscmVhZHkgd3JpdGluZyBhIGZpbGUKICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT09IEZpbGVXcml0ZXIuV1JJVElORykgewogICAgICAgIHRocm93IEZpbGVFcnJvci5JTlZBTElEX1NUQVRFX0VSUjsKICAgIH0KCiAgICBpZiAoIW9mZnNldCkgewogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBTZWUgYmFjayBmcm9tIGVuZCBvZiBmaWxlLgogICAgaWYgKG9mZnNldCA8IDApIHsKCQl0aGlzLnBvc2l0aW9uID0gTWF0aC5tYXgob2Zmc2V0ICsgdGhpcy5sZW5ndGgsIDApOwoJfQogICAgLy8gT2Zmc2V0IGlzIGJpZ2dlciB0aGVuIGZpbGUgc2l6ZSBzbyBzZXQgcG9zaXRpb24KICAgIC8vIHRvIHRoZSBlbmQgb2YgdGhlIGZpbGUuCgllbHNlIGlmIChvZmZzZXQgPiB0aGlzLmxlbmd0aCkgewoJCXRoaXMucG9zaXRpb24gPSB0aGlzLmxlbmd0aDsKCX0KICAgIC8vIE9mZnNldCBpcyBiZXR3ZWVuIDAgYW5kIGZpbGUgc2l6ZSBzbyBzZXQgdGhlIHBvc2l0aW9uCiAgICAvLyB0byBzdGFydCB3cml0aW5nLgoJZWxzZSB7CgkJdGhpcy5wb3NpdGlvbiA9IG9mZnNldDsKCX0KfTsKCi8qKgogKiBUcnVuY2F0ZXMgdGhlIGZpbGUgdG8gdGhlIHNpemUgc3BlY2lmaWVkLgogKgogKiBAcGFyYW0gc2l6ZSB0byBjaG9wIHRoZSBmaWxlIGF0LgogKi8KRmlsZVdyaXRlci5wcm90b3R5cGUudHJ1bmNhdGUgPSBmdW5jdGlvbihzaXplKSB7CgkvLyBUaHJvdyBhbiBleGNlcHRpb24gaWYgd2UgYXJlIGFscmVhZHkgd3JpdGluZyBhIGZpbGUKCWlmICh0aGlzLnJlYWR5U3RhdGUgPT09IEZpbGVXcml0ZXIuV1JJVElORykgewoJCXRocm93IEZpbGVFcnJvci5JTlZBTElEX1NUQVRFX0VSUjsKCX0KCiAgICAvLyBXUklUSU5HIHN0YXRlCiAgICB0aGlzLnJlYWR5U3RhdGUgPSBGaWxlV3JpdGVyLldSSVRJTkc7CgogICAgdmFyIG1lID0gdGhpczsKCiAgICAvLyBJZiBvbndyaXRlc3RhcnQgY2FsbGJhY2sKICAgIGlmICh0eXBlb2YgbWUub253cml0ZXN0YXJ0ID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgbWUub253cml0ZXN0YXJ0KHsidHlwZSI6IndyaXRlc3RhcnQiLCAidGFyZ2V0Ijp0aGlzfSk7CiAgICB9CgogICAgLy8gV3JpdGUgZmlsZQogICAgbmF2aWdhdG9yLmZpbGVNZ3IudHJ1bmNhdGUodGhpcy5maWxlTmFtZSwgc2l6ZSwKCiAgICAgICAgLy8gU3VjY2VzcyBjYWxsYmFjawogICAgICAgIGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgdmFyIGV2dDsKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVdyaXRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbGVuZ3RoIG9mIHRoZSBmaWxlCiAgICAgICAgICAgIG1lLmxlbmd0aCA9IHI7CiAgICAgICAgICAgIG1lLnBvc2l0aW9uID0gTWF0aC5taW4obWUucG9zaXRpb24sIHIpOwoKICAgICAgICAgICAgLy8gSWYgb253cml0ZSBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9ud3JpdGUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9ud3JpdGUoeyJ0eXBlIjoid3JpdGUiLCAidGFyZ2V0IjptZX0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBET05FIHN0YXRlCiAgICAgICAgICAgIG1lLnJlYWR5U3RhdGUgPSBGaWxlV3JpdGVyLkRPTkU7CgogICAgICAgICAgICAvLyBJZiBvbndyaXRlZW5kIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub253cml0ZWVuZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub253cml0ZWVuZCh7InR5cGUiOiJ3cml0ZWVuZCIsICJ0YXJnZXQiOm1lfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvLyBFcnJvciBjYWxsYmFjawogICAgICAgIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIGV2dDsKICAgICAgICAgICAgLy8gSWYgRE9ORSAoY2FuY2VsbGVkKSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICBpZiAobWUucmVhZHlTdGF0ZSA9PT0gRmlsZVdyaXRlci5ET05FKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNhdmUgZXJyb3IKICAgICAgICAgICAgbWUuZXJyb3IgPSBlOwoKICAgICAgICAgICAgLy8gSWYgb25lcnJvciBjYWxsYmFjawogICAgICAgICAgICBpZiAodHlwZW9mIG1lLm9uZXJyb3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG1lLm9uZXJyb3IoeyJ0eXBlIjoiZXJyb3IiLCAidGFyZ2V0IjptZX0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBET05FIHN0YXRlCiAgICAgICAgICAgIG1lLnJlYWR5U3RhdGUgPSBGaWxlV3JpdGVyLkRPTkU7CgogICAgICAgICAgICAvLyBJZiBvbndyaXRlZW5kIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICh0eXBlb2YgbWUub253cml0ZWVuZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgbWUub253cml0ZWVuZCh7InR5cGUiOiJ3cml0ZWVuZCIsICJ0YXJnZXQiOm1lfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICApOwp9OwoKLyoqCiAqIEluZm9ybWF0aW9uIGFib3V0IHRoZSBzdGF0ZSBvZiB0aGUgZmlsZSBvciBkaXJlY3RvcnkKICoKICogQGNvbnN0cnVjdG9yCiAqIHtEYXRlfSBtb2RpZmljYXRpb25UaW1lIChyZWFkb25seSkKICovCnZhciBNZXRhZGF0YSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5tb2RpZmljYXRpb25UaW1lPW51bGw7Cn07CgovKioKICogU3VwcGxpZXMgYXJndW1lbnRzIHRvIG1ldGhvZHMgdGhhdCBsb29rdXAgb3IgY3JlYXRlIGZpbGVzIGFuZCBkaXJlY3RvcmllcwogKgogKiBAY29uc3RydWN0b3IKICogQHBhcmFtIHtib29sZWFufSBjcmVhdGUgZmlsZSBvciBkaXJlY3RvcnkgaWYgaXQgZG9lc24ndCBleGlzdAogKiBAcGFyYW0ge2Jvb2xlYW59IGV4Y2x1c2l2ZSBpZiB0cnVlIHRoZSBjb21tYW5kIHdpbGwgZmFpbCBpZiB0aGUgZmlsZSBvciBkaXJlY3RvcnkgZXhpc3RzCiAqLwp2YXIgRmxhZ3MgPSBmdW5jdGlvbihjcmVhdGUsIGV4Y2x1c2l2ZSkgewogICAgdGhpcy5jcmVhdGUgPSBjcmVhdGUgfHwgZmFsc2U7CiAgICB0aGlzLmV4Y2x1c2l2ZSA9IGV4Y2x1c2l2ZSB8fCBmYWxzZTsKfTsKCi8qKgogKiBBbiBpbnRlcmZhY2UgcmVwcmVzZW50aW5nIGEgZmlsZSBzeXN0ZW0KICoKICogQGNvbnN0cnVjdG9yCiAqIHtET01TdHJpbmd9IG5hbWUgdGhlIHVuaXF1ZSBuYW1lIG9mIHRoZSBmaWxlIHN5c3RlbSAocmVhZG9ubHkpCiAqIHtEaXJlY3RvcnlFbnRyeX0gcm9vdCBkaXJlY3Rvcnkgb2YgdGhlIGZpbGUgc3lzdGVtIChyZWFkb25seSkKICovCnZhciBGaWxlU3lzdGVtID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLm5hbWUgPSBudWxsOwogICAgdGhpcy5yb290ID0gbnVsbDsKfTsKCi8qKgogKiBBbiBpbnRlcmZhY2UgdGhhdCBsaXN0cyB0aGUgZmlsZXMgYW5kIGRpcmVjdG9yaWVzIGluIGEgZGlyZWN0b3J5LgogKiBAY29uc3RydWN0b3IKICovCnZhciBEaXJlY3RvcnlSZWFkZXIgPSBmdW5jdGlvbihmdWxsUGF0aCl7CiAgICB0aGlzLmZ1bGxQYXRoID0gZnVsbFBhdGggfHwgbnVsbDsKfTsKCi8qKgogKiBSZXR1cm5zIGEgbGlzdCBvZiBlbnRyaWVzIGZyb20gYSBkaXJlY3RvcnkuCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIGxpc3Qgb2YgZW50cmllcwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpEaXJlY3RvcnlSZWFkZXIucHJvdG90eXBlLnJlYWRFbnRyaWVzID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAicmVhZEVudHJpZXMiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKLyoqCiAqIEFuIGludGVyZmFjZSByZXByZXNlbnRpbmcgYSBkaXJlY3Rvcnkgb24gdGhlIGZpbGUgc3lzdGVtLgogKgogKiBAY29uc3RydWN0b3IKICoge2Jvb2xlYW59IGlzRmlsZSBhbHdheXMgZmFsc2UgKHJlYWRvbmx5KQogKiB7Ym9vbGVhbn0gaXNEaXJlY3RvcnkgYWx3YXlzIHRydWUgKHJlYWRvbmx5KQogKiB7RE9NU3RyaW5nfSBuYW1lIG9mIHRoZSBkaXJlY3RvcnksIGV4Y2x1ZGluZyB0aGUgcGF0aCBsZWFkaW5nIHRvIGl0IChyZWFkb25seSkKICoge0RPTVN0cmluZ30gZnVsbFBhdGggdGhlIGFic29sdXRlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IChyZWFkb25seSkKICoge0ZpbGVTeXN0ZW19IGZpbGVzeXN0ZW0gb24gd2hpY2ggdGhlIGRpcmVjdG9yeSByZXNpZGVzIChyZWFkb25seSkKICovCnZhciBEaXJlY3RvcnlFbnRyeSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5pc0ZpbGUgPSBmYWxzZTsKICAgIHRoaXMuaXNEaXJlY3RvcnkgPSB0cnVlOwogICAgdGhpcy5uYW1lID0gbnVsbDsKICAgIHRoaXMuZnVsbFBhdGggPSBudWxsOwogICAgdGhpcy5maWxlc3lzdGVtID0gbnVsbDsKfTsKCi8qKgogKiBDb3BpZXMgYSBkaXJlY3RvcnkgdG8gYSBuZXcgbG9jYXRpb24KICoKICogQHBhcmFtIHtEaXJlY3RvcnlFbnRyeX0gcGFyZW50IHRoZSBkaXJlY3RvcnkgdG8gd2hpY2ggdG8gY29weSB0aGUgZW50cnkKICogQHBhcmFtIHtET01TdHJpbmd9IG5ld05hbWUgdGhlIG5ldyBuYW1lIG9mIHRoZSBlbnRyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgbmFtZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggdGhlIG5ldyBlbnRyeQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpEaXJlY3RvcnlFbnRyeS5wcm90b3R5cGUuY29weVRvID0gZnVuY3Rpb24ocGFyZW50LCBuZXdOYW1lLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJjb3B5VG8iLCBbdGhpcy5mdWxsUGF0aCwgcGFyZW50LCBuZXdOYW1lXSk7Cn07CgovKioKICogTG9va3MgdXAgdGhlIG1ldGFkYXRhIG9mIHRoZSBlbnRyeQogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBNZXRhZGF0YSBvYmplY3QKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRGlyZWN0b3J5RW50cnkucHJvdG90eXBlLmdldE1ldGFkYXRhID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAiZ2V0TWV0YWRhdGEiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKLyoqCiAqIEdldHMgdGhlIHBhcmVudCBvZiB0aGUgZW50cnkKICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgcGFyZW50IGVudHJ5CiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkRpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS5nZXRQYXJlbnQgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJnZXRQYXJlbnQiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKLyoqCiAqIE1vdmVzIGEgZGlyZWN0b3J5IHRvIGEgbmV3IGxvY2F0aW9uCiAqCiAqIEBwYXJhbSB7RGlyZWN0b3J5RW50cnl9IHBhcmVudCB0aGUgZGlyZWN0b3J5IHRvIHdoaWNoIHRvIG1vdmUgdGhlIGVudHJ5CiAqIEBwYXJhbSB7RE9NU3RyaW5nfSBuZXdOYW1lIHRoZSBuZXcgbmFtZSBvZiB0aGUgZW50cnksIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IG5hbWUKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBuZXcgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRGlyZWN0b3J5RW50cnkucHJvdG90eXBlLm1vdmVUbyA9IGZ1bmN0aW9uKHBhcmVudCwgbmV3TmFtZSwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAibW92ZVRvIiwgW3RoaXMuZnVsbFBhdGgsIHBhcmVudCwgbmV3TmFtZV0pOwp9OwoKLyoqCiAqIFJlbW92ZXMgdGhlIGVudHJ5CiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBubyBwYXJhbWV0ZXJzCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkRpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJyZW1vdmUiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKLyoqCiAqIFJldHVybnMgYSBVUkkgdGhhdCBjYW4gYmUgdXNlZCB0byBpZGVudGlmeSB0aGlzIGVudHJ5LgogKgogKiBAcGFyYW0ge0RPTVN0cmluZ30gbWltZVR5cGUgZm9yIGEgRmlsZUVudHJ5LCB0aGUgbWltZSB0eXBlIHRvIGJlIHVzZWQgdG8gaW50ZXJwcmV0IHRoZSBmaWxlLCB3aGVuIGxvYWRlZCB0aHJvdWdoIHRoaXMgVVJJLgogKiBAcmV0dXJuIHVyaQogKi8KRGlyZWN0b3J5RW50cnkucHJvdG90eXBlLnRvVVJJID0gZnVuY3Rpb24obWltZVR5cGUpIHsKICAgIHJldHVybiAiZmlsZTovLyIgKyB0aGlzLmZ1bGxQYXRoOwp9OwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgRGlyZWN0b3J5UmVhZGVyIHRvIHJlYWQgZW50cmllcyBmcm9tIHRoaXMgZGlyZWN0b3J5CiAqLwpEaXJlY3RvcnlFbnRyeS5wcm90b3R5cGUuY3JlYXRlUmVhZGVyID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICByZXR1cm4gbmV3IERpcmVjdG9yeVJlYWRlcih0aGlzLmZ1bGxQYXRoKTsKfTsKCi8qKgogKiBDcmVhdGVzIG9yIGxvb2tzIHVwIGEgZGlyZWN0b3J5CiAqCiAqIEBwYXJhbSB7RE9NU3RyaW5nfSBwYXRoIGVpdGhlciBhIHJlbGF0aXZlIG9yIGFic29sdXRlIHBhdGggZnJvbSB0aGlzIGRpcmVjdG9yeSBpbiB3aGljaCB0byBsb29rIHVwIG9yIGNyZWF0ZSBhIGRpcmVjdG9yeQogKiBAcGFyYW0ge0ZsYWdzfSBvcHRpb25zIHRvIGNyZWF0ZSBvciBleGNsdWl2ZWx5IGNyZWF0ZSB0aGUgZGlyZWN0b3J5CiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCB0aGUgbmV3IGVudHJ5CiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkRpcmVjdG9yeUVudHJ5LnByb3RvdHlwZS5nZXREaXJlY3RvcnkgPSBmdW5jdGlvbihwYXRoLCBvcHRpb25zLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJnZXREaXJlY3RvcnkiLCBbdGhpcy5mdWxsUGF0aCwgcGF0aCwgb3B0aW9uc10pOwp9OwoKLyoqCiAqIENyZWF0ZXMgb3IgbG9va3MgdXAgYSBmaWxlCiAqCiAqIEBwYXJhbSB7RE9NU3RyaW5nfSBwYXRoIGVpdGhlciBhIHJlbGF0aXZlIG9yIGFic29sdXRlIHBhdGggZnJvbSB0aGlzIGRpcmVjdG9yeSBpbiB3aGljaCB0byBsb29rIHVwIG9yIGNyZWF0ZSBhIGZpbGUKICogQHBhcmFtIHtGbGFnc30gb3B0aW9ucyB0byBjcmVhdGUgb3IgZXhjbHVpdmVseSBjcmVhdGUgdGhlIGZpbGUKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBuZXcgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRGlyZWN0b3J5RW50cnkucHJvdG90eXBlLmdldEZpbGUgPSBmdW5jdGlvbihwYXRoLCBvcHRpb25zLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJnZXRGaWxlIiwgW3RoaXMuZnVsbFBhdGgsIHBhdGgsIG9wdGlvbnNdKTsKfTsKCi8qKgogKiBEZWxldGVzIGEgZGlyZWN0b3J5IGFuZCBhbGwgb2YgaXQncyBjb250ZW50cwogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggbm8gcGFyYW1ldGVycwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpEaXJlY3RvcnlFbnRyeS5wcm90b3R5cGUucmVtb3ZlUmVjdXJzaXZlbHkgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJyZW1vdmVSZWN1cnNpdmVseSIsIFt0aGlzLmZ1bGxQYXRoXSk7Cn07CgovKioKICogQW4gaW50ZXJmYWNlIHJlcHJlc2VudGluZyBhIGRpcmVjdG9yeSBvbiB0aGUgZmlsZSBzeXN0ZW0uCiAqCiAqIEBjb25zdHJ1Y3RvcgogKiB7Ym9vbGVhbn0gaXNGaWxlIGFsd2F5cyB0cnVlIChyZWFkb25seSkKICoge2Jvb2xlYW59IGlzRGlyZWN0b3J5IGFsd2F5cyBmYWxzZSAocmVhZG9ubHkpCiAqIHtET01TdHJpbmd9IG5hbWUgb2YgdGhlIGZpbGUsIGV4Y2x1ZGluZyB0aGUgcGF0aCBsZWFkaW5nIHRvIGl0IChyZWFkb25seSkKICoge0RPTVN0cmluZ30gZnVsbFBhdGggdGhlIGFic29sdXRlIGZ1bGwgcGF0aCB0byB0aGUgZmlsZSAocmVhZG9ubHkpCiAqIHtGaWxlU3lzdGVtfSBmaWxlc3lzdGVtIG9uIHdoaWNoIHRoZSBkaXJlY3RvcnkgcmVzaWRlcyAocmVhZG9ubHkpCiAqLwp2YXIgRmlsZUVudHJ5ID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmlzRmlsZSA9IHRydWU7CiAgICB0aGlzLmlzRGlyZWN0b3J5ID0gZmFsc2U7CiAgICB0aGlzLm5hbWUgPSBudWxsOwogICAgdGhpcy5mdWxsUGF0aCA9IG51bGw7CiAgICB0aGlzLmZpbGVzeXN0ZW0gPSBudWxsOwp9OwoKLyoqCiAqIENvcGllcyBhIGZpbGUgdG8gYSBuZXcgbG9jYXRpb24KICoKICogQHBhcmFtIHtEaXJlY3RvcnlFbnRyeX0gcGFyZW50IHRoZSBkaXJlY3RvcnkgdG8gd2hpY2ggdG8gY29weSB0aGUgZW50cnkKICogQHBhcmFtIHtET01TdHJpbmd9IG5ld05hbWUgdGhlIG5ldyBuYW1lIG9mIHRoZSBlbnRyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgbmFtZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggdGhlIG5ldyBlbnRyeQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpGaWxlRW50cnkucHJvdG90eXBlLmNvcHlUbyA9IGZ1bmN0aW9uKHBhcmVudCwgbmV3TmFtZSwgc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAiY29weVRvIiwgW3RoaXMuZnVsbFBhdGgsIHBhcmVudCwgbmV3TmFtZV0pOwp9OwoKLyoqCiAqIExvb2tzIHVwIHRoZSBtZXRhZGF0YSBvZiB0aGUgZW50cnkKICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgTWV0YWRhdGEgb2JqZWN0CiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkZpbGVFbnRyeS5wcm90b3R5cGUuZ2V0TWV0YWRhdGEgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJnZXRNZXRhZGF0YSIsIFt0aGlzLmZ1bGxQYXRoXSk7Cn07CgovKioKICogR2V0cyB0aGUgcGFyZW50IG9mIHRoZSBlbnRyeQogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBwYXJlbnQgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRmlsZUVudHJ5LnByb3RvdHlwZS5nZXRQYXJlbnQgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJnZXRQYXJlbnQiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKLyoqCiAqIE1vdmVzIGEgZGlyZWN0b3J5IHRvIGEgbmV3IGxvY2F0aW9uCiAqCiAqIEBwYXJhbSB7RGlyZWN0b3J5RW50cnl9IHBhcmVudCB0aGUgZGlyZWN0b3J5IHRvIHdoaWNoIHRvIG1vdmUgdGhlIGVudHJ5CiAqIEBwYXJhbSB7RE9NU3RyaW5nfSBuZXdOYW1lIHRoZSBuZXcgbmFtZSBvZiB0aGUgZW50cnksIGRlZmF1bHRzIHRvIHRoZSBjdXJyZW50IG5hbWUKICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBuZXcgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KRmlsZUVudHJ5LnByb3RvdHlwZS5tb3ZlVG8gPSBmdW5jdGlvbihwYXJlbnQsIG5ld05hbWUsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgIm1vdmVUbyIsIFt0aGlzLmZ1bGxQYXRoLCBwYXJlbnQsIG5ld05hbWVdKTsKfTsKCi8qKgogKiBSZW1vdmVzIHRoZSBlbnRyeQogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggbm8gcGFyYW1ldGVycwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpGaWxlRW50cnkucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssICJGaWxlIiwgInJlbW92ZSIsIFt0aGlzLmZ1bGxQYXRoXSk7Cn07CgovKioKICogUmV0dXJucyBhIFVSSSB0aGF0IGNhbiBiZSB1c2VkIHRvIGlkZW50aWZ5IHRoaXMgZW50cnkuCiAqCiAqIEBwYXJhbSB7RE9NU3RyaW5nfSBtaW1lVHlwZSBmb3IgYSBGaWxlRW50cnksIHRoZSBtaW1lIHR5cGUgdG8gYmUgdXNlZCB0byBpbnRlcnByZXQgdGhlIGZpbGUsIHdoZW4gbG9hZGVkIHRocm91Z2ggdGhpcyBVUkkuCiAqIEByZXR1cm4gdXJpCiAqLwpGaWxlRW50cnkucHJvdG90eXBlLnRvVVJJID0gZnVuY3Rpb24obWltZVR5cGUpIHsKICAgIHJldHVybiAiZmlsZTovLyIgKyB0aGlzLmZ1bGxQYXRoOwp9OwoKLyoqCiAqIENyZWF0ZXMgYSBuZXcgRmlsZVdyaXRlciBhc3NvY2lhdGVkIHdpdGggdGhlIGZpbGUgdGhhdCB0aGlzIEZpbGVFbnRyeSByZXByZXNlbnRzLgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggdGhlIG5ldyBGaWxlV3JpdGVyCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkZpbGVFbnRyeS5wcm90b3R5cGUuY3JlYXRlV3JpdGVyID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICB0aGlzLmZpbGUoZnVuY3Rpb24oZmlsZVBvaW50ZXIpIHsKICAgICAgICB2YXIgd3JpdGVyID0gbmV3IEZpbGVXcml0ZXIoZmlsZVBvaW50ZXIpOwogICAgCiAgICAgICAgaWYgKHdyaXRlci5maWxlTmFtZSA9PT0gbnVsbCB8fCB3cml0ZXIuZmlsZU5hbWUgPT09ICIiKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZXJyb3JDYWxsYmFjayA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKHsKICAgICAgICAgICAgICAgICAgICAiY29kZSI6IEZpbGVFcnJvci5JTlZBTElEX1NUQVRFX0VSUgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAKICAgICAgICBpZiAodHlwZW9mIHN1Y2Nlc3NDYWxsYmFjayA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayh3cml0ZXIpOwogICAgICAgIH0gICAgICAgCiAgICB9LCBlcnJvckNhbGxiYWNrKTsKfTsKCi8qKgogKiBSZXR1cm5zIGEgRmlsZSB0aGF0IHJlcHJlc2VudHMgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGZpbGUgdGhhdCB0aGlzIEZpbGVFbnRyeSByZXByZXNlbnRzLgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggdGhlIG5ldyBGaWxlIG9iamVjdAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIGEgRmlsZUVycm9yCiAqLwpGaWxlRW50cnkucHJvdG90eXBlLmZpbGUgPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJnZXRGaWxlTWV0YWRhdGEiLCBbdGhpcy5mdWxsUGF0aF0pOwp9OwoKLyoqIEBjb25zdHJ1Y3RvciAqLwp2YXIgTG9jYWxGaWxlU3lzdGVtID0gZnVuY3Rpb24oKSB7Cn07CgovLyBGaWxlIGVycm9yIGNvZGVzCkxvY2FsRmlsZVN5c3RlbS5URU1QT1JBUlkgPSAwOwpMb2NhbEZpbGVTeXN0ZW0uUEVSU0lTVEVOVCA9IDE7CkxvY2FsRmlsZVN5c3RlbS5SRVNPVVJDRSA9IDI7CkxvY2FsRmlsZVN5c3RlbS5BUFBMSUNBVElPTiA9IDM7CgovKioKICogUmVxdWVzdHMgYSBmaWxlc3lzdGVtIGluIHdoaWNoIHRvIHN0b3JlIGFwcGxpY2F0aW9uIGRhdGEuCiAqCiAqIEBwYXJhbSB7aW50fSB0eXBlIG9mIGZpbGUgc3lzdGVtIGJlaW5nIHJlcXVlc3RlZAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggdGhlIG5ldyBGaWxlU3lzdGVtCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBGaWxlRXJyb3IKICovCkxvY2FsRmlsZVN5c3RlbS5wcm90b3R5cGUucmVxdWVzdEZpbGVTeXN0ZW0gPSBmdW5jdGlvbih0eXBlLCBzaXplLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIGlmICh0eXBlIDwgMCB8fCB0eXBlID4gMykgewogICAgICAgIGlmICh0eXBlb2YgZXJyb3JDYWxsYmFjayA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soewogICAgICAgICAgICAgICAgImNvZGUiOiBGaWxlRXJyb3IuU1lOVEFYX0VSUgogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIkZpbGUiLCAicmVxdWVzdEZpbGVTeXN0ZW0iLCBbdHlwZSwgc2l6ZV0pOwogICAgfQp9OwoKLyoqCiAqCiAqIEBwYXJhbSB7RE9NU3RyaW5nfSB1cmkgcmVmZXJyaW5nIHRvIGEgbG9jYWwgZmlsZSBpbiBhIGZpbGVzeXN0ZW0KICogQHBhcmFtIHtGdW5jdGlvbn0gc3VjY2Vzc0NhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBuZXcgZW50cnkKICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBhIEZpbGVFcnJvcgogKi8KTG9jYWxGaWxlU3lzdGVtLnByb3RvdHlwZS5yZXNvbHZlTG9jYWxGaWxlU3lzdGVtVVJJID0gZnVuY3Rpb24odXJpLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCAiRmlsZSIsICJyZXNvbHZlTG9jYWxGaWxlU3lzdGVtVVJJIiwgW3VyaV0pOwp9OwoKLyoqCiogVGhpcyBmdW5jdGlvbiByZXR1cm5zIGFuZCBhcnJheSBvZiBjb250YWN0cy4gIEl0IGlzIHJlcXVpcmVkIGFzIHdlIG5lZWQgdG8gY29udmVydCByYXcKKiBKU09OIG9iamVjdHMgaW50byBjb25jcmV0ZSBDb250YWN0IG9iamVjdHMuICBDdXJyZW50bHkgdGhpcyBtZXRob2QgaXMgY2FsbGVkIGFmdGVyCiogbmF2aWdhdG9yLnNlcnZpY2UuY29udGFjdHMuZmluZCBidXQgYmVmb3JlIHRoZSBmaW5kIG1ldGhvZHMgc3VjY2VzcyBjYWxsIGJhY2suCioKKiBAcGFyYW0gYSBKU09OIE9iamVjdHMgdGhhdCBuZWVkIHRvIGJlIGNvbnZlcnRlZCB0byBEaXJlY3RvcnlFbnRyeSBvciBGaWxlRW50cnkgb2JqZWN0cy4KKiBAcmV0dXJucyBhbiBlbnRyeQoqLwpMb2NhbEZpbGVTeXN0ZW0ucHJvdG90eXBlLl9jYXN0RlMgPSBmdW5jdGlvbihwbHVnaW5SZXN1bHQpIHsKICAgIHZhciBlbnRyeSA9IG51bGw7CiAgICBlbnRyeSA9IG5ldyBEaXJlY3RvcnlFbnRyeSgpOwogICAgZW50cnkuaXNEaXJlY3RvcnkgPSBwbHVnaW5SZXN1bHQubWVzc2FnZS5yb290LmlzRGlyZWN0b3J5OwogICAgZW50cnkuaXNGaWxlID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2Uucm9vdC5pc0ZpbGU7CiAgICBlbnRyeS5uYW1lID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2Uucm9vdC5uYW1lOwogICAgZW50cnkuZnVsbFBhdGggPSBwbHVnaW5SZXN1bHQubWVzc2FnZS5yb290LmZ1bGxQYXRoOwogICAgcGx1Z2luUmVzdWx0Lm1lc3NhZ2Uucm9vdCA9IGVudHJ5OwogICAgcmV0dXJuIHBsdWdpblJlc3VsdDsKfTsKCkxvY2FsRmlsZVN5c3RlbS5wcm90b3R5cGUuX2Nhc3RFbnRyeSA9IGZ1bmN0aW9uKHBsdWdpblJlc3VsdCkgewogICAgdmFyIGVudHJ5ID0gbnVsbDsKICAgIGlmIChwbHVnaW5SZXN1bHQubWVzc2FnZS5pc0RpcmVjdG9yeSkgewogICAgICAgIGNvbnNvbGUubG9nKCJUaGlzIGlzIGEgZGlyIik7CiAgICAgICAgZW50cnkgPSBuZXcgRGlyZWN0b3J5RW50cnkoKTsKICAgIH0KICAgIGVsc2UgaWYgKHBsdWdpblJlc3VsdC5tZXNzYWdlLmlzRmlsZSkgewogICAgICAgIGNvbnNvbGUubG9nKCJUaGlzIGlzIGEgZmlsZSIpOwogICAgICAgIGVudHJ5ID0gbmV3IEZpbGVFbnRyeSgpOwogICAgfQogICAgZW50cnkuaXNEaXJlY3RvcnkgPSBwbHVnaW5SZXN1bHQubWVzc2FnZS5pc0RpcmVjdG9yeTsKICAgIGVudHJ5LmlzRmlsZSA9IHBsdWdpblJlc3VsdC5tZXNzYWdlLmlzRmlsZTsKICAgIGVudHJ5Lm5hbWUgPSBwbHVnaW5SZXN1bHQubWVzc2FnZS5uYW1lOwogICAgZW50cnkuZnVsbFBhdGggPSBwbHVnaW5SZXN1bHQubWVzc2FnZS5mdWxsUGF0aDsKICAgIHBsdWdpblJlc3VsdC5tZXNzYWdlID0gZW50cnk7CiAgICByZXR1cm4gcGx1Z2luUmVzdWx0Owp9OwoKTG9jYWxGaWxlU3lzdGVtLnByb3RvdHlwZS5fY2FzdEVudHJpZXMgPSBmdW5jdGlvbihwbHVnaW5SZXN1bHQpIHsKICAgIHZhciBlbnRyaWVzID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2U7CiAgICB2YXIgcmV0VmFsID0gW107CiAgICBmb3IgKHZhciBpPTA7IGk8ZW50cmllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHJldFZhbC5wdXNoKHdpbmRvdy5sb2NhbEZpbGVTeXN0ZW0uX2NyZWF0ZUVudHJ5KGVudHJpZXNbaV0pKTsKICAgIH0KICAgIHBsdWdpblJlc3VsdC5tZXNzYWdlID0gcmV0VmFsOwogICAgcmV0dXJuIHBsdWdpblJlc3VsdDsKfTsKCkxvY2FsRmlsZVN5c3RlbS5wcm90b3R5cGUuX2NyZWF0ZUVudHJ5ID0gZnVuY3Rpb24oY2FzdE1lKSB7CiAgICB2YXIgZW50cnkgPSBudWxsOwogICAgaWYgKGNhc3RNZS5pc0RpcmVjdG9yeSkgewogICAgICAgIGNvbnNvbGUubG9nKCJUaGlzIGlzIGEgZGlyIik7CiAgICAgICAgZW50cnkgPSBuZXcgRGlyZWN0b3J5RW50cnkoKTsKICAgIH0KICAgIGVsc2UgaWYgKGNhc3RNZS5pc0ZpbGUpIHsKICAgICAgICBjb25zb2xlLmxvZygiVGhpcyBpcyBhIGZpbGUiKTsKICAgICAgICBlbnRyeSA9IG5ldyBGaWxlRW50cnkoKTsKICAgIH0KICAgIGVudHJ5LmlzRGlyZWN0b3J5ID0gY2FzdE1lLmlzRGlyZWN0b3J5OwogICAgZW50cnkuaXNGaWxlID0gY2FzdE1lLmlzRmlsZTsKICAgIGVudHJ5Lm5hbWUgPSBjYXN0TWUubmFtZTsKICAgIGVudHJ5LmZ1bGxQYXRoID0gY2FzdE1lLmZ1bGxQYXRoOwogICAgcmV0dXJuIGVudHJ5Owp9OwoKTG9jYWxGaWxlU3lzdGVtLnByb3RvdHlwZS5fY2FzdERhdGUgPSBmdW5jdGlvbihwbHVnaW5SZXN1bHQpIHsKICAgIGlmIChwbHVnaW5SZXN1bHQubWVzc2FnZS5tb2RpZmljYXRpb25UaW1lKSB7CiAgICAgICAgdmFyIG1vZFRpbWUgPSBuZXcgRGF0ZShwbHVnaW5SZXN1bHQubWVzc2FnZS5tb2RpZmljYXRpb25UaW1lKTsKICAgICAgICBwbHVnaW5SZXN1bHQubWVzc2FnZS5tb2RpZmljYXRpb25UaW1lID0gbW9kVGltZTsKICAgIH0KICAgIGVsc2UgaWYgKHBsdWdpblJlc3VsdC5tZXNzYWdlLmxhc3RNb2RpZmllZERhdGUpIHsKICAgICAgICB2YXIgZmlsZSA9IG5ldyBGaWxlKCk7CiAgICAgICAgZmlsZS5zaXplID0gcGx1Z2luUmVzdWx0Lm1lc3NhZ2Uuc2l6ZTsKICAgICAgICBmaWxlLnR5cGUgPSBwbHVnaW5SZXN1bHQubWVzc2FnZS50eXBlOwogICAgICAgIGZpbGUubmFtZSA9IHBsdWdpblJlc3VsdC5tZXNzYWdlLm5hbWU7CiAgICAgICAgZmlsZS5mdWxsUGF0aCA9IHBsdWdpblJlc3VsdC5tZXNzYWdlLmZ1bGxQYXRoOwogICAgICAgIGZpbGUubGFzdE1vZGlmaWVkRGF0ZSA9IG5ldyBEYXRlKHBsdWdpblJlc3VsdC5tZXNzYWdlLmxhc3RNb2RpZmllZERhdGUpOwogICAgICAgIHBsdWdpblJlc3VsdC5tZXNzYWdlID0gZmlsZTsKICAgIH0KICAgIHJldHVybiBwbHVnaW5SZXN1bHQ7Cn07CgovKioKICogQWRkIHRoZSBGaWxlU3lzdGVtIGludGVyZmFjZSBpbnRvIHRoZSBicm93c2VyLgogKi8KUGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKSB7Cgl2YXIgcGdMb2NhbEZpbGVTeXN0ZW0gPSBuZXcgTG9jYWxGaWxlU3lzdGVtKCk7CgkvLyBOZWVkZWQgZm9yIGNhc3QgbWV0aG9kcwogICAgaWYodHlwZW9mIHdpbmRvdy5sb2NhbEZpbGVTeXN0ZW0gPT0gInVuZGVmaW5lZCIpIHdpbmRvdy5sb2NhbEZpbGVTeXN0ZW0gID0gcGdMb2NhbEZpbGVTeXN0ZW07CiAgICBpZih0eXBlb2Ygd2luZG93LnJlcXVlc3RGaWxlU3lzdGVtID09ICJ1bmRlZmluZWQiKSB3aW5kb3cucmVxdWVzdEZpbGVTeXN0ZW0gID0gcGdMb2NhbEZpbGVTeXN0ZW0ucmVxdWVzdEZpbGVTeXN0ZW07CiAgICBpZih0eXBlb2Ygd2luZG93LnJlc29sdmVMb2NhbEZpbGVTeXN0ZW1VUkkgPT0gInVuZGVmaW5lZCIpIHdpbmRvdy5yZXNvbHZlTG9jYWxGaWxlU3lzdGVtVVJJID0gcGdMb2NhbEZpbGVTeXN0ZW0ucmVzb2x2ZUxvY2FsRmlsZVN5c3RlbVVSSTsKfSk7Cn0KLyoKICogUGhvbmVHYXAgaXMgYXZhaWxhYmxlIHVuZGVyICplaXRoZXIqIHRoZSB0ZXJtcyBvZiB0aGUgbW9kaWZpZWQgQlNEIGxpY2Vuc2UgKm9yKiB0aGUKICogTUlUIExpY2Vuc2UgKDIwMDgpLiBTZWUgaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL2FscGhhYmV0aWNhbCBmb3IgZnVsbCB0ZXh0LgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDUtMjAxMCwgTml0b2JpIFNvZnR3YXJlIEluYy4KICogQ29weXJpZ2h0IChjKSAyMDEwLTIwMTEsIElCTSBDb3Jwb3JhdGlvbgogKi8KCmlmICghUGhvbmVHYXAuaGFzUmVzb3VyY2UoImZpbGV0cmFuc2ZlciIpKSB7ClBob25lR2FwLmFkZFJlc291cmNlKCJmaWxldHJhbnNmZXIiKTsKCi8qKgogKiBGaWxlVHJhbnNmZXIgdXBsb2FkcyBhIGZpbGUgdG8gYSByZW1vdGUgc2VydmVyLgogKiBAY29uc3RydWN0b3IKICovCnZhciBGaWxlVHJhbnNmZXIgPSBmdW5jdGlvbigpIHt9OwoKLyoqCiAqIEZpbGVVcGxvYWRSZXN1bHQKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgRmlsZVVwbG9hZFJlc3VsdCA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5ieXRlc1NlbnQgPSAwOwogICAgdGhpcy5yZXNwb25zZUNvZGUgPSBudWxsOwogICAgdGhpcy5yZXNwb25zZSA9IG51bGw7Cn07CgovKioKICogRmlsZVRyYW5zZmVyRXJyb3IKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgRmlsZVRyYW5zZmVyRXJyb3IgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuY29kZSA9IG51bGw7Cn07CgpGaWxlVHJhbnNmZXJFcnJvci5GSUxFX05PVF9GT1VORF9FUlIgPSAxOwpGaWxlVHJhbnNmZXJFcnJvci5JTlZBTElEX1VSTF9FUlIgPSAyOwpGaWxlVHJhbnNmZXJFcnJvci5DT05ORUNUSU9OX0VSUiA9IDM7CgovKioKKiBHaXZlbiBhbiBhYnNvbHV0ZSBmaWxlIHBhdGgsIHVwbG9hZHMgYSBmaWxlIG9uIHRoZSBkZXZpY2UgdG8gYSByZW1vdGUgc2VydmVyCiogdXNpbmcgYSBtdWx0aXBhcnQgSFRUUCByZXF1ZXN0LgoqIEBwYXJhbSBmaWxlUGF0aCB7U3RyaW5nfSAgICAgICAgICAgRnVsbCBwYXRoIG9mIHRoZSBmaWxlIG9uIHRoZSBkZXZpY2UKKiBAcGFyYW0gc2VydmVyIHtTdHJpbmd9ICAgICAgICAgICAgIFVSTCBvZiB0aGUgc2VydmVyIHRvIHJlY2VpdmUgdGhlIGZpbGUKKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrIChGdW5jdGlvbn0gIENhbGxiYWNrIHRvIGJlIGludm9rZWQgd2hlbiB1cGxvYWQgaGFzIGNvbXBsZXRlZAoqIEBwYXJhbSBlcnJvckNhbGxiYWNrIHtGdW5jdGlvbn0gICAgQ2FsbGJhY2sgdG8gYmUgaW52b2tlZCB1cG9uIGVycm9yCiogQHBhcmFtIG9wdGlvbnMge0ZpbGVVcGxvYWRPcHRpb25zfSBPcHRpb25hbCBwYXJhbWV0ZXJzIHN1Y2ggYXMgZmlsZSBuYW1lIGFuZCBtaW1ldHlwZQoqLwpGaWxlVHJhbnNmZXIucHJvdG90eXBlLnVwbG9hZCA9IGZ1bmN0aW9uKGZpbGVQYXRoLCBzZXJ2ZXIsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucywgZGVidWcpIHsKCiAgICAvLyBjaGVjayBmb3Igb3B0aW9ucwogICAgdmFyIGZpbGVLZXkgPSBudWxsOwogICAgdmFyIGZpbGVOYW1lID0gbnVsbDsKICAgIHZhciBtaW1lVHlwZSA9IG51bGw7CiAgICB2YXIgcGFyYW1zID0gbnVsbDsKICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgZmlsZUtleSA9IG9wdGlvbnMuZmlsZUtleTsKICAgICAgICBmaWxlTmFtZSA9IG9wdGlvbnMuZmlsZU5hbWU7CiAgICAgICAgbWltZVR5cGUgPSBvcHRpb25zLm1pbWVUeXBlOwogICAgICAgIGlmIChvcHRpb25zLnBhcmFtcykgewogICAgICAgICAgICBwYXJhbXMgPSBvcHRpb25zLnBhcmFtczsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHBhcmFtcyA9IHt9OwogICAgICAgIH0KICAgIH0KCiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgJ0ZpbGVUcmFuc2ZlcicsICd1cGxvYWQnLCBbZmlsZVBhdGgsIHNlcnZlciwgZmlsZUtleSwgZmlsZU5hbWUsIG1pbWVUeXBlLCBwYXJhbXMsIGRlYnVnXSk7Cn07CgovKioKICogT3B0aW9ucyB0byBjdXN0b21pemUgdGhlIEhUVFAgcmVxdWVzdCB1c2VkIHRvIHVwbG9hZCBmaWxlcy4KICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSBmaWxlS2V5IHtTdHJpbmd9ICAgTmFtZSBvZiBmaWxlIHJlcXVlc3QgcGFyYW1ldGVyLgogKiBAcGFyYW0gZmlsZU5hbWUge1N0cmluZ30gIEZpbGVuYW1lIHRvIGJlIHVzZWQgYnkgdGhlIHNlcnZlci4gRGVmYXVsdHMgdG8gaW1hZ2UuanBnLgogKiBAcGFyYW0gbWltZVR5cGUge1N0cmluZ30gIE1pbWV0eXBlIG9mIHRoZSB1cGxvYWRlZCBmaWxlLiBEZWZhdWx0cyB0byBpbWFnZS9qcGVnLgogKiBAcGFyYW0gcGFyYW1zIHtPYmplY3R9ICAgIE9iamVjdCB3aXRoIGtleTogdmFsdWUgcGFyYW1zIHRvIHNlbmQgdG8gdGhlIHNlcnZlci4KICovCnZhciBGaWxlVXBsb2FkT3B0aW9ucyA9IGZ1bmN0aW9uKGZpbGVLZXksIGZpbGVOYW1lLCBtaW1lVHlwZSwgcGFyYW1zKSB7CiAgICB0aGlzLmZpbGVLZXkgPSBmaWxlS2V5IHx8IG51bGw7CiAgICB0aGlzLmZpbGVOYW1lID0gZmlsZU5hbWUgfHwgbnVsbDsKICAgIHRoaXMubWltZVR5cGUgPSBtaW1lVHlwZSB8fCBudWxsOwogICAgdGhpcy5wYXJhbXMgPSBwYXJhbXMgfHwgbnVsbDsKfTsKfQovKgogKiBQaG9uZUdhcCBpcyBhdmFpbGFibGUgdW5kZXIgKmVpdGhlciogdGhlIHRlcm1zIG9mIHRoZSBtb2RpZmllZCBCU0QgbGljZW5zZSAqb3IqIHRoZQogKiBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvYWxwaGFiZXRpY2FsIGZvciBmdWxsIHRleHQuCiAqCiAqIENvcHlyaWdodCAoYykgMjAwNS0yMDEwLCBOaXRvYmkgU29mdHdhcmUgSW5jLgogKiBDb3B5cmlnaHQgKGMpIDIwMTAtMjAxMSwgSUJNIENvcnBvcmF0aW9uCiAqLwoKaWYgKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgiZ2VvbG9jYXRpb24iKSkgewpQaG9uZUdhcC5hZGRSZXNvdXJjZSgiZ2VvbG9jYXRpb24iKTsKCi8qKgogKiBUaGlzIGNsYXNzIHByb3ZpZGVzIGFjY2VzcyB0byBkZXZpY2UgR1BTIGRhdGEuCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIEdlb2xvY2F0aW9uID0gZnVuY3Rpb24oKSB7CgogICAgLy8gVGhlIGxhc3Qga25vd24gR1BTIHBvc2l0aW9uLgogICAgdGhpcy5sYXN0UG9zaXRpb24gPSBudWxsOwoKICAgIC8vIEdlb2xvY2F0aW9uIGxpc3RlbmVycwogICAgdGhpcy5saXN0ZW5lcnMgPSB7fTsKfTsKCi8qKgogKiBQb3NpdGlvbiBlcnJvciBvYmplY3QKICoKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSBjb2RlCiAqIEBwYXJhbSBtZXNzYWdlCiAqLwp2YXIgUG9zaXRpb25FcnJvciA9IGZ1bmN0aW9uKGNvZGUsIG1lc3NhZ2UpIHsKICAgIHRoaXMuY29kZSA9IGNvZGU7CiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwp9OwoKUG9zaXRpb25FcnJvci5QRVJNSVNTSU9OX0RFTklFRCA9IDE7ClBvc2l0aW9uRXJyb3IuUE9TSVRJT05fVU5BVkFJTEFCTEUgPSAyOwpQb3NpdGlvbkVycm9yLlRJTUVPVVQgPSAzOwoKLyoqCiAqIEFzeW5jaHJvbm91c2x5IGFxdWlyZXMgdGhlIGN1cnJlbnQgcG9zaXRpb24uCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayAgICBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZSBwb3NpdGlvbiBkYXRhIGlzIGF2YWlsYWJsZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrICAgICAgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGVyZSBpcyBhbiBlcnJvciBnZXR0aW5nIHRoZSBoZWFkaW5nIHBvc2l0aW9uLiAoT1BUSU9OQUwpCiAqIEBwYXJhbSB7UG9zaXRpb25PcHRpb25zfSBvcHRpb25zICAgICBUaGUgb3B0aW9ucyBmb3IgZ2V0dGluZyB0aGUgcG9zaXRpb24gZGF0YS4gKE9QVElPTkFMKQogKi8KR2VvbG9jYXRpb24ucHJvdG90eXBlLmdldEN1cnJlbnRQb3NpdGlvbiA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgb3B0aW9ucykgewogICAgaWYgKG5hdmlnYXRvci5fZ2VvLmxpc3RlbmVycy5nbG9iYWwpIHsKICAgICAgICBjb25zb2xlLmxvZygiR2VvbG9jYXRpb24gRXJyb3I6IFN0aWxsIHdhaXRpbmcgZm9yIHByZXZpb3VzIGdldEN1cnJlbnRQb3NpdGlvbigpIHJlcXVlc3QuIik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhuZXcgUG9zaXRpb25FcnJvcihQb3NpdGlvbkVycm9yLlRJTUVPVVQsICJHZW9sb2NhdGlvbiBFcnJvcjogU3RpbGwgd2FpdGluZyBmb3IgcHJldmlvdXMgZ2V0Q3VycmVudFBvc2l0aW9uKCkgcmVxdWVzdC4iKSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgbWF4aW11bUFnZSA9IDEwMDAwOwogICAgdmFyIGVuYWJsZUhpZ2hBY2N1cmFjeSA9IGZhbHNlOwogICAgdmFyIHRpbWVvdXQgPSAxMDAwMDsKICAgIGlmICh0eXBlb2Ygb3B0aW9ucyAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMubWF4aW11bUFnZSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgbWF4aW11bUFnZSA9IG9wdGlvbnMubWF4aW11bUFnZTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmVuYWJsZUhpZ2hBY2N1cmFjeSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgZW5hYmxlSGlnaEFjY3VyYWN5ID0gb3B0aW9ucy5lbmFibGVIaWdoQWNjdXJhY3k7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy50aW1lb3V0ICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICB0aW1lb3V0ID0gb3B0aW9ucy50aW1lb3V0OwogICAgICAgIH0KICAgIH0KICAgIG5hdmlnYXRvci5fZ2VvLmxpc3RlbmVycy5nbG9iYWwgPSB7InN1Y2Nlc3MiIDogc3VjY2Vzc0NhbGxiYWNrLCAiZmFpbCIgOiBlcnJvckNhbGxiYWNrIH07CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJHZW9sb2NhdGlvbiIsICJnZXRDdXJyZW50TG9jYXRpb24iLCBbZW5hYmxlSGlnaEFjY3VyYWN5LCB0aW1lb3V0LCBtYXhpbXVtQWdlXSk7Cn07CgovKioKICogQXN5bmNocm9ub3VzbHkgd2F0Y2hlcyB0aGUgZ2VvbG9jYXRpb24gZm9yIGNoYW5nZXMgdG8gZ2VvbG9jYXRpb24uICBXaGVuIGEgY2hhbmdlIG9jY3VycywKICogdGhlIHN1Y2Nlc3NDYWxsYmFjayBpcyBjYWxsZWQgd2l0aCB0aGUgbmV3IGxvY2F0aW9uLgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgICAgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgZWFjaCB0aW1lIHRoZSBsb2NhdGlvbiBkYXRhIGlzIGF2YWlsYWJsZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrICAgICAgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGVyZSBpcyBhbiBlcnJvciBnZXR0aW5nIHRoZSBsb2NhdGlvbiBkYXRhLiAoT1BUSU9OQUwpCiAqIEBwYXJhbSB7UG9zaXRpb25PcHRpb25zfSBvcHRpb25zICAgICBUaGUgb3B0aW9ucyBmb3IgZ2V0dGluZyB0aGUgbG9jYXRpb24gZGF0YSBzdWNoIGFzIGZyZXF1ZW5jeS4gKE9QVElPTkFMKQogKiBAcmV0dXJuIFN0cmluZyAgICAgICAgICAgICAgICAgICAgICAgVGhlIHdhdGNoIGlkIHRoYXQgbXVzdCBiZSBwYXNzZWQgdG8gI2NsZWFyV2F0Y2ggdG8gc3RvcCB3YXRjaGluZy4KICovCkdlb2xvY2F0aW9uLnByb3RvdHlwZS53YXRjaFBvc2l0aW9uID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrLCBvcHRpb25zKSB7CiAgICB2YXIgbWF4aW11bUFnZSA9IDEwMDAwOwogICAgdmFyIGVuYWJsZUhpZ2hBY2N1cmFjeSA9IGZhbHNlOwogICAgdmFyIHRpbWVvdXQgPSAxMDAwMDsKICAgIGlmICh0eXBlb2Ygb3B0aW9ucyAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuZnJlcXVlbmN5ICAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgbWF4aW11bUFnZSA9IG9wdGlvbnMuZnJlcXVlbmN5OwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMubWF4aW11bUFnZSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgbWF4aW11bUFnZSA9IG9wdGlvbnMubWF4aW11bUFnZTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmVuYWJsZUhpZ2hBY2N1cmFjeSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgZW5hYmxlSGlnaEFjY3VyYWN5ID0gb3B0aW9ucy5lbmFibGVIaWdoQWNjdXJhY3k7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy50aW1lb3V0ICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICB0aW1lb3V0ID0gb3B0aW9ucy50aW1lb3V0OwogICAgICAgIH0KICAgIH0KICAgIHZhciBpZCA9IFBob25lR2FwLmNyZWF0ZVVVSUQoKTsKICAgIG5hdmlnYXRvci5fZ2VvLmxpc3RlbmVyc1tpZF0gPSB7InN1Y2Nlc3MiIDogc3VjY2Vzc0NhbGxiYWNrLCAiZmFpbCIgOiBlcnJvckNhbGxiYWNrIH07CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJHZW9sb2NhdGlvbiIsICJzdGFydCIsIFtpZCwgZW5hYmxlSGlnaEFjY3VyYWN5LCB0aW1lb3V0LCBtYXhpbXVtQWdlXSk7CiAgICByZXR1cm4gaWQ7Cn07CgovKgogKiBOYXRpdmUgY2FsbGJhY2sgd2hlbiB3YXRjaCBwb3NpdGlvbiBoYXMgYSBuZXcgcG9zaXRpb24uCiAqIFBSSVZBVEUgTUVUSE9ECiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBpZAogKiBAcGFyYW0ge051bWJlcn0gbGF0CiAqIEBwYXJhbSB7TnVtYmVyfSBsbmcKICogQHBhcmFtIHtOdW1iZXJ9IGFsdAogKiBAcGFyYW0ge051bWJlcn0gYWx0YWNjCiAqIEBwYXJhbSB7TnVtYmVyfSBoZWFkCiAqIEBwYXJhbSB7TnVtYmVyfSB2ZWwKICogQHBhcmFtIHtOdW1iZXJ9IHN0YW1wCiAqLwpHZW9sb2NhdGlvbi5wcm90b3R5cGUuc3VjY2VzcyA9IGZ1bmN0aW9uKGlkLCBsYXQsIGxuZywgYWx0LCBhbHRhY2MsIGhlYWQsIHZlbCwgc3RhbXApIHsKICAgIHZhciBjb29yZHMgPSBuZXcgQ29vcmRpbmF0ZXMobGF0LCBsbmcsIGFsdCwgYWx0YWNjLCBoZWFkLCB2ZWwpOwogICAgdmFyIGxvYyA9IG5ldyBQb3NpdGlvbihjb29yZHMsIHN0YW1wKTsKICAgIHRyeSB7CiAgICAgICAgaWYgKGxhdCA9PT0gInVuZGVmaW5lZCIgfHwgbG5nID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICBuYXZpZ2F0b3IuX2dlby5saXN0ZW5lcnNbaWRdLmZhaWwobmV3IFBvc2l0aW9uRXJyb3IoUG9zaXRpb25FcnJvci5QT1NJVElPTl9VTkFWQUlMQUJMRSwgIkxhdC9MbmcgYXJlIHVuZGVmaW5lZC4iKSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBuYXZpZ2F0b3IuX2dlby5sYXN0UG9zaXRpb24gPSBsb2M7CiAgICAgICAgICAgIG5hdmlnYXRvci5fZ2VvLmxpc3RlbmVyc1tpZF0uc3VjY2Vzcyhsb2MpOwogICAgICAgIH0KICAgIH0KICAgIGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coIkdlb2xvY2F0aW9uIEVycm9yOiBFcnJvciBjYWxsaW5nIHN1Y2Nlc3MgY2FsbGJhY2sgZnVuY3Rpb24uIik7CiAgICB9CgogICAgaWYgKGlkID09PSAiZ2xvYmFsIikgewogICAgICAgIGRlbGV0ZSBuYXZpZ2F0b3IuX2dlby5saXN0ZW5lcnMuZ2xvYmFsOwogICAgfQp9OwoKLyoqCiAqIE5hdGl2ZSBjYWxsYmFjayB3aGVuIHdhdGNoIHBvc2l0aW9uIGhhcyBhbiBlcnJvci4KICogUFJJVkFURSBNRVRIT0QKICoKICogQHBhcmFtIHtTdHJpbmd9IGlkICAgICAgIFRoZSBJRCBvZiB0aGUgd2F0Y2gKICogQHBhcmFtIHtOdW1iZXJ9IGNvZGUgICAgIFRoZSBlcnJvciBjb2RlCiAqIEBwYXJhbSB7U3RyaW5nfSBtc2cgICAgICBUaGUgZXJyb3IgbWVzc2FnZQogKi8KR2VvbG9jYXRpb24ucHJvdG90eXBlLmZhaWwgPSBmdW5jdGlvbihpZCwgY29kZSwgbXNnKSB7CiAgICB0cnkgewogICAgICAgIG5hdmlnYXRvci5fZ2VvLmxpc3RlbmVyc1tpZF0uZmFpbChuZXcgUG9zaXRpb25FcnJvcihjb2RlLCBtc2cpKTsKICAgIH0KICAgIGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coIkdlb2xvY2F0aW9uIEVycm9yOiBFcnJvciBjYWxsaW5nIGVycm9yIGNhbGxiYWNrIGZ1bmN0aW9uLiIpOwogICAgfQp9OwoKLyoqCiAqIENsZWFycyB0aGUgc3BlY2lmaWVkIGhlYWRpbmcgd2F0Y2guCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBpZCAgICAgICBUaGUgSUQgb2YgdGhlIHdhdGNoIHJldHVybmVkIGZyb20gI3dhdGNoUG9zaXRpb24KICovCkdlb2xvY2F0aW9uLnByb3RvdHlwZS5jbGVhcldhdGNoID0gZnVuY3Rpb24oaWQpIHsKICAgIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIkdlb2xvY2F0aW9uIiwgInN0b3AiLCBbaWRdKTsKICAgIGRlbGV0ZSBuYXZpZ2F0b3IuX2dlby5saXN0ZW5lcnNbaWRdOwp9OwoKLyoqCiAqIEZvcmNlIHRoZSBQaG9uZUdhcCBnZW9sb2NhdGlvbiB0byBiZSB1c2VkIGluc3RlYWQgb2YgYnVpbHQtaW4uCiAqLwpHZW9sb2NhdGlvbi51c2luZ1Bob25lR2FwID0gZmFsc2U7Ckdlb2xvY2F0aW9uLnVzZVBob25lR2FwID0gZnVuY3Rpb24oKSB7CiAgICBpZiAoR2VvbG9jYXRpb24udXNpbmdQaG9uZUdhcCkgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIEdlb2xvY2F0aW9uLnVzaW5nUGhvbmVHYXAgPSB0cnVlOwoKICAgIC8vIFNldCBidWlsdC1pbiBnZW9sb2NhdGlvbiBtZXRob2RzIHRvIG91ciBvd24gaW1wbGVtZW50YXRpb25zCiAgICAvLyAoQ2Fubm90IHJlcGxhY2UgZW50aXJlIGdlb2xvY2F0aW9uLCBidXQgY2FuIHJlcGxhY2UgaW5kaXZpZHVhbCBtZXRob2RzKQogICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLnNldExvY2F0aW9uID0gbmF2aWdhdG9yLl9nZW8uc2V0TG9jYXRpb247CiAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uID0gbmF2aWdhdG9yLl9nZW8uZ2V0Q3VycmVudFBvc2l0aW9uOwogICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLndhdGNoUG9zaXRpb24gPSBuYXZpZ2F0b3IuX2dlby53YXRjaFBvc2l0aW9uOwogICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmNsZWFyV2F0Y2ggPSBuYXZpZ2F0b3IuX2dlby5jbGVhcldhdGNoOwogICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLnN0YXJ0ID0gbmF2aWdhdG9yLl9nZW8uc3RhcnQ7CiAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uc3RvcCA9IG5hdmlnYXRvci5fZ2VvLnN0b3A7Cn07CgpQaG9uZUdhcC5hZGRDb25zdHJ1Y3RvcihmdW5jdGlvbigpIHsKICAgIG5hdmlnYXRvci5fZ2VvID0gbmV3IEdlb2xvY2F0aW9uKCk7CgogICAgLy8gTm8gbmF0aXZlIGdlb2xvY2F0aW9uIG9iamVjdCBmb3IgQW5kcm9pZCAxLngsIHNvIHVzZSBQaG9uZUdhcCBnZW9sb2NhdGlvbgogICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24gPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uID0gbmF2aWdhdG9yLl9nZW87CiAgICAgICAgR2VvbG9jYXRpb24udXNpbmdQaG9uZUdhcCA9IHRydWU7CiAgICB9Cn0pOwp9Ci8qCiAqIFBob25lR2FwIGlzIGF2YWlsYWJsZSB1bmRlciAqZWl0aGVyKiB0aGUgdGVybXMgb2YgdGhlIG1vZGlmaWVkIEJTRCBsaWNlbnNlICpvciogdGhlCiAqIE1JVCBMaWNlbnNlICgyMDA4KS4gU2VlIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9hbHBoYWJldGljYWwgZm9yIGZ1bGwgdGV4dC4KICoKICogQ29weXJpZ2h0IChjKSAyMDA1LTIwMTAsIE5pdG9iaSBTb2Z0d2FyZSBJbmMuCiAqIENvcHlyaWdodCAoYykgMjAxMC0yMDExLCBJQk0gQ29ycG9yYXRpb24KICovCgppZiAoIVBob25lR2FwLmhhc1Jlc291cmNlKCJtZWRpYSIpKSB7ClBob25lR2FwLmFkZFJlc291cmNlKCJtZWRpYSIpOwoKLyoqCiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgYWNjZXNzIHRvIHRoZSBkZXZpY2UgbWVkaWEsIGludGVyZmFjZXMgdG8gYm90aCBzb3VuZCBhbmQgdmlkZW8KICoKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSBzcmMgICAgICAgICAgICAgICAgICAgVGhlIGZpbGUgbmFtZSBvciB1cmwgdG8gcGxheQogKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrICAgICAgIFRoZSBjYWxsYmFjayB0byBiZSBjYWxsZWQgd2hlbiB0aGUgZmlsZSBpcyBkb25lIHBsYXlpbmcgb3IgcmVjb3JkaW5nLgogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soKSAtIE9QVElPTkFMCiAqIEBwYXJhbSBlcnJvckNhbGxiYWNrICAgICAgICAgVGhlIGNhbGxiYWNrIHRvIGJlIGNhbGxlZCBpZiB0aGVyZSBpcyBhbiBlcnJvci4KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhpbnQgZXJyb3JDb2RlKSAtIE9QVElPTkFMCiAqIEBwYXJhbSBzdGF0dXNDYWxsYmFjayAgICAgICAgVGhlIGNhbGxiYWNrIHRvIGJlIGNhbGxlZCB3aGVuIG1lZGlhIHN0YXR1cyBoYXMgY2hhbmdlZC4KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ2FsbGJhY2soaW50IHN0YXR1c0NvZGUpIC0gT1BUSU9OQUwKICogQHBhcmFtIHBvc2l0aW9uQ2FsbGJhY2sgICAgICBUaGUgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHdoZW4gbWVkaWEgcG9zaXRpb24gaGFzIGNoYW5nZWQuCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uQ2FsbGJhY2sobG9uZyBwb3NpdGlvbikgLSBPUFRJT05BTAogKi8KdmFyIE1lZGlhID0gZnVuY3Rpb24oc3JjLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2ssIHN0YXR1c0NhbGxiYWNrLCBwb3NpdGlvbkNhbGxiYWNrKSB7CgogICAgLy8gc3VjY2Vzc0NhbGxiYWNrIG9wdGlvbmFsCiAgICBpZiAoc3VjY2Vzc0NhbGxiYWNrICYmICh0eXBlb2Ygc3VjY2Vzc0NhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSkgewogICAgICAgIGNvbnNvbGUubG9nKCJNZWRpYSBFcnJvcjogc3VjY2Vzc0NhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIGVycm9yQ2FsbGJhY2sgb3B0aW9uYWwKICAgIGlmIChlcnJvckNhbGxiYWNrICYmICh0eXBlb2YgZXJyb3JDYWxsYmFjayAhPT0gImZ1bmN0aW9uIikpIHsKICAgICAgICBjb25zb2xlLmxvZygiTWVkaWEgRXJyb3I6IGVycm9yQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gc3RhdHVzQ2FsbGJhY2sgb3B0aW9uYWwKICAgIGlmIChzdGF0dXNDYWxsYmFjayAmJiAodHlwZW9mIHN0YXR1c0NhbGxiYWNrICE9PSAiZnVuY3Rpb24iKSkgewogICAgICAgIGNvbnNvbGUubG9nKCJNZWRpYSBFcnJvcjogc3RhdHVzQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gc3RhdHVzQ2FsbGJhY2sgb3B0aW9uYWwKICAgIGlmIChwb3NpdGlvbkNhbGxiYWNrICYmICh0eXBlb2YgcG9zaXRpb25DYWxsYmFjayAhPT0gImZ1bmN0aW9uIikpIHsKICAgICAgICBjb25zb2xlLmxvZygiTWVkaWEgRXJyb3I6IHBvc2l0aW9uQ2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5pZCA9IFBob25lR2FwLmNyZWF0ZVVVSUQoKTsKICAgIFBob25lR2FwLm1lZGlhT2JqZWN0c1t0aGlzLmlkXSA9IHRoaXM7CiAgICB0aGlzLnNyYyA9IHNyYzsKICAgIHRoaXMuc3VjY2Vzc0NhbGxiYWNrID0gc3VjY2Vzc0NhbGxiYWNrOwogICAgdGhpcy5lcnJvckNhbGxiYWNrID0gZXJyb3JDYWxsYmFjazsKICAgIHRoaXMuc3RhdHVzQ2FsbGJhY2sgPSBzdGF0dXNDYWxsYmFjazsKICAgIHRoaXMucG9zaXRpb25DYWxsYmFjayA9IHBvc2l0aW9uQ2FsbGJhY2s7CiAgICB0aGlzLl9kdXJhdGlvbiA9IC0xOwogICAgdGhpcy5fcG9zaXRpb24gPSAtMTsKfTsKCi8vIE1lZGlhIG1lc3NhZ2VzCk1lZGlhLk1FRElBX1NUQVRFID0gMTsKTWVkaWEuTUVESUFfRFVSQVRJT04gPSAyOwpNZWRpYS5NRURJQV9QT1NJVElPTiA9IDM7Ck1lZGlhLk1FRElBX0VSUk9SID0gOTsKCi8vIE1lZGlhIHN0YXRlcwpNZWRpYS5NRURJQV9OT05FID0gMDsKTWVkaWEuTUVESUFfU1RBUlRJTkcgPSAxOwpNZWRpYS5NRURJQV9SVU5OSU5HID0gMjsKTWVkaWEuTUVESUFfUEFVU0VEID0gMzsKTWVkaWEuTUVESUFfU1RPUFBFRCA9IDQ7Ck1lZGlhLk1FRElBX01TRyA9IFsiTm9uZSIsICJTdGFydGluZyIsICJSdW5uaW5nIiwgIlBhdXNlZCIsICJTdG9wcGVkIl07CgovLyBUT0RPOiBXaWxsIE1lZGlhRXJyb3IgYmUgdXNlZD8KLyoqCiAqIFRoaXMgY2xhc3MgY29udGFpbnMgaW5mb3JtYXRpb24gYWJvdXQgYW55IE1lZGlhIGVycm9ycy4KICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgTWVkaWFFcnJvciA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5jb2RlID0gbnVsbDsKICAgIHRoaXMubWVzc2FnZSA9ICIiOwp9OwoKTWVkaWFFcnJvci5NRURJQV9FUlJfQUJPUlRFRCAgICAgICAgPSAxOwpNZWRpYUVycm9yLk1FRElBX0VSUl9ORVRXT1JLICAgICAgICA9IDI7Ck1lZGlhRXJyb3IuTUVESUFfRVJSX0RFQ09ERSAgICAgICAgID0gMzsKTWVkaWFFcnJvci5NRURJQV9FUlJfTk9ORV9TVVBQT1JURUQgPSA0OwoKLyoqCiAqIFN0YXJ0IG9yIHJlc3VtZSBwbGF5aW5nIGF1ZGlvIGZpbGUuCiAqLwpNZWRpYS5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkgewogICAgUGhvbmVHYXAuZXhlYyhudWxsLCBudWxsLCAiTWVkaWEiLCAic3RhcnRQbGF5aW5nQXVkaW8iLCBbdGhpcy5pZCwgdGhpcy5zcmNdKTsKfTsKCi8qKgogKiBTdG9wIHBsYXlpbmcgYXVkaW8gZmlsZS4KICovCk1lZGlhLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gUGhvbmVHYXAuZXhlYyhudWxsLCBudWxsLCAiTWVkaWEiLCAic3RvcFBsYXlpbmdBdWRpbyIsIFt0aGlzLmlkXSk7Cn07CgovKioKICogU2VlayBvciBqdW1wIHRvIGEgbmV3IHRpbWUgaW4gdGhlIHRyYWNrLi4KICovCk1lZGlhLnByb3RvdHlwZS5zZWVrVG8gPSBmdW5jdGlvbihtaWxsaXNlY29uZHMpIHsKICAgIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIk1lZGlhIiwgInNlZWtUb0F1ZGlvIiwgW3RoaXMuaWQsIG1pbGxpc2Vjb25kc10pOwp9OwoKLyoqCiAqIFBhdXNlIHBsYXlpbmcgYXVkaW8gZmlsZS4KICovCk1lZGlhLnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uKCkgewogICAgUGhvbmVHYXAuZXhlYyhudWxsLCBudWxsLCAiTWVkaWEiLCAicGF1c2VQbGF5aW5nQXVkaW8iLCBbdGhpcy5pZF0pOwp9OwoKLyoqCiAqIEdldCBkdXJhdGlvbiBvZiBhbiBhdWRpbyBmaWxlLgogKiBUaGUgZHVyYXRpb24gaXMgb25seSBzZXQgZm9yIGF1ZGlvIHRoYXQgaXMgcGxheWluZywgcGF1c2VkIG9yIHN0b3BwZWQuCiAqCiAqIEByZXR1cm4gICAgICBkdXJhdGlvbiBvciAtMSBpZiBub3Qga25vd24uCiAqLwpNZWRpYS5wcm90b3R5cGUuZ2V0RHVyYXRpb24gPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl9kdXJhdGlvbjsKfTsKCi8qKgogKiBHZXQgcG9zaXRpb24gb2YgYXVkaW8uCiAqLwpNZWRpYS5wcm90b3R5cGUuZ2V0Q3VycmVudFBvc2l0aW9uID0gZnVuY3Rpb24oc3VjY2VzcywgZmFpbCkgewogICAgUGhvbmVHYXAuZXhlYyhzdWNjZXNzLCBmYWlsLCAiTWVkaWEiLCAiZ2V0Q3VycmVudFBvc2l0aW9uQXVkaW8iLCBbdGhpcy5pZF0pOwp9OwoKLyoqCiAqIFN0YXJ0IHJlY29yZGluZyBhdWRpbyBmaWxlLgogKi8KTWVkaWEucHJvdG90eXBlLnN0YXJ0UmVjb3JkID0gZnVuY3Rpb24oKSB7CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJNZWRpYSIsICJzdGFydFJlY29yZGluZ0F1ZGlvIiwgW3RoaXMuaWQsIHRoaXMuc3JjXSk7Cn07CgovKioKICogU3RvcCByZWNvcmRpbmcgYXVkaW8gZmlsZS4KICovCk1lZGlhLnByb3RvdHlwZS5zdG9wUmVjb3JkID0gZnVuY3Rpb24oKSB7CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJNZWRpYSIsICJzdG9wUmVjb3JkaW5nQXVkaW8iLCBbdGhpcy5pZF0pOwp9OwoKLyoqCiAqIFJlbGVhc2UgdGhlIHJlc291cmNlcy4KICovCk1lZGlhLnByb3RvdHlwZS5yZWxlYXNlID0gZnVuY3Rpb24oKSB7CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJNZWRpYSIsICJyZWxlYXNlIiwgW3RoaXMuaWRdKTsKfTsKCi8qKgogKiBMaXN0IG9mIG1lZGlhIG9iamVjdHMuCiAqIFBSSVZBVEUKICovClBob25lR2FwLm1lZGlhT2JqZWN0cyA9IHt9OwoKLyoqCiAqIE9iamVjdCB0aGF0IHJlY2VpdmVzIG5hdGl2ZSBjYWxsYmFja3MuCiAqIFBSSVZBVEUKICogQGNvbnN0cnVjdG9yCiAqLwpQaG9uZUdhcC5NZWRpYSA9IGZ1bmN0aW9uKCkge307CgovKioKICogR2V0IHRoZSBtZWRpYSBvYmplY3QuCiAqIFBSSVZBVEUKICoKICogQHBhcmFtIGlkICAgICAgICAgICAgVGhlIG1lZGlhIG9iamVjdCBpZCAoc3RyaW5nKQogKi8KUGhvbmVHYXAuTWVkaWEuZ2V0TWVkaWFPYmplY3QgPSBmdW5jdGlvbihpZCkgewogICAgcmV0dXJuIFBob25lR2FwLm1lZGlhT2JqZWN0c1tpZF07Cn07CgovKioKICogQXVkaW8gaGFzIHN0YXR1cyB1cGRhdGUuCiAqIFBSSVZBVEUKICoKICogQHBhcmFtIGlkICAgICAgICAgICAgVGhlIG1lZGlhIG9iamVjdCBpZCAoc3RyaW5nKQogKiBAcGFyYW0gc3RhdHVzICAgICAgICBUaGUgc3RhdHVzIGNvZGUgKGludCkKICogQHBhcmFtIG1zZyAgICAgICAgICAgVGhlIHN0YXR1cyBtZXNzYWdlIChzdHJpbmcpCiAqLwpQaG9uZUdhcC5NZWRpYS5vblN0YXR1cyA9IGZ1bmN0aW9uKGlkLCBtc2csIHZhbHVlKSB7CiAgICB2YXIgbWVkaWEgPSBQaG9uZUdhcC5tZWRpYU9iamVjdHNbaWRdOwogICAgLy8gSWYgc3RhdGUgdXBkYXRlCiAgICBpZiAobXNnID09PSBNZWRpYS5NRURJQV9TVEFURSkgewogICAgICAgIGlmICh2YWx1ZSA9PT0gTWVkaWEuTUVESUFfU1RPUFBFRCkgewogICAgICAgICAgICBpZiAobWVkaWEuc3VjY2Vzc0NhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBtZWRpYS5zdWNjZXNzQ2FsbGJhY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAobWVkaWEuc3RhdHVzQ2FsbGJhY2spIHsKICAgICAgICAgICAgbWVkaWEuc3RhdHVzQ2FsbGJhY2sodmFsdWUpOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgaWYgKG1zZyA9PT0gTWVkaWEuTUVESUFfRFVSQVRJT04pIHsKICAgICAgICBtZWRpYS5fZHVyYXRpb24gPSB2YWx1ZTsKICAgIH0KICAgIGVsc2UgaWYgKG1zZyA9PT0gTWVkaWEuTUVESUFfRVJST1IpIHsKICAgICAgICBpZiAobWVkaWEuZXJyb3JDYWxsYmFjaykgewogICAgICAgICAgICBtZWRpYS5lcnJvckNhbGxiYWNrKHZhbHVlKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIGlmIChtc2cgPT0gTWVkaWEuTUVESUFfUE9TSVRJT04pIHsKICAgICAgICBtZWRpYS5fcG9zaXRpb24gPSB2YWx1ZTsKICAgIH0KfTsKfQovKgogKiBQaG9uZUdhcCBpcyBhdmFpbGFibGUgdW5kZXIgKmVpdGhlciogdGhlIHRlcm1zIG9mIHRoZSBtb2RpZmllZCBCU0QgbGljZW5zZSAqb3IqIHRoZQogKiBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvYWxwaGFiZXRpY2FsIGZvciBmdWxsIHRleHQuCiAqCiAqIENvcHlyaWdodCAoYykgMjAwNS0yMDEwLCBOaXRvYmkgU29mdHdhcmUgSW5jLgogKiBDb3B5cmlnaHQgKGMpIDIwMTAtMjAxMSwgSUJNIENvcnBvcmF0aW9uCiAqLwoKaWYgKCFQaG9uZUdhcC5oYXNSZXNvdXJjZSgibmV0d29yayIpKSB7ClBob25lR2FwLmFkZFJlc291cmNlKCJuZXR3b3JrIik7CgovKioKICogVGhpcyBjbGFzcyBjb250YWlucyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgY3VycmVudCBuZXR3b3JrIENvbm5lY3Rpb24uCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIENvbm5lY3Rpb24gPSBmdW5jdGlvbigpIHsKICAgIHRoaXMudHlwZSA9IG51bGw7CiAgICB0aGlzLl9maXJzdFJ1biA9IHRydWU7CiAgICB0aGlzLl90aW1lciA9IG51bGw7CiAgICB0aGlzLnRpbWVvdXQgPSA1MDA7CgogICAgdmFyIG1lID0gdGhpczsKICAgIHRoaXMuZ2V0SW5mbygKICAgICAgICBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICAgIC8vIE5lZWQgdG8gc2VuZCBldmVudHMgaWYgd2UgYXJlIG9uIG9yIG9mZmxpbmUKICAgICAgICAgICAgaWYgKHR5cGUgPT0gIm5vbmUiKSB7CiAgICAgICAgICAgICAgICAvLyBzZXQgYSB0aW1lciBpZiBzdGlsbCBvZmZsaW5lIGF0IHRoZSBlbmQgb2YgdGltZXIgc2VuZCB0aGUgb2ZmbGluZSBldmVudAogICAgICAgICAgICAgICAgbWUuX3RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIG1lLnR5cGUgPSB0eXBlOwogICAgICAgICAgICAgICAgICAgIFBob25lR2FwLmZpcmVFdmVudCgnb2ZmbGluZScpOwogICAgICAgICAgICAgICAgICAgIG1lLl90aW1lciA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfSwgbWUudGltZW91dCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIGN1cnJlbnQgb2ZmbGluZSBldmVudCBwZW5kaW5nIGNsZWFyIGl0CiAgICAgICAgICAgICAgICBpZiAobWUuX3RpbWVyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobWUuX3RpbWVyKTsKICAgICAgICAgICAgICAgICAgICBtZS5fdGltZXIgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWUudHlwZSA9IHR5cGU7CiAgICAgICAgICAgICAgICBQaG9uZUdhcC5maXJlRXZlbnQoJ29ubGluZScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBzaG91bGQgb25seSBmaXJlIHRoaXMgb25jZQogICAgICAgICAgICBpZiAobWUuX2ZpcnN0UnVuKSB7CiAgICAgICAgICAgICAgICBtZS5fZmlyc3RSdW4gPSBmYWxzZTsKICAgICAgICAgICAgICAgIFBob25lR2FwLm9uUGhvbmVHYXBDb25uZWN0aW9uUmVhZHkuZmlyZSgpOwogICAgICAgICAgICB9ICAgICAgICAgICAgCiAgICAgICAgfSwKICAgICAgICBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJFcnJvciBpbml0aWFsaXppbmcgTmV0d29yayBDb25uZWN0aW9uOiAiICsgZSk7CiAgICAgICAgfSk7Cn07CgpDb25uZWN0aW9uLlVOS05PV04gPSAidW5rbm93biI7CkNvbm5lY3Rpb24uRVRIRVJORVQgPSAiZXRoZXJuZXQiOwpDb25uZWN0aW9uLldJRkkgPSAid2lmaSI7CkNvbm5lY3Rpb24uQ0VMTF8yRyA9ICIyZyI7CkNvbm5lY3Rpb24uQ0VMTF8zRyA9ICIzZyI7CkNvbm5lY3Rpb24uQ0VMTF80RyA9ICI0ZyI7CkNvbm5lY3Rpb24uTk9ORSA9ICJub25lIjsKCi8qKgogKiBHZXQgY29ubmVjdGlvbiBpbmZvCiAqCiAqIEBwYXJhbSB7RnVuY3Rpb259IHN1Y2Nlc3NDYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZSBDb25uZWN0aW9uIGRhdGEgaXMgYXZhaWxhYmxlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGVyZSBpcyBhbiBlcnJvciBnZXR0aW5nIHRoZSBDb25uZWN0aW9uIGRhdGEuIChPUFRJT05BTCkKICovCkNvbm5lY3Rpb24ucHJvdG90eXBlLmdldEluZm8gPSBmdW5jdGlvbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHsKICAgIC8vIEdldCBpbmZvCiAgICBQaG9uZUdhcC5leGVjKHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaywgIk5ldHdvcmsgU3RhdHVzIiwgImdldENvbm5lY3Rpb25JbmZvIiwgW10pOwp9OwoKClBob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCkgewogICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IubmV0d29yayA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBuYXZpZ2F0b3IubmV0d29yayA9IG5ldyBPYmplY3QoKTsKICAgIH0KICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yLm5ldHdvcmsuY29ubmVjdGlvbiA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBuYXZpZ2F0b3IubmV0d29yay5jb25uZWN0aW9uID0gbmV3IENvbm5lY3Rpb24oKTsKICAgIH0KfSk7Cn0KLyoKICogUGhvbmVHYXAgaXMgYXZhaWxhYmxlIHVuZGVyICplaXRoZXIqIHRoZSB0ZXJtcyBvZiB0aGUgbW9kaWZpZWQgQlNEIGxpY2Vuc2UgKm9yKiB0aGUKICogTUlUIExpY2Vuc2UgKDIwMDgpLiBTZWUgaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL2FscGhhYmV0aWNhbCBmb3IgZnVsbCB0ZXh0LgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDUtMjAxMCwgTml0b2JpIFNvZnR3YXJlIEluYy4KICogQ29weXJpZ2h0IChjKSAyMDEwLTIwMTEsIElCTSBDb3Jwb3JhdGlvbgogKi8KCmlmICghUGhvbmVHYXAuaGFzUmVzb3VyY2UoIm5vdGlmaWNhdGlvbiIpKSB7ClBob25lR2FwLmFkZFJlc291cmNlKCJub3RpZmljYXRpb24iKTsKCi8qKgogKiBUaGlzIGNsYXNzIHByb3ZpZGVzIGFjY2VzcyB0byBub3RpZmljYXRpb25zIG9uIHRoZSBkZXZpY2UuCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIE5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uKCkgewp9OwoKLyoqCiAqIE9wZW4gYSBuYXRpdmUgYWxlcnQgZGlhbG9nLCB3aXRoIGEgY3VzdG9taXphYmxlIHRpdGxlIGFuZCBidXR0b24gdGV4dC4KICoKICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgICAgICAgICAgICAgIE1lc3NhZ2UgdG8gcHJpbnQgaW4gdGhlIGJvZHkgb2YgdGhlIGFsZXJ0CiAqIEBwYXJhbSB7RnVuY3Rpb259IGNvbXBsZXRlQ2FsbGJhY2sgICBUaGUgY2FsbGJhY2sgdGhhdCBpcyBjYWxsZWQgd2hlbiB1c2VyIGNsaWNrcyBvbiBhIGJ1dHRvbi4KICogQHBhcmFtIHtTdHJpbmd9IHRpdGxlICAgICAgICAgICAgICAgIFRpdGxlIG9mIHRoZSBhbGVydCBkaWFsb2cgKGRlZmF1bHQ6IEFsZXJ0KQogKiBAcGFyYW0ge1N0cmluZ30gYnV0dG9uTGFiZWwgICAgICAgICAgTGFiZWwgb2YgdGhlIGNsb3NlIGJ1dHRvbiAoZGVmYXVsdDogT0spCiAqLwpOb3RpZmljYXRpb24ucHJvdG90eXBlLmFsZXJ0ID0gZnVuY3Rpb24obWVzc2FnZSwgY29tcGxldGVDYWxsYmFjaywgdGl0bGUsIGJ1dHRvbkxhYmVsKSB7CiAgICB2YXIgX3RpdGxlID0gKHRpdGxlIHx8ICJBbGVydCIpOwogICAgdmFyIF9idXR0b25MYWJlbCA9IChidXR0b25MYWJlbCB8fCAiT0siKTsKICAgIFBob25lR2FwLmV4ZWMoY29tcGxldGVDYWxsYmFjaywgbnVsbCwgIk5vdGlmaWNhdGlvbiIsICJhbGVydCIsIFttZXNzYWdlLF90aXRsZSxfYnV0dG9uTGFiZWxdKTsKfTsKCi8qKgogKiBPcGVuIGEgbmF0aXZlIGNvbmZpcm0gZGlhbG9nLCB3aXRoIGEgY3VzdG9taXphYmxlIHRpdGxlIGFuZCBidXR0b24gdGV4dC4KICogVGhlIHJlc3VsdCB0aGF0IHRoZSB1c2VyIHNlbGVjdHMgaXMgcmV0dXJuZWQgdG8gdGhlIHJlc3VsdCBjYWxsYmFjay4KICoKICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgICAgICAgICAgICAgIE1lc3NhZ2UgdG8gcHJpbnQgaW4gdGhlIGJvZHkgb2YgdGhlIGFsZXJ0CiAqIEBwYXJhbSB7RnVuY3Rpb259IHJlc3VsdENhbGxiYWNrICAgICBUaGUgY2FsbGJhY2sgdGhhdCBpcyBjYWxsZWQgd2hlbiB1c2VyIGNsaWNrcyBvbiBhIGJ1dHRvbi4KICogQHBhcmFtIHtTdHJpbmd9IHRpdGxlICAgICAgICAgICAgICAgIFRpdGxlIG9mIHRoZSBhbGVydCBkaWFsb2cgKGRlZmF1bHQ6IENvbmZpcm0pCiAqIEBwYXJhbSB7U3RyaW5nfSBidXR0b25MYWJlbHMgICAgICAgICBDb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiB0aGUgbGFiZWxzIG9mIHRoZSBidXR0b25zIChkZWZhdWx0OiAnT0ssQ2FuY2VsJykKICovCk5vdGlmaWNhdGlvbi5wcm90b3R5cGUuY29uZmlybSA9IGZ1bmN0aW9uKG1lc3NhZ2UsIHJlc3VsdENhbGxiYWNrLCB0aXRsZSwgYnV0dG9uTGFiZWxzKSB7CiAgICB2YXIgX3RpdGxlID0gKHRpdGxlIHx8ICJDb25maXJtIik7CiAgICB2YXIgX2J1dHRvbkxhYmVscyA9IChidXR0b25MYWJlbHMgfHwgIk9LLENhbmNlbCIpOwogICAgUGhvbmVHYXAuZXhlYyhyZXN1bHRDYWxsYmFjaywgbnVsbCwgIk5vdGlmaWNhdGlvbiIsICJjb25maXJtIiwgW21lc3NhZ2UsX3RpdGxlLF9idXR0b25MYWJlbHNdKTsKfTsKCi8qKgogKiBTdGFydCBzcGlubmluZyB0aGUgYWN0aXZpdHkgaW5kaWNhdG9yIG9uIHRoZSBzdGF0dXNiYXIKICovCk5vdGlmaWNhdGlvbi5wcm90b3R5cGUuYWN0aXZpdHlTdGFydCA9IGZ1bmN0aW9uKCkgewogICAgUGhvbmVHYXAuZXhlYyhudWxsLCBudWxsLCAiTm90aWZpY2F0aW9uIiwgImFjdGl2aXR5U3RhcnQiLCBbIkJ1c3kiLCJQbGVhc2Ugd2FpdC4uLiJdKTsKfTsKCi8qKgogKiBTdG9wIHNwaW5uaW5nIHRoZSBhY3Rpdml0eSBpbmRpY2F0b3Igb24gdGhlIHN0YXR1c2JhciwgaWYgaXQncyBjdXJyZW50bHkgc3Bpbm5pbmcKICovCk5vdGlmaWNhdGlvbi5wcm90b3R5cGUuYWN0aXZpdHlTdG9wID0gZnVuY3Rpb24oKSB7CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJOb3RpZmljYXRpb24iLCAiYWN0aXZpdHlTdG9wIiwgW10pOwp9OwoKLyoqCiAqIERpc3BsYXkgYSBwcm9ncmVzcyBkaWFsb2cgd2l0aCBwcm9ncmVzcyBiYXIgdGhhdCBnb2VzIGZyb20gMCB0byAxMDAuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSB0aXRsZSAgICAgICAgVGl0bGUgb2YgdGhlIHByb2dyZXNzIGRpYWxvZy4KICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgICAgICBNZXNzYWdlIHRvIGRpc3BsYXkgaW4gdGhlIGRpYWxvZy4KICovCk5vdGlmaWNhdGlvbi5wcm90b3R5cGUucHJvZ3Jlc3NTdGFydCA9IGZ1bmN0aW9uKHRpdGxlLCBtZXNzYWdlKSB7CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJOb3RpZmljYXRpb24iLCAicHJvZ3Jlc3NTdGFydCIsIFt0aXRsZSwgbWVzc2FnZV0pOwp9OwoKLyoqCiAqIFNldCB0aGUgcHJvZ3Jlc3MgZGlhbG9nIHZhbHVlLgogKgogKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgICAgICAgICAwLTEwMAogKi8KTm90aWZpY2F0aW9uLnByb3RvdHlwZS5wcm9ncmVzc1ZhbHVlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIk5vdGlmaWNhdGlvbiIsICJwcm9ncmVzc1ZhbHVlIiwgW3ZhbHVlXSk7Cn07CgovKioKICogQ2xvc2UgdGhlIHByb2dyZXNzIGRpYWxvZy4KICovCk5vdGlmaWNhdGlvbi5wcm90b3R5cGUucHJvZ3Jlc3NTdG9wID0gZnVuY3Rpb24oKSB7CiAgICBQaG9uZUdhcC5leGVjKG51bGwsIG51bGwsICJOb3RpZmljYXRpb24iLCAicHJvZ3Jlc3NTdG9wIiwgW10pOwp9OwoKLyoqCiAqIENhdXNlcyB0aGUgZGV2aWNlIHRvIGJsaW5rIGEgc3RhdHVzIExFRC4KICoKICogQHBhcmFtIHtJbnRlZ2VyfSBjb3VudCAgICAgICBUaGUgbnVtYmVyIG9mIGJsaW5rcy4KICogQHBhcmFtIHtTdHJpbmd9IGNvbG91ciAgICAgICBUaGUgY29sb3VyIG9mIHRoZSBsaWdodC4KICovCk5vdGlmaWNhdGlvbi5wcm90b3R5cGUuYmxpbmsgPSBmdW5jdGlvbihjb3VudCwgY29sb3VyKSB7CiAgICAvLyBOT1QgSU1QTEVNRU5URUQKfTsKCi8qKgogKiBDYXVzZXMgdGhlIGRldmljZSB0byB2aWJyYXRlLgogKgogKiBAcGFyYW0ge0ludGVnZXJ9IG1pbGxzICAgICAgIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHZpYnJhdGUgZm9yLgogKi8KTm90aWZpY2F0aW9uLnByb3RvdHlwZS52aWJyYXRlID0gZnVuY3Rpb24obWlsbHMpIHsKICAgIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIk5vdGlmaWNhdGlvbiIsICJ2aWJyYXRlIiwgW21pbGxzXSk7Cn07CgovKioKICogQ2F1c2VzIHRoZSBkZXZpY2UgdG8gYmVlcC4KICogT24gQW5kcm9pZCwgdGhlIGRlZmF1bHQgbm90aWZpY2F0aW9uIHJpbmd0b25lIGlzIHBsYXllZCAiY291bnQiIHRpbWVzLgogKgogKiBAcGFyYW0ge0ludGVnZXJ9IGNvdW50ICAgICAgIFRoZSBudW1iZXIgb2YgYmVlcHMuCiAqLwpOb3RpZmljYXRpb24ucHJvdG90eXBlLmJlZXAgPSBmdW5jdGlvbihjb3VudCkgewogICAgUGhvbmVHYXAuZXhlYyhudWxsLCBudWxsLCAiTm90aWZpY2F0aW9uIiwgImJlZXAiLCBbY291bnRdKTsKfTsKClBob25lR2FwLmFkZENvbnN0cnVjdG9yKGZ1bmN0aW9uKCkgewogICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3Iubm90aWZpY2F0aW9uID09PSAidW5kZWZpbmVkIikgewogICAgICAgIG5hdmlnYXRvci5ub3RpZmljYXRpb24gPSBuZXcgTm90aWZpY2F0aW9uKCk7CiAgICB9Cn0pOwp9Ci8qCiAqIFBob25lR2FwIGlzIGF2YWlsYWJsZSB1bmRlciAqZWl0aGVyKiB0aGUgdGVybXMgb2YgdGhlIG1vZGlmaWVkIEJTRCBsaWNlbnNlICpvciogdGhlCiAqIE1JVCBMaWNlbnNlICgyMDA4KS4gU2VlIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9hbHBoYWJldGljYWwgZm9yIGZ1bGwgdGV4dC4KICoKICogQ29weXJpZ2h0IChjKSAyMDA1LTIwMTAsIE5pdG9iaSBTb2Z0d2FyZSBJbmMuCiAqIENvcHlyaWdodCAoYykgMjAxMC0yMDExLCBJQk0gQ29ycG9yYXRpb24KICovCgppZiAoIVBob25lR2FwLmhhc1Jlc291cmNlKCJwb3NpdGlvbiIpKSB7ClBob25lR2FwLmFkZFJlc291cmNlKCJwb3NpdGlvbiIpOwoKLyoqCiAqIFRoaXMgY2xhc3MgY29udGFpbnMgcG9zaXRpb24gaW5mb3JtYXRpb24uCiAqIEBwYXJhbSB7T2JqZWN0fSBsYXQKICogQHBhcmFtIHtPYmplY3R9IGxuZwogKiBAcGFyYW0ge09iamVjdH0gYWNjCiAqIEBwYXJhbSB7T2JqZWN0fSBhbHQKICogQHBhcmFtIHtPYmplY3R9IGFsdGFjYwogKiBAcGFyYW0ge09iamVjdH0gaGVhZAogKiBAcGFyYW0ge09iamVjdH0gdmVsCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIFBvc2l0aW9uID0gZnVuY3Rpb24oY29vcmRzLCB0aW1lc3RhbXApIHsKCXRoaXMuY29vcmRzID0gY29vcmRzOwoJdGhpcy50aW1lc3RhbXAgPSAodGltZXN0YW1wICE9PSAndW5kZWZpbmVkJykgPyB0aW1lc3RhbXAgOiBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKfTsKCi8qKiBAY29uc3RydWN0b3IgKi8KdmFyIENvb3JkaW5hdGVzID0gZnVuY3Rpb24obGF0LCBsbmcsIGFsdCwgYWNjLCBoZWFkLCB2ZWwsIGFsdGFjYykgewoJLyoqCgkgKiBUaGUgbGF0aXR1ZGUgb2YgdGhlIHBvc2l0aW9uLgoJICovCgl0aGlzLmxhdGl0dWRlID0gbGF0OwoJLyoqCgkgKiBUaGUgbG9uZ2l0dWRlIG9mIHRoZSBwb3NpdGlvbiwKCSAqLwoJdGhpcy5sb25naXR1ZGUgPSBsbmc7CgkvKioKCSAqIFRoZSBhY2N1cmFjeSBvZiB0aGUgcG9zaXRpb24uCgkgKi8KCXRoaXMuYWNjdXJhY3kgPSBhY2M7CgkvKioKCSAqIFRoZSBhbHRpdHVkZSBvZiB0aGUgcG9zaXRpb24uCgkgKi8KCXRoaXMuYWx0aXR1ZGUgPSBhbHQ7CgkvKioKCSAqIFRoZSBkaXJlY3Rpb24gdGhlIGRldmljZSBpcyBtb3ZpbmcgYXQgdGhlIHBvc2l0aW9uLgoJICovCgl0aGlzLmhlYWRpbmcgPSBoZWFkOwoJLyoqCgkgKiBUaGUgdmVsb2NpdHkgd2l0aCB3aGljaCB0aGUgZGV2aWNlIGlzIG1vdmluZyBhdCB0aGUgcG9zaXRpb24uCgkgKi8KCXRoaXMuc3BlZWQgPSB2ZWw7CgkvKioKCSAqIFRoZSBhbHRpdHVkZSBhY2N1cmFjeSBvZiB0aGUgcG9zaXRpb24uCgkgKi8KCXRoaXMuYWx0aXR1ZGVBY2N1cmFjeSA9IChhbHRhY2MgIT09ICd1bmRlZmluZWQnKSA/IGFsdGFjYyA6IG51bGw7Cn07CgovKioKICogVGhpcyBjbGFzcyBzcGVjaWZpZXMgdGhlIG9wdGlvbnMgZm9yIHJlcXVlc3RpbmcgcG9zaXRpb24gZGF0YS4KICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgUG9zaXRpb25PcHRpb25zID0gZnVuY3Rpb24oKSB7CgkvKioKCSAqIFNwZWNpZmllcyB0aGUgZGVzaXJlZCBwb3NpdGlvbiBhY2N1cmFjeS4KCSAqLwoJdGhpcy5lbmFibGVIaWdoQWNjdXJhY3kgPSB0cnVlOwoJLyoqCgkgKiBUaGUgdGltZW91dCBhZnRlciB3aGljaCBpZiBwb3NpdGlvbiBkYXRhIGNhbm5vdCBiZSBvYnRhaW5lZCB0aGUgZXJyb3JDYWxsYmFjawoJICogaXMgY2FsbGVkLgoJICovCgl0aGlzLnRpbWVvdXQgPSAxMDAwMDsKfTsKCi8qKgogKiBUaGlzIGNsYXNzIGNvbnRhaW5zIGluZm9ybWF0aW9uIGFib3V0IGFueSBHU1AgZXJyb3JzLgogKiBAY29uc3RydWN0b3IKICovCnZhciBQb3NpdGlvbkVycm9yID0gZnVuY3Rpb24oKSB7Cgl0aGlzLmNvZGUgPSBudWxsOwoJdGhpcy5tZXNzYWdlID0gIiI7Cn07CgpQb3NpdGlvbkVycm9yLlVOS05PV05fRVJST1IgPSAwOwpQb3NpdGlvbkVycm9yLlBFUk1JU1NJT05fREVOSUVEID0gMTsKUG9zaXRpb25FcnJvci5QT1NJVElPTl9VTkFWQUlMQUJMRSA9IDI7ClBvc2l0aW9uRXJyb3IuVElNRU9VVCA9IDM7Cn0KLyoKICogUGhvbmVHYXAgaXMgYXZhaWxhYmxlIHVuZGVyICplaXRoZXIqIHRoZSB0ZXJtcyBvZiB0aGUgbW9kaWZpZWQgQlNEIGxpY2Vuc2UgKm9yKiB0aGUKICogTUlUIExpY2Vuc2UgKDIwMDgpLiBTZWUgaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL2FscGhhYmV0aWNhbCBmb3IgZnVsbCB0ZXh0LgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDUtMjAxMCwgTml0b2JpIFNvZnR3YXJlIEluYy4KICogQ29weXJpZ2h0IChjKSAyMDEwLTIwMTEsIElCTSBDb3Jwb3JhdGlvbgogKi8KCi8qCiAqIFRoaXMgaXMgcHVyZWx5IGZvciB0aGUgQW5kcm9pZCAxLjUvMS42IEhUTUwgNSBTdG9yYWdlCiAqIEkgd2FzIGhvcGluZyB0aGF0IEFuZHJvaWQgMi4wIHdvdWxkIGRlcHJlY2F0ZSB0aGlzLCBidXQgZ2l2ZW4gdGhlIGZhY3QgdGhhdAogKiBtb3N0IG1hbnVmYWN0dXJlcnMgc2hpcCB3aXRoIEFuZHJvaWQgMS41IGFuZCBkbyBub3QgZG8gT1RBIFVwZGF0ZXMsIHRoaXMgaXMgcmVxdWlyZWQKICovCgppZiAoIVBob25lR2FwLmhhc1Jlc291cmNlKCJzdG9yYWdlIikpIHsKUGhvbmVHYXAuYWRkUmVzb3VyY2UoInN0b3JhZ2UiKTsKCi8qKgogKiBTUUwgcmVzdWx0IHNldCBvYmplY3QKICogUFJJVkFURSBNRVRIT0QKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgRHJvaWREQl9Sb3dzID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLnJlc3VsdFNldCA9IFtdOyAgICAvLyByZXN1bHRzIGFycmF5CiAgICB0aGlzLmxlbmd0aCA9IDA7ICAgICAgICAvLyBudW1iZXIgb2Ygcm93cwp9OwoKLyoqCiAqIEdldCBpdGVtIGZyb20gU1FMIHJlc3VsdCBzZXQKICoKICogQHBhcmFtIHJvdyAgICAgICAgICAgVGhlIHJvdyBudW1iZXIgdG8gcmV0dXJuCiAqIEByZXR1cm4gICAgICAgICAgICAgIFRoZSByb3cgb2JqZWN0CiAqLwpEcm9pZERCX1Jvd3MucHJvdG90eXBlLml0ZW0gPSBmdW5jdGlvbihyb3cpIHsKICAgIHJldHVybiB0aGlzLnJlc3VsdFNldFtyb3ddOwp9OwoKLyoqCiAqIFNRTCByZXN1bHQgc2V0IHRoYXQgaXMgcmV0dXJuZWQgdG8gdXNlci4KICogUFJJVkFURSBNRVRIT0QKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgRHJvaWREQl9SZXN1bHQgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMucm93cyA9IG5ldyBEcm9pZERCX1Jvd3MoKTsKfTsKCi8qKgogKiBTdG9yYWdlIG9iamVjdCB0aGF0IGlzIGNhbGxlZCBieSBuYXRpdmUgY29kZSB3aGVuIHBlcmZvcm1pbmcgcXVlcmllcy4KICogUFJJVkFURSBNRVRIT0QKICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgRHJvaWREQiA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5xdWVyeVF1ZXVlID0ge307Cn07CgovKioKICogQ2FsbGJhY2sgZnJvbSBuYXRpdmUgY29kZSB3aGVuIHF1ZXJ5IGlzIGNvbXBsZXRlLgogKiBQUklWQVRFIE1FVEhPRAogKgogKiBAcGFyYW0gaWQgICAgICAgICAgICAgICAgUXVlcnkgaWQKICovCkRyb2lkREIucHJvdG90eXBlLmNvbXBsZXRlUXVlcnkgPSBmdW5jdGlvbihpZCwgZGF0YSkgewogICAgdmFyIHF1ZXJ5ID0gdGhpcy5xdWVyeVF1ZXVlW2lkXTsKICAgIGlmIChxdWVyeSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnF1ZXJ5UXVldWVbaWRdOwoKICAgICAgICAgICAgLy8gR2V0IHRyYW5zYWN0aW9uCiAgICAgICAgICAgIHZhciB0eCA9IHF1ZXJ5LnR4OwoKICAgICAgICAgICAgLy8gSWYgdHJhbnNhY3Rpb24gaGFzbid0IGZhaWxlZAogICAgICAgICAgICAvLyBOb3RlOiBXZSBpZ25vcmUgYWxsIHF1ZXJ5IHJlc3VsdHMgaWYgcHJldmlvdXMgcXVlcnkKICAgICAgICAgICAgLy8gICAgICAgaW4gdGhlIHNhbWUgdHJhbnNhY3Rpb24gZmFpbGVkLgogICAgICAgICAgICBpZiAodHggJiYgdHgucXVlcnlMaXN0W2lkXSkgewoKICAgICAgICAgICAgICAgIC8vIFNhdmUgcXVlcnkgcmVzdWx0cwogICAgICAgICAgICAgICAgdmFyIHIgPSBuZXcgRHJvaWREQl9SZXN1bHQoKTsKICAgICAgICAgICAgICAgIHIucm93cy5yZXN1bHRTZXQgPSBkYXRhOwogICAgICAgICAgICAgICAgci5yb3dzLmxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHF1ZXJ5LnN1Y2Nlc3NDYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeS5zdWNjZXNzQ2FsbGJhY2socXVlcnkudHgsIHIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImV4ZWN1dGVTcWwgZXJyb3IgY2FsbGluZyB1c2VyIHN1Y2Nlc3MgY2FsbGJhY2s6ICIrZXgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHR4LnF1ZXJ5Q29tcGxldGUoaWQpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiZXhlY3V0ZVNxbCBlcnJvcjogIitlKTsKICAgICAgICB9CiAgICB9Cn07CgovKioKICogQ2FsbGJhY2sgZnJvbSBuYXRpdmUgY29kZSB3aGVuIHF1ZXJ5IGZhaWxzCiAqIFBSSVZBVEUgTUVUSE9ECiAqCiAqIEBwYXJhbSByZWFzb24gICAgICAgICAgICBFcnJvciBtZXNzYWdlCiAqIEBwYXJhbSBpZCAgICAgICAgICAgICAgICBRdWVyeSBpZAogKi8KRHJvaWREQi5wcm90b3R5cGUuZmFpbCA9IGZ1bmN0aW9uKHJlYXNvbiwgaWQpIHsKICAgIHZhciBxdWVyeSA9IHRoaXMucXVlcnlRdWV1ZVtpZF07CiAgICBpZiAocXVlcnkpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBkZWxldGUgdGhpcy5xdWVyeVF1ZXVlW2lkXTsKCiAgICAgICAgICAgIC8vIEdldCB0cmFuc2FjdGlvbgogICAgICAgICAgICB2YXIgdHggPSBxdWVyeS50eDsKCiAgICAgICAgICAgIC8vIElmIHRyYW5zYWN0aW9uIGhhc24ndCBmYWlsZWQKICAgICAgICAgICAgLy8gTm90ZTogV2UgaWdub3JlIGFsbCBxdWVyeSByZXN1bHRzIGlmIHByZXZpb3VzIHF1ZXJ5CiAgICAgICAgICAgIC8vICAgICAgIGluIHRoZSBzYW1lIHRyYW5zYWN0aW9uIGZhaWxlZC4KICAgICAgICAgICAgaWYgKHR4ICYmIHR4LnF1ZXJ5TGlzdFtpZF0pIHsKICAgICAgICAgICAgICAgIHR4LnF1ZXJ5TGlzdCA9IHt9OwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBxdWVyeS5lcnJvckNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5LmVycm9yQ2FsbGJhY2socXVlcnkudHgsIHJlYXNvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZXhlY3V0ZVNxbCBlcnJvciBjYWxsaW5nIHVzZXIgZXJyb3IgY2FsbGJhY2s6ICIrZXgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHR4LnF1ZXJ5RmFpbGVkKGlkLCByZWFzb24pOwogICAgICAgICAgICB9CgogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImV4ZWN1dGVTcWwgZXJyb3I6ICIrZSk7CiAgICAgICAgfQogICAgfQp9OwoKLyoqCiAqIFNRTCBxdWVyeSBvYmplY3QKICogUFJJVkFURSBNRVRIT0QKICoKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSB0eCAgICAgICAgICAgICAgICBUaGUgdHJhbnNhY3Rpb24gb2JqZWN0IHRoYXQgdGhpcyBxdWVyeSBiZWxvbmdzIHRvCiAqLwp2YXIgRHJvaWREQl9RdWVyeSA9IGZ1bmN0aW9uKHR4KSB7CgogICAgLy8gU2V0IHRoZSBpZCBvZiB0aGUgcXVlcnkKICAgIHRoaXMuaWQgPSBQaG9uZUdhcC5jcmVhdGVVVUlEKCk7CgogICAgLy8gQWRkIHRoaXMgcXVlcnkgdG8gdGhlIHF1ZXVlCiAgICBkcm9pZGRiLnF1ZXJ5UXVldWVbdGhpcy5pZF0gPSB0aGlzOwoKICAgIC8vIEluaXQgcmVzdWx0CiAgICB0aGlzLnJlc3VsdFNldCA9IFtdOwoKICAgIC8vIFNldCB0cmFuc2FjdGlvbiB0aGF0IHRoaXMgcXVlcnkgYmVsb25ncyB0bwogICAgdGhpcy50eCA9IHR4OwoKICAgIC8vIEFkZCB0aGlzIHF1ZXJ5IHRvIHRyYW5zYWN0aW9uIGxpc3QKICAgIHRoaXMudHgucXVlcnlMaXN0W3RoaXMuaWRdID0gdGhpczsKCiAgICAvLyBDYWxsYmFja3MKICAgIHRoaXMuc3VjY2Vzc0NhbGxiYWNrID0gbnVsbDsKICAgIHRoaXMuZXJyb3JDYWxsYmFjayA9IG51bGw7Cgp9OwoKLyoqCiAqIFRyYW5zYWN0aW9uIG9iamVjdAogKiBQUklWQVRFIE1FVEhPRAogKiBAY29uc3RydWN0b3IKICovCnZhciBEcm9pZERCX1R4ID0gZnVuY3Rpb24oKSB7CgogICAgLy8gU2V0IHRoZSBpZCBvZiB0aGUgdHJhbnNhY3Rpb24KICAgIHRoaXMuaWQgPSBQaG9uZUdhcC5jcmVhdGVVVUlEKCk7CgogICAgLy8gQ2FsbGJhY2tzCiAgICB0aGlzLnN1Y2Nlc3NDYWxsYmFjayA9IG51bGw7CiAgICB0aGlzLmVycm9yQ2FsbGJhY2sgPSBudWxsOwoKICAgIC8vIFF1ZXJ5IGxpc3QKICAgIHRoaXMucXVlcnlMaXN0ID0ge307Cn07CgovKioKICogTWFyayBxdWVyeSBpbiB0cmFuc2FjdGlvbiBhcyBjb21wbGV0ZS4KICogSWYgYWxsIHF1ZXJpZXMgYXJlIGNvbXBsZXRlLCBjYWxsIHRoZSB1c2VyJ3MgdHJhbnNhY3Rpb24gc3VjY2VzcyBjYWxsYmFjay4KICoKICogQHBhcmFtIGlkICAgICAgICAgICAgICAgIFF1ZXJ5IGlkCiAqLwpEcm9pZERCX1R4LnByb3RvdHlwZS5xdWVyeUNvbXBsZXRlID0gZnVuY3Rpb24oaWQpIHsKICAgIGRlbGV0ZSB0aGlzLnF1ZXJ5TGlzdFtpZF07CgogICAgLy8gSWYgbm8gbW9yZSBvdXRzdGFuZGluZyBxdWVyaWVzLCB0aGVuIGZpcmUgdHJhbnNhY3Rpb24gc3VjY2VzcwogICAgaWYgKHRoaXMuc3VjY2Vzc0NhbGxiYWNrKSB7CiAgICAgICAgdmFyIGNvdW50ID0gMDsKICAgICAgICB2YXIgaTsKICAgICAgICBmb3IgKGkgaW4gdGhpcy5xdWVyeUxpc3QpIHsKICAgICAgICAgICAgaWYgKHRoaXMucXVlcnlMaXN0Lmhhc093blByb3BlcnR5KGkpKSB7CiAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChjb3VudCA9PT0gMCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdGhpcy5zdWNjZXNzQ2FsbGJhY2soKTsKICAgICAgICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiVHJhbnNhY3Rpb24gZXJyb3IgY2FsbGluZyB1c2VyIHN1Y2Nlc3MgY2FsbGJhY2s6ICIgKyBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfTsKCi8qKgogKiBNYXJrIHF1ZXJ5IGluIHRyYW5zYWN0aW9uIGFzIGZhaWxlZC4KICoKICogQHBhcmFtIGlkICAgICAgICAgICAgICAgIFF1ZXJ5IGlkCiAqIEBwYXJhbSByZWFzb24gICAgICAgICAgICBFcnJvciBtZXNzYWdlCiAqLwpEcm9pZERCX1R4LnByb3RvdHlwZS5xdWVyeUZhaWxlZCA9IGZ1bmN0aW9uKGlkLCByZWFzb24pIHsKCiAgICAvLyBUaGUgc3FsIHF1ZXJpZXMgaW4gdGhpcyB0cmFuc2FjdGlvbiBoYXZlIGFscmVhZHkgYmVlbiBydW4sIHNpbmNlCiAgICAvLyB3ZSByZWFsbHkgZG9uJ3QgaGF2ZSBhIHJlYWwgdHJhbnNhY3Rpb24gaW1wbGVtZW50ZWQgaW4gbmF0aXZlIGNvZGUuCiAgICAvLyBIb3dldmVyLCB0aGUgdXNlciBjYWxsYmFja3MgZm9yIHRoZSByZW1haW5pbmcgc3FsIHF1ZXJpZXMgaW4gdHJhbnNhY3Rpb24KICAgIC8vIHdpbGwgbm90IGJlIGNhbGxlZC4KICAgIHRoaXMucXVlcnlMaXN0ID0ge307CgogICAgaWYgKHRoaXMuZXJyb3JDYWxsYmFjaykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3JDYWxsYmFjayhyZWFzb24pOwogICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiVHJhbnNhY3Rpb24gZXJyb3IgY2FsbGluZyB1c2VyIGVycm9yIGNhbGxiYWNrOiAiICsgZSk7CiAgICAgICAgfQogICAgfQp9OwoKLyoqCiAqIEV4ZWN1dGUgU1FMIHN0YXRlbWVudAogKgogKiBAcGFyYW0gc3FsICAgICAgICAgICAgICAgICAgIFNRTCBzdGF0ZW1lbnQgdG8gZXhlY3V0ZQogKiBAcGFyYW0gcGFyYW1zICAgICAgICAgICAgICAgIFN0YXRlbWVudCBwYXJhbWV0ZXJzCiAqIEBwYXJhbSBzdWNjZXNzQ2FsbGJhY2sgICAgICAgU3VjY2VzcyBjYWxsYmFjawogKiBAcGFyYW0gZXJyb3JDYWxsYmFjayAgICAgICAgIEVycm9yIGNhbGxiYWNrCiAqLwpEcm9pZERCX1R4LnByb3RvdHlwZS5leGVjdXRlU3FsID0gZnVuY3Rpb24oc3FsLCBwYXJhbXMsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewoKICAgIC8vIEluaXQgcGFyYW1zIGFycmF5CiAgICBpZiAodHlwZW9mIHBhcmFtcyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBwYXJhbXMgPSBbXTsKICAgIH0KCiAgICAvLyBDcmVhdGUgcXVlcnkgYW5kIGFkZCB0byBxdWV1ZQogICAgdmFyIHF1ZXJ5ID0gbmV3IERyb2lkREJfUXVlcnkodGhpcyk7CiAgICBkcm9pZGRiLnF1ZXJ5UXVldWVbcXVlcnkuaWRdID0gcXVlcnk7CgogICAgLy8gU2F2ZSBjYWxsYmFja3MKICAgIHF1ZXJ5LnN1Y2Nlc3NDYWxsYmFjayA9IHN1Y2Nlc3NDYWxsYmFjazsKICAgIHF1ZXJ5LmVycm9yQ2FsbGJhY2sgPSBlcnJvckNhbGxiYWNrOwoKICAgIC8vIENhbGwgbmF0aXZlIGNvZGUKICAgIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIlN0b3JhZ2UiLCAiZXhlY3V0ZVNxbCIsIFtzcWwsIHBhcmFtcywgcXVlcnkuaWRdKTsKfTsKCnZhciBEYXRhYmFzZVNoZWxsID0gZnVuY3Rpb24oKSB7Cn07CgovKioKICogU3RhcnQgYSB0cmFuc2FjdGlvbi4KICogRG9lcyBub3Qgc3VwcG9ydCByb2xsYmFjayBpbiBldmVudCBvZiBmYWlsdXJlLgogKgogKiBAcGFyYW0gcHJvY2VzcyB7RnVuY3Rpb259ICAgICAgICAgICAgVGhlIHRyYW5zYWN0aW9uIGZ1bmN0aW9uCiAqIEBwYXJhbSBzdWNjZXNzQ2FsbGJhY2sge0Z1bmN0aW9ufQogKiBAcGFyYW0gZXJyb3JDYWxsYmFjayB7RnVuY3Rpb259CiAqLwpEYXRhYmFzZVNoZWxsLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKHByb2Nlc3MsIGVycm9yQ2FsbGJhY2ssIHN1Y2Nlc3NDYWxsYmFjaykgewogICAgdmFyIHR4ID0gbmV3IERyb2lkREJfVHgoKTsKICAgIHR4LnN1Y2Nlc3NDYWxsYmFjayA9IHN1Y2Nlc3NDYWxsYmFjazsKICAgIHR4LmVycm9yQ2FsbGJhY2sgPSBlcnJvckNhbGxiYWNrOwogICAgdHJ5IHsKICAgICAgICBwcm9jZXNzKHR4KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmxvZygiVHJhbnNhY3Rpb24gZXJyb3I6ICIrZSk7CiAgICAgICAgaWYgKHR4LmVycm9yQ2FsbGJhY2spIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHR4LmVycm9yQ2FsbGJhY2soZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiVHJhbnNhY3Rpb24gZXJyb3IgY2FsbGluZyB1c2VyIGVycm9yIGNhbGxiYWNrOiAiK2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9OwoKLyoqCiAqIE9wZW4gZGF0YWJhc2UKICoKICogQHBhcmFtIG5hbWUgICAgICAgICAgICAgIERhdGFiYXNlIG5hbWUKICogQHBhcmFtIHZlcnNpb24gICAgICAgICAgIERhdGFiYXNlIHZlcnNpb24KICogQHBhcmFtIGRpc3BsYXlfbmFtZSAgICAgIERhdGFiYXNlIGRpc3BsYXkgbmFtZQogKiBAcGFyYW0gc2l6ZSAgICAgICAgICAgICAgRGF0YWJhc2Ugc2l6ZSBpbiBieXRlcwogKiBAcmV0dXJuICAgICAgICAgICAgICAgICAgRGF0YWJhc2Ugb2JqZWN0CiAqLwp2YXIgRHJvaWREQl9vcGVuRGF0YWJhc2UgPSBmdW5jdGlvbihuYW1lLCB2ZXJzaW9uLCBkaXNwbGF5X25hbWUsIHNpemUpIHsKICAgIFBob25lR2FwLmV4ZWMobnVsbCwgbnVsbCwgIlN0b3JhZ2UiLCAib3BlbkRhdGFiYXNlIiwgW25hbWUsIHZlcnNpb24sIGRpc3BsYXlfbmFtZSwgc2l6ZV0pOwogICAgdmFyIGRiID0gbmV3IERhdGFiYXNlU2hlbGwoKTsKICAgIHJldHVybiBkYjsKfTsKCi8qKgogKiBGb3IgYnJvd3NlcnMgd2l0aCBubyBsb2NhbFN0b3JhZ2Ugd2UgZW11bGF0ZSBpdCB3aXRoIFNRTGl0ZS4gRm9sbG93cyB0aGUgdzNjIGFwaS4KICogVE9ETzogRG8gc2ltaWxhciBmb3Igc2Vzc2lvblN0b3JhZ2UuCiAqLwoKLyoqCiAqIEBjb25zdHJ1Y3RvcgogKi8KdmFyIEN1cGNha2VMb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbigpIHsKCQl0cnkgewoKCQkJdGhpcy5kYiA9IG9wZW5EYXRhYmFzZSgnbG9jYWxTdG9yYWdlJywgJzEuMCcsICdsb2NhbFN0b3JhZ2UnLCAyNjIxNDQwKTsKCQkJdmFyIHN0b3JhZ2UgPSB7fTsKCQkJdGhpcy5sZW5ndGggPSAwOwoJCQlmdW5jdGlvbiBzZXRMZW5ndGggKGxlbmd0aCkgewoJCQkJdGhpcy5sZW5ndGggPSBsZW5ndGg7CgkJCQlsb2NhbFN0b3JhZ2UubGVuZ3RoID0gbGVuZ3RoOwoJCQl9CgkJCXRoaXMuZGIudHJhbnNhY3Rpb24oCgkJCQlmdW5jdGlvbiAodHJhbnNhY3Rpb24pIHsKCQkJCSAgICB2YXIgaTsKCQkJCQl0cmFuc2FjdGlvbi5leGVjdXRlU3FsKCdDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBzdG9yYWdlIChpZCBOVkFSQ0hBUig0MCkgUFJJTUFSWSBLRVksIGJvZHkgTlZBUkNIQVIoMjU1KSknKTsKCQkJCQl0cmFuc2FjdGlvbi5leGVjdXRlU3FsKCdTRUxFQ1QgKiBGUk9NIHN0b3JhZ2UnLCBbXSwgZnVuY3Rpb24odHgsIHJlc3VsdCkgewoJCQkJCQlmb3IodmFyIGkgPSAwOyBpIDwgcmVzdWx0LnJvd3MubGVuZ3RoOyBpKyspIHsKCQkJCQkJCXN0b3JhZ2VbcmVzdWx0LnJvd3MuaXRlbShpKVsnaWQnXV0gPSAgcmVzdWx0LnJvd3MuaXRlbShpKVsnYm9keSddOwoJCQkJCQl9CgkJCQkJCXNldExlbmd0aChyZXN1bHQucm93cy5sZW5ndGgpOwoJCQkJCQlQaG9uZUdhcC5pbml0aWFsaXphdGlvbkNvbXBsZXRlKCJjdXBjYWtlU3RvcmFnZSIpOwoJCQkJCX0pOwoKCQkJCX0sCgkJCQlmdW5jdGlvbiAoZXJyKSB7CgkJCQkJYWxlcnQoZXJyLm1lc3NhZ2UpOwoJCQkJfQoJCQkpOwoJCQl0aGlzLnNldEl0ZW0gPSBmdW5jdGlvbihrZXksIHZhbCkgewoJCQkJaWYgKHR5cGVvZihzdG9yYWdlW2tleV0pPT0ndW5kZWZpbmVkJykgewoJCQkJCXRoaXMubGVuZ3RoKys7CgkJCQl9CgkJCQlzdG9yYWdlW2tleV0gPSB2YWw7CgkJCQl0aGlzLmRiLnRyYW5zYWN0aW9uKAoJCQkJCWZ1bmN0aW9uICh0cmFuc2FjdGlvbikgewoJCQkJCQl0cmFuc2FjdGlvbi5leGVjdXRlU3FsKCdDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBzdG9yYWdlIChpZCBOVkFSQ0hBUig0MCkgUFJJTUFSWSBLRVksIGJvZHkgTlZBUkNIQVIoMjU1KSknKTsKCQkJCQkJdHJhbnNhY3Rpb24uZXhlY3V0ZVNxbCgnUkVQTEFDRSBJTlRPIHN0b3JhZ2UgKGlkLCBib2R5KSB2YWx1ZXMoPyw/KScsIFtrZXksdmFsXSk7CgkJCQkJfQoJCQkJKTsKCQkJfTsKCQkJdGhpcy5nZXRJdGVtID0gZnVuY3Rpb24oa2V5KSB7CgkJCQlyZXR1cm4gc3RvcmFnZVtrZXldOwoJCQl9OwoJCQl0aGlzLnJlbW92ZUl0ZW0gPSBmdW5jdGlvbihrZXkpIHsKCQkJCWRlbGV0ZSBzdG9yYWdlW2tleV07CgkJCQl0aGlzLmxlbmd0aC0tOwoJCQkJdGhpcy5kYi50cmFuc2FjdGlvbigKCQkJCQlmdW5jdGlvbiAodHJhbnNhY3Rpb24pIHsKCQkJCQkJdHJhbnNhY3Rpb24uZXhlY3V0ZVNxbCgnQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgc3RvcmFnZSAoaWQgTlZBUkNIQVIoNDApIFBSSU1BUlkgS0VZLCBib2R5IE5WQVJDSEFSKDI1NSkpJyk7CgkJCQkJCXRyYW5zYWN0aW9uLmV4ZWN1dGVTcWwoJ0RFTEVURSBGUk9NIHN0b3JhZ2Ugd2hlcmUgaWQ9PycsIFtrZXldKTsKCQkJCQl9CgkJCQkpOwoJCQl9OwoJCQl0aGlzLmNsZWFyID0gZnVuY3Rpb24oKSB7CgkJCQlzdG9yYWdlID0ge307CgkJCQl0aGlzLmxlbmd0aCA9IDA7CgkJCQl0aGlzLmRiLnRyYW5zYWN0aW9uKAoJCQkJCWZ1bmN0aW9uICh0cmFuc2FjdGlvbikgewoJCQkJCQl0cmFuc2FjdGlvbi5leGVjdXRlU3FsKCdDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBzdG9yYWdlIChpZCBOVkFSQ0hBUig0MCkgUFJJTUFSWSBLRVksIGJvZHkgTlZBUkNIQVIoMjU1KSknKTsKCQkJCQkJdHJhbnNhY3Rpb24uZXhlY3V0ZVNxbCgnREVMRVRFIEZST00gc3RvcmFnZScsIFtdKTsKCQkJCQl9CgkJCQkpOwoJCQl9OwoJCQl0aGlzLmtleSA9IGZ1bmN0aW9uKGluZGV4KSB7CgkJCQl2YXIgaSA9IDA7CgkJCQlmb3IgKHZhciBqIGluIHN0b3JhZ2UpIHsKCQkJCQlpZiAoaT09aW5kZXgpIHsKCQkJCQkJcmV0dXJuIGo7CgkJCQkJfSBlbHNlIHsKCQkJCQkJaSsrOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiBudWxsOwoJCQl9OwoKCQl9IGNhdGNoKGUpIHsKCQkJYWxlcnQoIkRhdGFiYXNlIGVycm9yICIrZSsiLiIpOwoJCSAgICByZXR1cm47CgkJfQp9OwoKUGhvbmVHYXAuYWRkQ29uc3RydWN0b3IoZnVuY3Rpb24oKSB7CiAgICB2YXIgc2V0dXBEcm9pZERCID0gZnVuY3Rpb24oKSB7CiAgICAgICAgbmF2aWdhdG9yLm9wZW5EYXRhYmFzZSA9IHdpbmRvdy5vcGVuRGF0YWJhc2UgPSBEcm9pZERCX29wZW5EYXRhYmFzZTsKICAgICAgICB3aW5kb3cuZHJvaWRkYiA9IG5ldyBEcm9pZERCKCk7CiAgICB9CiAgICBpZiAodHlwZW9mIHdpbmRvdy5vcGVuRGF0YWJhc2UgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgc2V0dXBEcm9pZERCKCk7CiAgICB9IGVsc2UgewogICAgICAgIHdpbmRvdy5vcGVuRGF0YWJhc2Vfb3JpZyA9IHdpbmRvdy5vcGVuRGF0YWJhc2U7CiAgICAgICAgd2luZG93Lm9wZW5EYXRhYmFzZSA9IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIGRlc2MsIHNpemUpewogICAgICAgICAgICAvLyBTb21lIHZlcnNpb25zIG9mIEFuZHJvaWQgd2lsbCB0aHJvdyBhIFNFQ1VSSVRZX0VSUiBzbyB3ZSBuZWVkIAogICAgICAgICAgICAvLyB0byBjYXRjaCB0aGUgZXhjZXB0aW9uIGFuZCBzZXV0cCBvdXIgb3duIERCIGhhbmRsaW5nLgogICAgICAgICAgICB2YXIgZGIgPSBudWxsOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZGIgPSB3aW5kb3cub3BlbkRhdGFiYXNlX29yaWcobmFtZSwgdmVyc2lvbiwgZGVzYywgc2l6ZSk7CiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIGNhdGNoIChleCkgewogICAgICAgICAgICAgICAgZGIgPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGIgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2V0dXBEcm9pZERCKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gRHJvaWREQl9vcGVuRGF0YWJhc2UobmFtZSwgdmVyc2lvbiwgZGVzYywgc2l6ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIGlmICh0eXBlb2Ygd2luZG93LmxvY2FsU3RvcmFnZSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBuYXZpZ2F0b3IubG9jYWxTdG9yYWdlID0gd2luZG93LmxvY2FsU3RvcmFnZSA9IG5ldyBDdXBjYWtlTG9jYWxTdG9yYWdlKCk7CiAgICAgICAgUGhvbmVHYXAud2FpdEZvckluaXRpYWxpemF0aW9uKCJjdXBjYWtlU3RvcmFnZSIpOwogICAgfQp9KTsKfQo="},"vendor/zepto/zepto.js":{"content_type":"application/javascript","revpos":1,"data":"Ly8gICAgIFplcHRvLmpzCi8vICAgICAoYykgMjAxMCwgMjAxMSBUaG9tYXMgRnVjaHMKLy8gICAgIFplcHRvLmpzIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgoKKGZ1bmN0aW9uKHVuZGVmaW5lZCl7CiAgaWYgKFN0cmluZy5wcm90b3R5cGUudHJpbSA9PT0gdW5kZWZpbmVkKSAvLyBmaXggZm9yIGlPUyAzLjIKICAgIFN0cmluZy5wcm90b3R5cGUudHJpbSA9IGZ1bmN0aW9uKCl7IHJldHVybiB0aGlzLnJlcGxhY2UoL15ccysvLCAnJykucmVwbGFjZSgvXHMrJC8sICcnKSB9OwoKICAvLyBGb3IgaU9TIDMueAogIC8vIGZyb20gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvQXJyYXkvcmVkdWNlCiAgaWYgKEFycmF5LnByb3RvdHlwZS5yZWR1Y2UgPT09IHVuZGVmaW5lZCkKICAgIEFycmF5LnByb3RvdHlwZS5yZWR1Y2UgPSBmdW5jdGlvbihmdW4pewogICAgICBpZih0aGlzID09PSB2b2lkIDAgfHwgdGhpcyA9PT0gbnVsbCkgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogICAgICB2YXIgdCA9IE9iamVjdCh0aGlzKSwgbGVuID0gdC5sZW5ndGggPj4+IDAsIGsgPSAwLCBhY2N1bXVsYXRvcjsKICAgICAgaWYodHlwZW9mIGZ1biAhPSAnZnVuY3Rpb24nKSB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgIGlmKGxlbiA9PSAwICYmIGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwoKICAgICAgaWYoYXJndW1lbnRzLmxlbmd0aCA+PSAyKQogICAgICAgYWNjdW11bGF0b3IgPSBhcmd1bWVudHNbMV07CiAgICAgIGVsc2UKICAgICAgICBkb3sKICAgICAgICAgIGlmKGsgaW4gdCl7CiAgICAgICAgICAgIGFjY3VtdWxhdG9yID0gdFtrKytdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmKCsrayA+PSBsZW4pIHRocm93IG5ldyBUeXBlRXJyb3IoKTsKICAgICAgICB9IHdoaWxlICh0cnVlKTsKCiAgICAgIHdoaWxlIChrIDwgbGVuKXsKICAgICAgICBpZihrIGluIHQpIGFjY3VtdWxhdG9yID0gZnVuLmNhbGwodW5kZWZpbmVkLCBhY2N1bXVsYXRvciwgdFtrXSwgaywgdCk7CiAgICAgICAgaysrOwogICAgICB9CiAgICAgIHJldHVybiBhY2N1bXVsYXRvcjsKICAgIH07Cgp9KSgpOwovLyAgICAgWmVwdG8uanMKLy8gICAgIChjKSAyMDEwLCAyMDExIFRob21hcyBGdWNocwovLyAgICAgWmVwdG8uanMgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCgp2YXIgWmVwdG8gPSAoZnVuY3Rpb24oKSB7CiAgdmFyIHVuZGVmaW5lZCwga2V5LCAkJCwgY2xhc3NMaXN0LCBlbXB0eUFycmF5ID0gW10sIHNsaWNlID0gZW1wdHlBcnJheS5zbGljZSwKICAgIGRvY3VtZW50ID0gd2luZG93LmRvY3VtZW50LAogICAgZWxlbWVudERpc3BsYXkgPSB7fSwgY2xhc3NDYWNoZSA9IHt9LAogICAgZ2V0Q29tcHV0ZWRTdHlsZSA9IGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUsCiAgICBjc3NOdW1iZXIgPSB7ICdjb2x1bW4tY291bnQnOiAxLCAnY29sdW1ucyc6IDEsICdmb250LXdlaWdodCc6IDEsICdsaW5lLWhlaWdodCc6IDEsJ29wYWNpdHknOiAxLCAnei1pbmRleCc6IDEsICd6b29tJzogMSB9LAogICAgZnJhZ21lbnRSRSA9IC9eXHMqPChcdyspW14+XSo+LywKICAgIGVsZW1lbnRUeXBlcyA9IFsxLCA5LCAxMV0sCiAgICBhZGphY2VuY3lPcGVyYXRvcnMgPSBbJ3ByZXBlbmQnLCAnYWZ0ZXInLCAnYmVmb3JlJywgJ2FwcGVuZCddLAogICAgcmV2ZXJzZUFkamFjZW5jeU9wZXJhdG9ycyA9IFsnYXBwZW5kJywgJ3ByZXBlbmQnXSwKICAgIHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKSwKICAgIHRhYmxlUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKSwKICAgIGNvbnRhaW5lcnMgPSB7CiAgICAgICd0cic6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rib2R5JyksCiAgICAgICd0Ym9keSc6IHRhYmxlLCAndGhlYWQnOiB0YWJsZSwgJ3Rmb290JzogdGFibGUsCiAgICAgICd0ZCc6IHRhYmxlUm93LCAndGgnOiB0YWJsZVJvdywKICAgICAgJyonOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKQogICAgfTsKCiAgZnVuY3Rpb24gaXNGKHZhbHVlKSB7IHJldHVybiAoe30pLnRvU3RyaW5nLmNhbGwodmFsdWUpID09ICJbb2JqZWN0IEZ1bmN0aW9uXSIgfQogIGZ1bmN0aW9uIGlzTyh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBPYmplY3QgfQogIGZ1bmN0aW9uIGlzQSh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBBcnJheSB9CiAgZnVuY3Rpb24gbGlrZUFycmF5KG9iaikgeyByZXR1cm4gdHlwZW9mIG9iai5sZW5ndGggPT0gJ251bWJlcicgfQoKICBmdW5jdGlvbiBjb21wYWN0KGFycmF5KSB7IHJldHVybiBhcnJheS5maWx0ZXIoZnVuY3Rpb24oaXRlbSl7IHJldHVybiBpdGVtICE9PSB1bmRlZmluZWQgJiYgaXRlbSAhPT0gbnVsbCB9KSB9CiAgZnVuY3Rpb24gZmxhdHRlbihhcnJheSkgeyByZXR1cm4gYXJyYXkubGVuZ3RoID4gMCA/IFtdLmNvbmNhdC5hcHBseShbXSwgYXJyYXkpIDogYXJyYXkgfQogIGZ1bmN0aW9uIGNhbWVsaXplKHN0cikgIHsgcmV0dXJuIHN0ci5yZXBsYWNlKC8tKyguKT8vZywgZnVuY3Rpb24obWF0Y2gsIGNocil7IHJldHVybiBjaHIgPyBjaHIudG9VcHBlckNhc2UoKSA6ICcnIH0pIH0KICBmdW5jdGlvbiBkYXNoZXJpemUoc3RyKXsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvOjovZywgJy8nKQogICAgICAgICAgIC5yZXBsYWNlKC8oW0EtWl0rKShbQS1aXVthLXpdKS9nLCAnJDFfJDInKQogICAgICAgICAgIC5yZXBsYWNlKC8oW2EtelxkXSkoW0EtWl0pL2csICckMV8kMicpCiAgICAgICAgICAgLnJlcGxhY2UoL18vZywgJy0nKQogICAgICAgICAgIC50b0xvd2VyQ2FzZSgpOwogIH0KICBmdW5jdGlvbiB1bmlxKGFycmF5KSAgICB7IHJldHVybiBhcnJheS5maWx0ZXIoZnVuY3Rpb24oaXRlbSxpbmRleCxhcnJheSl7IHJldHVybiBhcnJheS5pbmRleE9mKGl0ZW0pID09IGluZGV4IH0pIH0KCiAgZnVuY3Rpb24gY2xhc3NSRShuYW1lKXsKICAgIHJldHVybiBuYW1lIGluIGNsYXNzQ2FjaGUgPwogICAgICBjbGFzc0NhY2hlW25hbWVdIDogKGNsYXNzQ2FjaGVbbmFtZV0gPSBuZXcgUmVnRXhwKCcoXnxcXHMpJyArIG5hbWUgKyAnKFxcc3wkKScpKTsKICB9CgogIGZ1bmN0aW9uIG1heWJlQWRkUHgobmFtZSwgdmFsdWUpIHsgcmV0dXJuICh0eXBlb2YgdmFsdWUgPT0gIm51bWJlciIgJiYgIWNzc051bWJlcltkYXNoZXJpemUobmFtZSldKSA/IHZhbHVlICsgInB4IiA6IHZhbHVlOyB9CgogIGZ1bmN0aW9uIGRlZmF1bHREaXNwbGF5KG5vZGVOYW1lKSB7CiAgICB2YXIgZWxlbWVudCwgZGlzcGxheTsKICAgIGlmICghZWxlbWVudERpc3BsYXlbbm9kZU5hbWVdKSB7CiAgICAgIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG5vZGVOYW1lKTsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtZW50KTsKICAgICAgZGlzcGxheSA9IGdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgJycpLmdldFByb3BlcnR5VmFsdWUoImRpc3BsYXkiKTsKICAgICAgZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpOwogICAgICBkaXNwbGF5ID09ICJub25lIiAmJiAoZGlzcGxheSA9ICJibG9jayIpOwogICAgICBlbGVtZW50RGlzcGxheVtub2RlTmFtZV0gPSBkaXNwbGF5OwogICAgfQogICAgcmV0dXJuIGVsZW1lbnREaXNwbGF5W25vZGVOYW1lXTsKICB9CgogIGZ1bmN0aW9uIGZyYWdtZW50KGh0bWwsIG5hbWUpIHsKICAgIGlmIChuYW1lID09PSB1bmRlZmluZWQpIGZyYWdtZW50UkUudGVzdChodG1sKSAmJiBSZWdFeHAuJDE7CiAgICBpZiAoIShuYW1lIGluIGNvbnRhaW5lcnMpKSBuYW1lID0gJyonOwogICAgdmFyIGNvbnRhaW5lciA9IGNvbnRhaW5lcnNbbmFtZV07CiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJycgKyBodG1sOwogICAgcmV0dXJuIHNsaWNlLmNhbGwoY29udGFpbmVyLmNoaWxkTm9kZXMpOwogIH0KCiAgZnVuY3Rpb24gWihkb20sIHNlbGVjdG9yKXsKICAgIGRvbSA9IGRvbSB8fCBlbXB0eUFycmF5OwogICAgZG9tLl9fcHJvdG9fXyA9IFoucHJvdG90eXBlOwogICAgZG9tLnNlbGVjdG9yID0gc2VsZWN0b3IgfHwgJyc7CiAgICByZXR1cm4gZG9tOwogIH0KCiAgZnVuY3Rpb24gJChzZWxlY3RvciwgY29udGV4dCl7CiAgICBpZiAoIXNlbGVjdG9yKSByZXR1cm4gWigpOwogICAgaWYgKGNvbnRleHQgIT09IHVuZGVmaW5lZCkgcmV0dXJuICQoY29udGV4dCkuZmluZChzZWxlY3Rvcik7CiAgICBlbHNlIGlmIChpc0Yoc2VsZWN0b3IpKSByZXR1cm4gJChkb2N1bWVudCkucmVhZHkoc2VsZWN0b3IpOwogICAgZWxzZSBpZiAoc2VsZWN0b3IgaW5zdGFuY2VvZiBaKSByZXR1cm4gc2VsZWN0b3I7CiAgICBlbHNlIHsKICAgICAgdmFyIGRvbTsKICAgICAgaWYgKGlzQShzZWxlY3RvcikpIGRvbSA9IGNvbXBhY3Qoc2VsZWN0b3IpOwogICAgICBlbHNlIGlmIChlbGVtZW50VHlwZXMuaW5kZXhPZihzZWxlY3Rvci5ub2RlVHlwZSkgPj0gMCB8fCBzZWxlY3RvciA9PT0gd2luZG93KQogICAgICAgIGRvbSA9IFtzZWxlY3Rvcl0sIHNlbGVjdG9yID0gbnVsbDsKICAgICAgZWxzZSBpZiAoZnJhZ21lbnRSRS50ZXN0KHNlbGVjdG9yKSkKICAgICAgICBkb20gPSBmcmFnbWVudChzZWxlY3RvciwgUmVnRXhwLiQxKSwgc2VsZWN0b3IgPSBudWxsOwogICAgICBlbHNlIGlmIChzZWxlY3Rvci5ub2RlVHlwZSAmJiBzZWxlY3Rvci5ub2RlVHlwZSA9PSAzKSBkb20gPSBbc2VsZWN0b3JdOwogICAgICBlbHNlIGRvbSA9ICQkKGRvY3VtZW50LCBzZWxlY3Rvcik7CiAgICAgIHJldHVybiBaKGRvbSwgc2VsZWN0b3IpOwogICAgfQogIH0KCiAgJC5leHRlbmQgPSBmdW5jdGlvbih0YXJnZXQpewogICAgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLmZvckVhY2goZnVuY3Rpb24oc291cmNlKSB7CiAgICAgIGZvciAoa2V5IGluIHNvdXJjZSkgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgIH0pCiAgICByZXR1cm4gdGFyZ2V0OwogIH0KICAkLnFzYSA9ICQkID0gZnVuY3Rpb24oZWxlbWVudCwgc2VsZWN0b3IpeyByZXR1cm4gc2xpY2UuY2FsbChlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpKSB9CgogIGZ1bmN0aW9uIGZpbHRlcmVkKG5vZGVzLCBzZWxlY3Rvcil7CiAgICByZXR1cm4gc2VsZWN0b3IgPT09IHVuZGVmaW5lZCA/ICQobm9kZXMpIDogJChub2RlcykuZmlsdGVyKHNlbGVjdG9yKTsKICB9CgogIGZ1bmN0aW9uIGZ1bmNBcmcoY29udGV4dCwgYXJnLCBpZHgsIHBheWxvYWQpewogICByZXR1cm4gaXNGKGFyZykgPyBhcmcuY2FsbChjb250ZXh0LCBpZHgsIHBheWxvYWQpIDogYXJnOwogIH0KCiAgJC5pc0Z1bmN0aW9uID0gaXNGOwogICQuaXNPYmplY3QgPSBpc087CiAgJC5pc0FycmF5ID0gaXNBOwoKICAkLm1hcCA9IGZ1bmN0aW9uKGVsZW1lbnRzLCBjYWxsYmFjaykgewogICAgdmFyIHZhbHVlLCB2YWx1ZXMgPSBbXSwgaSwga2V5OwogICAgaWYgKGxpa2VBcnJheShlbGVtZW50cykpCiAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhbHVlID0gY2FsbGJhY2soZWxlbWVudHNbaV0sIGkpOwogICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB2YWx1ZXMucHVzaCh2YWx1ZSk7CiAgICAgIH0KICAgIGVsc2UKICAgICAgZm9yIChrZXkgaW4gZWxlbWVudHMpIHsKICAgICAgICB2YWx1ZSA9IGNhbGxiYWNrKGVsZW1lbnRzW2tleV0sIGtleSk7CiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHZhbHVlcy5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgcmV0dXJuIGZsYXR0ZW4odmFsdWVzKTsKICB9CgogICQuZWFjaCA9IGZ1bmN0aW9uKGVsZW1lbnRzLCBjYWxsYmFjaykgewogICAgdmFyIGksIGtleTsKICAgIGlmIChsaWtlQXJyYXkoZWxlbWVudHMpKQogICAgICBmb3IoaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmKGNhbGxiYWNrKGksIGVsZW1lbnRzW2ldKSA9PT0gZmFsc2UpIHJldHVybiBlbGVtZW50czsKICAgICAgfQogICAgZWxzZQogICAgICBmb3Ioa2V5IGluIGVsZW1lbnRzKSB7CiAgICAgICAgaWYoY2FsbGJhY2soa2V5LCBlbGVtZW50c1trZXldKSA9PT0gZmFsc2UpIHJldHVybiBlbGVtZW50czsKICAgICAgfQogICAgcmV0dXJuIGVsZW1lbnRzOwogIH0KCiAgJC5mbiA9IHsKICAgIGZvckVhY2g6IGVtcHR5QXJyYXkuZm9yRWFjaCwKICAgIHJlZHVjZTogZW1wdHlBcnJheS5yZWR1Y2UsCiAgICBwdXNoOiBlbXB0eUFycmF5LnB1c2gsCiAgICBpbmRleE9mOiBlbXB0eUFycmF5LmluZGV4T2YsCiAgICBjb25jYXQ6IGVtcHR5QXJyYXkuY29uY2F0LAogICAgbWFwOiBmdW5jdGlvbihmbil7CiAgICAgIHJldHVybiAkLm1hcCh0aGlzLCBmdW5jdGlvbihlbCwgaSl7IHJldHVybiBmbi5jYWxsKGVsLCBpLCBlbCkgfSk7CiAgICB9LAogICAgc2xpY2U6IGZ1bmN0aW9uKCl7CiAgICAgIHJldHVybiAkKHNsaWNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgfSwKICAgIHJlYWR5OiBmdW5jdGlvbihjYWxsYmFjayl7CiAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09ICdjb21wbGV0ZScgfHwgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PSAnbG9hZGVkJykgY2FsbGJhY2soKTsKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGNhbGxiYWNrLCBmYWxzZSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIGdldDogZnVuY3Rpb24oaWR4KXsgcmV0dXJuIGlkeCA9PT0gdW5kZWZpbmVkID8gdGhpcyA6IHRoaXNbaWR4XSB9LAogICAgc2l6ZTogZnVuY3Rpb24oKXsgcmV0dXJuIHRoaXMubGVuZ3RoIH0sCiAgICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMucGFyZW50Tm9kZSAhPSBudWxsKSB7CiAgICAgICAgICB0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBlYWNoOiBmdW5jdGlvbihjYWxsYmFjayl7CiAgICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbihlbCwgaWR4KXsgY2FsbGJhY2suY2FsbChlbCwgaWR4LCBlbCkgfSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIGZpbHRlcjogZnVuY3Rpb24oc2VsZWN0b3IpewogICAgICByZXR1cm4gJChbXS5maWx0ZXIuY2FsbCh0aGlzLCBmdW5jdGlvbihlbGVtZW50KXsKICAgICAgICByZXR1cm4gJCQoZWxlbWVudC5wYXJlbnROb2RlLCBzZWxlY3RvcikuaW5kZXhPZihlbGVtZW50KSA+PSAwOwogICAgICB9KSk7CiAgICB9LAogICAgZW5kOiBmdW5jdGlvbigpewogICAgICByZXR1cm4gdGhpcy5wcmV2T2JqZWN0IHx8ICQoKTsKICAgIH0sCiAgICBhZGQ6ZnVuY3Rpb24oc2VsZWN0b3IsY29udGV4dCl7CiAgICAgIHJldHVybiAkKHVuaXEodGhpcy5jb25jYXQoJChzZWxlY3Rvcixjb250ZXh0KSkpKTsKICAgIH0sCiAgICBpczogZnVuY3Rpb24oc2VsZWN0b3IpewogICAgICByZXR1cm4gdGhpcy5sZW5ndGggPiAwICYmICQodGhpc1swXSkuZmlsdGVyKHNlbGVjdG9yKS5sZW5ndGggPiAwOwogICAgfSwKICAgIG5vdDogZnVuY3Rpb24oc2VsZWN0b3IpewogICAgICB2YXIgbm9kZXM9W107CiAgICAgIGlmIChpc0Yoc2VsZWN0b3IpICYmIHNlbGVjdG9yLmNhbGwgIT09IHVuZGVmaW5lZCkKICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oaWR4KXsKICAgICAgICAgIGlmICghc2VsZWN0b3IuY2FsbCh0aGlzLGlkeCkpIG5vZGVzLnB1c2godGhpcyk7CiAgICAgICAgfSk7CiAgICAgIGVsc2UgewogICAgICAgIHZhciBleGNsdWRlcyA9IHR5cGVvZiBzZWxlY3RvciA9PSAnc3RyaW5nJyA/IHRoaXMuZmlsdGVyKHNlbGVjdG9yKSA6CiAgICAgICAgICAobGlrZUFycmF5KHNlbGVjdG9yKSAmJiBpc0Yoc2VsZWN0b3IuaXRlbSkpID8gc2xpY2UuY2FsbChzZWxlY3RvcikgOiAkKHNlbGVjdG9yKTsKICAgICAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24oZWwpewogICAgICAgICAgaWYgKGV4Y2x1ZGVzLmluZGV4T2YoZWwpIDwgMCkgbm9kZXMucHVzaChlbCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuICQobm9kZXMpOwogICAgfSwKICAgIGVxOiBmdW5jdGlvbihpZHgpewogICAgICByZXR1cm4gaWR4ID09PSAtMSA/IHRoaXMuc2xpY2UoaWR4KSA6IHRoaXMuc2xpY2UoaWR4LCArIGlkeCArIDEpOwogICAgfSwKICAgIGZpcnN0OiBmdW5jdGlvbigpeyByZXR1cm4gJCh0aGlzWzBdKSB9LAogICAgbGFzdDogZnVuY3Rpb24oKXsgcmV0dXJuICQodGhpc1t0aGlzLmxlbmd0aCAtIDFdKSB9LAogICAgZmluZDogZnVuY3Rpb24oc2VsZWN0b3IpewogICAgICB2YXIgcmVzdWx0OwogICAgICBpZiAodGhpcy5sZW5ndGggPT0gMSkgcmVzdWx0ID0gJCQodGhpc1swXSwgc2VsZWN0b3IpOwogICAgICBlbHNlIHJlc3VsdCA9IHRoaXMubWFwKGZ1bmN0aW9uKCl7IHJldHVybiAkJCh0aGlzLCBzZWxlY3RvcikgfSk7CiAgICAgIHJldHVybiAkKHJlc3VsdCk7CiAgICB9LAogICAgY2xvc2VzdDogZnVuY3Rpb24oc2VsZWN0b3IsIGNvbnRleHQpewogICAgICB2YXIgbm9kZSA9IHRoaXNbMF0sIG5vZGVzID0gJCQoY29udGV4dCAhPT0gdW5kZWZpbmVkID8gY29udGV4dCA6IGRvY3VtZW50LCBzZWxlY3Rvcik7CiAgICAgIGlmIChub2Rlcy5sZW5ndGggPT09IDApIG5vZGUgPSBudWxsOwogICAgICB3aGlsZShub2RlICYmIG5vZGUgIT09IGRvY3VtZW50ICYmIG5vZGVzLmluZGV4T2Yobm9kZSkgPCAwKSBub2RlID0gbm9kZS5wYXJlbnROb2RlOwogICAgICByZXR1cm4gJChub2RlICE9PSBkb2N1bWVudCAmJiBub2RlKTsKICAgIH0sCiAgICBwYXJlbnRzOiBmdW5jdGlvbihzZWxlY3Rvcil7CiAgICAgIHZhciBhbmNlc3RvcnMgPSBbXSwgbm9kZXMgPSB0aGlzOwogICAgICB3aGlsZSAobm9kZXMubGVuZ3RoID4gMCkKICAgICAgICBub2RlcyA9ICQubWFwKG5vZGVzLCBmdW5jdGlvbihub2RlKXsKICAgICAgICAgIGlmICgobm9kZSA9IG5vZGUucGFyZW50Tm9kZSkgJiYgbm9kZSAhPT0gZG9jdW1lbnQgJiYgYW5jZXN0b3JzLmluZGV4T2Yobm9kZSkgPCAwKSB7CiAgICAgICAgICAgIGFuY2VzdG9ycy5wdXNoKG5vZGUpOwogICAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgcmV0dXJuIGZpbHRlcmVkKGFuY2VzdG9ycywgc2VsZWN0b3IpOwogICAgfSwKICAgIHBhcmVudDogZnVuY3Rpb24oc2VsZWN0b3IpewogICAgICByZXR1cm4gZmlsdGVyZWQodW5pcSh0aGlzLnBsdWNrKCdwYXJlbnROb2RlJykpLCBzZWxlY3Rvcik7CiAgICB9LAogICAgY2hpbGRyZW46IGZ1bmN0aW9uKHNlbGVjdG9yKXsKICAgICAgcmV0dXJuIGZpbHRlcmVkKHRoaXMubWFwKGZ1bmN0aW9uKCl7IHJldHVybiBzbGljZS5jYWxsKHRoaXMuY2hpbGRyZW4pIH0pLCBzZWxlY3Rvcik7CiAgICB9LAogICAgc2libGluZ3M6IGZ1bmN0aW9uKHNlbGVjdG9yKXsKICAgICAgcmV0dXJuIGZpbHRlcmVkKHRoaXMubWFwKGZ1bmN0aW9uKGksIGVsKXsKICAgICAgICByZXR1cm4gc2xpY2UuY2FsbChlbC5wYXJlbnROb2RlLmNoaWxkcmVuKS5maWx0ZXIoZnVuY3Rpb24oY2hpbGQpeyByZXR1cm4gY2hpbGQhPT1lbCB9KTsKICAgICAgfSksIHNlbGVjdG9yKTsKICAgIH0sCiAgICBlbXB0eTogZnVuY3Rpb24oKXsgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpeyB0aGlzLmlubmVySFRNTCA9ICcnIH0pIH0sCiAgICBwbHVjazogZnVuY3Rpb24ocHJvcGVydHkpeyByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXsgcmV0dXJuIHRoaXNbcHJvcGVydHldIH0pIH0sCiAgICBzaG93OiBmdW5jdGlvbigpewogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9PSAibm9uZSIgJiYgKHRoaXMuc3R5bGUuZGlzcGxheSA9IG51bGwpOwogICAgICAgIGlmIChnZXRDb21wdXRlZFN0eWxlKHRoaXMsICcnKS5nZXRQcm9wZXJ0eVZhbHVlKCJkaXNwbGF5IikgPT0gIm5vbmUiKSB7CiAgICAgICAgICB0aGlzLnN0eWxlLmRpc3BsYXkgPSBkZWZhdWx0RGlzcGxheSh0aGlzLm5vZGVOYW1lKQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICByZXBsYWNlV2l0aDogZnVuY3Rpb24obmV3Q29udGVudCkgewogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBwYXI9dGhpcy5wYXJlbnROb2RlLG5leHQ9dGhpcy5uZXh0U2libGluZzsKICAgICAgICAkKHRoaXMpLnJlbW92ZSgpOwogICAgICAgIG5leHQgPyAkKG5leHQpLmJlZm9yZShuZXdDb250ZW50KSA6ICQocGFyKS5hcHBlbmQobmV3Q29udGVudCk7CiAgICAgIH0pOwogICAgfSwKICAgIHdyYXA6IGZ1bmN0aW9uKG5ld0NvbnRlbnQpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAkKHRoaXMpLndyYXBBbGwoJChuZXdDb250ZW50KVswXS5jbG9uZU5vZGUoZmFsc2UpKTsKICAgICAgfSk7CiAgICB9LAogICAgd3JhcEFsbDogZnVuY3Rpb24obmV3Q29udGVudCkgewogICAgICBpZiAodGhpc1swXSkgewogICAgICAgICQodGhpc1swXSkuYmVmb3JlKG5ld0NvbnRlbnQgPSAkKG5ld0NvbnRlbnQpKTsKICAgICAgICBuZXdDb250ZW50LmFwcGVuZCh0aGlzKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICB1bndyYXA6IGZ1bmN0aW9uKCl7CiAgICAgIHRoaXMucGFyZW50KCkuZWFjaChmdW5jdGlvbigpewogICAgICAgICQodGhpcykucmVwbGFjZVdpdGgoJCh0aGlzKS5jaGlsZHJlbigpKTsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIGhpZGU6IGZ1bmN0aW9uKCl7CiAgICAgIHJldHVybiB0aGlzLmNzcygiZGlzcGxheSIsICJub25lIikKICAgIH0sCiAgICB0b2dnbGU6IGZ1bmN0aW9uKHNldHRpbmcpewogICAgICByZXR1cm4gKHNldHRpbmcgPT09IHVuZGVmaW5lZCA/IHRoaXMuY3NzKCJkaXNwbGF5IikgPT0gIm5vbmUiIDogc2V0dGluZykgPyB0aGlzLnNob3coKSA6IHRoaXMuaGlkZSgpOwogICAgfSwKICAgIHByZXY6IGZ1bmN0aW9uKCl7IHJldHVybiAkKHRoaXMucGx1Y2soJ3ByZXZpb3VzRWxlbWVudFNpYmxpbmcnKSkgfSwKICAgIG5leHQ6IGZ1bmN0aW9uKCl7IHJldHVybiAkKHRoaXMucGx1Y2soJ25leHRFbGVtZW50U2libGluZycpKSB9LAogICAgaHRtbDogZnVuY3Rpb24oaHRtbCl7CiAgICAgIHJldHVybiBodG1sID09PSB1bmRlZmluZWQgPwogICAgICAgICh0aGlzLmxlbmd0aCA+IDAgPyB0aGlzWzBdLmlubmVySFRNTCA6IG51bGwpIDoKICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKGlkeCkgewogICAgICAgICAgdmFyIG9yaWdpbkh0bWwgPSB0aGlzLmlubmVySFRNTDsKICAgICAgICAgICQodGhpcykuZW1wdHkoKS5hcHBlbmQoIGZ1bmNBcmcodGhpcywgaHRtbCwgaWR4LCBvcmlnaW5IdG1sKSApOwogICAgICAgIH0pOwogICAgfSwKICAgIHRleHQ6IGZ1bmN0aW9uKHRleHQpewogICAgICByZXR1cm4gdGV4dCA9PT0gdW5kZWZpbmVkID8KICAgICAgICAodGhpcy5sZW5ndGggPiAwID8gdGhpc1swXS50ZXh0Q29udGVudCA6IG51bGwpIDoKICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oKXsgdGhpcy50ZXh0Q29udGVudCA9IHRleHQgfSk7CiAgICB9LAogICAgYXR0cjogZnVuY3Rpb24obmFtZSwgdmFsdWUpewogICAgICByZXR1cm4gKHR5cGVvZiBuYW1lID09ICdzdHJpbmcnICYmIHZhbHVlID09PSB1bmRlZmluZWQpID8KICAgICAgICAodGhpcy5sZW5ndGggPiAwICYmIHRoaXNbMF0ubm9kZU5hbWUgPT0gJ0lOUFVUJyAmJiB0aGlzWzBdLnR5cGUgPT0gJ3RleHQnICYmIG5hbWUgPT0gJ3ZhbHVlJykgPyAodGhpcy52YWwoKSkgOgogICAgICAgICh0aGlzLmxlbmd0aCA+IDAgPyB0aGlzWzBdLmdldEF0dHJpYnV0ZShuYW1lKSB8fCAobmFtZSBpbiB0aGlzWzBdID8gdGhpc1swXVtuYW1lXSA6IHVuZGVmaW5lZCkgOiB1bmRlZmluZWQpIDoKICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oaWR4KXsKICAgICAgICAgIGlmIChpc08obmFtZSkpIGZvciAoa2V5IGluIG5hbWUpIHRoaXMuc2V0QXR0cmlidXRlKGtleSwgbmFtZVtrZXldKQogICAgICAgICAgZWxzZSB0aGlzLnNldEF0dHJpYnV0ZShuYW1lLCBmdW5jQXJnKHRoaXMsIHZhbHVlLCBpZHgsIHRoaXMuZ2V0QXR0cmlidXRlKG5hbWUpKSk7CiAgICAgICAgfSk7CiAgICB9LAogICAgcmVtb3ZlQXR0cjogZnVuY3Rpb24obmFtZSkgewogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgeyB0aGlzLnJlbW92ZUF0dHJpYnV0ZShuYW1lKTsgfSk7CiAgICB9LAogICAgZGF0YTogZnVuY3Rpb24obmFtZSwgdmFsdWUpewogICAgICByZXR1cm4gdGhpcy5hdHRyKCdkYXRhLScgKyBuYW1lLCB2YWx1ZSk7CiAgICB9LAogICAgdmFsOiBmdW5jdGlvbih2YWx1ZSl7CiAgICAgIHJldHVybiAodmFsdWUgPT09IHVuZGVmaW5lZCkgPwogICAgICAgICh0aGlzLmxlbmd0aCA+IDAgPyB0aGlzWzBdLnZhbHVlIDogbnVsbCkgOgogICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpewogICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgICAgIH0pOwogICAgfSwKICAgIG9mZnNldDogZnVuY3Rpb24oKXsKICAgICAgaWYodGhpcy5sZW5ndGg9PTApIHJldHVybiBudWxsOwogICAgICB2YXIgb2JqID0gdGhpc1swXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBsZWZ0OiBvYmoubGVmdCArIGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCwKICAgICAgICB0b3A6IG9iai50b3AgKyBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCwKICAgICAgICB3aWR0aDogb2JqLndpZHRoLAogICAgICAgIGhlaWdodDogb2JqLmhlaWdodAogICAgICB9OwogICAgfSwKICAgIGNzczogZnVuY3Rpb24ocHJvcGVydHksIHZhbHVlKXsKICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYgdHlwZW9mIHByb3BlcnR5ID09ICdzdHJpbmcnKQogICAgICAgIHJldHVybiB0aGlzWzBdLnN0eWxlW2NhbWVsaXplKHByb3BlcnR5KV0gfHwgZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzWzBdLCAnJykuZ2V0UHJvcGVydHlWYWx1ZShwcm9wZXJ0eSk7CiAgICAgIHZhciBjc3MgPSAnJzsKICAgICAgZm9yIChrZXkgaW4gcHJvcGVydHkpIGNzcyArPSBkYXNoZXJpemUoa2V5KSArICc6JyArIG1heWJlQWRkUHgoa2V5LCBwcm9wZXJ0eVtrZXldKSArICc7JzsKICAgICAgaWYgKHR5cGVvZiBwcm9wZXJ0eSA9PSAnc3RyaW5nJykgY3NzID0gZGFzaGVyaXplKHByb3BlcnR5KSArICI6IiArIG1heWJlQWRkUHgocHJvcGVydHksIHZhbHVlKTsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsgdGhpcy5zdHlsZS5jc3NUZXh0ICs9ICc7JyArIGNzcyB9KTsKICAgIH0sCiAgICBpbmRleDogZnVuY3Rpb24oZWxlbWVudCl7CiAgICAgIHJldHVybiBlbGVtZW50ID8gdGhpcy5pbmRleE9mKCQoZWxlbWVudClbMF0pIDogdGhpcy5wYXJlbnQoKS5jaGlsZHJlbigpLmluZGV4T2YodGhpc1swXSk7CiAgICB9LAogICAgaGFzQ2xhc3M6IGZ1bmN0aW9uKG5hbWUpewogICAgICBpZiAodGhpcy5sZW5ndGggPCAxKSByZXR1cm4gZmFsc2U7CiAgICAgIGVsc2UgcmV0dXJuIGNsYXNzUkUobmFtZSkudGVzdCh0aGlzWzBdLmNsYXNzTmFtZSk7CiAgICB9LAogICAgYWRkQ2xhc3M6IGZ1bmN0aW9uKG5hbWUpewogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGlkeCkgewogICAgICAgIGNsYXNzTGlzdCA9IFtdOwogICAgICAgIHZhciBjbHMgPSB0aGlzLmNsYXNzTmFtZSwgbmV3TmFtZSA9IGZ1bmNBcmcodGhpcywgbmFtZSwgaWR4LCBjbHMpOwogICAgICAgIG5ld05hbWUuc3BsaXQoL1xzKy9nKS5mb3JFYWNoKGZ1bmN0aW9uKGtsYXNzKSB7CiAgICAgICAgICBpZiAoISQodGhpcykuaGFzQ2xhc3Moa2xhc3MpKSB7CiAgICAgICAgICAgIGNsYXNzTGlzdC5wdXNoKGtsYXNzKQogICAgICAgICAgfQogICAgICAgIH0sIHRoaXMpOwogICAgICAgIGNsYXNzTGlzdC5sZW5ndGggJiYgKHRoaXMuY2xhc3NOYW1lICs9IChjbHMgPyAiICIgOiAiIikgKyBjbGFzc0xpc3Quam9pbigiICIpKQogICAgICB9KTsKICAgIH0sCiAgICByZW1vdmVDbGFzczogZnVuY3Rpb24obmFtZSl7CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oaWR4KSB7CiAgICAgICAgaWYobmFtZSA9PT0gdW5kZWZpbmVkKQogICAgICAgICAgcmV0dXJuIHRoaXMuY2xhc3NOYW1lID0gJyc7CiAgICAgICAgY2xhc3NMaXN0ID0gdGhpcy5jbGFzc05hbWU7CiAgICAgICAgZnVuY0FyZyh0aGlzLCBuYW1lLCBpZHgsIGNsYXNzTGlzdCkuc3BsaXQoL1xzKy9nKS5mb3JFYWNoKGZ1bmN0aW9uKGtsYXNzKSB7CiAgICAgICAgICBjbGFzc0xpc3QgPSBjbGFzc0xpc3QucmVwbGFjZShjbGFzc1JFKGtsYXNzKSwgIiAiKQogICAgICAgIH0pOwogICAgICAgIHRoaXMuY2xhc3NOYW1lID0gY2xhc3NMaXN0LnRyaW0oKQogICAgICB9KTsKICAgIH0sCiAgICB0b2dnbGVDbGFzczogZnVuY3Rpb24obmFtZSwgd2hlbil7CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oaWR4KXsKICAgICAgIHZhciBjbHMgPSB0aGlzLmNsYXNzTmFtZSwgbmV3TmFtZSA9IGZ1bmNBcmcodGhpcywgbmFtZSwgaWR4LCBjbHMpOwogICAgICAgKCh3aGVuICE9PSB1bmRlZmluZWQgJiYgIXdoZW4pIHx8ICQodGhpcykuaGFzQ2xhc3MobmV3TmFtZSkpID8KICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcyhuZXdOYW1lKSA6ICQodGhpcykuYWRkQ2xhc3MobmV3TmFtZSkKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgJ2ZpbHRlcixhZGQsbm90LGVxLGZpcnN0LGxhc3QsZmluZCxjbG9zZXN0LHBhcmVudHMscGFyZW50LGNoaWxkcmVuLHNpYmxpbmdzJy5zcGxpdCgnLCcpLmZvckVhY2goZnVuY3Rpb24ocHJvcGVydHkpewogICAgdmFyIGZuID0gJC5mbltwcm9wZXJ0eV07CiAgICAkLmZuW3Byb3BlcnR5XSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgcmV0ID0gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgcmV0LnByZXZPYmplY3QgPSB0aGlzOwogICAgICByZXR1cm4gcmV0OwogICAgfQogIH0pOwoKICBbJ3dpZHRoJywgJ2hlaWdodCddLmZvckVhY2goZnVuY3Rpb24ocHJvcGVydHkpewogICAgJC5mbltwcm9wZXJ0eV0gPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICB2YXIgb2Zmc2V0OwogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gKG9mZnNldCA9IHRoaXMub2Zmc2V0KCkpICYmIG9mZnNldFtwcm9wZXJ0eV0gfQogICAgICBlbHNlIHJldHVybiB0aGlzLmNzcyhwcm9wZXJ0eSwgdmFsdWUpOwogICAgfQogIH0pOwoKICBmdW5jdGlvbiBpbnNlcnQob3BlcmF0b3IsIHRhcmdldCwgbm9kZSkgewogICAgdmFyIHBhcmVudCA9ICghb3BlcmF0b3IgfHwgb3BlcmF0b3IgPT0gMykgPyB0YXJnZXQgOiB0YXJnZXQucGFyZW50Tm9kZTsKICAgIHBhcmVudC5pbnNlcnRCZWZvcmUobm9kZSwKICAgICAgIW9wZXJhdG9yID8gcGFyZW50LmZpcnN0Q2hpbGQgOiAgICAgICAgIC8vIHByZXBlbmQKICAgICAgb3BlcmF0b3IgPT0gMSA/IHRhcmdldC5uZXh0U2libGluZyA6ICAgIC8vIGFmdGVyCiAgICAgIG9wZXJhdG9yID09IDIgPyB0YXJnZXQgOiAgICAgICAgICAgICAgICAvLyBiZWZvcmUKICAgICAgbnVsbCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFwcGVuZAogIH0KCiAgZnVuY3Rpb24gdHJhdmVyc2VOb2RlIChub2RlLCBmdW4pIHsKICAgIGZ1bihub2RlKTsKICAgIGZvciAoa2V5IGluIG5vZGUuY2hpbGROb2RlcykgewogICAgICB0cmF2ZXJzZU5vZGUobm9kZS5jaGlsZE5vZGVzW2tleV0sIGZ1bik7CiAgICB9CiAgfQoKICBhZGphY2VuY3lPcGVyYXRvcnMuZm9yRWFjaChmdW5jdGlvbihrZXksIG9wZXJhdG9yKSB7CiAgICAkLmZuW2tleV0gPSBmdW5jdGlvbihodG1sKXsKICAgICAgdmFyIG5vZGVzID0gdHlwZW9mKGh0bWwpID09ICdvYmplY3QnID8gaHRtbCA6IGZyYWdtZW50KGh0bWwpOwogICAgICBpZiAoISgnbGVuZ3RoJyBpbiBub2RlcykpIG5vZGVzID0gW25vZGVzXTsKICAgICAgaWYgKG5vZGVzLmxlbmd0aCA8IDEpIHJldHVybiB0aGlzOwogICAgICB2YXIgc2l6ZSA9IHRoaXMubGVuZ3RoLCBjb3B5QnlDbG9uZSA9IHNpemUgPiAxLCBpblJldmVyc2UgPSBvcGVyYXRvciA8IDI7CgogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGluZGV4LCB0YXJnZXQpewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBub2RlID0gbm9kZXNbaW5SZXZlcnNlID8gbm9kZXMubGVuZ3RoLWktMSA6IGldOwogICAgICAgICAgdHJhdmVyc2VOb2RlKG5vZGUsIGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICAgIGlmIChub2RlLm5vZGVOYW1lICE9IG51bGwgJiYgbm9kZS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09PSAnU0NSSVBUJykgewogICAgICAgICAgICAgIHdpbmRvd1snZXZhbCddLmNhbGwod2luZG93LCBub2RlLmlubmVySFRNTCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKGNvcHlCeUNsb25lICYmIGluZGV4IDwgc2l6ZSAtIDEpIG5vZGUgPSBub2RlLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICAgIGluc2VydChvcGVyYXRvciwgdGFyZ2V0LCBub2RlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICB9KTsKCiAgcmV2ZXJzZUFkamFjZW5jeU9wZXJhdG9ycy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgJC5mbltrZXkrJ1RvJ10gPSBmdW5jdGlvbihodG1sKXsKICAgICAgaWYgKHR5cGVvZihodG1sKSAhPSAnb2JqZWN0JykgaHRtbCA9ICQoaHRtbCk7CiAgICAgIGh0bWxba2V5XSh0aGlzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogIH0pOwoKICBaLnByb3RvdHlwZSA9ICQuZm47CgogIHJldHVybiAkOwp9KSgpOwoKJyQnIGluIHdpbmRvdyB8fCAod2luZG93LiQgPSBaZXB0byk7Ci8vICAgICBaZXB0by5qcwovLyAgICAgKGMpIDIwMTAsIDIwMTEgVGhvbWFzIEZ1Y2hzCi8vICAgICBaZXB0by5qcyBtYXkgYmUgZnJlZWx5IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KCihmdW5jdGlvbigkKXsKICB2YXIgJCQgPSAkLnFzYSwgaGFuZGxlcnMgPSB7fSwgX3ppZCA9IDE7CiAgZnVuY3Rpb24gemlkKGVsZW1lbnQpIHsKICAgIHJldHVybiBlbGVtZW50Ll96aWQgfHwgKGVsZW1lbnQuX3ppZCA9IF96aWQrKyk7CiAgfQogIGZ1bmN0aW9uIGZpbmRIYW5kbGVycyhlbGVtZW50LCBldmVudCwgZm4sIHNlbGVjdG9yKSB7CiAgICBldmVudCA9IHBhcnNlKGV2ZW50KTsKICAgIGlmIChldmVudC5ucykgdmFyIG1hdGNoZXIgPSBtYXRjaGVyRm9yKGV2ZW50Lm5zKTsKICAgIHJldHVybiAoaGFuZGxlcnNbemlkKGVsZW1lbnQpXSB8fCBbXSkuZmlsdGVyKGZ1bmN0aW9uKGhhbmRsZXIpIHsKICAgICAgcmV0dXJuIGhhbmRsZXIKICAgICAgICAmJiAoIWV2ZW50LmUgIHx8IGhhbmRsZXIuZSA9PSBldmVudC5lKQogICAgICAgICYmICghZXZlbnQubnMgfHwgbWF0Y2hlci50ZXN0KGhhbmRsZXIubnMpKQogICAgICAgICYmICghZm4gICAgICAgfHwgaGFuZGxlci5mbiA9PSBmbikKICAgICAgICAmJiAoIXNlbGVjdG9yIHx8IGhhbmRsZXIuc2VsID09IHNlbGVjdG9yKTsKICAgIH0pOwogIH0KICBmdW5jdGlvbiBwYXJzZShldmVudCkgewogICAgdmFyIHBhcnRzID0gKCcnICsgZXZlbnQpLnNwbGl0KCcuJyk7CiAgICByZXR1cm4ge2U6IHBhcnRzWzBdLCBuczogcGFydHMuc2xpY2UoMSkuc29ydCgpLmpvaW4oJyAnKX07CiAgfQogIGZ1bmN0aW9uIG1hdGNoZXJGb3IobnMpIHsKICAgIHJldHVybiBuZXcgUmVnRXhwKCcoPzpefCApJyArIG5zLnJlcGxhY2UoJyAnLCAnIC4qID8nKSArICcoPzogfCQpJyk7CiAgfQoKICBmdW5jdGlvbiBhZGQoZWxlbWVudCwgZXZlbnRzLCBmbiwgc2VsZWN0b3IsIGRlbGVnYXRlKXsKICAgIHZhciBpZCA9IHppZChlbGVtZW50KSwgc2V0ID0gKGhhbmRsZXJzW2lkXSB8fCAoaGFuZGxlcnNbaWRdID0gW10pKTsKICAgIGV2ZW50cy5zcGxpdCgvXHMvKS5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgdmFyIGNhbGxiYWNrID0gZGVsZWdhdGUgfHwgZm47CiAgICAgIHZhciBwcm94eWZuID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IGNhbGxiYWNrLmFwcGx5KGVsZW1lbnQsIFtldmVudF0uY29uY2F0KGV2ZW50LmRhdGEpKTsKICAgICAgICBpZiAocmVzdWx0ID09PSBmYWxzZSkgewogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgdmFyIGhhbmRsZXIgPSAkLmV4dGVuZChwYXJzZShldmVudCksIHtmbjogZm4sIHByb3h5OiBwcm94eWZuLCBzZWw6IHNlbGVjdG9yLCBkZWw6IGRlbGVnYXRlLCBpOiBzZXQubGVuZ3RofSk7CiAgICAgIHNldC5wdXNoKGhhbmRsZXIpOwogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoaGFuZGxlci5lLCBwcm94eWZuLCBmYWxzZSk7CiAgICB9KTsKICB9CiAgZnVuY3Rpb24gcmVtb3ZlKGVsZW1lbnQsIGV2ZW50cywgZm4sIHNlbGVjdG9yKXsKICAgIHZhciBpZCA9IHppZChlbGVtZW50KTsKICAgIChldmVudHMgfHwgJycpLnNwbGl0KC9ccy8pLmZvckVhY2goZnVuY3Rpb24oZXZlbnQpewogICAgICBmaW5kSGFuZGxlcnMoZWxlbWVudCwgZXZlbnQsIGZuLCBzZWxlY3RvcikuZm9yRWFjaChmdW5jdGlvbihoYW5kbGVyKXsKICAgICAgICBkZWxldGUgaGFuZGxlcnNbaWRdW2hhbmRsZXIuaV07CiAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGhhbmRsZXIuZSwgaGFuZGxlci5wcm94eSwgZmFsc2UpOwogICAgICB9KTsKICAgIH0pOwogIH0KCiAgJC5ldmVudCA9IHsgYWRkOiBhZGQsIHJlbW92ZTogcmVtb3ZlIH0KCiAgJC5mbi5iaW5kID0gZnVuY3Rpb24oZXZlbnQsIGNhbGxiYWNrKXsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsKICAgICAgYWRkKHRoaXMsIGV2ZW50LCBjYWxsYmFjayk7CiAgICB9KTsKICB9OwogICQuZm4udW5iaW5kID0gZnVuY3Rpb24oZXZlbnQsIGNhbGxiYWNrKXsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsKICAgICAgcmVtb3ZlKHRoaXMsIGV2ZW50LCBjYWxsYmFjayk7CiAgICB9KTsKICB9OwogICQuZm4ub25lID0gZnVuY3Rpb24oZXZlbnQsIGNhbGxiYWNrKXsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBhZGQodGhpcywgZXZlbnQsIGZ1bmN0aW9uIHdyYXBwZXIoZXZ0KXsKICAgICAgICBjYWxsYmFjay5jYWxsKHNlbGYsIGV2dCk7CiAgICAgICAgcmVtb3ZlKHNlbGYsIGV2ZW50LCBhcmd1bWVudHMuY2FsbGVlKTsKICAgICAgfSk7CiAgICB9KTsKICB9OwoKICB2YXIgcmV0dXJuVHJ1ZSA9IGZ1bmN0aW9uKCl7cmV0dXJuIHRydWV9LAogICAgICByZXR1cm5GYWxzZSA9IGZ1bmN0aW9uKCl7cmV0dXJuIGZhbHNlfSwKICAgICAgZXZlbnRNZXRob2RzID0gewogICAgICAgIHByZXZlbnREZWZhdWx0OiAnaXNEZWZhdWx0UHJldmVudGVkJywKICAgICAgICBzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb246ICdpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCcsCiAgICAgICAgc3RvcFByb3BhZ2F0aW9uOiAnaXNQcm9wYWdhdGlvblN0b3BwZWQnCiAgICAgIH07CiAgZnVuY3Rpb24gY3JlYXRlUHJveHkoZXZlbnQpIHsKICAgIHZhciBwcm94eSA9ICQuZXh0ZW5kKHtvcmlnaW5hbEV2ZW50OiBldmVudH0sIGV2ZW50KTsKICAgICQuZWFjaChldmVudE1ldGhvZHMsIGZ1bmN0aW9uKG5hbWUsIHByZWRpY2F0ZSkgewogICAgICBwcm94eVtuYW1lXSA9IGZ1bmN0aW9uKCl7CiAgICAgICAgdGhpc1twcmVkaWNhdGVdID0gcmV0dXJuVHJ1ZTsKICAgICAgICByZXR1cm4gZXZlbnRbbmFtZV0uYXBwbHkoZXZlbnQsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICAgIHByb3h5W3ByZWRpY2F0ZV0gPSByZXR1cm5GYWxzZTsKICAgIH0pCiAgICByZXR1cm4gcHJveHk7CiAgfQoKICAkLmZuLmRlbGVnYXRlID0gZnVuY3Rpb24oc2VsZWN0b3IsIGV2ZW50LCBjYWxsYmFjayl7CiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGksIGVsZW1lbnQpewogICAgICBhZGQoZWxlbWVudCwgZXZlbnQsIGNhbGxiYWNrLCBzZWxlY3RvciwgZnVuY3Rpb24oZSwgZGF0YSl7CiAgICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0LCBub2RlcyA9ICQkKGVsZW1lbnQsIHNlbGVjdG9yKTsKICAgICAgICB3aGlsZSAodGFyZ2V0ICYmIG5vZGVzLmluZGV4T2YodGFyZ2V0KSA8IDApIHRhcmdldCA9IHRhcmdldC5wYXJlbnROb2RlOwogICAgICAgIGlmICh0YXJnZXQgJiYgISh0YXJnZXQgPT09IGVsZW1lbnQpICYmICEodGFyZ2V0ID09PSBkb2N1bWVudCkpIHsKICAgICAgICAgIGNhbGxiYWNrLmNhbGwodGFyZ2V0LCAkLmV4dGVuZChjcmVhdGVQcm94eShlKSwgewogICAgICAgICAgICBjdXJyZW50VGFyZ2V0OiB0YXJnZXQsIGxpdmVGaXJlZDogZWxlbWVudAogICAgICAgICAgfSksIGRhdGEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9OwogICQuZm4udW5kZWxlZ2F0ZSA9IGZ1bmN0aW9uKHNlbGVjdG9yLCBldmVudCwgY2FsbGJhY2spewogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpewogICAgICByZW1vdmUodGhpcywgZXZlbnQsIGNhbGxiYWNrLCBzZWxlY3Rvcik7CiAgICB9KTsKICB9CgogICQuZm4ubGl2ZSA9IGZ1bmN0aW9uKGV2ZW50LCBjYWxsYmFjayl7CiAgICAkKGRvY3VtZW50LmJvZHkpLmRlbGVnYXRlKHRoaXMuc2VsZWN0b3IsIGV2ZW50LCBjYWxsYmFjayk7CiAgICByZXR1cm4gdGhpczsKICB9OwogICQuZm4uZGllID0gZnVuY3Rpb24oZXZlbnQsIGNhbGxiYWNrKXsKICAgICQoZG9jdW1lbnQuYm9keSkudW5kZWxlZ2F0ZSh0aGlzLnNlbGVjdG9yLCBldmVudCwgY2FsbGJhY2spOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgJC5mbi50cmlnZ2VyID0gZnVuY3Rpb24oZXZlbnQsIGRhdGEpewogICAgaWYgKHR5cGVvZiBldmVudCA9PSAnc3RyaW5nJykgZXZlbnQgPSAkLkV2ZW50KGV2ZW50KTsKICAgIGV2ZW50LmRhdGEgPSBkYXRhOwogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpeyB0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpIH0pOwogIH07CgogIC8vIHRyaWdnZXJzIGV2ZW50IGhhbmRsZXJzIG9uIGN1cnJlbnQgZWxlbWVudCBqdXN0IGFzIGlmIGFuIGV2ZW50IG9jY3VycmVkLAogIC8vIGRvZXNuJ3QgdHJpZ2dlciBhbiBhY3R1YWwgZXZlbnQsIGRvZXNuJ3QgYnViYmxlCiAgJC5mbi50cmlnZ2VySGFuZGxlciA9IGZ1bmN0aW9uKGV2ZW50LCBkYXRhKXsKICAgIHZhciBlLCByZXN1bHQ7CiAgICB0aGlzLmVhY2goZnVuY3Rpb24oaSwgZWxlbWVudCl7CiAgICAgIGUgPSBjcmVhdGVQcm94eSh0eXBlb2YgZXZlbnQgPT0gJ3N0cmluZycgPyAkLkV2ZW50KGV2ZW50KSA6IGV2ZW50KTsKICAgICAgZS5kYXRhID0gZGF0YTsgZS50YXJnZXQgPSBlbGVtZW50OwogICAgICAkLmVhY2goZmluZEhhbmRsZXJzKGVsZW1lbnQsIGV2ZW50LnR5cGUgfHwgZXZlbnQpLCBmdW5jdGlvbihpLCBoYW5kbGVyKXsKICAgICAgICByZXN1bHQgPSBoYW5kbGVyLnByb3h5KGUpOwogICAgICAgIGlmIChlLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKCkpIHJldHVybiBmYWxzZTsKICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gc2hvcnRjdXQgbWV0aG9kcyBmb3IgYC5iaW5kKGV2ZW50LCBmbilgIGZvciBlYWNoIGV2ZW50IHR5cGUKICAoJ2ZvY3VzaW4gZm9jdXNvdXQgbG9hZCByZXNpemUgc2Nyb2xsIHVubG9hZCBjbGljayBkYmxjbGljayAnKwogICdtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0ICcrCiAgJ2NoYW5nZSBzZWxlY3Qga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvcicpLnNwbGl0KCcgJykuZm9yRWFjaChmdW5jdGlvbihldmVudCkgewogICAgJC5mbltldmVudF0gPSBmdW5jdGlvbihjYWxsYmFjayl7IHJldHVybiB0aGlzLmJpbmQoZXZlbnQsIGNhbGxiYWNrKSB9OwogIH0pOwoKICBbJ2ZvY3VzJywgJ2JsdXInXS5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpIHsKICAgICQuZm5bbmFtZV0gPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgICBpZiAoY2FsbGJhY2spIHRoaXMuYmluZChuYW1lLCBjYWxsYmFjayk7CiAgICAgIGVsc2UgaWYgKHRoaXMubGVuZ3RoKSB0cnkgeyB0aGlzLmdldCgwKVtuYW1lXSgpIH0gY2F0Y2goZSl7fTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogIH0pOwoKICAkLkV2ZW50ID0gZnVuY3Rpb24odHlwZSwgcHJvcHMpIHsKICAgIHZhciBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudHMnKTsKICAgIGlmIChwcm9wcykgJC5leHRlbmQoZXZlbnQsIHByb3BzKTsKICAgIGV2ZW50LmluaXRFdmVudCh0eXBlLCAhKHByb3BzICYmIHByb3BzLmJ1YmJsZXMgPT09IGZhbHNlKSwgdHJ1ZSk7CiAgICByZXR1cm4gZXZlbnQ7CiAgfTsKCn0pKFplcHRvKTsKLy8gICAgIFplcHRvLmpzCi8vICAgICAoYykgMjAxMCwgMjAxMSBUaG9tYXMgRnVjaHMKLy8gICAgIFplcHRvLmpzIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgoKKGZ1bmN0aW9uKCQpewogIGZ1bmN0aW9uIGRldGVjdCh1YSl7CiAgICB2YXIgdWEgPSB1YSwgb3MgPSB7fSwKICAgICAgYW5kcm9pZCA9IHVhLm1hdGNoKC8oQW5kcm9pZClccysoW1xkLl0rKS8pLAogICAgICBpcGFkID0gdWEubWF0Y2goLyhpUGFkKS4qT1NccyhbXGRfXSspLyksCiAgICAgIGlwaG9uZSA9ICFpcGFkICYmIHVhLm1hdGNoKC8oaVBob25lXHNPUylccyhbXGRfXSspLyksCiAgICAgIHdlYm9zID0gdWEubWF0Y2goLyh3ZWJPU3xocHdPUylbXHNcL10oW1xkLl0rKS8pLAogICAgICB0b3VjaHBhZCA9IHdlYm9zICYmIHVhLm1hdGNoKC9Ub3VjaFBhZC8pLAogICAgICBibGFja2JlcnJ5ID0gdWEubWF0Y2goLyhCbGFja0JlcnJ5KS4qVmVyc2lvblwvKFtcZC5dKykvKTsKICAgIGlmIChhbmRyb2lkKSBvcy5hbmRyb2lkID0gdHJ1ZSwgb3MudmVyc2lvbiA9IGFuZHJvaWRbMl07CiAgICBpZiAoaXBob25lKSBvcy5pb3MgPSB0cnVlLCBvcy52ZXJzaW9uID0gaXBob25lWzJdLnJlcGxhY2UoL18vZywgJy4nKSwgb3MuaXBob25lID0gdHJ1ZTsKICAgIGlmIChpcGFkKSBvcy5pb3MgPSB0cnVlLCBvcy52ZXJzaW9uID0gaXBhZFsyXS5yZXBsYWNlKC9fL2csICcuJyksIG9zLmlwYWQgPSB0cnVlOwogICAgaWYgKHdlYm9zKSBvcy53ZWJvcyA9IHRydWUsIG9zLnZlcnNpb24gPSB3ZWJvc1syXTsKICAgIGlmICh0b3VjaHBhZCkgb3MudG91Y2hwYWQgPSB0cnVlOwogICAgaWYgKGJsYWNrYmVycnkpIG9zLmJsYWNrYmVycnkgPSB0cnVlLCBvcy52ZXJzaW9uID0gYmxhY2tiZXJyeVsyXTsKICAgIHJldHVybiBvczsKICB9CgogIC8vICMjIyAkLm9zCiAgLy8KICAvLyBPYmplY3QgY29udGFpbnMgaW5mb3JtYXRpb24gYWJvdXQgcnVubmluZyBlbnZpcm9ubWVudGFsCiAgLy8KICAvLyAqRXhhbXBsZToqCiAgLy8KICAvLyAgICAgJC5vcy5pb3MgICAgICAvLyA9PiB0cnVlIGlmIHJ1bm5pbmcgb24gQXBwbGUgaU9TCiAgLy8gICAgICQub3MuYW5kcm9pZCAgLy8gPT4gdHJ1ZSBpZiBydW5uaW5nIG9uIEFuZHJvaWQKICAvLyAgICAgJC5vcy53ZWJvcyAgICAvLyA9PiB0cnVlIGlmIHJ1bm5pbmcgb24gSFAvUGFsbSBXZWJPUwogIC8vICAgICAkLm9zLnRvdWNocGFkIC8vID0+IHRydWUgaWYgcnVubmluZyBvbiBhIEhQIFRvdWNoUGFkCiAgLy8gICAgICQub3MudmVyc2lvbiAgLy8gPT4gc3RyaW5nIHdpdGggdmVyc2lvbiBudW1iZXIsCiAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgIjQuMCIsICIzLjEuMSIsICIyLjEiLCBldGMuCiAgLy8gICAgICQub3MuaXBob25lICAgLy8gPT4gdHJ1ZSBpZiBydW5uaW5nIG9uIGlQaG9uZQogIC8vICAgICAkLm9zLmlwYWQgICAgIC8vID0+IHRydWUgaWYgcnVubmluZyBvbiBpUGFkCiAgLy8gICAgICQub3MuYmxhY2tiZXJyeSAvLyA9PiB0cnVlIGlmIHJ1bm5pbmcgb24gQmxhY2tCZXJyeQogIC8vCiAgJC5vcyA9IGRldGVjdChuYXZpZ2F0b3IudXNlckFnZW50KTsKICAkLl9fZGV0ZWN0ID0gZGV0ZWN0OwoKICB2YXIgdiA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL1dlYktpdFwvKFtcZC5dKykvKTsKICAkLmJyb3dzZXIgPSB2ID8geyB3ZWJraXQ6IHRydWUsIHZlcnNpb246IHZbMV0gfSA6IHsgd2Via2l0OiBmYWxzZSB9OwoKfSkoWmVwdG8pOwovLyAgICAgWmVwdG8uanMKLy8gICAgIChjKSAyMDEwLCAyMDExIFRob21hcyBGdWNocwovLyAgICAgWmVwdG8uanMgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCgooZnVuY3Rpb24oJCwgdW5kZWZpbmVkKXsKICB2YXIgc3VwcG9ydGVkVHJhbnNmb3JtcyA9IFsKICAgICdzY2FsZScsICdzY2FsZVgnLCAnc2NhbGVZJywKICAgICd0cmFuc2xhdGUnLCAndHJhbnNsYXRlWCcsICd0cmFuc2xhdGVZJywgJ3RyYW5zbGF0ZTNkJywKICAgICdza2V3JywgICAgICAnc2tld1gnLCAgICAgICdza2V3WScsCiAgICAncm90YXRlJywgICAgJ3JvdGF0ZVgnLCAgICAncm90YXRlWScsICAgICdyb3RhdGVaJywgICAgJ3JvdGF0ZTNkJywKICAgICdtYXRyaXgnCiAgXTsKCiAgJC5mbi5hbmltID0gZnVuY3Rpb24ocHJvcGVydGllcywgZHVyYXRpb24sIGVhc2UsIGNhbGxiYWNrKXsKICAgIHZhciB0cmFuc2Zvcm1zID0gW10sIGNzc1Byb3BlcnRpZXMgPSB7fSwga2V5LCB0aGF0ID0gdGhpcywgd3JhcHBlZENhbGxiYWNrOwoKICAgIGZvciAoa2V5IGluIHByb3BlcnRpZXMpCiAgICAgIGlmIChzdXBwb3J0ZWRUcmFuc2Zvcm1zLmluZGV4T2Yoa2V5KT49MCkKICAgICAgICB0cmFuc2Zvcm1zLnB1c2goa2V5ICsgJygnICsgcHJvcGVydGllc1trZXldICsgJyknKTsKICAgICAgZWxzZQogICAgICAgIGNzc1Byb3BlcnRpZXNba2V5XSA9IHByb3BlcnRpZXNba2V5XTsKCiAgICB3cmFwcGVkQ2FsbGJhY2sgPSBmdW5jdGlvbigpewogICAgICB0aGF0LmNzcyh7Jy13ZWJraXQtdHJhbnNpdGlvbic6J25vbmUnfSk7CiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7CiAgICB9CgogICAgaWYgKGR1cmF0aW9uID4gMCkKICAgICAgdGhpcy5vbmUoJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCB3cmFwcGVkQ2FsbGJhY2spOwogICAgZWxzZQogICAgICBzZXRUaW1lb3V0KHdyYXBwZWRDYWxsYmFjaywgMCk7CgogICAgaWYgKHRyYW5zZm9ybXMubGVuZ3RoID4gMCkgewogICAgICBjc3NQcm9wZXJ0aWVzWyctd2Via2l0LXRyYW5zZm9ybSddID0gdHJhbnNmb3Jtcy5qb2luKCcgJykKICAgIH0KCiAgICBjc3NQcm9wZXJ0aWVzWyctd2Via2l0LXRyYW5zaXRpb24nXSA9ICdhbGwgJyArIChkdXJhdGlvbiAhPT0gdW5kZWZpbmVkID8gZHVyYXRpb24gOiAwLjUpICsgJ3MgJyArIChlYXNlIHx8ICcnKTsKCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgdGhhdC5jc3MoY3NzUHJvcGVydGllcyk7CiAgICB9LCAwKTsKCiAgICByZXR1cm4gdGhpczsKICB9Cn0pKFplcHRvKTsKLy8gICAgIFplcHRvLmpzCi8vICAgICAoYykgMjAxMCwgMjAxMSBUaG9tYXMgRnVjaHMKLy8gICAgIFplcHRvLmpzIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgoKKGZ1bmN0aW9uKCQpewogIHZhciBqc29ucElEID0gMCwKICAgICAgaXNPYmplY3QgPSAkLmlzT2JqZWN0LAogICAgICBrZXk7CgogIC8vIEVtcHR5IGZ1bmN0aW9uLCB1c2VkIGFzIGRlZmF1bHQgY2FsbGJhY2sKICBmdW5jdGlvbiBlbXB0eSgpIHt9CgogIC8vICMjIyAkLmFqYXhKU09OUAogIC8vCiAgLy8gTG9hZCBKU09OIGZyb20gYSBzZXJ2ZXIgaW4gYSBkaWZmZXJlbnQgZG9tYWluIChKU09OUCkKICAvLwogIC8vICpBcmd1bWVudHM6KgogIC8vCiAgLy8gICAgIG9wdGlvbnMg4oCUIG9iamVjdCB0aGF0IGNvbmZpZ3VyZSB0aGUgcmVxdWVzdCwKICAvLyAgICAgICAgICAgICAgIHNlZSBhdmFsaWFibGUgb3B0aW9ucyBiZWxvdwogIC8vCiAgLy8gKkF2YWxpYWJsZSBvcHRpb25zOioKICAvLwogIC8vICAgICB1cmwgICAgIOKAlCB1cmwgdG8gd2hpY2ggdGhlIHJlcXVlc3QgaXMgc2VudAogIC8vICAgICBzdWNjZXNzIOKAlCBjYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIGlmIHRoZSByZXF1ZXN0IHN1Y2NlZWRzCiAgLy8KICAvLyAqRXhhbXBsZToqCiAgLy8KICAvLyAgICAgJC5hamF4SlNPTlAoewogIC8vICAgICAgICB1cmw6ICAgICAnaHR0cDovL2V4YW1wbGUuY29tL3Byb2plY3RzP2NhbGxiYWNrPT8nLAogIC8vICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogIC8vICAgICAgICAgICAgcHJvamVjdHMucHVzaChqc29uKTsKICAvLyAgICAgICAgfQogIC8vICAgICB9KTsKICAvLwogICQuYWpheEpTT05QID0gZnVuY3Rpb24ob3B0aW9ucyl7CiAgICB2YXIganNvbnBTdHJpbmcgPSAnanNvbnAnICsgKytqc29ucElELAogICAgICAgIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgd2luZG93W2pzb25wU3RyaW5nXSA9IGZ1bmN0aW9uKGRhdGEpewogICAgICBvcHRpb25zLnN1Y2Nlc3MoZGF0YSk7CiAgICAgIGRlbGV0ZSB3aW5kb3dbanNvbnBTdHJpbmddOwogICAgfTsKICAgIHNjcmlwdC5zcmMgPSBvcHRpb25zLnVybC5yZXBsYWNlKC89XD8vLCAnPScgKyBqc29ucFN0cmluZyk7CiAgICAkKCdoZWFkJykuYXBwZW5kKHNjcmlwdCk7CiAgfTsKCiAgLy8gIyMjICQuYWpheFNldHRpbmdzCiAgLy8KICAvLyBBSkFYIHNldHRpbmdzCiAgLy8KICAkLmFqYXhTZXR0aW5ncyA9IHsKICAgIC8vIERlZmF1bHQgdHlwZSBvZiByZXF1ZXN0CiAgICB0eXBlOiAnR0VUJywKICAgIC8vIENhbGxiYWNrIHRoYXQgaXMgZXhlY3V0ZWQgYmVmb3JlIHJlcXVlc3QKICAgIGJlZm9yZVNlbmQ6IGVtcHR5LAogICAgLy8gQ2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpZiB0aGUgcmVxdWVzdCBzdWNjZWVkcwogICAgc3VjY2VzczogZW1wdHksCiAgICAvLyBDYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIHRoZSB0aGUgc2VydmVyIGRyb3BzIGVycm9yCiAgICBlcnJvcjogZW1wdHksCiAgICAvLyBDYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIG9uIHJlcXVlc3QgY29tcGxldGUgKGJvdGg6IGVycm9yIGFuZCBzdWNjZXNzKQogICAgY29tcGxldGU6IGVtcHR5LAogICAgLy8gTUlNRSB0eXBlcyBtYXBwaW5nCiAgICBhY2NlcHRzOiB7CiAgICAgIHNjcmlwdDogJ3RleHQvamF2YXNjcmlwdCwgYXBwbGljYXRpb24vamF2YXNjcmlwdCcsCiAgICAgIGpzb246ICAgJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICB4bWw6ICAgICdhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sJywKICAgICAgaHRtbDogICAndGV4dC9odG1sJywKICAgICAgdGV4dDogICAndGV4dC9wbGFpbicKICAgIH0KICB9OwoKICAvLyAjIyMgJC5hamF4CiAgLy8KICAvLyBQZXJmb3JtIEFKQVggcmVxdWVzdAogIC8vCiAgLy8gKkFyZ3VtZW50czoqCiAgLy8KICAvLyAgICAgb3B0aW9ucyDigJQgb2JqZWN0IHRoYXQgY29uZmlndXJlIHRoZSByZXF1ZXN0LAogIC8vICAgICAgICAgICAgICAgc2VlIGF2YWxpYWJsZSBvcHRpb25zIGJlbG93CiAgLy8KICAvLyAqQXZhbGlhYmxlIG9wdGlvbnM6KgogIC8vCiAgLy8gICAgIHR5cGUgKCdHRVQnKSAgICAgICAgICDigJQgdHlwZSBvZiByZXF1ZXN0IEdFVCAvIFBPU1QKICAvLyAgICAgdXJsICh3aW5kb3cubG9jYXRpb24pIOKAlCB1cmwgdG8gd2hpY2ggdGhlIHJlcXVlc3QgaXMgc2VudAogIC8vICAgICBkYXRhICAgICAgICAgICAgICAgICAg4oCUIGRhdGEgdG8gc2VuZCB0byBzZXJ2ZXIsCiAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbiBiZSBzdHJpbmcgb3Igb2JqZWN0CiAgLy8gICAgIGRhdGFUeXBlICgnanNvbicpICAgICDigJQgd2hhdCByZXNwb25zZSB0eXBlIHlvdSBhY2NlcHQgZnJvbQogIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgc2VydmVyOgogIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnanNvbicsICd4bWwnLCAnaHRtbCcsIG9yICd0ZXh0JwogIC8vICAgICBzdWNjZXNzICAgICAgICAgICAgICAg4oCUIGNhbGxiYWNrIHRoYXQgaXMgZXhlY3V0ZWQgaWYKICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIHJlcXVlc3Qgc3VjY2VlZHMKICAvLyAgICAgZXJyb3IgICAgICAgICAgICAgICAgIOKAlCBjYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIGlmCiAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBzZXJ2ZXIgZHJvcHMgZXJyb3IKICAvLwogIC8vICpFeGFtcGxlOioKICAvLwogIC8vICAgICAkLmFqYXgoewogIC8vICAgICAgICB0eXBlOiAgICAgJ1BPU1QnLAogIC8vICAgICAgICB1cmw6ICAgICAgJy9wcm9qZWN0cycsCiAgLy8gICAgICAgIGRhdGE6ICAgICB7IG5hbWU6ICdaZXB0by5qcycgfSwKICAvLyAgICAgICAgZGF0YVR5cGU6ICdodG1sJywKICAvLyAgICAgICAgc3VjY2VzczogIGZ1bmN0aW9uIChkYXRhKSB7CiAgLy8gICAgICAgICAgICAkKCdib2R5JykuYXBwZW5kKGRhdGEpOwogIC8vICAgICAgICB9LAogIC8vICAgICAgICBlcnJvcjogICAgZnVuY3Rpb24gKHhociwgdHlwZSkgewogIC8vICAgICAgICAgICAgYWxlcnQoJ0Vycm9yIScpOwogIC8vICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vCiAgJC5hamF4ID0gZnVuY3Rpb24ob3B0aW9ucyl7CiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgIGZvciAoa2V5IGluICQuYWpheFNldHRpbmdzKSBpZiAoIXNldHRpbmdzW2tleV0pIHNldHRpbmdzW2tleV0gPSAkLmFqYXhTZXR0aW5nc1trZXldOwoKICAgIGlmICgvPVw/Ly50ZXN0KHNldHRpbmdzLnVybCkpIHJldHVybiAkLmFqYXhKU09OUChzZXR0aW5ncyk7CgogICAgaWYgKCFzZXR0aW5ncy51cmwpIHNldHRpbmdzLnVybCA9IHdpbmRvdy5sb2NhdGlvbi50b1N0cmluZygpOwogICAgaWYgKHNldHRpbmdzLmRhdGEgJiYgIXNldHRpbmdzLmNvbnRlbnRUeXBlKSBzZXR0aW5ncy5jb250ZW50VHlwZSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOwogICAgaWYgKGlzT2JqZWN0KHNldHRpbmdzLmRhdGEpKSBzZXR0aW5ncy5kYXRhID0gJC5wYXJhbShzZXR0aW5ncy5kYXRhKTsKCiAgICBpZiAoc2V0dGluZ3MudHlwZS5tYXRjaCgvZ2V0L2kpICYmIHNldHRpbmdzLmRhdGEpIHsKICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gc2V0dGluZ3MuZGF0YTsKICAgICAgaWYgKHNldHRpbmdzLnVybC5tYXRjaCgvXD8uKj0vKSkgewogICAgICAgIHF1ZXJ5U3RyaW5nID0gJyYnICsgcXVlcnlTdHJpbmc7CiAgICAgIH0gZWxzZSBpZiAocXVlcnlTdHJpbmdbMF0gIT0gJz8nKSB7CiAgICAgICAgcXVlcnlTdHJpbmcgPSAnPycgKyBxdWVyeVN0cmluZzsKICAgICAgfQogICAgICBzZXR0aW5ncy51cmwgKz0gcXVlcnlTdHJpbmc7CiAgICB9CgogICAgdmFyIG1pbWUgPSBzZXR0aW5ncy5hY2NlcHRzW3NldHRpbmdzLmRhdGFUeXBlXSwKICAgICAgICB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCiAgICBzZXR0aW5ncy5oZWFkZXJzID0gJC5leHRlbmQoeydYLVJlcXVlc3RlZC1XaXRoJzogJ1hNTEh0dHBSZXF1ZXN0J30sIHNldHRpbmdzLmhlYWRlcnMgfHwge30pOwogICAgaWYgKG1pbWUpIHNldHRpbmdzLmhlYWRlcnNbJ0FjY2VwdCddID0gbWltZTsKCiAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKXsKICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09IDQpIHsKICAgICAgICB2YXIgcmVzdWx0LCBlcnJvciA9IGZhbHNlOwogICAgICAgIGlmICgoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkgfHwgeGhyLnN0YXR1cyA9PSAwKSB7CiAgICAgICAgICBpZiAobWltZSA9PSAnYXBwbGljYXRpb24vanNvbicgJiYgISh4aHIucmVzcG9uc2VUZXh0ID09ICcnKSkgewogICAgICAgICAgICB0cnkgeyByZXN1bHQgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpOyB9CiAgICAgICAgICAgIGNhdGNoIChlKSB7IGVycm9yID0gZTsgfQogICAgICAgICAgfQogICAgICAgICAgZWxzZSByZXN1bHQgPSB4aHIucmVzcG9uc2VUZXh0OwogICAgICAgICAgaWYgKGVycm9yKSBzZXR0aW5ncy5lcnJvcih4aHIsICdwYXJzZXJlcnJvcicsIGVycm9yKTsKICAgICAgICAgIGVsc2Ugc2V0dGluZ3Muc3VjY2VzcyhyZXN1bHQsICdzdWNjZXNzJywgeGhyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgc2V0dGluZ3MuZXJyb3IoeGhyLCAnZXJyb3InKTsKICAgICAgICB9CiAgICAgICAgc2V0dGluZ3MuY29tcGxldGUoeGhyLCBlcnJvciA/ICdlcnJvcicgOiAnc3VjY2VzcycpOwogICAgICB9CiAgICB9OwoKICAgIHhoci5vcGVuKHNldHRpbmdzLnR5cGUsIHNldHRpbmdzLnVybCwgdHJ1ZSk7CiAgICBpZiAoc2V0dGluZ3MuYmVmb3JlU2VuZCh4aHIsIHNldHRpbmdzKSA9PT0gZmFsc2UpIHsKICAgICAgeGhyLmFib3J0KCk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoc2V0dGluZ3MuY29udGVudFR5cGUpIHNldHRpbmdzLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gc2V0dGluZ3MuY29udGVudFR5cGU7CiAgICBmb3IgKG5hbWUgaW4gc2V0dGluZ3MuaGVhZGVycykgeGhyLnNldFJlcXVlc3RIZWFkZXIobmFtZSwgc2V0dGluZ3MuaGVhZGVyc1tuYW1lXSk7CiAgICB4aHIuc2VuZChzZXR0aW5ncy5kYXRhKTsKCiAgICByZXR1cm4geGhyOwogIH07CgogIC8vICMjIyAkLmdldAogIC8vCiAgLy8gTG9hZCBkYXRhIGZyb20gdGhlIHNlcnZlciB1c2luZyBhIEdFVCByZXF1ZXN0CiAgLy8KICAvLyAqQXJndW1lbnRzOioKICAvLwogIC8vICAgICB1cmwgICAgIOKAlCB1cmwgdG8gd2hpY2ggdGhlIHJlcXVlc3QgaXMgc2VudAogIC8vICAgICBzdWNjZXNzIOKAlCBjYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIGlmIHRoZSByZXF1ZXN0IHN1Y2NlZWRzCiAgLy8KICAvLyAqRXhhbXBsZToqCiAgLy8KICAvLyAgICAgJC5nZXQoCiAgLy8gICAgICAgICcvcHJvamVjdHMvNDInLAogIC8vICAgICAgICBmdW5jdGlvbiAoZGF0YSkgewogIC8vICAgICAgICAgICAgJCgnYm9keScpLmFwcGVuZChkYXRhKTsKICAvLyAgICAgICAgfQogIC8vICAgICApOwogIC8vCiAgJC5nZXQgPSBmdW5jdGlvbih1cmwsIHN1Y2Nlc3MpeyAkLmFqYXgoeyB1cmw6IHVybCwgc3VjY2Vzczogc3VjY2VzcyB9KSB9OwoKICAvLyAjIyMgJC5wb3N0CiAgLy8KICAvLyBMb2FkIGRhdGEgZnJvbSB0aGUgc2VydmVyIHVzaW5nIFBPU1QgcmVxdWVzdAogIC8vCiAgLy8gKkFyZ3VtZW50czoqCiAgLy8KICAvLyAgICAgdXJsICAgICAgICDigJQgdXJsIHRvIHdoaWNoIHRoZSByZXF1ZXN0IGlzIHNlbnQKICAvLyAgICAgW2RhdGFdICAgICDigJQgZGF0YSB0byBzZW5kIHRvIHNlcnZlciwgY2FuIGJlIHN0cmluZyBvciBvYmplY3QKICAvLyAgICAgW3N1Y2Nlc3NdICDigJQgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpZiB0aGUgcmVxdWVzdCBzdWNjZWVkcwogIC8vICAgICBbZGF0YVR5cGVdIOKAlCB0eXBlIG9mIGV4cGVjdGVkIHJlc3BvbnNlCiAgLy8gICAgICAgICAgICAgICAgICAnanNvbicsICd4bWwnLCAnaHRtbCcsIG9yICd0ZXh0JwogIC8vCiAgLy8gKkV4YW1wbGU6KgogIC8vCiAgLy8gICAgICQucG9zdCgKICAvLyAgICAgICAgJy9wcm9qZWN0cycsCiAgLy8gICAgICAgIHsgbmFtZTogJ1plcHRvLmpzJyB9LAogIC8vICAgICAgICBmdW5jdGlvbiAoZGF0YSkgewogIC8vICAgICAgICAgICAgJCgnYm9keScpLmFwcGVuZChkYXRhKTsKICAvLyAgICAgICAgfSwKICAvLyAgICAgICAgJ2h0bWwnCiAgLy8gICAgICk7CiAgLy8KICAkLnBvc3QgPSBmdW5jdGlvbih1cmwsIGRhdGEsIHN1Y2Nlc3MsIGRhdGFUeXBlKXsKICAgIGlmICgkLmlzRnVuY3Rpb24oZGF0YSkpIGRhdGFUeXBlID0gZGF0YVR5cGUgfHwgc3VjY2Vzcywgc3VjY2VzcyA9IGRhdGEsIGRhdGEgPSBudWxsOwogICAgJC5hamF4KHsgdHlwZTogJ1BPU1QnLCB1cmw6IHVybCwgZGF0YTogZGF0YSwgc3VjY2Vzczogc3VjY2VzcywgZGF0YVR5cGU6IGRhdGFUeXBlIH0pOwogIH07CgogIC8vICMjIyAkLmdldEpTT04KICAvLwogIC8vIExvYWQgSlNPTiBmcm9tIHRoZSBzZXJ2ZXIgdXNpbmcgR0VUIHJlcXVlc3QKICAvLwogIC8vICpBcmd1bWVudHM6KgogIC8vCiAgLy8gICAgIHVybCAgICAg4oCUIHVybCB0byB3aGljaCB0aGUgcmVxdWVzdCBpcyBzZW50CiAgLy8gICAgIHN1Y2Nlc3Mg4oCUIGNhbGxiYWNrIHRoYXQgaXMgZXhlY3V0ZWQgaWYgdGhlIHJlcXVlc3Qgc3VjY2VlZHMKICAvLwogIC8vICpFeGFtcGxlOioKICAvLwogIC8vICAgICAkLmdldEpTT04oCiAgLy8gICAgICAgICcvcHJvamVjdHMvNDInLAogIC8vICAgICAgICBmdW5jdGlvbiAoanNvbikgewogIC8vICAgICAgICAgICAgcHJvamVjdHMucHVzaChqc29uKTsKICAvLyAgICAgICAgfQogIC8vICAgICApOwogIC8vCiAgJC5nZXRKU09OID0gZnVuY3Rpb24odXJsLCBzdWNjZXNzKXsgJC5hamF4KHsgdXJsOiB1cmwsIHN1Y2Nlc3M6IHN1Y2Nlc3MsIGRhdGFUeXBlOiAnanNvbicgfSkgfTsKCiAgLy8gIyMjICQuZm4ubG9hZAogIC8vCiAgLy8gTG9hZCBkYXRhIGZyb20gdGhlIHNlcnZlciBpbnRvIGFuIGVsZW1lbnQKICAvLwogIC8vICpBcmd1bWVudHM6KgogIC8vCiAgLy8gICAgIHVybCAgICAg4oCUIHVybCB0byB3aGljaCB0aGUgcmVxdWVzdCBpcyBzZW50CiAgLy8gICAgIFtzdWNjZXNzXSDigJQgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpZiB0aGUgcmVxdWVzdCBzdWNjZWVkcwogIC8vCiAgLy8gKkV4YW1wbGVzOioKICAvLwogIC8vICAgICAkKCcjcHJvamVjdF9jb250YWluZXInKS5nZXQoCiAgLy8gICAgICAgICcvcHJvamVjdHMvNDInLAogIC8vICAgICAgICBmdW5jdGlvbiAoKSB7CiAgLy8gICAgICAgICAgICBhbGVydCgnUHJvamVjdCB3YXMgc3VjY2Vzc2Z1bGx5IGxvYWRlZCcpOwogIC8vICAgICAgICB9CiAgLy8gICAgICk7CiAgLy8KICAvLyAgICAgJCgnI3Byb2plY3RfY29tbWVudHMnKS5nZXQoCiAgLy8gICAgICAgICcvcHJvamVjdHMvNDIgI2NvbW1lbnRzJywKICAvLyAgICAgICAgZnVuY3Rpb24gKCkgewogIC8vICAgICAgICAgICAgYWxlcnQoJ0NvbW1lbnRzIHdhcyBzdWNjZXNzZnVsbHkgbG9hZGVkJyk7CiAgLy8gICAgICAgIH0KICAvLyAgICAgKTsKICAvLwogICQuZm4ubG9hZCA9IGZ1bmN0aW9uKHVybCwgc3VjY2Vzcyl7CiAgICBpZiAoIXRoaXMubGVuZ3RoKSByZXR1cm4gdGhpczsKICAgIHZhciBzZWxmID0gdGhpcywgcGFydHMgPSB1cmwuc3BsaXQoL1xzLyksIHNlbGVjdG9yOwogICAgaWYgKHBhcnRzLmxlbmd0aCA+IDEpIHVybCA9IHBhcnRzWzBdLCBzZWxlY3RvciA9IHBhcnRzWzFdOwogICAgJC5nZXQodXJsLCBmdW5jdGlvbihyZXNwb25zZSl7CiAgICAgIHNlbGYuaHRtbChzZWxlY3RvciA/CiAgICAgICAgJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSkuaHRtbChyZXNwb25zZSkuZmluZChzZWxlY3RvcikuaHRtbCgpCiAgICAgICAgOiByZXNwb25zZSk7CiAgICAgIHN1Y2Nlc3MgJiYgc3VjY2VzcygpOwogICAgfSk7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvLyAjIyMgJC5wYXJhbQogIC8vCiAgLy8gRW5jb2RlIG9iamVjdCBhcyBhIHN0cmluZyBmb3Igc3VibWlzc2lvbgogIC8vCiAgLy8gKkFyZ3VtZW50czoqCiAgLy8KICAvLyAgICAgb2JqIOKAlCBvYmplY3QgdG8gc2VyaWFsaXplCiAgLy8gICAgIFt2XSDigJQgcm9vdCBub2RlCiAgLy8KICAvLyAqRXhhbXBsZToqCiAgLy8KICAvLyAgICAgJC5wYXJhbSggeyBuYW1lOiAnWmVwdG8uanMnLCB2ZXJzaW9uOiAnMC42JyB9ICk7CiAgLy8KICAkLnBhcmFtID0gZnVuY3Rpb24ob2JqLCB2KXsKICAgIHZhciByZXN1bHQgPSBbXSwgYWRkID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSl7CiAgICAgIHJlc3VsdC5wdXNoKGVuY29kZVVSSUNvbXBvbmVudCh2ID8gdiArICdbJyArIGtleSArICddJyA6IGtleSkKICAgICAgICArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkpOwogICAgICB9LAogICAgICBpc09iakFycmF5ID0gJC5pc0FycmF5KG9iaik7CgogICAgZm9yKGtleSBpbiBvYmopCiAgICAgIGlmKGlzT2JqZWN0KG9ialtrZXldKSkKICAgICAgICByZXN1bHQucHVzaCgkLnBhcmFtKG9ialtrZXldLCAodiA/IHYgKyAnWycgKyBrZXkgKyAnXScgOiBrZXkpKSk7CiAgICAgIGVsc2UKICAgICAgICBhZGQoaXNPYmpBcnJheSA/ICcnIDoga2V5LCBvYmpba2V5XSk7CgogICAgcmV0dXJuIHJlc3VsdC5qb2luKCcmJykucmVwbGFjZSgnJTIwJywgJysnKTsKICB9Owp9KShaZXB0byk7Ci8vICAgICBaZXB0by5qcwovLyAgICAgKGMpIDIwMTAsIDIwMTEgVGhvbWFzIEZ1Y2hzCi8vICAgICBaZXB0by5qcyBtYXkgYmUgZnJlZWx5IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KCihmdW5jdGlvbiAoJCkgewoKICAvLyAjIyMgJC5mbi5zZXJpYWxpemVBcnJheQogIC8vCiAgLy8gRW5jb2RlIGEgc2V0IG9mIGZvcm0gZWxlbWVudHMgYXMgYW4gYXJyYXkgb2YgbmFtZXMgYW5kIHZhbHVlcwogIC8vCiAgLy8gKkV4YW1wbGU6KgogIC8vCiAgLy8gICAgICQoJyNsb2dpbl9mb3JtJykuc2VyaWFsaXplQXJyYXkoKTsKICAvLwogIC8vICByZXR1cm5zCiAgLy8KICAvLyAgICAgWwogIC8vICAgICAgICAgewogIC8vICAgICAgICAgICAgIG5hbWU6ICdlbWFpbCcsCiAgLy8gICAgICAgICAgICAgdmFsdWU6ICdrb3NzQG5vY29ycC5tZScKICAvLyAgICAgICAgIH0sCiAgLy8gICAgICAgICB7CiAgLy8gICAgICAgICAgICAgbmFtZTogJ3Bhc3N3b3JkJywKICAvLyAgICAgICAgICAgICB2YWx1ZTogJzEyMzQ1NicKICAvLyAgICAgICAgIH0KICAvLyAgICAgXQogIC8vCiAgJC5mbi5zZXJpYWxpemVBcnJheSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciByZXN1bHQgPSBbXSwgZWw7CiAgICAkKCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh0aGlzLmdldCgwKS5lbGVtZW50cykgKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgZWwgPSAkKHRoaXMpOwogICAgICBpZiAoIChlbC5hdHRyKCd0eXBlJykgIT09ICdyYWRpbycgfHwgZWwuaXMoJzpjaGVja2VkJykpICYmICEoZWwuYXR0cigndHlwZScpID09PSAnY2hlY2tib3gnICYmICFlbC5pcygnOmNoZWNrZWQnKSkpIHsKICAgICAgICByZXN1bHQucHVzaCh7CiAgICAgICAgICBuYW1lOiBlbC5hdHRyKCduYW1lJyksCiAgICAgICAgICB2YWx1ZTogZWwudmFsKCkKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vICMjIyAkLmZuLnNlcmlhbGl6ZQogIC8vCiAgLy8KICAvLyBFbmNvZGUgYSBzZXQgb2YgZm9ybSBlbGVtZW50cyBhcyBhIHN0cmluZyBmb3Igc3VibWlzc2lvbgogIC8vCiAgLy8gKkV4YW1wbGU6KgogIC8vCiAgLy8gICAgICQoJyNsb2dpbl9mb3JtJykuc2VyaWFsaXplKCk7CiAgLy8KICAvLyAgcmV0dXJucwogIC8vCiAgLy8gICAgICJlbWFpbD1rb3NzJTQwbm9jb3JwLm1lJnBhc3N3b3JkPTEyMzQ1NiIKICAvLwogICQuZm4uc2VyaWFsaXplID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgdGhpcy5zZXJpYWxpemVBcnJheSgpLmZvckVhY2goZnVuY3Rpb24gKGVsbSkgewogICAgICByZXN1bHQucHVzaCggZW5jb2RlVVJJQ29tcG9uZW50KGVsbS5uYW1lKSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudChlbG0udmFsdWUpICk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQuam9pbignJicpOwogIH07CgogIC8vICMjIyAkLmZuLnN1Ym1pdAogIC8vCiAgLy8gQmluZCBvciB0cmlnZ2VyIHRoZSBzdWJtaXQgZXZlbnQgZm9yIGEgZm9ybQogIC8vCiAgLy8gKkV4YW1wbGVzOioKICAvLwogIC8vIFRvIGJpbmQgYSBoYW5kbGVyIGZvciB0aGUgc3VibWl0IGV2ZW50OgogIC8vCiAgLy8gICAgICQoJyNsb2dpbl9mb3JtJykuc3VibWl0KGZ1bmN0aW9uIChlKSB7CiAgLy8gICAgICAgICBhbGVydCgnRm9ybSB3YXMgc3VibWl0dGVkIScpOwogIC8vICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogIC8vICAgICB9KTsKICAvLwogIC8vIFRvIHRyaWdnZXIgZm9ybSBzdWJtaXQ6CiAgLy8KICAvLyAgICAgJCgnI2xvZ2luX2Zvcm0nKS5zdWJtaXQoKTsKICAvLwogICQuZm4uc3VibWl0ID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICBpZiAoY2FsbGJhY2spIHRoaXMuYmluZCgnc3VibWl0JywgY2FsbGJhY2spCiAgICBlbHNlIGlmICh0aGlzLmxlbmd0aCkgewogICAgICB2YXIgZXZlbnQgPSAkLkV2ZW50KCdzdWJtaXQnKTsKICAgICAgdGhpcy5lcSgwKS50cmlnZ2VyKGV2ZW50KTsKICAgICAgaWYgKCFldmVudC5kZWZhdWx0UHJldmVudGVkKSB0aGlzLmdldCgwKS5zdWJtaXQoKQogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfQoKfSkoWmVwdG8pOwovLyAgICAgWmVwdG8uanMKLy8gICAgIChjKSAyMDEwLCAyMDExIFRob21hcyBGdWNocwovLyAgICAgWmVwdG8uanMgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCgooZnVuY3Rpb24oJCl7CiAgdmFyIHRvdWNoID0ge30sIHRvdWNoVGltZW91dDsKCiAgZnVuY3Rpb24gcGFyZW50SWZUZXh0KG5vZGUpewogICAgcmV0dXJuICd0YWdOYW1lJyBpbiBub2RlID8gbm9kZSA6IG5vZGUucGFyZW50Tm9kZTsKICB9CgogIGZ1bmN0aW9uIHN3aXBlRGlyZWN0aW9uKHgxLCB4MiwgeTEsIHkyKXsKICAgIHZhciB4RGVsdGEgPSBNYXRoLmFicyh4MSAtIHgyKSwgeURlbHRhID0gTWF0aC5hYnMoeTEgLSB5Mik7CiAgICBpZiAoeERlbHRhID49IHlEZWx0YSkgewogICAgICByZXR1cm4gKHgxIC0geDIgPiAwID8gJ0xlZnQnIDogJ1JpZ2h0Jyk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gKHkxIC0geTIgPiAwID8gJ1VwJyA6ICdEb3duJyk7CiAgICB9CiAgfQoKICB2YXIgbG9uZ1RhcERlbGF5ID0gNzUwOwogIGZ1bmN0aW9uIGxvbmdUYXAoKXsKICAgIGlmICh0b3VjaC5sYXN0ICYmIChEYXRlLm5vdygpIC0gdG91Y2gubGFzdCA+PSBsb25nVGFwRGVsYXkpKSB7CiAgICAgICQodG91Y2gudGFyZ2V0KS50cmlnZ2VyKCdsb25nVGFwJyk7CiAgICAgIHRvdWNoID0ge307CiAgICB9CiAgfQoKICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpewogICAgJChkb2N1bWVudC5ib2R5KS5iaW5kKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24oZSl7CiAgICAgIHZhciBub3cgPSBEYXRlLm5vdygpLCBkZWx0YSA9IG5vdyAtICh0b3VjaC5sYXN0IHx8IG5vdyk7CiAgICAgIHRvdWNoLnRhcmdldCA9IHBhcmVudElmVGV4dChlLnRvdWNoZXNbMF0udGFyZ2V0KTsKICAgICAgdG91Y2hUaW1lb3V0ICYmIGNsZWFyVGltZW91dCh0b3VjaFRpbWVvdXQpOwogICAgICB0b3VjaC54MSA9IGUudG91Y2hlc1swXS5wYWdlWDsKICAgICAgdG91Y2gueTEgPSBlLnRvdWNoZXNbMF0ucGFnZVk7CiAgICAgIGlmIChkZWx0YSA+IDAgJiYgZGVsdGEgPD0gMjUwKSB0b3VjaC5pc0RvdWJsZVRhcCA9IHRydWU7CiAgICAgIHRvdWNoLmxhc3QgPSBub3c7CiAgICAgIHNldFRpbWVvdXQobG9uZ1RhcCwgbG9uZ1RhcERlbGF5KTsKICAgIH0pLmJpbmQoJ3RvdWNobW92ZScsIGZ1bmN0aW9uKGUpewogICAgICB0b3VjaC54MiA9IGUudG91Y2hlc1swXS5wYWdlWDsKICAgICAgdG91Y2gueTIgPSBlLnRvdWNoZXNbMF0ucGFnZVk7CiAgICB9KS5iaW5kKCd0b3VjaGVuZCcsIGZ1bmN0aW9uKGUpewogICAgICBpZiAodG91Y2guaXNEb3VibGVUYXApIHsKICAgICAgICAkKHRvdWNoLnRhcmdldCkudHJpZ2dlcignZG91YmxlVGFwJyk7CiAgICAgICAgdG91Y2ggPSB7fTsKICAgICAgfSBlbHNlIGlmICh0b3VjaC54MiA+IDAgfHwgdG91Y2gueTIgPiAwKSB7CiAgICAgICAgKE1hdGguYWJzKHRvdWNoLngxIC0gdG91Y2gueDIpID4gMzAgfHwgTWF0aC5hYnModG91Y2gueTEgLSB0b3VjaC55MikgPiAzMCkgICYmCiAgICAgICAgICAkKHRvdWNoLnRhcmdldCkudHJpZ2dlcignc3dpcGUnKSAmJgogICAgICAgICAgJCh0b3VjaC50YXJnZXQpLnRyaWdnZXIoJ3N3aXBlJyArIChzd2lwZURpcmVjdGlvbih0b3VjaC54MSwgdG91Y2gueDIsIHRvdWNoLnkxLCB0b3VjaC55MikpKTsKICAgICAgICB0b3VjaC54MSA9IHRvdWNoLngyID0gdG91Y2gueTEgPSB0b3VjaC55MiA9IHRvdWNoLmxhc3QgPSAwOwogICAgICB9IGVsc2UgaWYgKCdsYXN0JyBpbiB0b3VjaCkgewogICAgICAgIHRvdWNoVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsKICAgICAgICAgIHRvdWNoVGltZW91dCA9IG51bGw7CiAgICAgICAgICAkKHRvdWNoLnRhcmdldCkudHJpZ2dlcigndGFwJykKICAgICAgICAgIHRvdWNoID0ge307CiAgICAgICAgfSwgMjUwKTsKICAgICAgfQogICAgfSkuYmluZCgndG91Y2hjYW5jZWwnLCBmdW5jdGlvbigpeyB0b3VjaCA9IHt9IH0pOwogIH0pOwoKICBbJ3N3aXBlJywgJ3N3aXBlTGVmdCcsICdzd2lwZVJpZ2h0JywgJ3N3aXBlVXAnLCAnc3dpcGVEb3duJywgJ2RvdWJsZVRhcCcsICd0YXAnLCAnbG9uZ1RhcCddLmZvckVhY2goZnVuY3Rpb24obSl7CiAgICAkLmZuW21dID0gZnVuY3Rpb24oY2FsbGJhY2speyByZXR1cm4gdGhpcy5iaW5kKG0sIGNhbGxiYWNrKSB9CiAgfSk7Cn0pKFplcHRvKTsK"},"script/couchdbplugin.js":{"content_type":"application/javascript","revpos":6,"data":"dmFyIENvdWNoRGJQbHVnaW4gPSB7CiAgIHN0YXJ0ZWQ6IGZhbHNlLAogICBnZXRTeW5jUG9pbnQ6IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZmFpbHVyZUNhbGxiYWNrKSB7CiAgICAgcmV0dXJuIFBob25lR2FwLmV4ZWMoc3VjY2Vzc0NhbGxiYWNrLAogICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVDYWxsYmFjaywKICAgICAgICAgICAgICAgICAgICAgICAgICAnQ291Y2hEYlBsdWdpbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgJ2dldFN5bmNQb2ludCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgW10KICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgIH0sCiAgIHNhdmU6IGZ1bmN0aW9uKGltYWdlRG9jLCBzdWNjZXNzQ2FsbGJhY2ssIGZhaWx1cmVDYWxsYmFjaykgewogICAgICQuYWpheCh7CiAgICAgICB0eXBlOiAnUE9TVCcsCiAgICAgICB1cmw6ICcvcGhvdG9zaGFyZScsCiAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShpbWFnZURvYyksCiAgICAgICBkYXRhVHlwZTogJ2pzb24nLAogICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgIHN1Y2Nlc3M6IHN1Y2Nlc3NDYWxsYmFjaywKICAgICAgIGVycm9yOiBmYWlsdXJlQ2FsbGJhY2sKICAgICB9KTsKICAgfQp9Cg=="}}}
